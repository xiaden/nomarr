import{t as e}from"./Stack-BCPoueSH.js";import"./List-CfWp4vvT.js";import{a as t,i as n,n as r,o as i,r as a,s as o,t as s}from"./TextField-2jnP7VVO.js";import{t as c}from"./useControlled-CGoMmTwl.js";import{t as l}from"./Popper-T4bLPyqh.js";import{t as u}from"./Chip-BtGJIN8e.js";import{t as d}from"./MenuItem-BlxDxlnT.js";import"./listItemTextClasses-DGkxi7I8.js";import{$t as f,Bt as p,D as m,Dn as h,Dt as g,Et as _,G as v,It as ee,J as y,Kt as b,Mt as x,Pt as S,Tn as C,Vt as w,Wt as te,Yt as T,_ as E,_t as D,a as ne,b as O,bt as k,cn as A,ct as j,dt as M,et as re,f as N,gt as P,h as ie,ht as F,ln as I,mn as L,o as ae,p as oe,pt as se,q as ce,qt as R,rt as le,st as z,tn as ue,tt as de,un as B,ut as fe,v as pe,vt as me,x as he,y as ge,zt as V}from"./index-GbBoqRhg.js";import{t as _e}from"./useConfirmDialog-D0aLOh3U.js";import{t as ve}from"./ServerFilePicker-BSvSWvUO.js";import{t as H}from"./useNotification-CvgZJFlJ.js";function ye(e){return I(`PrivateSwitchBase`,e)}A(`PrivateSwitchBase`,[`root`,`checked`,`disabled`,`input`,`edgeStart`,`edgeEnd`]);var U=h(C()),W=h(L()),G=e=>{let{classes:t,checked:n,disabled:r,edge:i}=e;return f({root:[`root`,n&&`checked`,r&&`disabled`,i&&`edge${w(i)}`],input:[`input`]},ye,t)},be=b(D,{name:`MuiSwitchBase`})({padding:9,borderRadius:`50%`,variants:[{props:{edge:`start`,size:`small`},style:{marginLeft:-3}},{props:({edge:e,ownerState:t})=>e===`start`&&t.size!==`small`,style:{marginLeft:-12}},{props:{edge:`end`,size:`small`},style:{marginRight:-3}},{props:({edge:e,ownerState:t})=>e===`end`&&t.size!==`small`,style:{marginRight:-12}}]}),K=b(`input`,{name:`MuiSwitchBase`,shouldForwardProp:R})({cursor:`inherit`,position:`absolute`,opacity:0,width:`100%`,height:`100%`,top:0,left:0,margin:0,padding:0,zIndex:1}),q=U.forwardRef(function(e,n){let{autoFocus:r,checked:i,checkedIcon:a,defaultChecked:o,disabled:s,disableFocusRipple:l=!1,edge:u=!1,icon:d,id:f,inputProps:p,inputRef:m,name:h,onBlur:g,onChange:_,onFocus:v,readOnly:ee,required:y=!1,tabIndex:b,type:x,value:S,slots:C={},slotProps:w={},...te}=e,[T,E]=c({controlled:i,default:!!o,name:`SwitchBase`,state:`checked`}),D=t(),ne=e=>{v&&v(e),D&&D.onFocus&&D.onFocus(e)},O=e=>{g&&g(e),D&&D.onBlur&&D.onBlur(e)},A=e=>{if(e.nativeEvent.defaultPrevented||ee)return;let t=e.target.checked;E(t),_&&_(e,t)},j=s;D&&j===void 0&&(j=D.disabled);let M=x===`checkbox`||x===`radio`,re={...e,checked:T,disabled:j,disableFocusRipple:l,edge:u},N=G(re),P={slots:C,slotProps:{input:p,...w}},[ie,F]=k(`root`,{ref:n,elementType:be,className:N.root,shouldForwardComponentProp:!0,externalForwardedProps:{...P,component:`span`,...te},getSlotProps:e=>({...e,onFocus:t=>{e.onFocus?.(t),ne(t)},onBlur:t=>{e.onBlur?.(t),O(t)}}),ownerState:re,additionalProps:{centerRipple:!0,focusRipple:!l,disabled:j,role:void 0,tabIndex:null}}),[I,L]=k(`input`,{ref:m,elementType:K,className:N.input,externalForwardedProps:P,getSlotProps:e=>({...e,onChange:t=>{e.onChange?.(t),A(t)}}),ownerState:re,additionalProps:{autoFocus:r,checked:i,defaultChecked:o,disabled:j,id:M?f:void 0,name:h,readOnly:ee,required:y,tabIndex:b,type:x,...x===`checkbox`&&S===void 0?{}:{value:S}}});return(0,W.jsxs)(ie,{...F,children:[(0,W.jsx)(I,{...L}),T?a:d]})}),xe=V((0,W.jsx)(`path`,{d:`M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z`}),`CheckBoxOutlineBlank`),J=V((0,W.jsx)(`path`,{d:`M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z`}),`CheckBox`),Se=V((0,W.jsx)(`path`,{d:`M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z`}),`IndeterminateCheckBox`);function Ce(e){return I(`MuiCheckbox`,e)}var we=A(`MuiCheckbox`,[`root`,`checked`,`disabled`,`indeterminate`,`colorPrimary`,`colorSecondary`,`sizeSmall`,`sizeMedium`]),Te=e=>{let{classes:t,indeterminate:n,color:r,size:i}=e,a=f({root:[`root`,n&&`indeterminate`,`color${w(r)}`,`size${w(i)}`]},Ce,t);return{...t,...a}},Ee=b(q,{shouldForwardProp:e=>R(e)||e===`classes`,name:`MuiCheckbox`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${w(n.size)}`],n.color!==`default`&&t[`color${w(n.color)}`]]}})(p(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:`default`,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(P()).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(P()).map(([t])=>({props:{color:t},style:{[`&.${we.checked}, &.${we.indeterminate}`]:{color:(e.vars||e).palette[t].main},[`&.${we.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:`transparent`}}}}]}))),De=(0,W.jsx)(J,{}),Oe=(0,W.jsx)(xe,{}),ke=(0,W.jsx)(Se,{}),Ae=U.forwardRef(function(e,t){let n=te({props:e,name:`MuiCheckbox`}),{checkedIcon:r=De,color:i=`primary`,icon:a=Oe,indeterminate:s=!1,indeterminateIcon:c=ke,inputProps:l,size:u=`medium`,disableRipple:d=!1,className:f,slots:p={},slotProps:m={},...h}=n,g=s?c:a,_=s?c:r,v={...n,disableRipple:d,color:i,indeterminate:s,size:u},ee=Te(v),y=m.input??l,[b,x]=k(`root`,{ref:t,elementType:Ee,className:B(ee.root,f),shouldForwardComponentProp:!0,externalForwardedProps:{slots:p,slotProps:m,...h},ownerState:v,additionalProps:{type:`checkbox`,icon:U.cloneElement(g,{fontSize:g.props.fontSize??u}),checkedIcon:U.cloneElement(_,{fontSize:_.props.fontSize??u}),disableRipple:d,slots:p,slotProps:{input:o(typeof y==`function`?y(v):y,{"data-indeterminate":s})}}});return(0,W.jsx)(b,{...x,classes:ee})});function je(e){return I(`MuiFormControlLabel`,e)}var Y=A(`MuiFormControlLabel`,[`root`,`labelPlacementStart`,`labelPlacementTop`,`labelPlacementBottom`,`disabled`,`label`,`error`,`required`,`asterisk`]),X=e=>{let{classes:t,disabled:n,labelPlacement:r,error:i,required:a}=e;return f({root:[`root`,n&&`disabled`,`labelPlacement${w(r)}`,i&&`error`,a&&`required`],label:[`label`,n&&`disabled`],asterisk:[`asterisk`,i&&`error`]},je,t)};const Z=b(`label`,{name:`MuiFormControlLabel`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${Y.label}`]:t.label},t.root,t[`labelPlacement${w(n.labelPlacement)}`]]}})(p(({theme:e})=>({display:`inline-flex`,alignItems:`center`,cursor:`pointer`,verticalAlign:`middle`,WebkitTapHighlightColor:`transparent`,marginLeft:-11,marginRight:16,[`&.${Y.disabled}`]:{cursor:`default`},[`& .${Y.label}`]:{[`&.${Y.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:`start`},style:{flexDirection:`row-reverse`,marginRight:-11}},{props:{labelPlacement:`top`},style:{flexDirection:`column-reverse`}},{props:{labelPlacement:`bottom`},style:{flexDirection:`column`}},{props:({labelPlacement:e})=>e===`start`||e===`top`||e===`bottom`,style:{marginLeft:16}}]})));var Q=b(`span`,{name:`MuiFormControlLabel`,slot:`Asterisk`})(p(({theme:e})=>({[`&.${Y.error}`]:{color:(e.vars||e).palette.error.main}}))),Me=U.forwardRef(function(e,n){let r=te({props:e,name:`MuiFormControlLabel`}),{checked:a,className:o,componentsProps:s={},control:c,disabled:l,disableTypography:u,inputRef:d,label:f,labelPlacement:p=`end`,name:m,onChange:h,required:g,slots:_={},slotProps:v={},value:ee,...y}=r,b=t(),x=l??c.props.disabled??b?.disabled,S=g??c.props.required,C={disabled:x,required:S};[`checked`,`name`,`onChange`,`value`,`inputRef`].forEach(e=>{c.props[e]===void 0&&r[e]!==void 0&&(C[e]=r[e])});let w=i({props:r,muiFormControl:b,states:[`error`]}),T={...r,disabled:x,labelPlacement:p,required:S,error:w.error},E=X(T),[D,ne]=k(`typography`,{elementType:M,externalForwardedProps:{slots:_,slotProps:{...s,...v}},ownerState:T}),O=f;return O!=null&&O.type!==M&&!u&&(O=(0,W.jsx)(D,{component:`span`,...ne,className:B(E.label,ne?.className),children:O})),(0,W.jsxs)(Z,{className:B(E.root,o),ownerState:T,ref:n,...y,children:[U.cloneElement(c,C),S?(0,W.jsxs)(`div`,{children:[O,(0,W.jsxs)(Q,{ownerState:T,"aria-hidden":!0,className:E.asterisk,children:[` `,`*`]})]}):O]})});function Ne(e){return I(`MuiTooltip`,e)}var $=A(`MuiTooltip`,[`popper`,`popperInteractive`,`popperArrow`,`popperClose`,`tooltip`,`tooltipArrow`,`touch`,`tooltipPlacementLeft`,`tooltipPlacementRight`,`tooltipPlacementTop`,`tooltipPlacementBottom`,`arrow`]);function Pe(e){return Math.round(e*1e5)/1e5}var Fe=e=>{let{classes:t,disableInteractive:n,arrow:r,touch:i,placement:a}=e;return f({popper:[`popper`,!n&&`popperInteractive`,r&&`popperArrow`],tooltip:[`tooltip`,r&&`tooltipArrow`,i&&`touch`,`tooltipPlacement${w(a.split(`-`)[0])}`],arrow:[`arrow`]},Ne,t)},Ie=b(l,{name:`MuiTooltip`,slot:`Popper`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.popper,!n.disableInteractive&&t.popperInteractive,n.arrow&&t.popperArrow,!n.open&&t.popperClose]}})(p(({theme:e})=>({zIndex:(e.vars||e).zIndex.tooltip,pointerEvents:`none`,variants:[{props:({ownerState:e})=>!e.disableInteractive,style:{pointerEvents:`auto`}},{props:({open:e})=>!e,style:{pointerEvents:`none`}},{props:({ownerState:e})=>e.arrow,style:{[`&[data-popper-placement*="bottom"] .${$.arrow}`]:{top:0,marginTop:`-0.71em`,"&::before":{transformOrigin:`0 100%`}},[`&[data-popper-placement*="top"] .${$.arrow}`]:{bottom:0,marginBottom:`-0.71em`,"&::before":{transformOrigin:`100% 0`}},[`&[data-popper-placement*="right"] .${$.arrow}`]:{height:`1em`,width:`0.71em`,"&::before":{transformOrigin:`100% 100%`}},[`&[data-popper-placement*="left"] .${$.arrow}`]:{height:`1em`,width:`0.71em`,"&::before":{transformOrigin:`0 0`}}}},{props:({ownerState:e})=>e.arrow&&!e.isRtl,style:{[`&[data-popper-placement*="right"] .${$.arrow}`]:{left:0,marginLeft:`-0.71em`}}},{props:({ownerState:e})=>e.arrow&&!!e.isRtl,style:{[`&[data-popper-placement*="right"] .${$.arrow}`]:{right:0,marginRight:`-0.71em`}}},{props:({ownerState:e})=>e.arrow&&!e.isRtl,style:{[`&[data-popper-placement*="left"] .${$.arrow}`]:{right:0,marginRight:`-0.71em`}}},{props:({ownerState:e})=>e.arrow&&!!e.isRtl,style:{[`&[data-popper-placement*="left"] .${$.arrow}`]:{left:0,marginLeft:`-0.71em`}}}]}))),Le=b(`div`,{name:`MuiTooltip`,slot:`Tooltip`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.tooltip,n.touch&&t.touch,n.arrow&&t.tooltipArrow,t[`tooltipPlacement${w(n.placement.split(`-`)[0])}`]]}})(p(({theme:e})=>({backgroundColor:e.vars?e.vars.palette.Tooltip.bg:e.alpha(e.palette.grey[700],.92),borderRadius:(e.vars||e).shape.borderRadius,color:(e.vars||e).palette.common.white,fontFamily:e.typography.fontFamily,padding:`4px 8px`,fontSize:e.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:`break-word`,fontWeight:e.typography.fontWeightMedium,[`.${$.popper}[data-popper-placement*="left"] &`]:{transformOrigin:`right center`},[`.${$.popper}[data-popper-placement*="right"] &`]:{transformOrigin:`left center`},[`.${$.popper}[data-popper-placement*="top"] &`]:{transformOrigin:`center bottom`,marginBottom:`14px`},[`.${$.popper}[data-popper-placement*="bottom"] &`]:{transformOrigin:`center top`,marginTop:`14px`},variants:[{props:({ownerState:e})=>e.arrow,style:{position:`relative`,margin:0}},{props:({ownerState:e})=>e.touch,style:{padding:`8px 16px`,fontSize:e.typography.pxToRem(14),lineHeight:`${Pe(16/14)}em`,fontWeight:e.typography.fontWeightRegular}},{props:({ownerState:e})=>!e.isRtl,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginRight:`14px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginLeft:`14px`}}},{props:({ownerState:e})=>!e.isRtl&&e.touch,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginRight:`24px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginLeft:`24px`}}},{props:({ownerState:e})=>!!e.isRtl,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginLeft:`14px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginRight:`14px`}}},{props:({ownerState:e})=>!!e.isRtl&&e.touch,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginLeft:`24px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginRight:`24px`}}},{props:({ownerState:e})=>e.touch,style:{[`.${$.popper}[data-popper-placement*="top"] &`]:{marginBottom:`24px`}}},{props:({ownerState:e})=>e.touch,style:{[`.${$.popper}[data-popper-placement*="bottom"] &`]:{marginTop:`24px`}}}]}))),Re=b(`span`,{name:`MuiTooltip`,slot:`Arrow`})(p(({theme:e})=>({overflow:`hidden`,position:`absolute`,width:`1em`,height:`0.71em`,boxSizing:`border-box`,color:e.vars?e.vars.palette.Tooltip.bg:e.alpha(e.palette.grey[700],.9),"&::before":{content:`""`,margin:`auto`,display:`block`,width:`100%`,height:`100%`,backgroundColor:`currentColor`,transform:`rotate(45deg)`}}))),ze=!1,Be=new _,Ve={x:0,y:0};function He(e,t){return(n,...r)=>{t&&t(n,...r),e(n,...r)}}var Ue=U.forwardRef(function(e,t){let n=te({props:e,name:`MuiTooltip`}),{arrow:r=!1,children:i,classes:a,components:o={},componentsProps:s={},describeChild:u=!1,disableFocusListener:d=!1,disableHoverListener:f=!1,disableInteractive:p=!1,disableTouchListener:m=!1,enterDelay:h=100,enterNextDelay:_=0,enterTouchDelay:v=700,followCursor:y=!1,id:b,leaveDelay:C=0,leaveTouchDelay:w=1500,onClose:E,onOpen:D,open:ne,placement:O=`bottom`,PopperComponent:A,PopperProps:j={},slotProps:M={},slots:re={},title:N,TransitionComponent:P,TransitionProps:ie,...F}=n,I=U.isValidElement(i)?i:(0,W.jsx)(`span`,{children:i}),L=T(),ae=ue(),[oe,se]=U.useState(),[ce,R]=U.useState(null),z=U.useRef(!1),de=p||y,pe=g(),he=g(),ge=g(),V=g(),[_e,ve]=c({controlled:ne,default:!1,name:`Tooltip`,state:`open`}),H=_e,ye=ee(b),G=U.useRef(),be=S(()=>{G.current!==void 0&&(document.body.style.WebkitUserSelect=G.current,G.current=void 0),V.clear()});U.useEffect(()=>be,[be]);let K=e=>{Be.clear(),ze=!0,ve(!0),D&&!H&&D(e)},q=S(e=>{Be.start(800+C,()=>{ze=!1}),ve(!1),E&&H&&E(e),pe.start(L.transitions.duration.shortest,()=>{z.current=!1})}),xe=e=>{z.current&&e.type!==`touchstart`||(oe&&oe.removeAttribute(`title`),he.clear(),ge.clear(),h||ze&&_?he.start(ze?_:h,()=>{K(e)}):K(e))},J=e=>{he.clear(),ge.start(C,()=>{q(e)})},[,Se]=U.useState(!1),Ce=e=>{me(e.target)||(Se(!1),J(e))},we=e=>{oe||se(e.currentTarget),me(e.target)&&(Se(!0),xe(e))},Te=e=>{z.current=!0;let t=I.props;t.onTouchStart&&t.onTouchStart(e)},Ee=e=>{Te(e),ge.clear(),pe.clear(),be(),G.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect=`none`,V.start(v,()=>{document.body.style.WebkitUserSelect=G.current,xe(e)})},De=e=>{I.props.onTouchEnd&&I.props.onTouchEnd(e),be(),ge.start(w,()=>{q(e)})};U.useEffect(()=>{if(!H)return;function e(e){e.key===`Escape`&&q(e)}return document.addEventListener(`keydown`,e),()=>{document.removeEventListener(`keydown`,e)}},[q,H]);let Oe=x(fe(I),se,t);!N&&N!==0&&(H=!1);let ke=U.useRef(),Ae=e=>{let t=I.props;t.onMouseMove&&t.onMouseMove(e),Ve={x:e.clientX,y:e.clientY},ke.current&&ke.current.update()},je={},Y=typeof N==`string`;u?(je.title=!H&&Y&&!f?N:null,je[`aria-describedby`]=H?ye:null):(je[`aria-label`]=Y?N:null,je[`aria-labelledby`]=H&&!Y?ye:null);let X={...je,...F,...I.props,className:B(F.className,I.props.className),onTouchStart:Te,ref:Oe,...y?{onMouseMove:Ae}:{}},Z={};m||(X.onTouchStart=Ee,X.onTouchEnd=De),f||(X.onMouseOver=He(xe,X.onMouseOver),X.onMouseLeave=He(J,X.onMouseLeave),de||(Z.onMouseOver=xe,Z.onMouseLeave=J)),d||(X.onFocus=He(we,X.onFocus),X.onBlur=He(Ce,X.onBlur),de||(Z.onFocus=we,Z.onBlur=Ce));let Q={...n,isRtl:ae,arrow:r,disableInteractive:de,placement:O,PopperComponentProp:A,touch:z.current},Me=typeof M.popper==`function`?M.popper(Q):M.popper,Ne=U.useMemo(()=>{let e=[{name:`arrow`,enabled:!!ce,options:{element:ce,padding:4}}];return j.popperOptions?.modifiers&&(e=e.concat(j.popperOptions.modifiers)),Me?.popperOptions?.modifiers&&(e=e.concat(Me.popperOptions.modifiers)),{...j.popperOptions,...Me?.popperOptions,modifiers:e}},[ce,j.popperOptions,Me?.popperOptions]),$=Fe(Q),Pe=typeof M.transition==`function`?M.transition(Q):M.transition,Ue={slots:{popper:o.Popper,transition:o.Transition??P,tooltip:o.Tooltip,arrow:o.Arrow,...re},slotProps:{arrow:M.arrow??s.arrow,popper:{...j,...Me??s.popper},tooltip:M.tooltip??s.tooltip,transition:{...ie,...Pe??s.transition}}},[We,Ge]=k(`popper`,{elementType:Ie,externalForwardedProps:Ue,ownerState:Q,className:B($.popper,j?.className)}),[Ke,qe]=k(`transition`,{elementType:le,externalForwardedProps:Ue,ownerState:Q}),[Je,Ye]=k(`tooltip`,{elementType:Le,className:$.tooltip,externalForwardedProps:Ue,ownerState:Q}),[Xe,Ze]=k(`arrow`,{elementType:Re,className:$.arrow,externalForwardedProps:Ue,ownerState:Q,ref:R});return(0,W.jsxs)(U.Fragment,{children:[U.cloneElement(I,X),(0,W.jsx)(We,{as:A??l,placement:O,anchorEl:y?{getBoundingClientRect:()=>({top:Ve.y,left:Ve.x,right:Ve.x,bottom:Ve.y,width:0,height:0})}:oe,popperRef:ke,open:oe?H:!1,id:ye,transition:!0,...Z,...Ge,popperOptions:Ne,children:({TransitionProps:e})=>(0,W.jsx)(Ke,{timeout:L.transitions.duration.shorter,...e,...qe,children:(0,W.jsxs)(Je,{...Ye,children:[N,r?(0,W.jsx)(Xe,{...Ze}):null]})})})]})});function We(){let{showSuccess:t}=H(),{confirm:i,isOpen:o,options:c,handleConfirm:l,handleCancel:f}=_e(),[p,h]=(0,U.useState)([]),[g,_]=(0,U.useState)(!0),[ee,y]=(0,U.useState)(null),[b,x]=(0,U.useState)(!1),[S,C]=(0,U.useState)(null),[w,te]=(0,U.useState)(null),[T,D]=(0,U.useState)(null),[k,A]=(0,U.useState)(``),[P,F]=(0,U.useState)(``),[I,L]=(0,U.useState)(!0),[ae,se]=(0,U.useState)(`off`),[R,le]=(0,U.useState)(`full`),[ue,B]=(0,U.useState)(!1),[fe,me]=(0,U.useState)(null),[V,ye]=(0,U.useState)({}),[G,be]=(0,U.useState)(`full`),K=(0,U.useCallback)(async()=>{try{_(!0),y(null),h(await E())}catch(e){y(e instanceof Error?e.message:`Failed to load libraries`),console.error(`[LibraryManagement] Load error:`,e)}finally{_(!1)}},[]),q=(0,U.useCallback)(async()=>{try{let e=await E();h(t=>{if(t.length!==e.length)return e;let n=new Map(e.map(e=>[e.library_id,e])),r=!1;for(let e of t){let t=n.get(e.library_id);if(!t){r=!0;break}if(e.scanStatus!==t.scanStatus||e.scanProgress!==t.scanProgress||e.scanTotal!==t.scanTotal||e.scanError!==t.scanError||e.scannedAt!==t.scannedAt||e.fileCount!==t.fileCount||e.folderCount!==t.folderCount){r=!0;break}}return r?t.map(e=>{let t=n.get(e.library_id);return!t||e.scanStatus===t.scanStatus&&e.scanProgress===t.scanProgress&&e.scanTotal===t.scanTotal&&e.scanError===t.scanError&&e.scannedAt===t.scannedAt&&e.fileCount===t.fileCount&&e.folderCount===t.folderCount?e:t}):t})}catch(e){console.error(`[LibraryManagement] Refresh error:`,e)}},[]),xe=async()=>{try{D((await ne()).library_root||null)}catch(e){console.error(`[LibraryManagement] Failed to load config:`,e)}};(0,U.useEffect)(()=>{K(),xe()},[K]),(0,U.useEffect)(()=>{let e=!0,t=null,n=async()=>{try{let n=await m();if(!e)return;n.is_busy?t||=setInterval(()=>{q()},500):t&&(clearInterval(t),t=null,q())}catch(e){console.error(`[LibraryManagement] Failed to check work status:`,e)}};n();let r=setInterval(n,5e3);return()=>{e=!1,t&&clearInterval(t),clearInterval(r)}},[q]);let J=e=>{if(!T)return!1;let t=T.replace(/\/+$/,``);return!e.replace(/\/+$/,``).startsWith(t)},Se=()=>{A(``),F(``),L(!0),se(`off`),le(`full`),be(`full`),B(!1),x(!1),C(null)},Ce=()=>{Se(),x(!0)},we=e=>{A(e.name),F(e.rootPath),L(e.isEnabled),se(e.watchMode),le(e.fileWriteMode),be(e.fileWriteMode),C(e.library_id),x(!1)},Te=async()=>{if(!P.trim()){y(`Path is required`);return}try{y(null),await N({name:k.trim()||null,rootPath:P,isEnabled:I,watchMode:ae,fileWriteMode:R}),await K(),Se()}catch(e){y(e instanceof Error?e.message:`Failed to create library`)}},Ee=async()=>{if(S===null)return;if(!P.trim()){y(`Path is required`);return}let e=R!==G;try{if(y(null),await O(S,{name:k.trim()||void 0,rootPath:P,isEnabled:I,watchMode:ae,...e?{}:{fileWriteMode:R}}),e){let e=await he(S,R);e.requires_reconciliation&&e.affected_file_count>0&&await i({title:`Reconcile Tags?`,message:`${e.affected_file_count} files need to be rewritten with the new tag format. Reconcile now?`,severity:`info`})&&await Q(S)}await K(),Se()}catch(e){y(e instanceof Error?e.message:`Failed to update library`)}},De=async(e,n)=>{try{y(null),te(e);let r=await ge(e,n);t(r.message||`Library scan started (${r.stats?.files_queued??0} files)`),await K()}catch(e){y(e instanceof Error?e.message:`Failed to scan library`)}finally{te(null)}},Oe=async(e,t)=>{if(await i({title:`Delete Library?`,message:`Delete library "${t}"?\n\nThis will remove the library entry but will NOT delete files on disk.`,severity:`warning`}))try{y(null),await oe(e),await K()}catch(e){y(e instanceof Error?e.message:`Failed to delete library`)}},ke=async(e,n)=>{try{y(null),await O(e,{watchMode:n}),await K(),t(`File watching mode changed to ${n}`)}catch(e){y(e instanceof Error?e.message:`Failed to change watch mode`)}},je=e=>{switch(e){case`event`:return`Event`;case`poll`:return`Poll`;default:return`Off`}},Y=e=>{switch(e){case`event`:return`success`;case`poll`:return`warning`;default:return`default`}},X=e=>{switch(e){case`none`:return`None`;case`minimal`:return`Minimal`;case`full`:return`Full`}},Z=e=>{switch(e){case`none`:return`default`;case`minimal`:return`secondary`;case`full`:return`primary`}},Q=async e=>{try{y(null),me(e);let n=await pe(e);t(`Reconciled ${n.processed} files (${n.remaining} remaining, ${n.failed} failed)`);let r=await ie(e);ye(t=>({...t,[e]:{pending:r.pending_count,inProgress:r.in_progress}}))}catch(e){y(e instanceof Error?e.message:`Failed to reconcile tags`)}finally{me(null)}},Ne=async e=>{try{let t=await ie(e);ye(n=>({...n,[e]:{pending:t.pending_count,inProgress:t.in_progress}}))}catch{}},$=b||S!==null;return(0,W.jsxs)(e,{spacing:2.5,children:[(0,W.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`center`,children:[(0,W.jsx)(M,{variant:`h5`,children:`Libraries`}),!$&&(0,W.jsx)(z,{variant:`contained`,onClick:Ce,children:`+ Add Library`})]}),ee&&(0,W.jsx)(ce,{children:ee}),$&&(0,W.jsxs)(de,{children:[(0,W.jsx)(re,{title:b?`Create Library`:`Edit Library`}),(0,W.jsxs)(e,{spacing:2,children:[(0,W.jsxs)(j,{children:[(0,W.jsx)(M,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Name (optional)`}),(0,W.jsx)(s,{value:k,onChange:e=>A(e.target.value),placeholder:`Auto-generated from path if left empty`,fullWidth:!0})]}),(0,W.jsxs)(j,{children:[(0,W.jsx)(M,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Root Path`}),(0,W.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,W.jsx)(s,{value:P,onChange:e=>F(e.target.value),placeholder:`/music`,fullWidth:!0}),(0,W.jsx)(z,{variant:`outlined`,onClick:()=>B(!ue),sx:{minWidth:120},children:ue?`Hide Picker`:`Browse...`})]}),ue&&(0,W.jsx)(j,{sx:{mt:1.25,p:2,bgcolor:`background.default`,borderRadius:1,border:1,borderColor:`divider`},children:(0,W.jsx)(ve,{value:P,onChange:e=>{F(e),B(!1)},mode:`directory`,label:`Select Library Root Directory`})})]}),(0,W.jsx)(Me,{control:(0,W.jsx)(Ae,{checked:I,onChange:e=>L(e.target.checked)}),label:`Enabled`}),(0,W.jsx)(j,{children:(0,W.jsxs)(n,{fullWidth:!0,children:[(0,W.jsx)(a,{id:`watch-mode-label`,children:`File Watching`}),(0,W.jsxs)(r,{labelId:`watch-mode-label`,value:ae,label:`File Watching`,onChange:e=>se(e.target.value),children:[(0,W.jsx)(d,{value:`off`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(M,{children:[(0,W.jsx)(`strong`,{children:`Off`}),` - No automatic scanning`]}),(0,W.jsx)(M,{variant:`caption`,color:`text.secondary`,children:`Manual scans only`})]})}),(0,W.jsx)(d,{value:`event`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(M,{children:[(0,W.jsx)(`strong`,{children:`Event`}),` - Real-time file watching`]}),(0,W.jsx)(M,{variant:`caption`,color:`text.secondary`,children:`Fast (2-5s response), local filesystems only`})]})}),(0,W.jsx)(d,{value:`poll`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(M,{children:[(0,W.jsx)(`strong`,{children:`Poll`}),` - Periodic scanning`]}),(0,W.jsx)(M,{variant:`caption`,color:`text.secondary`,children:`Slower (60s interval), network-mount-safe`})]})})]})]})}),(0,W.jsx)(j,{children:(0,W.jsxs)(n,{fullWidth:!0,children:[(0,W.jsx)(a,{id:`write-mode-label`,children:`Tag Writing Mode`}),(0,W.jsxs)(r,{labelId:`write-mode-label`,value:R,label:`Tag Writing Mode`,onChange:e=>le(e.target.value),children:[(0,W.jsx)(d,{value:`none`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(M,{children:[(0,W.jsx)(`strong`,{children:`None`}),` - Don't write tags to files`]}),(0,W.jsx)(M,{variant:`caption`,color:`text.secondary`,children:`DB is source of truth; clears existing nomarr tags`})]})}),(0,W.jsx)(d,{value:`minimal`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(M,{children:[(0,W.jsx)(`strong`,{children:`Minimal`}),` - Mood tags only`]}),(0,W.jsx)(M,{variant:`caption`,color:`text.secondary`,children:`Write mood-strict, mood-regular, mood-loose`})]})}),(0,W.jsx)(d,{value:`full`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(M,{children:[(0,W.jsx)(`strong`,{children:`Full`}),` - All tags`]}),(0,W.jsx)(M,{variant:`caption`,color:`text.secondary`,children:`Write all ML-derived tags to audio files`})]})})]})]})}),(0,W.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,W.jsx)(z,{variant:`contained`,onClick:b?Te:Ee,children:b?`Create`:`Update`}),(0,W.jsx)(z,{variant:`outlined`,onClick:Se,children:`Cancel`})]})]})]}),g&&(0,W.jsx)(M,{children:`Loading libraries...`}),!g&&!$&&p.length===0&&(0,W.jsx)(de,{children:(0,W.jsx)(M,{color:`text.secondary`,textAlign:`center`,fontStyle:`italic`,children:`No libraries configured. Click "Add Library" to get started.`})}),!g&&!$&&p.length>0&&(0,W.jsx)(e,{spacing:2,children:p.map(t=>(0,W.jsxs)(de,{children:[(0,W.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`flex-start`,sx:{mb:2},children:[(0,W.jsxs)(j,{children:[(0,W.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1.25,sx:{mb:.5},children:[(0,W.jsx)(M,{variant:`h6`,children:t.name}),J(t.rootPath)&&(0,W.jsx)(u,{label:`Outside library_root`,color:`warning`,size:`small`})]}),(0,W.jsx)(M,{variant:`body2`,color:`text.secondary`,sx:{fontFamily:`monospace`},children:t.rootPath}),(0,W.jsxs)(e,{direction:`row`,spacing:2,sx:{mt:.5},children:[(0,W.jsxs)(M,{variant:`body2`,color:`text.secondary`,children:[(0,W.jsx)(`strong`,{children:t.fileCount.toLocaleString()}),` files`]}),(0,W.jsxs)(M,{variant:`body2`,color:`text.secondary`,children:[(0,W.jsx)(`strong`,{children:t.folderCount.toLocaleString()}),` folders`]})]}),t.scanStatus===`scanning`&&(0,W.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:.5},children:[(0,W.jsx)(u,{label:`Scanning...`,color:`info`,size:`small`,sx:{animation:`pulse 1.5s infinite`}}),t.scanProgress!=null&&t.scanTotal!=null&&t.scanTotal>0&&(0,W.jsxs)(M,{variant:`body2`,color:`info.main`,children:[t.scanProgress.toLocaleString(),` / `,t.scanTotal.toLocaleString(),` files`,` `,`(`,Math.round(t.scanProgress/t.scanTotal*100),`%)`]})]}),t.scanStatus===`error`&&t.scanError&&(0,W.jsxs)(M,{variant:`caption`,color:`error.main`,sx:{mt:.5},children:[`⚠ Scan error: `,t.scanError]}),J(t.rootPath)&&(0,W.jsxs)(M,{variant:`caption`,color:`warning.main`,sx:{mt:.5},children:[`⚠ This library is outside the configured library_root (`,T,`)`]}),(0,W.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:1},children:[(0,W.jsx)(M,{variant:`caption`,color:`text.secondary`,children:`File Watching:`}),(0,W.jsx)(n,{size:`small`,sx:{minWidth:120},children:(0,W.jsxs)(r,{value:t.watchMode,onChange:e=>ke(t.library_id,e.target.value),size:`small`,sx:{fontSize:`0.75rem`},disabled:w===t.library_id,children:[(0,W.jsx)(d,{value:`off`,children:`Off`}),(0,W.jsx)(d,{value:`event`,children:`Event`}),(0,W.jsx)(d,{value:`poll`,children:`Poll`})]})}),(0,W.jsx)(Ue,{title:t.watchMode===`event`?`Real-time file watching (local filesystems)`:t.watchMode===`poll`?`Periodic scanning (network-mount-safe)`:`No automatic file watching`,children:(0,W.jsx)(u,{label:je(t.watchMode),color:Y(t.watchMode),size:`small`})})]}),(0,W.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:.5},children:[(0,W.jsx)(M,{variant:`caption`,color:`text.secondary`,children:`Tag Writing:`}),(0,W.jsx)(Ue,{title:t.fileWriteMode===`full`?`All ML-derived tags written to audio files`:t.fileWriteMode===`minimal`?`Only mood tags written to audio files`:`No tags written to audio files (DB only)`,children:(0,W.jsx)(u,{label:X(t.fileWriteMode),color:Z(t.fileWriteMode),size:`small`})}),V[t.library_id]?.pending>0&&(0,W.jsx)(u,{label:`${V[t.library_id].pending} pending`,color:`warning`,size:`small`})]})]}),(0,W.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,children:[(0,W.jsx)(j,{sx:{width:8,height:8,borderRadius:`50%`,bgcolor:t.isEnabled?`success.main`:`text.disabled`}}),(0,W.jsx)(M,{variant:`body2`,color:`text.secondary`,children:t.isEnabled?`Enabled`:`Disabled`})]})]}),(0,W.jsxs)(e,{direction:`row`,spacing:1.25,flexWrap:`wrap`,children:[(0,W.jsx)(z,{variant:`outlined`,size:`small`,onClick:()=>we(t),disabled:w===t.library_id,children:`Edit`}),(0,W.jsx)(z,{variant:`outlined`,color:`success`,size:`small`,onClick:()=>De(t.library_id,`quick`),disabled:!t.isEnabled||w===t.library_id||t.scanStatus===`scanning`||J(t.rootPath)||!t.scannedAt,title:t.scannedAt?t.scanStatus===`scanning`?`Scan already in progress`:J(t.rootPath)?`Cannot scan: library is outside library_root`:`Scan only new and modified files`:`Run a Full Scan first before using Quick Scan`,children:w===t.library_id||t.scanStatus===`scanning`?`Scanning...`:`Quick Scan`}),(0,W.jsx)(z,{variant:`contained`,color:`success`,size:`small`,onClick:()=>De(t.library_id,`full`),disabled:!t.isEnabled||w===t.library_id||t.scanStatus===`scanning`||J(t.rootPath),title:t.scanStatus===`scanning`?`Scan already in progress`:J(t.rootPath)?`Cannot scan: library is outside library_root`:`Rescan all files in the library`,children:w===t.library_id||t.scanStatus===`scanning`?`Scanning...`:`Full Scan`}),(0,W.jsx)(z,{variant:`outlined`,color:`secondary`,size:`small`,onClick:()=>Q(t.library_id),disabled:!t.isEnabled||fe===t.library_id||t.scanStatus===`scanning`,title:fe===t.library_id?`Reconciling tags...`:`Write tags from database to audio files`,onMouseEnter:()=>Ne(t.library_id),children:fe===t.library_id?`Reconciling...`:`Reconcile Tags`}),(0,W.jsx)(z,{variant:`contained`,color:`error`,size:`small`,onClick:()=>Oe(t.library_id,t.name),disabled:w===t.library_id,children:`Delete`})]})]},t.library_id))}),(0,W.jsx)(v,{open:o,title:c.title,message:c.message,confirmLabel:c.confirmLabel,cancelLabel:c.cancelLabel,severity:c.severity,onConfirm:l,onCancel:f})]})}var Ge={file_write_mode:{label:`Tag Writing Mode`,description:`Controls which tags are written to audio files`,type:`select`,options:[{value:`none`,label:`None - Tags stored in database only`},{value:`minimal`,label:`Minimal - Essential tags only (artist, album, title, genre)`},{value:`full`,label:`Full - All generated tags written to files`}]},overwrite_tags:{label:`Overwrite Existing Tags`,description:`Whether to overwrite existing tags in audio files`,type:`boolean`},library_auto_tag:{label:`Auto-Tag New Files`,description:`Automatically process new files found during library scans`,type:`boolean`},library_ignore_patterns:{label:`Ignore Patterns`,description:`Comma-separated patterns to ignore during scanning (e.g., */Audiobooks/*,*.tmp)`,type:`text`},tagger_worker_count:{label:`Worker Threads`,description:`Number of parallel worker processes for tagging (0 = auto-detect)`,type:`text`},cache_idle_timeout:{label:`Cache Timeout (seconds)`,description:`How long to keep ML models in memory when idle`,type:`text`},calibrate_heads:{label:`Auto-Calibrate Heads`,description:`Automatically calibrate tag thresholds for optimal results`,type:`boolean`},calibration_repo:{label:`Calibration Repository`,description:`Git repository URL for calibration data downloads`,type:`text`}};function Ke({configKey:e,value:t,onChange:n,disabled:i}){let a=t==null?``:String(t),o=Ge[e],c=o?.label||e,l=o?.description,u=o?.type||(typeof t==`boolean`?`boolean`:`text`),f=o?.options||[];return(0,W.jsxs)(j,{sx:{display:`flex`,gap:2,alignItems:`flex-start`,py:1},children:[(0,W.jsxs)(j,{sx:{minWidth:`280px`,flexShrink:0},children:[(0,W.jsx)(M,{variant:`body2`,color:`text.primary`,sx:{fontWeight:500,mb:l?.5:0},children:c}),l&&(0,W.jsx)(M,{variant:`caption`,color:`text.secondary`,sx:{display:`block`},children:l})]}),(0,W.jsx)(j,{sx:{flex:1,maxWidth:`400px`},children:(()=>u===`select`&&f.length>0?(0,W.jsx)(r,{value:a,onChange:t=>n(e,t.target.value),disabled:i,size:`small`,fullWidth:!0,children:f.map(({value:e,label:t})=>(0,W.jsx)(d,{value:e,children:t},e))}):u===`boolean`?(0,W.jsxs)(r,{value:a,onChange:t=>n(e,t.target.value),disabled:i,size:`small`,fullWidth:!0,children:[(0,W.jsx)(d,{value:`true`,children:`true`}),(0,W.jsx)(d,{value:`false`,children:`false`})]}):(0,W.jsx)(s,{type:`text`,value:a,onChange:t=>n(e,t.target.value),disabled:i,size:`small`,fullWidth:!0,placeholder:l}))()})]})}function qe({config:t,hasChanges:n,saveLoading:r,onChange:i,onSaveAll:a}){return(0,W.jsxs)(de,{children:[(0,W.jsx)(re,{title:`Settings`}),(0,W.jsx)(M,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Changes are saved to the database and will take effect on server restart. Use "Restart Server" in Admin page to apply changes.`}),(0,W.jsx)(e,{spacing:1.875,children:Object.entries(t).map(([e,t])=>(0,W.jsx)(Ke,{configKey:e,value:t,onChange:i,disabled:r},e))}),(0,W.jsxs)(j,{sx:{mt:3.75,display:`flex`,gap:1.25,alignItems:`center`},children:[(0,W.jsx)(z,{onClick:a,variant:`contained`,disabled:!n||r,sx:{whiteSpace:`nowrap`},children:r?`Saving...`:`Save All Changes`}),n&&(0,W.jsx)(M,{variant:`body2`,color:`warning.main`,children:`Unsaved changes`})]})]})}function Je(){let{showSuccess:e,showError:t,showInfo:n}=H(),[r,i]=(0,U.useState)({}),[a,o]=(0,U.useState)({}),[s,c]=(0,U.useState)(!0),[l,u]=(0,U.useState)(null),[d,f]=(0,U.useState)(!1),[p,m]=(0,U.useState)(!1),h=async()=>{try{c(!0),u(null);let e=await ne();i(e),o(e),m(!1)}catch(e){u(e instanceof Error?e.message:`Failed to load config`),console.error(`[Config] Load error:`,e)}finally{c(!1)}};return(0,U.useEffect)(()=>{h()},[]),(0,U.useEffect)(()=>{m(Object.keys(r).some(e=>r[e]!==a[e]))},[r,a]),{config:r,loading:s,error:l,saveLoading:d,hasChanges:p,handleSaveAll:async()=>{try{f(!0);let t=[];for(let e of Object.keys(r))if(r[e]!==a[e]){let n=r[e];if(n==null||n===``)continue;await ae(e,String(n)),t.push(e)}if(t.length===0){n(`No changes to save`);return}e(`Saved ${t.length} config change(s). Use "Restart Server" in Admin page to apply.`),await h()}catch(e){t(e instanceof Error?e.message:`Failed to save config`)}finally{f(!1)}},handleChange:(e,t)=>{i(n=>({...n,[e]:t}))}}}function Ye(){let{config:t,loading:n,error:r,saveLoading:i,hasChanges:a,handleSaveAll:o,handleChange:s}=Je();return(0,W.jsxs)(y,{title:`Configuration`,children:[n&&(0,W.jsx)(F,{}),r&&(0,W.jsxs)(se,{severity:`error`,children:[`Error: `,r]}),!n&&!r&&(0,W.jsxs)(e,{spacing:2.5,children:[(0,W.jsx)(We,{}),(0,W.jsx)(qe,{config:t,hasChanges:a,saveLoading:i,onChange:s,onSaveAll:o})]})]})}export{Ye as ConfigPage};