import{t as e}from"./Stack-DoLtnbcQ.js";import{r as t,t as n}from"./Select-B5bVQCV0.js";import{t as r}from"./ExpandMore-65li7hLD.js";import{n as i,r as a,t as o}from"./AccordionSummary-BAVN3JM4.js";import{t as s}from"./TextField-Bs2H1HgS.js";import"./TableRow-tyIFvJAE.js";import{Et as c,Gn as l,Mn as u,Un as d,bt as f,c as p,ct as m,et as h,kt as g,lt as _,rt as v,s as y,wt as b,xt as x}from"./index-D3CBCd4e.js";import"./useConfirmDialog-Bbgm_gYn.js";import"./ServerFilePicker-s29CDuSq.js";import{i as S,n as C,r as w,t as T}from"./useAdminActions-7vLuMe2-.js";import{t as E}from"./useNotification-BfaSfgIA.js";var D=l(u(),1),O={file_write_mode:{label:`Tag Writing Mode`,description:`Controls which tags are written to audio files`,type:`select`,options:[{value:`none`,label:`None - Tags stored in database only`},{value:`minimal`,label:`Minimal - Essential tags only (artist, album, title, genre)`},{value:`full`,label:`Full - All generated tags written to files`}]},overwrite_tags:{label:`Overwrite Existing Tags`,description:`Whether to overwrite existing tags in audio files`,type:`boolean`},library_auto_tag:{label:`Auto-Tag New Files`,description:`Automatically process new files found during library scans`,type:`boolean`},library_ignore_patterns:{label:`Ignore Patterns`,description:`Comma-separated patterns to ignore during scanning (e.g., */Audiobooks/*,*.tmp)`,type:`text`},tagger_worker_count:{label:`Worker Threads`,description:`Number of parallel worker processes for tagging (0 = auto-detect)`,type:`text`},cache_idle_timeout:{label:`Cache Timeout (seconds)`,description:`How long to keep ML models in memory when idle`,type:`text`},calibrate_heads:{label:`Auto-Calibrate Heads`,description:`Automatically calibrate tag thresholds for optimal results`,type:`boolean`},calibration_repo:{label:`Calibration Repository`,description:`Git repository URL for calibration data downloads`,type:`text`},spotify_client_id:{label:`Spotify Client ID`,description:`From https://developer.spotify.com/dashboard - for playlist import`,type:`text`},spotify_client_secret:{label:`Spotify Client Secret`,description:`From https://developer.spotify.com/dashboard - keep this private`,type:`password`}};function k({configKey:e,value:r,onChange:i,disabled:a}){let o=r==null?``:String(r),c=O[e],l=c?.label||e,u=c?.description,d=c?.type||(typeof r==`boolean`?`boolean`:`text`),f=c?.options||[];return(0,D.jsxs)(x,{sx:{display:`flex`,gap:2,alignItems:`flex-start`,py:1},children:[(0,D.jsxs)(x,{sx:{minWidth:`280px`,flexShrink:0},children:[(0,D.jsx)(b,{variant:`body2`,color:`text.primary`,sx:{fontWeight:500,mb:u?.5:0},children:l}),u&&(0,D.jsx)(b,{variant:`caption`,color:`text.secondary`,sx:{display:`block`},children:u})]}),(0,D.jsx)(x,{sx:{flex:1,maxWidth:`400px`},children:(()=>d===`select`&&f.length>0?(0,D.jsx)(n,{value:o,onChange:t=>i(e,t.target.value),disabled:a,size:`small`,fullWidth:!0,children:f.map(({value:e,label:n})=>(0,D.jsx)(t,{value:e,children:n},e))}):d===`boolean`?(0,D.jsxs)(n,{value:o,onChange:t=>i(e,t.target.value),disabled:a,size:`small`,fullWidth:!0,children:[(0,D.jsx)(t,{value:`true`,children:`true`}),(0,D.jsx)(t,{value:`false`,children:`false`})]}):(0,D.jsx)(s,{type:d===`password`?`password`:`text`,value:o,onChange:t=>i(e,t.target.value),disabled:a,size:`small`,fullWidth:!0,placeholder:u}))()})]})}function A({config:t,hasChanges:n,saveLoading:r,onChange:i,onSaveAll:a}){return(0,D.jsxs)(_,{children:[(0,D.jsx)(m,{title:`Settings`}),(0,D.jsx)(b,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Changes are saved to the database and will take effect on server restart. Use "Restart Server" in the Admin section below to apply changes.`}),(0,D.jsx)(e,{spacing:1.875,children:Object.entries(t).map(([e,t])=>(0,D.jsx)(k,{configKey:e,value:t,onChange:i,disabled:r},e))}),(0,D.jsxs)(x,{sx:{mt:3.75,display:`flex`,gap:1.25,alignItems:`center`},children:[(0,D.jsx)(f,{onClick:a,variant:`contained`,disabled:!n||r,sx:{whiteSpace:`nowrap`},children:r?`Saving...`:`Save All Changes`}),n&&(0,D.jsx)(b,{variant:`body2`,color:`warning.main`,children:`Unsaved changes`})]})]})}var j=l(d(),1);function M(){let{showSuccess:e,showError:t,showInfo:n}=E(),[r,i]=(0,j.useState)({}),[a,o]=(0,j.useState)({}),[s,c]=(0,j.useState)(!0),[l,u]=(0,j.useState)(null),[d,f]=(0,j.useState)(!1),[m,h]=(0,j.useState)(!1),g=async()=>{try{c(!0),u(null);let e=await y();i(e),o(e),h(!1)}catch(e){u(e instanceof Error?e.message:`Failed to load config`),console.error(`[Config] Load error:`,e)}finally{c(!1)}};return(0,j.useEffect)(()=>{g()},[]),(0,j.useEffect)(()=>{h(Object.keys(r).some(e=>r[e]!==a[e]))},[r,a]),{config:r,loading:s,error:l,saveLoading:d,hasChanges:m,handleSaveAll:async()=>{try{f(!0);let t=[];for(let e of Object.keys(r))if(r[e]!==a[e]){let n=r[e];if(n==null||n===``)continue;await p(e,String(n)),t.push(e)}if(t.length===0){n(`No changes to save`);return}e(`Saved ${t.length} config change(s). Use "Restart Server" in the Admin section to apply.`),await g()}catch(e){t(e instanceof Error?e.message:`Failed to save config`)}finally{f(!1)}},handleChange:(e,t)=>{i(n=>({...n,[e]:t}))}}}function N(){let{config:t,loading:n,error:s,saveLoading:l,hasChanges:u,handleSaveAll:d,handleChange:f}=M(),{actionLoading:p,handlePauseWorker:m,handleResumeWorker:_,handleRestart:y,dialogState:x}=T();return(0,D.jsxs)(v,{title:`Configuration`,children:[n&&(0,D.jsx)(g,{}),s&&(0,D.jsxs)(c,{severity:`error`,children:[`Error: `,s]}),!n&&!s&&(0,D.jsxs)(e,{spacing:2,children:[(0,D.jsxs)(a,{defaultExpanded:!0,disableGutters:!0,children:[(0,D.jsx)(o,{expandIcon:(0,D.jsx)(r,{}),children:(0,D.jsx)(b,{variant:`h6`,sx:{fontWeight:600},children:`Settings`})}),(0,D.jsx)(i,{children:(0,D.jsx)(A,{config:t,hasChanges:u,saveLoading:l,onChange:f,onSaveAll:d})})]}),(0,D.jsxs)(a,{disableGutters:!0,children:[(0,D.jsx)(o,{expandIcon:(0,D.jsx)(r,{}),children:(0,D.jsx)(b,{variant:`h6`,sx:{fontWeight:600},children:`Admin`})}),(0,D.jsx)(i,{children:(0,D.jsxs)(e,{spacing:2.5,children:[(0,D.jsx)(C,{onPause:m,onResume:_,actionLoading:p}),(0,D.jsx)(w,{onRestart:y,actionLoading:p}),(0,D.jsx)(S,{})]})})]})]}),(0,D.jsx)(h,{open:x.isOpen,title:x.options.title,message:x.options.message,confirmLabel:x.options.confirmLabel,cancelLabel:x.options.cancelLabel,severity:x.options.severity,onConfirm:x.handleConfirm,onCancel:x.handleCancel})]})}export{N as ConfigPage};