import{t as e}from"./Stack-BuinieWh.js";import{B as t,G as n,K as r,T as i,U as a,W as o,Yt as s,an as c,et as l,h as u,on as d,q as f,rt as p,z as m}from"./index-CdtNBxdo.js";var h=d(c(),1),g=d(s(),1);function _(){let[s,c]=(0,h.useState)(null),[d,_]=(0,h.useState)(null),[v,y]=(0,h.useState)(!0),[b,x]=(0,h.useState)(null),[S,C]=(0,h.useState)(null),w=(0,h.useRef)([]),T=async()=>{try{y(!0),x(null);let[e,t]=await Promise.all([i(),u()]);c(e),_(t),E(e)}catch(e){x(e instanceof Error?e.message:`Failed to load dashboard data`),console.error(`[Dashboard] Load error:`,e)}finally{y(!1)}},E=e=>{let t=Date.now(),n=e.processed_files,r=w.current;r.push({count:n,time:t});let i=t-300*1e3;w.current=r.filter(e=>e.time>i);let a=0,o=null;if(w.current.length>=2){let t=w.current[0],n=w.current[w.current.length-1],r=(n.time-t.time)/(1e3*60),i=n.count-t.count;if(r>0&&i>0){a=i/r;let t=e.pending_files;t>0&&a>0&&(o=t/a)}}C({totalFiles:e.total_files,processedCount:n,filesPerMinute:Math.round(a*10)/10,estimatedMinutesRemaining:o,lastUpdateTime:t})};(0,h.useEffect)(()=>{T()},[]),(0,h.useEffect)(()=>{let e=s?.is_busy??!1?1e3:3e4,t=setInterval(async()=>{try{let e=await i();c(e),E(e)}catch(e){console.error(`[Dashboard] Failed to update work status:`,e)}},e);return()=>clearInterval(t)},[s]);let D=e=>`${Math.floor(e/3600)}h ${Math.floor(e%3600/60)}m`,O=e=>e===null||e<=0?`—`:e<1?`< 1 min`:e<60?`${Math.round(e)} min`:`${Math.floor(e/60)}h ${Math.round(e%60)}m`,k=s&&s.pending_files>0,A=s?.is_scanning??!1,j=S&&S.totalFiles>0?Math.round(S.processedCount/S.totalFiles*100):0;return(0,g.jsxs)(t,{title:`Dashboard`,children:[v&&(0,g.jsx)(p,{sx:{mt:2},children:`Loading dashboard...`}),b&&(0,g.jsxs)(m,{children:[`Error: `,b]}),!v&&!b&&(0,g.jsxs)(e,{spacing:2.5,children:[A&&s?.scanning_libraries&&(0,g.jsxs)(f,{children:[(0,g.jsx)(r,{title:`Scanning Libraries`}),(0,g.jsx)(e,{spacing:1,children:s.scanning_libraries.map(e=>(0,g.jsx)(o,{label:e.name,value:e.progress,total:e.total,percentage:e.total>0?Math.round(e.progress/e.total*100):0},e.library_id))})]}),k&&S&&(0,g.jsxs)(f,{children:[(0,g.jsx)(r,{title:`Processing Status`}),(0,g.jsx)(l,{sx:{mb:2},children:(0,g.jsx)(o,{label:`Files processed`,value:S.processedCount,total:S.totalFiles,percentage:j})}),(0,g.jsxs)(a,{minWidth:150,children:[(0,g.jsx)(n,{label:`Velocity`,value:S.filesPerMinute>0?`${S.filesPerMinute}/min`:`—`}),(0,g.jsx)(n,{label:`ETA`,value:O(S.estimatedMinutesRemaining)}),(0,g.jsx)(n,{label:`Pending`,value:s?.pending_files||0}),(0,g.jsx)(n,{label:`Processed`,value:s?.processed_files||0})]})]}),(0,g.jsxs)(f,{children:[(0,g.jsx)(r,{title:`Processing Summary`}),s&&(0,g.jsxs)(a,{minWidth:150,children:[(0,g.jsx)(n,{label:`Pending`,value:s.pending_files}),(0,g.jsx)(n,{label:`Processed`,value:s.processed_files}),(0,g.jsx)(n,{label:`Total Files`,value:s.total_files})]})]}),(0,g.jsxs)(f,{children:[(0,g.jsx)(r,{title:`Library Stats`}),d&&(0,g.jsxs)(a,{minWidth:200,children:[(0,g.jsx)(n,{label:`Total Files`,value:d.total_files}),(0,g.jsx)(n,{label:`Artists`,value:d.unique_artists}),(0,g.jsx)(n,{label:`Albums`,value:d.unique_albums}),(0,g.jsx)(n,{label:`Total Duration`,value:D(d.total_duration_seconds)})]})]}),(0,g.jsxs)(f,{children:[(0,g.jsx)(r,{title:`Recent Activity`}),(0,g.jsx)(p,{color:`text.secondary`,fontStyle:`italic`,children:`Recently processed tracks and system events will appear here.`})]})]})]})}export{_ as DashboardPage};