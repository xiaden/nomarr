import{t as e}from"./Stack-CHbb6P4R.js";import{a as t,c as n,l as r,n as i,o as a,s as o,t as s}from"./TextField-dZ6ShoYp.js";import{n as c}from"./useSlotProps--BZhkIc6.js";import{t as l}from"./Tooltip-DKP7nFlS.js";import{t as u}from"./Chip-C03yJejV.js";import{t as d}from"./MenuItem-ivxu979D.js";import{t as f}from"./ServerFilePicker-DEhnNwez.js";import{a as p,i as m,n as h,o as g,s as _,t as v}from"./library-zN48eqId.js";import{C as y,D as b,Dt as x,Et as S,I as C,M as w,N as T,Q as E,X as D,Z as O,_t as k,a as A,c as ee,et as j,ft as M,g as N,h as te,j as P,k as F,l as I,mt as L,nt as R,o as ne,ot as z,pt as B,r as V,rt as H,w as U}from"./index-uH8yfxIe.js";import{t as re}from"./useConfirmDialog-D_yV7nVf.js";import{t as ie}from"./useNotification-DrfMeyUT.js";function ae(e){return B(`PrivateSwitchBase`,e)}M(`PrivateSwitchBase`,[`root`,`checked`,`disabled`,`input`,`edgeStart`,`edgeEnd`]);var W=x(S()),G=x(k()),K=e=>{let{classes:t,checked:n,disabled:r,edge:i}=e;return z({root:[`root`,n&&`checked`,r&&`disabled`,i&&`edge${E(i)}`],input:[`input`]},ae,t)},q=R(T,{name:`MuiSwitchBase`})({padding:9,borderRadius:`50%`,variants:[{props:{edge:`start`,size:`small`},style:{marginLeft:-3}},{props:({edge:e,ownerState:t})=>e===`start`&&t.size!==`small`,style:{marginLeft:-12}},{props:{edge:`end`,size:`small`},style:{marginRight:-3}},{props:({edge:e,ownerState:t})=>e===`end`&&t.size!==`small`,style:{marginRight:-12}}]}),J=R(`input`,{name:`MuiSwitchBase`,shouldForwardProp:H})({cursor:`inherit`,position:`absolute`,opacity:0,width:`100%`,height:`100%`,top:0,left:0,margin:0,padding:0,zIndex:1}),oe=W.forwardRef(function(e,t){let{autoFocus:n,checked:r,checkedIcon:i,defaultChecked:a,disabled:s,disableFocusRipple:l=!1,edge:u=!1,icon:d,id:f,inputProps:p,inputRef:m,name:h,onBlur:g,onChange:_,onFocus:v,readOnly:y,required:b=!1,tabIndex:x,type:S,value:w,slots:T={},slotProps:E={},...D}=e,[O,k]=c({controlled:r,default:!!a,name:`SwitchBase`,state:`checked`}),A=o(),ee=e=>{v&&v(e),A&&A.onFocus&&A.onFocus(e)},j=e=>{g&&g(e),A&&A.onBlur&&A.onBlur(e)},M=e=>{if(e.nativeEvent.defaultPrevented)return;let t=e.target.checked;k(t),_&&_(e,t)},N=s;A&&N===void 0&&(N=A.disabled);let te=S===`checkbox`||S===`radio`,P={...e,checked:O,disabled:N,disableFocusRipple:l,edge:u},F=K(P),I={slots:T,slotProps:{input:p,...E}},[L,R]=C(`root`,{ref:t,elementType:q,className:F.root,shouldForwardComponentProp:!0,externalForwardedProps:{...I,component:`span`,...D},getSlotProps:e=>({...e,onFocus:t=>{e.onFocus?.(t),ee(t)},onBlur:t=>{e.onBlur?.(t),j(t)}}),ownerState:P,additionalProps:{centerRipple:!0,focusRipple:!l,disabled:N,role:void 0,tabIndex:null}}),[ne,z]=C(`input`,{ref:m,elementType:J,className:F.input,externalForwardedProps:I,getSlotProps:e=>({...e,onChange:t=>{e.onChange?.(t),M(t)}}),ownerState:P,additionalProps:{autoFocus:n,checked:r,defaultChecked:a,disabled:N,id:te?f:void 0,name:h,readOnly:y,required:b,tabIndex:x,type:S,...S===`checkbox`&&w===void 0?{}:{value:w}}});return(0,G.jsxs)(L,{...R,children:[(0,G.jsx)(ne,{...z}),O?i:d]})}),se=D((0,G.jsx)(`path`,{d:`M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z`}),`CheckBoxOutlineBlank`),ce=D((0,G.jsx)(`path`,{d:`M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z`}),`CheckBox`),Y=D((0,G.jsx)(`path`,{d:`M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z`}),`IndeterminateCheckBox`);function le(e){return B(`MuiCheckbox`,e)}var X=M(`MuiCheckbox`,[`root`,`checked`,`disabled`,`indeterminate`,`colorPrimary`,`colorSecondary`,`sizeSmall`,`sizeMedium`]),Z=e=>{let{classes:t,indeterminate:n,color:r,size:i}=e,a=z({root:[`root`,n&&`indeterminate`,`color${E(r)}`,`size${E(i)}`]},le,t);return{...t,...a}},ue=R(oe,{shouldForwardProp:e=>H(e)||e===`classes`,name:`MuiCheckbox`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${E(n.size)}`],n.color!==`default`&&t[`color${E(n.color)}`]]}})(O(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:`default`,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(w()).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(w()).map(([t])=>({props:{color:t},style:{[`&.${X.checked}, &.${X.indeterminate}`]:{color:(e.vars||e).palette[t].main},[`&.${X.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:`transparent`}}}}]}))),de=(0,G.jsx)(ce,{}),fe=(0,G.jsx)(se,{}),pe=(0,G.jsx)(Y,{}),me=W.forwardRef(function(e,t){let n=j({props:e,name:`MuiCheckbox`}),{checkedIcon:i=de,color:a=`primary`,icon:o=fe,indeterminate:s=!1,indeterminateIcon:c=pe,inputProps:l,size:u=`medium`,disableRipple:d=!1,className:f,slots:p={},slotProps:m={},...h}=n,g=s?c:o,_=s?c:i,v={...n,disableRipple:d,color:a,indeterminate:s,size:u},y=Z(v),b=m.input??l,[x,S]=C(`root`,{ref:t,elementType:ue,className:L(y.root,f),shouldForwardComponentProp:!0,externalForwardedProps:{slots:p,slotProps:m,...h},ownerState:v,additionalProps:{type:`checkbox`,icon:W.cloneElement(g,{fontSize:g.props.fontSize??u}),checkedIcon:W.cloneElement(_,{fontSize:_.props.fontSize??u}),disableRipple:d,slots:p,slotProps:{input:r(typeof b==`function`?b(v):b,{"data-indeterminate":s})}}});return(0,G.jsx)(x,{...S,classes:y})});function he(e){return B(`MuiFormControlLabel`,e)}var Q=M(`MuiFormControlLabel`,[`root`,`labelPlacementStart`,`labelPlacementTop`,`labelPlacementBottom`,`disabled`,`label`,`error`,`required`,`asterisk`]),ge=e=>{let{classes:t,disabled:n,labelPlacement:r,error:i,required:a}=e;return z({root:[`root`,n&&`disabled`,`labelPlacement${E(r)}`,i&&`error`,a&&`required`],label:[`label`,n&&`disabled`],asterisk:[`asterisk`,i&&`error`]},he,t)};const _e=R(`label`,{name:`MuiFormControlLabel`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${Q.label}`]:t.label},t.root,t[`labelPlacement${E(n.labelPlacement)}`]]}})(O(({theme:e})=>({display:`inline-flex`,alignItems:`center`,cursor:`pointer`,verticalAlign:`middle`,WebkitTapHighlightColor:`transparent`,marginLeft:-11,marginRight:16,[`&.${Q.disabled}`]:{cursor:`default`},[`& .${Q.label}`]:{[`&.${Q.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:`start`},style:{flexDirection:`row-reverse`,marginRight:-11}},{props:{labelPlacement:`top`},style:{flexDirection:`column-reverse`}},{props:{labelPlacement:`bottom`},style:{flexDirection:`column`}},{props:({labelPlacement:e})=>e===`start`||e===`top`||e===`bottom`,style:{marginLeft:16}}]})));var ve=R(`span`,{name:`MuiFormControlLabel`,slot:`Asterisk`})(O(({theme:e})=>({[`&.${Q.error}`]:{color:(e.vars||e).palette.error.main}}))),ye=W.forwardRef(function(e,t){let r=j({props:e,name:`MuiFormControlLabel`}),{checked:i,className:a,componentsProps:s={},control:c,disabled:l,disableTypography:u,inputRef:d,label:f,labelPlacement:p=`end`,name:m,onChange:h,required:g,slots:_={},slotProps:v={},value:y,...x}=r,S=o(),w=l??c.props.disabled??S?.disabled,T=g??c.props.required,E={disabled:w,required:T};[`checked`,`name`,`onChange`,`value`,`inputRef`].forEach(e=>{c.props[e]===void 0&&r[e]!==void 0&&(E[e]=r[e])});let D=n({props:r,muiFormControl:S,states:[`error`]}),O={...r,disabled:w,labelPlacement:p,required:T,error:D.error},k=ge(O),[A,ee]=C(`typography`,{elementType:b,externalForwardedProps:{slots:_,slotProps:{...s,...v}},ownerState:O}),M=f;return M!=null&&M.type!==b&&!u&&(M=(0,G.jsx)(A,{component:`span`,...ee,className:L(k.label,ee?.className),children:M})),(0,G.jsxs)(_e,{className:L(k.root,a),ownerState:O,ref:t,...x,children:[W.cloneElement(c,E),T?(0,G.jsxs)(`div`,{children:[M,(0,G.jsxs)(ve,{ownerState:O,"aria-hidden":!0,className:k.asterisk,children:[` `,`*`]})]}):M]})});async function be(){return V(`/api/web/config`)}async function xe(e,t){return A(`/api/web/config`,{key:e,value:t})}function $(){let{showSuccess:n}=ie(),{confirm:r,isOpen:o,options:c,handleConfirm:x,handleCancel:S}=re(),[C,w]=(0,W.useState)([]),[T,E]=(0,W.useState)(!0),[D,O]=(0,W.useState)(null),[k,A]=(0,W.useState)(!1),[j,M]=(0,W.useState)(null),[P,F]=(0,W.useState)(null),[I,L]=(0,W.useState)(null),[R,z]=(0,W.useState)(``),[B,V]=(0,W.useState)(``),[H,ae]=(0,W.useState)(!0),[K,q]=(0,W.useState)(!1),[J,oe]=(0,W.useState)(`off`),[se,ce]=(0,W.useState)(!1),Y=async()=>{try{E(!0),O(null),w(await m())}catch(e){O(e instanceof Error?e.message:`Failed to load libraries`),console.error(`[LibraryManagement] Load error:`,e)}finally{E(!1)}},le=async()=>{try{L((await be()).library_root||null)}catch(e){console.error(`[LibraryManagement] Failed to load config:`,e)}};(0,W.useEffect)(()=>{Y(),le()},[]);let X=e=>{if(!I)return!1;let t=I.replace(/\/+$/,``);return!e.replace(/\/+$/,``).startsWith(t)},Z=()=>{z(``),V(``),ae(!0),q(!1),oe(`off`),ce(!1),A(!1),M(null)},ue=()=>{Z(),A(!0)},de=e=>{z(e.name),V(e.rootPath),ae(e.isEnabled),q(e.isDefault),oe(e.watchMode),M(e.id),A(!1)},fe=async()=>{if(!B.trim()){O(`Path is required`);return}try{O(null),await v({name:R.trim()||null,rootPath:B,isEnabled:H,isDefault:K,watchMode:J}),await Y(),Z()}catch(e){O(e instanceof Error?e.message:`Failed to create library`)}},pe=async()=>{if(j!==null){if(!B.trim()){O(`Path is required`);return}try{O(null),await _(j,{name:R.trim()||void 0,rootPath:B,isEnabled:H,isDefault:K,watchMode:J}),await Y(),Z()}catch(e){O(e instanceof Error?e.message:`Failed to update library`)}}},he=async e=>{try{O(null),await g(e),await Y()}catch(e){O(e instanceof Error?e.message:`Failed to set default library`)}},Q=async(e,t)=>{try{O(null),F(e);let r=await p(e,t);n(`Scan ${r.status}: ${r.message||`Library scan queued`}`),await Y()}catch(e){O(e instanceof Error?e.message:`Failed to scan library`)}finally{F(null)}},ge=async(e,t,n)=>{if(n){O(`Cannot delete the default library. Set another library as default first.`);return}if(await r({title:`Delete Library?`,message:`Delete library "${t}"?\n\nThis will remove the library entry but will NOT delete files on disk.`,severity:`warning`}))try{O(null),await h(e),await Y()}catch(e){O(e instanceof Error?e.message:`Failed to delete library`)}},_e=async(e,t)=>{try{O(null),await _(e,{watchMode:t}),await Y(),n(`File watching mode changed to ${t}`)}catch(e){O(e instanceof Error?e.message:`Failed to change watch mode`)}},ve=e=>{switch(e){case`event`:return`Event`;case`poll`:return`Poll`;default:return`Off`}},xe=e=>{switch(e){case`event`:return`success`;case`poll`:return`warning`;default:return`default`}},$=k||j!==null;return(0,G.jsxs)(e,{spacing:2.5,children:[(0,G.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`center`,children:[(0,G.jsx)(b,{variant:`h5`,children:`Libraries`}),!$&&(0,G.jsx)(y,{variant:`contained`,onClick:ue,children:`+ Add Library`})]}),D&&(0,G.jsx)(ee,{children:D}),$&&(0,G.jsxs)(N,{children:[(0,G.jsx)(te,{title:k?`Create Library`:`Edit Library`}),(0,G.jsxs)(e,{spacing:2,children:[(0,G.jsxs)(U,{children:[(0,G.jsx)(b,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Name (optional)`}),(0,G.jsx)(s,{value:R,onChange:e=>z(e.target.value),placeholder:`Auto-generated from path if left empty`,fullWidth:!0})]}),(0,G.jsxs)(U,{children:[(0,G.jsx)(b,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Root Path`}),(0,G.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,G.jsx)(s,{value:B,onChange:e=>V(e.target.value),placeholder:`/music`,fullWidth:!0}),(0,G.jsx)(y,{variant:`outlined`,onClick:()=>ce(!se),sx:{minWidth:120},children:se?`Hide Picker`:`Browse...`})]}),se&&(0,G.jsx)(U,{sx:{mt:1.25,p:2,bgcolor:`background.default`,borderRadius:1,border:1,borderColor:`divider`},children:(0,G.jsx)(f,{value:B,onChange:e=>{V(e),ce(!1)},mode:`directory`,label:`Select Library Root Directory`})})]}),(0,G.jsx)(ye,{control:(0,G.jsx)(me,{checked:H,onChange:e=>ae(e.target.checked)}),label:`Enabled`}),(0,G.jsx)(ye,{control:(0,G.jsx)(me,{checked:K,onChange:e=>q(e.target.checked)}),label:`Default Library`}),(0,G.jsx)(U,{children:(0,G.jsxs)(a,{fullWidth:!0,children:[(0,G.jsx)(t,{id:`watch-mode-label`,children:`File Watching`}),(0,G.jsxs)(i,{labelId:`watch-mode-label`,value:J,label:`File Watching`,onChange:e=>oe(e.target.value),children:[(0,G.jsx)(d,{value:`off`,children:(0,G.jsxs)(e,{children:[(0,G.jsxs)(b,{children:[(0,G.jsx)(`strong`,{children:`Off`}),` - No automatic scanning`]}),(0,G.jsx)(b,{variant:`caption`,color:`text.secondary`,children:`Manual scans only`})]})}),(0,G.jsx)(d,{value:`event`,children:(0,G.jsxs)(e,{children:[(0,G.jsxs)(b,{children:[(0,G.jsx)(`strong`,{children:`Event`}),` - Real-time file watching`]}),(0,G.jsx)(b,{variant:`caption`,color:`text.secondary`,children:`Fast (2-5s response), local filesystems only`})]})}),(0,G.jsx)(d,{value:`poll`,children:(0,G.jsxs)(e,{children:[(0,G.jsxs)(b,{children:[(0,G.jsx)(`strong`,{children:`Poll`}),` - Periodic scanning`]}),(0,G.jsx)(b,{variant:`caption`,color:`text.secondary`,children:`Slower (60s interval), network-mount-safe`})]})})]})]})}),(0,G.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,G.jsx)(y,{variant:`contained`,onClick:k?fe:pe,children:k?`Create`:`Update`}),(0,G.jsx)(y,{variant:`outlined`,onClick:Z,children:`Cancel`})]})]})]}),T&&(0,G.jsx)(b,{children:`Loading libraries...`}),!T&&!$&&C.length===0&&(0,G.jsx)(N,{children:(0,G.jsx)(b,{color:`text.secondary`,textAlign:`center`,fontStyle:`italic`,children:`No libraries configured. Click "Add Library" to get started.`})}),!T&&!$&&C.length>0&&(0,G.jsx)(e,{spacing:2,children:C.map(t=>(0,G.jsxs)(N,{children:[(0,G.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`flex-start`,sx:{mb:2},children:[(0,G.jsxs)(U,{children:[(0,G.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1.25,sx:{mb:.5},children:[(0,G.jsx)(b,{variant:`h6`,children:t.name}),t.isDefault&&(0,G.jsx)(u,{label:`Default`,color:`primary`,size:`small`}),X(t.rootPath)&&(0,G.jsx)(u,{label:`Outside library_root`,color:`warning`,size:`small`})]}),(0,G.jsx)(b,{variant:`body2`,color:`text.secondary`,sx:{fontFamily:`monospace`},children:t.rootPath}),(0,G.jsxs)(e,{direction:`row`,spacing:2,sx:{mt:.5},children:[(0,G.jsxs)(b,{variant:`body2`,color:`text.secondary`,children:[(0,G.jsx)(`strong`,{children:t.fileCount.toLocaleString()}),` files`]}),(0,G.jsxs)(b,{variant:`body2`,color:`text.secondary`,children:[(0,G.jsx)(`strong`,{children:t.folderCount.toLocaleString()}),` folders`]})]}),X(t.rootPath)&&(0,G.jsxs)(b,{variant:`caption`,color:`warning.main`,sx:{mt:.5},children:[`⚠ This library is outside the configured library_root (`,I,`)`]}),(0,G.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:1},children:[(0,G.jsx)(b,{variant:`caption`,color:`text.secondary`,children:`File Watching:`}),(0,G.jsx)(a,{size:`small`,sx:{minWidth:120},children:(0,G.jsxs)(i,{value:t.watchMode,onChange:e=>_e(t.id,e.target.value),size:`small`,sx:{fontSize:`0.75rem`},disabled:P===t.id,children:[(0,G.jsx)(d,{value:`off`,children:`Off`}),(0,G.jsx)(d,{value:`event`,children:`Event`}),(0,G.jsx)(d,{value:`poll`,children:`Poll`})]})}),(0,G.jsx)(l,{title:t.watchMode===`event`?`Real-time file watching (local filesystems)`:t.watchMode===`poll`?`Periodic scanning (network-mount-safe)`:`No automatic file watching`,children:(0,G.jsx)(u,{label:ve(t.watchMode),color:xe(t.watchMode),size:`small`})})]})]}),(0,G.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,children:[(0,G.jsx)(U,{sx:{width:8,height:8,borderRadius:`50%`,bgcolor:t.isEnabled?`success.main`:`text.disabled`}}),(0,G.jsx)(b,{variant:`body2`,color:`text.secondary`,children:t.isEnabled?`Enabled`:`Disabled`})]})]}),(0,G.jsxs)(e,{direction:`row`,spacing:1.25,flexWrap:`wrap`,children:[(0,G.jsx)(y,{variant:`outlined`,size:`small`,onClick:()=>de(t),disabled:P===t.id,children:`Edit`}),!t.isDefault&&(0,G.jsx)(y,{variant:`outlined`,size:`small`,onClick:()=>he(t.id),disabled:P===t.id,children:`Set Default`}),(0,G.jsx)(y,{variant:`outlined`,color:`success`,size:`small`,onClick:()=>Q(t.id,`quick`),disabled:!t.isEnabled||P===t.id||X(t.rootPath)||!t.scannedAt,title:t.scannedAt?X(t.rootPath)?`Cannot scan: library is outside library_root`:`Scan only new and modified files`:`Run a Full Scan first before using Quick Scan`,children:P===t.id?`Scanning...`:`Quick Scan`}),(0,G.jsx)(y,{variant:`contained`,color:`success`,size:`small`,onClick:()=>Q(t.id,`full`),disabled:!t.isEnabled||P===t.id||X(t.rootPath),title:X(t.rootPath)?`Cannot scan: library is outside library_root`:`Rescan all files in the library`,children:P===t.id?`Scanning...`:`Full Scan`}),(0,G.jsx)(y,{variant:`contained`,color:`error`,size:`small`,onClick:()=>ge(t.id,t.name,t.isDefault),disabled:P===t.id,children:`Delete`})]})]},t.id))}),(0,G.jsx)(ne,{open:o,title:c.title,message:c.message,confirmLabel:c.confirmLabel,cancelLabel:c.cancelLabel,severity:c.severity,onConfirm:x,onCancel:S})]})}var Se={library_root:`Library Root Directory`,scan_recursive:`Scan Subdirectories`,scan_ignore_patterns:`Ignore Patterns`,tagging_enabled:`Auto-Tagging Enabled`,tagging_version_tag_key:`Version Tag Key`,processing_batch_size:`Processing Batch Size`,processing_max_workers:`Max Worker Threads`,gpu_enabled:`GPU Acceleration`,gpu_device_id:`GPU Device ID`,cache_size_mb:`Cache Size (MB)`,log_level:`Log Level`};function Ce({configKey:e,value:t,onChange:n,disabled:r}){let a=t==null?``:String(t),o=typeof t==`boolean`;return(0,G.jsxs)(U,{sx:{display:`flex`,gap:2,alignItems:`center`},children:[(0,G.jsx)(b,{variant:`body2`,color:`text.primary`,sx:{fontWeight:500,minWidth:`240px`,flexShrink:0},children:Se[e]||e}),(0,G.jsx)(U,{sx:{flex:1,maxWidth:`400px`},children:o?(0,G.jsxs)(i,{value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0,children:[(0,G.jsx)(d,{value:`true`,children:`true`}),(0,G.jsx)(d,{value:`false`,children:`false`})]}):(0,G.jsx)(s,{type:`text`,value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0})})]})}function we({config:t,hasChanges:n,saveLoading:r,onChange:i,onSaveAll:a}){return(0,G.jsxs)(N,{children:[(0,G.jsx)(te,{title:`Settings`}),(0,G.jsx)(b,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Changes are saved to the database and will take effect on server restart. Use "Restart Server" in Admin page to apply changes.`}),(0,G.jsx)(e,{spacing:1.875,children:Object.entries(t).map(([e,t])=>(0,G.jsx)(Ce,{configKey:e,value:t,onChange:i,disabled:r},e))}),(0,G.jsxs)(U,{sx:{mt:3.75,display:`flex`,gap:1.25,alignItems:`center`},children:[(0,G.jsx)(y,{onClick:a,variant:`contained`,disabled:!n||r,sx:{whiteSpace:`nowrap`},children:r?`Saving...`:`Save All Changes`}),n&&(0,G.jsx)(b,{variant:`body2`,color:`warning.main`,children:`Unsaved changes`})]})]})}function Te(){let{showSuccess:e,showError:t,showInfo:n}=ie(),[r,i]=(0,W.useState)({}),[a,o]=(0,W.useState)({}),[s,c]=(0,W.useState)(!0),[l,u]=(0,W.useState)(null),[d,f]=(0,W.useState)(!1),[p,m]=(0,W.useState)(!1),h=async()=>{try{c(!0),u(null);let e=await be();i(e),o(e),m(!1)}catch(e){u(e instanceof Error?e.message:`Failed to load config`),console.error(`[Config] Load error:`,e)}finally{c(!1)}};return(0,W.useEffect)(()=>{h()},[]),(0,W.useEffect)(()=>{m(Object.keys(r).some(e=>r[e]!==a[e]))},[r,a]),{config:r,loading:s,error:l,saveLoading:d,hasChanges:p,handleSaveAll:async()=>{try{f(!0);let t=[];for(let e of Object.keys(r))if(r[e]!==a[e]){let n=r[e];if(n==null||n===``)continue;await xe(e,String(n)),t.push(e)}if(t.length===0){n(`No changes to save`);return}e(`Saved ${t.length} config change(s). Use "Restart Server" in Admin page to apply.`),await h()}catch(e){t(e instanceof Error?e.message:`Failed to save config`)}finally{f(!1)}},handleChange:(e,t)=>{i(n=>({...n,[e]:t}))}}}function Ee(){let{config:t,loading:n,error:r,saveLoading:i,hasChanges:a,handleSaveAll:o,handleChange:s}=Te();return(0,G.jsxs)(I,{title:`Configuration`,children:[n&&(0,G.jsx)(P,{}),r&&(0,G.jsxs)(F,{severity:`error`,children:[`Error: `,r]}),!n&&!r&&(0,G.jsxs)(e,{spacing:2.5,children:[(0,G.jsx)($,{}),(0,G.jsx)(we,{config:t,hasChanges:a,saveLoading:i,onChange:s,onSaveAll:o})]})]})}export{Ee as ConfigPage};