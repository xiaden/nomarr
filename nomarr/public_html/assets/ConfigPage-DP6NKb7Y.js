import{c as e,l as t,u as n}from"./ui-DMTNeb6j.js";import{n as r,t as i}from"./TextField-B_WIdEsd.js";import"./Grow-K3BNb4Vk.js";import{t as a}from"./MenuItem-DCE9RDZS.js";import{Z as o,a as s,dt as c,n as l,o as u,pt as d,s as f}from"./index-Ck38l4oW.js";var p=d(o(),1);function m({configKey:e,value:t,onChange:n,disabled:o}){let s=t==null?``:String(t);return(0,p.jsxs)(u,{sx:{display:`grid`,gap:1},children:[(0,p.jsx)(f,{variant:`body2`,color:`text.secondary`,sx:{fontWeight:`bold`},children:e}),(0,p.jsx)(u,{sx:{display:`flex`,gap:1.25,alignItems:`center`},children:typeof t==`boolean`?(0,p.jsxs)(r,{value:s,onChange:t=>n(e,t.target.value),disabled:o,size:`small`,fullWidth:!0,children:[(0,p.jsx)(a,{value:`true`,children:`true`}),(0,p.jsx)(a,{value:`false`,children:`false`})]}):(0,p.jsx)(i,{type:`text`,value:s,onChange:t=>n(e,t.target.value),disabled:o,size:`small`,fullWidth:!0})})]})}function h({config:r,hasChanges:i,saveLoading:a,onChange:o,onSaveAll:c}){return(0,p.jsxs)(t,{children:[(0,p.jsx)(e,{title:`Settings`}),(0,p.jsx)(f,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Changes are saved to the database and will take effect on server restart. Use "Restart Server" in Admin page to apply changes.`}),(0,p.jsx)(n,{spacing:1.875,children:Object.entries(r).map(([e,t])=>(0,p.jsx)(m,{configKey:e,value:t,onChange:o,disabled:a},e))}),(0,p.jsxs)(u,{sx:{mt:3.75,display:`flex`,gap:1.25,alignItems:`center`},children:[(0,p.jsx)(s,{onClick:c,variant:`contained`,disabled:!i||a,sx:{whiteSpace:`nowrap`},children:a?`Saving...`:`Save All Changes`}),i&&(0,p.jsx)(f,{variant:`body2`,color:`warning.main`,children:`Unsaved changes`})]})]})}var g=d(c(),1);function _(){let[e,t]=(0,g.useState)({}),[n,r]=(0,g.useState)({}),[i,a]=(0,g.useState)(!0),[o,s]=(0,g.useState)(null),[c,u]=(0,g.useState)(!1),[d,f]=(0,g.useState)(!1),p=async()=>{try{a(!0),s(null);let e=await l.config.get();t(e),r(e),f(!1)}catch(e){s(e instanceof Error?e.message:`Failed to load config`),console.error(`[Config] Load error:`,e)}finally{a(!1)}};return(0,g.useEffect)(()=>{p()},[]),(0,g.useEffect)(()=>{f(Object.keys(e).some(t=>e[t]!==n[t]))},[e,n]),{config:e,loading:i,error:o,saveLoading:c,hasChanges:d,handleSaveAll:async()=>{try{u(!0);let t=[];for(let r of Object.keys(e))if(e[r]!==n[r]){let n=e[r];if(n==null||n===``)continue;await l.config.update(r,String(n)),t.push(r)}if(t.length===0){alert(`No changes to save`);return}alert(`Saved ${t.length} config change(s). Use "Restart Server" in Admin page to apply.`),await p()}catch(e){alert(e instanceof Error?e.message:`Failed to save config`)}finally{u(!1)}},handleChange:(e,n)=>{t(t=>({...t,[e]:n}))}}}function v(){let{config:e,loading:t,error:n,saveLoading:r,hasChanges:i,handleSaveAll:a,handleChange:o}=_();return(0,p.jsxs)(`div`,{style:{padding:`20px`},children:[(0,p.jsx)(`h1`,{style:{marginBottom:`20px`},children:`Configuration`}),t&&(0,p.jsx)(`p`,{children:`Loading configuration...`}),n&&(0,p.jsxs)(`p`,{style:{color:`var(--accent-red)`},children:[`Error: `,n]}),!t&&!n&&(0,p.jsx)(`div`,{style:{display:`grid`,gap:`20px`},children:(0,p.jsx)(h,{config:e,hasChanges:i,saveLoading:r,onChange:o,onSaveAll:a})})]})}export{v as ConfigPage};