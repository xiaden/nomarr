import{t as e}from"./Stack-Ci7vglO3.js";import"./List-7pMkh3h0.js";import{t}from"./TextField-CVSXSijV.js";import"./useControlled-B08UsLrc.js";import{a as n,i as r,n as i,r as a,t as o}from"./TableRow-DEPU6oe5.js";import{$ as s,C as c,Cn as l,E as u,J as d,K as f,Q as p,S as m,T as h,Tn as g,U as _,at as v,dt as y,fn as b,lt as x,ot as S,w as C}from"./index-kBFNCzMM.js";import{t as w}from"./useConfirmDialog-xSQX65nX.js";import{t as T}from"./ServerFilePicker-CcuIdECz.js";import{t as E}from"./useNotification-COuTLxX_.js";var D=g(l(),1),O=g(b(),1);function k(){let{confirm:c}=w(),[l,d]=(0,D.useState)(``),[f,m]=(0,D.useState)(null),[g,_]=(0,D.useState)(!1),[b,C]=(0,D.useState)(null),[E,k]=(0,D.useState)(!1),[A,j]=(0,D.useState)(!1),[M,N]=(0,D.useState)(null),P=async e=>{if(e.preventDefault(),l.trim())try{_(!0),C(null),N(null),m(await u(l))}catch(e){C(e instanceof Error?e.message:`Failed to load tags`),m(null),console.error(`[Inspect] Load error:`,e)}finally{_(!1)}},F=async()=>{if(l.trim()&&await c({title:`Remove All Tags?`,message:`Remove all tags from ${l}?\n\nThis cannot be undone!`,severity:`warning`}))try{j(!0),C(null),N(null);let e=await h(l);N(`Removed ${e.removed} tag(s) from ${e.path}`),m(await u(l))}catch(e){C(e instanceof Error?e.message:`Failed to remove tags`),console.error(`[Inspect] Remove error:`,e)}finally{j(!1)}},I=e=>Array.isArray(e)?e.join(`, `):String(e);return(0,O.jsxs)(s,{children:[(0,O.jsx)(p,{title:`Inspect Tags`}),(0,O.jsx)(x,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Debug tool to view and remove tags from individual audio files.`}),(0,O.jsx)(`form`,{onSubmit:P,children:(0,O.jsxs)(e,{spacing:2,children:[(0,O.jsxs)(S,{sx:{display:`flex`,gap:1.25,alignItems:`center`},children:[(0,O.jsx)(t,{label:`File Path`,value:l,onChange:e=>d(e.target.value),placeholder:`/music/artist/album/track.flac`,fullWidth:!0,size:`small`,disabled:g||A}),(0,O.jsx)(v,{type:`button`,variant:`outlined`,onClick:()=>k(!0),disabled:g||A,sx:{whiteSpace:`nowrap`,minWidth:`fit-content`},children:`Browse Files`}),(0,O.jsx)(v,{type:`submit`,variant:`contained`,disabled:!l.trim()||g||A,sx:{whiteSpace:`nowrap`,minWidth:`fit-content`},children:g?`Loading...`:`Show Tags`})]}),b&&(0,O.jsx)(y,{severity:`error`,children:b}),M&&(0,O.jsx)(y,{severity:`success`,children:M}),E&&(0,O.jsx)(S,{sx:{mt:2},children:(0,O.jsx)(T,{value:l,onChange:e=>{d(e),k(!1)},mode:`file`,label:`Select Audio File`})}),f&&(0,O.jsxs)(e,{spacing:2,children:[(0,O.jsxs)(S,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,py:1,px:2,backgroundColor:`action.hover`,borderRadius:1},children:[(0,O.jsxs)(x,{variant:`body2`,children:[(0,O.jsx)(`strong`,{children:`File:`}),` `,f.path]}),(0,O.jsxs)(x,{variant:`body2`,children:[(0,O.jsx)(`strong`,{children:`Tags:`}),` `,f.count]})]}),f.count>0&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(n,{size:`small`,children:[(0,O.jsx)(i,{children:(0,O.jsxs)(o,{children:[(0,O.jsx)(a,{children:(0,O.jsx)(`strong`,{children:`Key`})}),(0,O.jsx)(a,{children:(0,O.jsx)(`strong`,{children:`Value`})})]})}),(0,O.jsx)(r,{children:Object.entries(f.tags).map(([e,t])=>(0,O.jsxs)(o,{children:[(0,O.jsx)(a,{sx:{fontFamily:`monospace`},children:e}),(0,O.jsx)(a,{sx:{wordBreak:`break-all`},children:I(t)})]},e))})]}),(0,O.jsx)(S,{sx:{display:`flex`,justifyContent:`flex-end`},children:(0,O.jsx)(v,{onClick:F,variant:`outlined`,color:`error`,disabled:A,sx:{textTransform:`none`},children:A?`Removing...`:`Remove All Tags`})})]}),f.count===0&&(0,O.jsx)(y,{severity:`info`,children:`No tags found in this file.`})]})]})})]})}function A({onRestart:e,actionLoading:t}){return(0,O.jsxs)(s,{children:[(0,O.jsx)(p,{title:`System Controls`}),(0,O.jsx)(d,{label:`Restart Server`,description:`Stops and restarts the API server. Config changes will take effect. Page will reload automatically after restart.`,onClick:e,disabled:t,variant:`contained`,color:`error`})]})}function j({onPause:t,onResume:n,actionLoading:r}){return(0,O.jsxs)(s,{children:[(0,O.jsx)(p,{title:`Worker Controls`}),(0,O.jsxs)(e,{spacing:1.25,children:[(0,O.jsx)(d,{label:`Pause Worker`,description:`Stops the worker from processing queue jobs. Jobs remain in the queue.`,onClick:t,disabled:r}),(0,O.jsx)(d,{label:`Resume Worker`,description:`Starts the worker to process queue jobs.`,onClick:n,disabled:r})]})]})}function M(){let{showSuccess:e,showError:t}=E(),{confirm:n,isOpen:r,options:i,handleConfirm:a,handleCancel:o}=w(),[s,l]=(0,D.useState)(!1);return{actionLoading:s,handlePauseWorker:async()=>{if(await n({title:`Pause Worker?`,message:`Pause the worker? Processing will stop.`,confirmLabel:`Pause`,severity:`warning`}))try{l(!0),e((await m()).message)}catch(e){t(e instanceof Error?e.message:`Failed to pause worker`)}finally{l(!1)}},handleResumeWorker:async()=>{if(await n({title:`Resume Worker?`,message:`Resume the worker? Processing will start.`,confirmLabel:`Resume`}))try{l(!0),e((await C()).message)}catch(e){t(e instanceof Error?e.message:`Failed to resume worker`)}finally{l(!1)}},handleRestart:async()=>{if(await n({title:`Restart Server?`,message:`Restart the API server? The page will reload in a few seconds.`,confirmLabel:`Restart`,severity:`error`}))try{l(!0),e((await c()).message),setTimeout(()=>{window.location.reload()},3e3)}catch(e){t(e instanceof Error?e.message:`Failed to restart server`),l(!1)}},dialogState:{isOpen:r,options:i,handleConfirm:a,handleCancel:o}}}function N(){let{actionLoading:t,handlePauseWorker:n,handleResumeWorker:r,handleRestart:i,dialogState:a}=M();return(0,O.jsxs)(f,{title:`Admin`,children:[(0,O.jsxs)(e,{spacing:2.5,children:[(0,O.jsx)(j,{onPause:n,onResume:r,actionLoading:t}),(0,O.jsx)(A,{onRestart:i,actionLoading:t}),(0,O.jsx)(k,{})]}),(0,O.jsx)(_,{open:a.isOpen,title:a.options.title,message:a.options.message,confirmLabel:a.options.confirmLabel,cancelLabel:a.options.cancelLabel,severity:a.options.severity,onConfirm:a.handleConfirm,onCancel:a.handleCancel})]})}export{N as AdminPage};