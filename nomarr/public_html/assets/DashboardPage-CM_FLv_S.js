import{a as e,c as t,l as n,n as r,o as i,s as a,t as o,u as s}from"./ui-DtgV6QDH.js";import{Z as c,dt as l,n as u,o as d,pt as f,s as p,t as m}from"./index-D4HyKH-U.js";var h=f(l(),1),g=f(c(),1);function _(){let[c,l]=(0,h.useState)(null),[f,_]=(0,h.useState)(null),[v,y]=(0,h.useState)(!0),[b,x]=(0,h.useState)(null),[S,C]=(0,h.useState)(null),w=(0,h.useRef)([]),T=async()=>{try{y(!0),x(null);let[e,t]=await Promise.all([u.queue.getStatus(),u.library.getStats()]);l(e),_(t),E(e)}catch(e){x(e instanceof Error?e.message:`Failed to load dashboard data`),console.error(`[Dashboard] Load error:`,e)}finally{y(!1)}},E=e=>{let t=Date.now(),n=e.pending+e.running+e.completed+e.errors,r=e.completed,i=w.current;i.push({count:r,time:t});let a=t-300*1e3;w.current=i.filter(e=>e.time>a);let o=0,s=null;if(w.current.length>=2){let t=w.current[0],n=w.current[w.current.length-1],r=(n.time-t.time)/(1e3*60),i=n.count-t.count;if(r>0&&i>0){o=i/r;let t=e.pending+e.running;t>0&&o>0&&(s=t/o)}}C({totalJobs:n,completedCount:r,filesPerMinute:Math.round(o*10)/10,estimatedMinutesRemaining:s,lastUpdateTime:t})};(0,h.useEffect)(()=>{T()},[]);let{connected:D}=m({onMessage:e=>{try{let t=JSON.parse(e.data);console.log(`[Dashboard] SSE update:`,t),t.queue&&(l({pending:t.queue.pending||0,running:t.queue.running||0,completed:t.queue.completed||0,errors:t.queue.errors||0}),E({pending:t.queue.pending||0,running:t.queue.running||0,completed:t.queue.completed||0,errors:t.queue.errors||0}))}catch(e){console.error(`[Dashboard] Failed to parse SSE message:`,e)}},onError:e=>{console.error(`[Dashboard] SSE error:`,e)}}),O=e=>`${Math.floor(e/3600)}h ${Math.floor(e%3600/60)}m`,k=e=>e===null||e<=0?`—`:e<1?`< 1 min`:e<60?`${Math.round(e)} min`:`${Math.floor(e/60)}h ${Math.round(e%60)}m`,A=c&&(c.pending>0||c.running>0),j=S&&S.totalJobs>0?Math.round(S.completedCount/S.totalJobs*100):0;return(0,g.jsxs)(r,{title:`Dashboard`,children:[(0,g.jsx)(p,{variant:`body2`,sx:{color:D?`success.main`:`error.main`,mb:2},children:D?`● Live`:`● Disconnected`}),v&&(0,g.jsx)(p,{sx:{mt:2},children:`Loading dashboard...`}),b&&(0,g.jsxs)(o,{children:[`Error: `,b]}),!v&&!b&&(0,g.jsxs)(s,{spacing:2.5,children:[A&&S&&(0,g.jsxs)(n,{children:[(0,g.jsx)(t,{title:`Processing Status`}),(0,g.jsx)(d,{sx:{mb:2},children:(0,g.jsx)(i,{label:`Files processed`,value:S.completedCount,total:S.totalJobs,percentage:j})}),(0,g.jsxs)(e,{minWidth:150,children:[(0,g.jsx)(a,{label:`Velocity`,value:S.filesPerMinute>0?`${S.filesPerMinute}/min`:`—`}),(0,g.jsx)(a,{label:`ETA`,value:k(S.estimatedMinutesRemaining)}),(0,g.jsx)(a,{label:`Active`,value:c?.running||0}),(0,g.jsx)(a,{label:`Remaining`,value:c?.pending||0})]})]}),(0,g.jsxs)(n,{children:[(0,g.jsx)(t,{title:`Queue Summary`}),c&&(0,g.jsxs)(e,{minWidth:150,children:[(0,g.jsx)(a,{label:`Pending`,value:c.pending}),(0,g.jsx)(a,{label:`Running`,value:c.running}),(0,g.jsx)(a,{label:`Completed`,value:c.completed}),(0,g.jsx)(a,{label:`Errors`,value:c.errors})]})]}),(0,g.jsxs)(n,{children:[(0,g.jsx)(t,{title:`Library Stats`}),f&&(0,g.jsxs)(e,{minWidth:200,children:[(0,g.jsx)(a,{label:`Total Files`,value:f.total_files}),(0,g.jsx)(a,{label:`Artists`,value:f.unique_artists}),(0,g.jsx)(a,{label:`Albums`,value:f.unique_albums}),(0,g.jsx)(a,{label:`Total Duration`,value:O(f.total_duration_seconds)})]})]}),(0,g.jsxs)(n,{children:[(0,g.jsx)(t,{title:`Recent Activity`}),(0,g.jsx)(p,{color:`text.secondary`,fontStyle:`italic`,children:`Recently processed tracks and system events will appear here.`})]})]})]})}export{_ as DashboardPage};