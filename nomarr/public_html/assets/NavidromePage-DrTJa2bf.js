import{t as e}from"./Stack-CHbb6P4R.js";import{t}from"./TextField-dZ6ShoYp.js";import"./useSlotProps--BZhkIc6.js";import{a as n,i as r,n as i,r as a,t as o}from"./TableRow-Dn6eU1pa.js";import{C as s,D as c,Dt as l,Et as u,_t as d,a as f,c as p,g as m,h,l as g,r as _,u as v,w as y}from"./index-uH8yfxIe.js";import{t as b}from"./useNotification-DrfMeyUT.js";var x=l(d(),1),S=l(u(),1);async function C(){return _(`/api/web/navidrome/preview`)}async function w(){return _(`/api/web/navidrome/config`)}async function T(e,t=10){return f(`/api/web/navidrome/playlists/preview`,{query:e,preview_limit:t})}async function E(e){return f(`/api/web/navidrome/playlists/generate`,e)}function D({preview:c,configText:l,loading:u,error:d,onLoadPreview:f,onGenerateConfig:g}){let{showSuccess:_}=b();return(0,x.jsxs)(e,{spacing:2.5,children:[(0,x.jsxs)(m,{children:[(0,x.jsx)(h,{title:`Navidrome TOML Configuration`}),(0,x.jsxs)(e,{spacing:1.25,children:[(0,x.jsx)(s,{onClick:f,disabled:u,variant:`contained`,fullWidth:!0,children:u?`Loading...`:`Load Tag Preview`}),(0,x.jsx)(s,{onClick:g,disabled:u,variant:`contained`,fullWidth:!0,children:u?`Generating...`:`Generate Config`})]}),d&&(0,x.jsxs)(p,{children:[`Error: `,d]})]}),c&&(0,x.jsxs)(m,{children:[(0,x.jsx)(h,{title:`Tag Preview`}),(0,x.jsx)(y,{sx:{overflowX:`auto`},children:(0,x.jsxs)(n,{children:[(0,x.jsx)(i,{children:(0,x.jsxs)(o,{children:[(0,x.jsx)(a,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Tag`}),(0,x.jsx)(a,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Type`}),(0,x.jsx)(a,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Multivalue`}),(0,x.jsx)(a,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Count`}),(0,x.jsx)(a,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Summary`})]})}),(0,x.jsx)(r,{children:c.map(e=>(0,x.jsxs)(o,{children:[(0,x.jsx)(a,{sx:{borderColor:`divider`},children:e.tag_key}),(0,x.jsx)(a,{sx:{borderColor:`divider`},children:e.type}),(0,x.jsx)(a,{sx:{borderColor:`divider`},children:e.is_multivalue?`Yes`:`No`}),(0,x.jsx)(a,{sx:{borderColor:`divider`},children:e.total_count}),(0,x.jsx)(a,{sx:{borderColor:`divider`},children:e.summary})]},e.tag_key))})]})})]}),l&&(0,x.jsxs)(m,{children:[(0,x.jsx)(h,{title:`Generated Config`}),(0,x.jsx)(t,{multiline:!0,rows:20,value:l,fullWidth:!0,InputProps:{readOnly:!0,sx:{fontFamily:`monospace`,fontSize:`0.875rem`}}}),(0,x.jsx)(s,{onClick:()=>{l&&(navigator.clipboard.writeText(l),_(`Copied to clipboard!`))},variant:`contained`,sx:{mt:1.25},children:`Copy to Clipboard`})]})]})}function O({query:n,name:r,comment:i,limit:a,sort:o,preview:l,content:u,loading:d,error:f,onQueryChange:g,onNameChange:_,onCommentChange:v,onLimitChange:b,onSortChange:S,onPreview:C,onGenerate:w}){return(0,x.jsxs)(e,{spacing:2.5,children:[(0,x.jsxs)(m,{children:[(0,x.jsx)(h,{title:`Smart Playlist Generator`}),(0,x.jsx)(y,{component:`form`,onSubmit:C,children:(0,x.jsxs)(e,{spacing:2,children:[(0,x.jsxs)(y,{children:[(0,x.jsx)(c,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Query *`}),(0,x.jsx)(t,{value:n,onChange:e=>g(e.target.value),placeholder:`e.g., tag:nom_happy > 0.8`,multiline:!0,rows:3,disabled:d,required:!0,fullWidth:!0,InputProps:{sx:{fontFamily:`monospace`,fontSize:`0.875rem`}}})]}),(0,x.jsxs)(y,{children:[(0,x.jsx)(c,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Playlist Name *`}),(0,x.jsx)(t,{value:r,onChange:e=>_(e.target.value),disabled:d,required:!0,fullWidth:!0})]}),(0,x.jsxs)(y,{children:[(0,x.jsx)(c,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Comment`}),(0,x.jsx)(t,{value:i,onChange:e=>v(e.target.value),disabled:d,fullWidth:!0})]}),(0,x.jsxs)(y,{sx:{display:`grid`,gridTemplateColumns:`1fr 1fr`,gap:1.25},children:[(0,x.jsxs)(y,{children:[(0,x.jsx)(c,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Limit`}),(0,x.jsx)(t,{type:`number`,value:a??``,onChange:e=>b(e.target.value?parseInt(e.target.value):void 0),disabled:d,placeholder:`Optional`,fullWidth:!0})]}),(0,x.jsxs)(y,{children:[(0,x.jsx)(c,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Sort`}),(0,x.jsx)(t,{value:o,onChange:e=>S(e.target.value),disabled:d,placeholder:`Optional`,fullWidth:!0})]})]}),(0,x.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,x.jsx)(s,{type:`submit`,variant:`contained`,disabled:d,fullWidth:!0,children:d?`Loading...`:`Preview Query`}),(0,x.jsx)(s,{type:`button`,onClick:w,variant:`contained`,disabled:d,fullWidth:!0,children:d?`Generating...`:`Generate .nsp`})]})]})}),f&&(0,x.jsxs)(p,{children:[`Error: `,f]})]}),l&&(0,x.jsxs)(m,{children:[(0,x.jsx)(h,{title:`Query Preview`}),(0,x.jsx)(y,{component:`pre`,sx:{p:2,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,overflow:`auto`,fontSize:`0.875rem`,fontFamily:`monospace`},children:JSON.stringify(l,null,2)})]}),u&&(0,x.jsxs)(m,{children:[(0,x.jsx)(h,{title:`Generated Playlist (.nsp)`}),(0,x.jsx)(t,{multiline:!0,rows:15,value:u,fullWidth:!0,InputProps:{readOnly:!0,sx:{fontFamily:`monospace`,fontSize:`0.875rem`}}}),(0,x.jsx)(s,{onClick:()=>{if(u){let e=new Blob([u],{type:`text/plain`}),t=URL.createObjectURL(e),n=document.createElement(`a`);n.href=t,n.download=`${r}.nsp`,n.click(),URL.revokeObjectURL(t)}},variant:`contained`,sx:{mt:1.25},children:`Download .nsp File`})]})]})}function k(){let{showError:e}=b(),[t,n]=(0,S.useState)(null),[r,i]=(0,S.useState)(null),[a,o]=(0,S.useState)(!1),[s,c]=(0,S.useState)(null),[l,u]=(0,S.useState)(``),[d,f]=(0,S.useState)(`My Playlist`),[p,m]=(0,S.useState)(``),[h,g]=(0,S.useState)(void 0),[_,v]=(0,S.useState)(``),[y,x]=(0,S.useState)(null),[D,O]=(0,S.useState)(null),[k,A]=(0,S.useState)(!1),[j,M]=(0,S.useState)(null);return{configPreview:t,configText:r,configLoading:a,configError:s,playlistQuery:l,playlistName:d,playlistComment:p,playlistLimit:h,playlistSort:_,playlistPreview:y,playlistContent:D,playlistLoading:k,playlistError:j,loadConfigPreview:async()=>{try{o(!0),c(null),n((await C()).tags)}catch(e){c(e instanceof Error?e.message:`Failed to load preview`)}finally{o(!1)}},generateConfig:async()=>{try{o(!0),c(null),i((await w()).config)}catch(e){c(e instanceof Error?e.message:`Failed to generate config`)}finally{o(!1)}},previewPlaylist:async e=>{if(e.preventDefault(),l.trim())try{A(!0),M(null),x(await T(l,10))}catch(e){M(e instanceof Error?e.message:`Failed to preview playlist`)}finally{A(!1)}},generatePlaylist:async()=>{if(!l.trim()){e(`Query is required`);return}if(!d.trim()){e(`Playlist name is required`);return}try{A(!0),M(null),O((await E({query:l,playlist_name:d,comment:p,limit:h,sort:_||void 0})).content)}catch(e){M(e instanceof Error?e.message:`Failed to generate playlist`)}finally{A(!1)}},setPlaylistQuery:u,setPlaylistName:f,setPlaylistComment:m,setPlaylistLimit:g,setPlaylistSort:v}}function A(){let[e,t]=(0,S.useState)(`config`),{configPreview:n,configText:r,configLoading:i,configError:a,playlistQuery:o,playlistName:s,playlistComment:c,playlistLimit:l,playlistSort:u,playlistPreview:d,playlistContent:f,playlistLoading:p,playlistError:m,loadConfigPreview:h,generateConfig:_,previewPlaylist:y,generatePlaylist:b,setPlaylistQuery:C,setPlaylistName:w,setPlaylistComment:T,setPlaylistLimit:E,setPlaylistSort:A}=k();return(0,x.jsxs)(g,{title:`Navidrome Integration`,children:[(0,x.jsx)(v,{tabs:[{id:`config`,label:`Config Generator`},{id:`playlist`,label:`Playlist Generator`}],activeTab:e,onTabChange:e=>t(e)}),e===`config`&&(0,x.jsx)(D,{preview:n,configText:r,loading:i,error:a,onLoadPreview:h,onGenerateConfig:_}),e===`playlist`&&(0,x.jsx)(O,{query:o,name:s,comment:c,limit:l,sort:u,preview:d,content:f,loading:p,error:m,onQueryChange:C,onNameChange:w,onCommentChange:T,onLimitChange:E,onSortChange:A,onPreview:y,onGenerate:b})]})}export{A as NavidromePage};