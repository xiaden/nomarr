import{t as e}from"./Stack-CDy2Wfdf.js";import{a as t,o as n,s as r,t as i}from"./TextField-CIuD8ryX.js";import{n as a}from"./useSlotProps-By36iWK-.js";import{t as o}from"./Chip-BYawHei2.js";import{t as s}from"./ServerFilePicker-D5_dH_NU.js";import{a as c,c as l,i as u,n as d,o as ee,r as f,s as te,t as ne}from"./library-CA9bBme1.js";import{t as p}from"./config-Cobm8jKM.js";import{C as m,D as h,Dt as g,Et as _,I as v,M as y,N as b,Q as x,X as S,Z as C,_t as w,c as T,et as E,f as D,ft as O,g as k,h as A,l as j,m as re,mt as M,nt as N,o as ie,ot as P,pt as F,rt as I,w as L}from"./index-DYVoQaaX.js";import{t as ae}from"./useConfirmDialog-CXpXnTno.js";import{t as oe}from"./useNotification-rEoqVTeN.js";function R(e){return F(`PrivateSwitchBase`,e)}O(`PrivateSwitchBase`,[`root`,`checked`,`disabled`,`input`,`edgeStart`,`edgeEnd`]);var z=g(_()),B=g(w()),V=e=>{let{classes:t,checked:n,disabled:r,edge:i}=e;return P({root:[`root`,n&&`checked`,r&&`disabled`,i&&`edge${x(i)}`],input:[`input`]},R,t)},H=N(b,{name:`MuiSwitchBase`})({padding:9,borderRadius:`50%`,variants:[{props:{edge:`start`,size:`small`},style:{marginLeft:-3}},{props:({edge:e,ownerState:t})=>e===`start`&&t.size!==`small`,style:{marginLeft:-12}},{props:{edge:`end`,size:`small`},style:{marginRight:-3}},{props:({edge:e,ownerState:t})=>e===`end`&&t.size!==`small`,style:{marginRight:-12}}]}),U=N(`input`,{name:`MuiSwitchBase`,shouldForwardProp:I})({cursor:`inherit`,position:`absolute`,opacity:0,width:`100%`,height:`100%`,top:0,left:0,margin:0,padding:0,zIndex:1}),W=z.forwardRef(function(e,n){let{autoFocus:r,checked:i,checkedIcon:o,defaultChecked:s,disabled:c,disableFocusRipple:l=!1,edge:u=!1,icon:d,id:ee,inputProps:f,inputRef:te,name:ne,onBlur:p,onChange:m,onFocus:h,readOnly:g,required:_=!1,tabIndex:y,type:b,value:x,slots:S={},slotProps:C={},...w}=e,[T,E]=a({controlled:i,default:!!s,name:`SwitchBase`,state:`checked`}),D=t(),O=e=>{h&&h(e),D&&D.onFocus&&D.onFocus(e)},k=e=>{p&&p(e),D&&D.onBlur&&D.onBlur(e)},A=e=>{if(e.nativeEvent.defaultPrevented)return;let t=e.target.checked;E(t),m&&m(e,t)},j=c;D&&j===void 0&&(j=D.disabled);let re=b===`checkbox`||b===`radio`,M={...e,checked:T,disabled:j,disableFocusRipple:l,edge:u},N=V(M),ie={slots:S,slotProps:{input:f,...C}},[P,F]=v(`root`,{ref:n,elementType:H,className:N.root,shouldForwardComponentProp:!0,externalForwardedProps:{...ie,component:`span`,...w},getSlotProps:e=>({...e,onFocus:t=>{e.onFocus?.(t),O(t)},onBlur:t=>{e.onBlur?.(t),k(t)}}),ownerState:M,additionalProps:{centerRipple:!0,focusRipple:!l,disabled:j,role:void 0,tabIndex:null}}),[I,L]=v(`input`,{ref:te,elementType:U,className:N.input,externalForwardedProps:ie,getSlotProps:e=>({...e,onChange:t=>{e.onChange?.(t),A(t)}}),ownerState:M,additionalProps:{autoFocus:r,checked:i,defaultChecked:s,disabled:j,id:re?ee:void 0,name:ne,readOnly:g,required:_,tabIndex:y,type:b,...b===`checkbox`&&x===void 0?{}:{value:x}}});return(0,B.jsxs)(P,{...F,children:[(0,B.jsx)(I,{...L}),T?o:d]})}),G=S((0,B.jsx)(`path`,{d:`M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z`}),`CheckBoxOutlineBlank`),K=S((0,B.jsx)(`path`,{d:`M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z`}),`CheckBox`),q=S((0,B.jsx)(`path`,{d:`M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z`}),`IndeterminateCheckBox`);function se(e){return F(`MuiCheckbox`,e)}var J=O(`MuiCheckbox`,[`root`,`checked`,`disabled`,`indeterminate`,`colorPrimary`,`colorSecondary`,`sizeSmall`,`sizeMedium`]),ce=e=>{let{classes:t,indeterminate:n,color:r,size:i}=e,a=P({root:[`root`,n&&`indeterminate`,`color${x(r)}`,`size${x(i)}`]},se,t);return{...t,...a}},Y=N(W,{shouldForwardProp:e=>I(e)||e===`classes`,name:`MuiCheckbox`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${x(n.size)}`],n.color!==`default`&&t[`color${x(n.color)}`]]}})(C(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:`default`,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(y()).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(y()).map(([t])=>({props:{color:t},style:{[`&.${J.checked}, &.${J.indeterminate}`]:{color:(e.vars||e).palette[t].main},[`&.${J.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:`transparent`}}}}]}))),X=(0,B.jsx)(K,{}),le=(0,B.jsx)(G,{}),Z=(0,B.jsx)(q,{}),ue=z.forwardRef(function(e,t){let n=E({props:e,name:`MuiCheckbox`}),{checkedIcon:i=X,color:a=`primary`,icon:o=le,indeterminate:s=!1,indeterminateIcon:c=Z,inputProps:l,size:u=`medium`,disableRipple:d=!1,className:ee,slots:f={},slotProps:te={},...ne}=n,p=s?c:o,m=s?c:i,h={...n,disableRipple:d,color:a,indeterminate:s,size:u},g=ce(h),_=te.input??l,[y,b]=v(`root`,{ref:t,elementType:Y,className:M(g.root,ee),shouldForwardComponentProp:!0,externalForwardedProps:{slots:f,slotProps:te,...ne},ownerState:h,additionalProps:{type:`checkbox`,icon:z.cloneElement(p,{fontSize:p.props.fontSize??u}),checkedIcon:z.cloneElement(m,{fontSize:m.props.fontSize??u}),disableRipple:d,slots:f,slotProps:{input:r(typeof _==`function`?_(h):_,{"data-indeterminate":s})}}});return(0,B.jsx)(y,{...b,classes:g})});function Q(e){return F(`MuiFormControlLabel`,e)}var $=O(`MuiFormControlLabel`,[`root`,`labelPlacementStart`,`labelPlacementTop`,`labelPlacementBottom`,`disabled`,`label`,`error`,`required`,`asterisk`]),de=e=>{let{classes:t,disabled:n,labelPlacement:r,error:i,required:a}=e;return P({root:[`root`,n&&`disabled`,`labelPlacement${x(r)}`,i&&`error`,a&&`required`],label:[`label`,n&&`disabled`],asterisk:[`asterisk`,i&&`error`]},Q,t)};const fe=N(`label`,{name:`MuiFormControlLabel`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${$.label}`]:t.label},t.root,t[`labelPlacement${x(n.labelPlacement)}`]]}})(C(({theme:e})=>({display:`inline-flex`,alignItems:`center`,cursor:`pointer`,verticalAlign:`middle`,WebkitTapHighlightColor:`transparent`,marginLeft:-11,marginRight:16,[`&.${$.disabled}`]:{cursor:`default`},[`& .${$.label}`]:{[`&.${$.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:`start`},style:{flexDirection:`row-reverse`,marginRight:-11}},{props:{labelPlacement:`top`},style:{flexDirection:`column-reverse`}},{props:{labelPlacement:`bottom`},style:{flexDirection:`column`}},{props:({labelPlacement:e})=>e===`start`||e===`top`||e===`bottom`,style:{marginLeft:16}}]})));var pe=N(`span`,{name:`MuiFormControlLabel`,slot:`Asterisk`})(C(({theme:e})=>({[`&.${$.error}`]:{color:(e.vars||e).palette.error.main}}))),me=z.forwardRef(function(e,r){let i=E({props:e,name:`MuiFormControlLabel`}),{checked:a,className:o,componentsProps:s={},control:c,disabled:l,disableTypography:u,inputRef:d,label:ee,labelPlacement:f=`end`,name:te,onChange:ne,required:p,slots:m={},slotProps:g={},value:_,...y}=i,b=t(),x=l??c.props.disabled??b?.disabled,S=p??c.props.required,C={disabled:x,required:S};[`checked`,`name`,`onChange`,`value`,`inputRef`].forEach(e=>{c.props[e]===void 0&&i[e]!==void 0&&(C[e]=i[e])});let w=n({props:i,muiFormControl:b,states:[`error`]}),T={...i,disabled:x,labelPlacement:f,required:S,error:w.error},D=de(T),[O,k]=v(`typography`,{elementType:h,externalForwardedProps:{slots:m,slotProps:{...s,...g}},ownerState:T}),A=ee;return A!=null&&A.type!==h&&!u&&(A=(0,B.jsx)(O,{component:`span`,...k,className:M(D.label,k?.className),children:A})),(0,B.jsxs)(fe,{className:M(D.root,o),ownerState:T,ref:r,...y,children:[z.cloneElement(c,C),S?(0,B.jsxs)(`div`,{children:[A,(0,B.jsxs)(pe,{ownerState:T,"aria-hidden":!0,className:D.asterisk,children:[` `,`*`]})]}):A]})});function he(){let{showSuccess:t}=oe(),{confirm:n,isOpen:r,options:a,handleConfirm:f,handleCancel:g}=ae(),[_,v]=(0,z.useState)([]),[y,b]=(0,z.useState)(!0),[x,S]=(0,z.useState)(null),[C,w]=(0,z.useState)(!1),[E,D]=(0,z.useState)(null),[O,j]=(0,z.useState)(null),[re,M]=(0,z.useState)(null),[N,P]=(0,z.useState)(null),[F,I]=(0,z.useState)(``),[R,V]=(0,z.useState)(``),[H,U]=(0,z.useState)(!0),[W,G]=(0,z.useState)(!1),[K,q]=(0,z.useState)(!1),[se,J]=(0,z.useState)(null),[ce,Y]=(0,z.useState)(!1),X=async()=>{try{b(!0),S(null),v(await u())}catch(e){S(e instanceof Error?e.message:`Failed to load libraries`),console.error(`[LibraryManagement] Load error:`,e)}finally{b(!1)}},le=async()=>{try{P((await p()).library_root||null)}catch(e){console.error(`[LibraryManagement] Failed to load config:`,e)}};(0,z.useEffect)(()=>{X(),le()},[]);let Z=e=>{if(!N)return!1;let t=N.replace(/\/+$/,``);return!e.replace(/\/+$/,``).startsWith(t)},Q=()=>{I(``),V(``),U(!0),G(!1),q(!1),J(null),Y(!1),w(!1),D(null)},$=()=>{Q(),w(!0)},de=e=>{I(e.name),V(e.rootPath),U(e.isEnabled),G(e.isDefault),D(e.id),w(!1),J(null),Y(!1)},fe=async()=>{if(!R.trim()){S(`Path is required for preview`);return}if(E===null){S(`Create the library first to preview file count`);return}try{S(null),Y(!0),J((await c(E,{recursive:!0})).file_count)}catch(e){S(e instanceof Error?e.message:`Failed to preview library`)}finally{Y(!1)}},pe=async()=>{if(!F.trim()||!R.trim()){S(`Name and path are required`);return}try{S(null),await ne({name:F,rootPath:R,isEnabled:H,isDefault:W}),await X(),Q()}catch(e){S(e instanceof Error?e.message:`Failed to create library`)}},he=async()=>{if(E!==null){if(!F.trim()||!R.trim()){S(`Name and path are required`);return}try{S(null),await l(E,{name:F,rootPath:R,isEnabled:H,isDefault:W}),await X(),Q()}catch(e){S(e instanceof Error?e.message:`Failed to update library`)}}},ge=async e=>{try{S(null),await te(e),await X()}catch(e){S(e instanceof Error?e.message:`Failed to set default library`)}},_e=async e=>{try{if(S(null),j(e),M(`preparing`),!await n({title:`Start Library Scan?`,message:`Found ${(await c(e,{recursive:!0})).file_count.toLocaleString()} audio files. Start scan?`}))return;M(`queueing`);let r=await ee(e,{recursive:!0,force:!1,cleanMissing:!0});t(`Scan ${r.status}: ${r.message||`Library scan queued`}`),await X()}catch(e){S(e instanceof Error?e.message:`Failed to scan library`)}finally{j(null),M(null)}},ve=async(e,t,r)=>{if(r){S(`Cannot delete the default library. Set another library as default first.`);return}if(await n({title:`Delete Library?`,message:`Delete library "${t}"?\n\nThis will remove the library entry but will NOT delete files on disk.`,severity:`warning`}))try{S(null),await d(e),await X()}catch(e){S(e instanceof Error?e.message:`Failed to delete library`)}},ye=C||E!==null;return(0,B.jsxs)(e,{spacing:2.5,children:[(0,B.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`center`,children:[(0,B.jsx)(h,{variant:`h5`,children:`Libraries`}),!ye&&(0,B.jsx)(m,{variant:`contained`,onClick:$,children:`+ Add Library`})]}),x&&(0,B.jsx)(T,{children:x}),ye&&(0,B.jsxs)(k,{children:[(0,B.jsx)(A,{title:C?`Create Library`:`Edit Library`}),(0,B.jsxs)(e,{spacing:2,children:[(0,B.jsxs)(L,{children:[(0,B.jsx)(h,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Name`}),(0,B.jsx)(i,{value:F,onChange:e=>I(e.target.value),placeholder:`My Music Library`,fullWidth:!0})]}),(0,B.jsxs)(L,{children:[(0,B.jsx)(h,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Root Path`}),(0,B.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,B.jsx)(i,{value:R,onChange:e=>V(e.target.value),placeholder:`/music`,fullWidth:!0}),(0,B.jsx)(m,{variant:`outlined`,onClick:()=>q(!K),sx:{minWidth:120},children:K?`Hide Picker`:`Browse...`})]}),K&&(0,B.jsx)(L,{sx:{mt:1.25,p:2,bgcolor:`background.default`,borderRadius:1,border:1,borderColor:`divider`},children:(0,B.jsx)(s,{value:R,onChange:e=>{V(e),q(!1)},mode:`directory`,label:`Select Library Root Directory`})})]}),(0,B.jsx)(me,{control:(0,B.jsx)(ue,{checked:H,onChange:e=>U(e.target.checked)}),label:`Enabled`}),(0,B.jsx)(me,{control:(0,B.jsx)(ue,{checked:W,onChange:e=>G(e.target.checked)}),label:`Default Library`}),E!==null&&(0,B.jsxs)(L,{children:[(0,B.jsx)(m,{variant:`outlined`,onClick:fe,disabled:!R.trim()||ce,children:ce?`Checking...`:`Preview File Count`}),se!==null&&(0,B.jsx)(L,{sx:{mt:1,p:1.5,bgcolor:`background.paper`,borderRadius:1,border:1,borderColor:`divider`},children:(0,B.jsxs)(h,{children:[(0,B.jsx)(`strong`,{children:se.toLocaleString()}),` audio files found`]})})]}),(0,B.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,B.jsx)(m,{variant:`contained`,onClick:C?pe:he,children:C?`Create`:`Update`}),(0,B.jsx)(m,{variant:`outlined`,onClick:Q,children:`Cancel`})]})]})]}),y&&(0,B.jsx)(h,{children:`Loading libraries...`}),!y&&!ye&&_.length===0&&(0,B.jsx)(k,{children:(0,B.jsx)(h,{color:`text.secondary`,textAlign:`center`,fontStyle:`italic`,children:`No libraries configured. Click "Add Library" to get started.`})}),!y&&!ye&&_.length>0&&(0,B.jsx)(e,{spacing:2,children:_.map(t=>(0,B.jsxs)(k,{children:[(0,B.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`flex-start`,sx:{mb:2},children:[(0,B.jsxs)(L,{children:[(0,B.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1.25,sx:{mb:.5},children:[(0,B.jsx)(h,{variant:`h6`,children:t.name}),t.isDefault&&(0,B.jsx)(o,{label:`Default`,color:`primary`,size:`small`}),Z(t.rootPath)&&(0,B.jsx)(o,{label:`Outside library_root`,color:`warning`,size:`small`})]}),(0,B.jsx)(h,{variant:`body2`,color:`text.secondary`,sx:{fontFamily:`monospace`},children:t.rootPath}),Z(t.rootPath)&&(0,B.jsxs)(h,{variant:`caption`,color:`warning.main`,sx:{mt:.5},children:[`⚠ This library is outside the configured library_root (`,N,`)`]})]}),(0,B.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,children:[(0,B.jsx)(L,{sx:{width:8,height:8,borderRadius:`50%`,bgcolor:t.isEnabled?`success.main`:`text.disabled`}}),(0,B.jsx)(h,{variant:`body2`,color:`text.secondary`,children:t.isEnabled?`Enabled`:`Disabled`})]})]}),(0,B.jsxs)(e,{direction:`row`,spacing:1.25,flexWrap:`wrap`,children:[(0,B.jsx)(m,{variant:`outlined`,size:`small`,onClick:()=>de(t),disabled:O===t.id,children:`Edit`}),!t.isDefault&&(0,B.jsx)(m,{variant:`outlined`,size:`small`,onClick:()=>ge(t.id),disabled:O===t.id,children:`Set Default`}),(0,B.jsx)(m,{variant:`contained`,color:`success`,size:`small`,onClick:()=>_e(t.id),disabled:!t.isEnabled||O===t.id||Z(t.rootPath),title:Z(t.rootPath)?`Cannot scan: library is outside library_root`:void 0,children:O===t.id?re===`preparing`?`Preparing...`:`Queueing...`:`Scan`}),(0,B.jsx)(m,{variant:`contained`,color:`error`,size:`small`,onClick:()=>ve(t.id,t.name,t.isDefault),disabled:O===t.id,children:`Delete`})]})]},t.id))}),(0,B.jsx)(ie,{open:r,title:a.title,message:a.message,confirmLabel:a.confirmLabel,cancelLabel:a.cancelLabel,severity:a.severity,onConfirm:f,onCancel:g})]})}function ge({stats:e}){let t=[{label:`Total Files`,value:e.total_files},{label:`Artists`,value:e.unique_artists},{label:`Albums`,value:e.unique_albums},{label:`Total Duration`,value:(e=>`${Math.floor(e/3600)}h ${Math.floor(e%3600/60)}m`)(e.total_duration_seconds)}];return(0,B.jsxs)(k,{children:[(0,B.jsx)(A,{title:`Library Statistics`}),(0,B.jsx)(D,{minColumnWidth:200,children:t.map(e=>(0,B.jsx)(re,{label:e.label,value:e.value},e.label))})]})}function _e(){let[e,t]=(0,z.useState)(null),[n,r]=(0,z.useState)(!0),[i,a]=(0,z.useState)(null),o=async()=>{try{r(!0),a(null),t(await f())}catch(e){a(e instanceof Error?e.message:`Failed to load stats`),console.error(`[Library] Load error:`,e)}finally{r(!1)}};return(0,z.useEffect)(()=>{o()},[]),{stats:e,loading:n,error:i}}function ve(){let{stats:t,loading:n,error:r}=_e();return(0,B.jsxs)(j,{title:`Library Management`,children:[n&&(0,B.jsx)(h,{children:`Loading library statistics...`}),r&&(0,B.jsxs)(T,{children:[`Error: `,r]}),t&&(0,B.jsxs)(e,{spacing:2.5,children:[(0,B.jsx)(ge,{stats:t}),(0,B.jsx)(k,{children:(0,B.jsx)(he,{})})]})]})}export{ve as LibraryPage};