import{t as e}from"./Stack-L1UqHbhy.js";import"./listItemTextClasses-Uhd-dstd.js";import{n as t,r as n,t as r}from"./TextField-BN02J0Qc.js";import"./useControlled-D4vMBhe9.js";import{a as i,c as a,i as o,l as s,n as c,o as l,r as u,s as d,t as f,u as p}from"./useNotification-Cc5v4Swf.js";import{J as m,R as h,U as g,V as _,_ as v,a as y,an as b,ct as x,et as S,g as C,gn as w,h as T,it as E,o as D,ot as O,q as k,tt as A,v as j,vn as M,w as N,y as P}from"./index-xFlYkpsF.js";import{t as F}from"./useConfirmDialog-h5hSsxcQ.js";var I=M(w(),1),L=M(b(),1);function R({value:e,onChange:t,mode:n=`directory`,label:r,libraryRoot:i}){let a=n??`directory`,[o,s]=(0,I.useState)(``),[c,l]=(0,I.useState)([]),[u,d]=(0,I.useState)(!1),[f,p]=(0,I.useState)(null),m=(0,I.useCallback)(async e=>{d(!0),p(null);try{l((await N(i?e?`${i}/${e}`:i:e||void 0)).entries)}catch(e){p(e instanceof Error?e.message:`Failed to load directory`),l([])}finally{d(!1)}},[i]);(0,I.useEffect)(()=>{m(o)},[o,m]);let h=e=>{s(o?`${o}/${e}`:e)},g=e=>{s(o.split(`/`).filter(e=>e).slice(0,e+1).join(`/`))},_=()=>{s(``)},v=e=>{e.is_dir?h(e.name):(a===`file`||a===`either`)&&t(o?`${o}/${e.name}`:e.name)},y=()=>{(a===`directory`||a===`either`)&&t(o)},b=e=>e.is_dir?!1:a===`file`||a===`either`,x=o.split(`/`).filter(e=>e);return(0,L.jsxs)(`div`,{className:`server-file-picker`,children:[r&&(0,L.jsx)(`label`,{className:`picker-label`,children:r}),(0,L.jsxs)(`div`,{className:`breadcrumbs`,children:[(0,L.jsx)(`button`,{type:`button`,className:`breadcrumb-item root`,onClick:_,children:`Library Root`}),x.map((e,t)=>(0,L.jsxs)(`span`,{children:[(0,L.jsx)(`span`,{className:`breadcrumb-separator`,children:`/`}),(0,L.jsx)(`button`,{type:`button`,className:`breadcrumb-item`,onClick:()=>g(t),children:e})]},t))]}),(0,L.jsxs)(`div`,{className:`current-path`,children:[(0,L.jsx)(`strong`,{children:`Current:`}),` /`,o||``]}),(a===`directory`||a===`either`)&&(0,L.jsx)(`div`,{className:`select-current`,children:(0,L.jsx)(`button`,{type:`button`,className:`btn-select-current`,onClick:y,children:`Select This Folder`})}),u&&(0,L.jsx)(`div`,{className:`loading`,children:`Loading...`}),f&&(0,L.jsx)(`div`,{className:`error`,children:f}),!u&&!f&&c.length===0&&(0,L.jsx)(`div`,{className:`empty`,children:`Empty directory`}),!u&&!f&&c.length>0&&(0,L.jsx)(`ul`,{className:`entries-list`,children:c.map((t,n)=>{let r=b(t),i=e&&e===(o?`${o}/${t.name}`:t.name);return(0,L.jsx)(`li`,{className:`entry-item`,children:(0,L.jsxs)(`button`,{type:`button`,className:`entry-button ${t.is_dir?`directory`:`file`} ${r?`selectable`:`non-selectable`} ${i?`selected`:``}`,onClick:()=>v(t),disabled:!t.is_dir&&!r,children:[(0,L.jsx)(`span`,{className:`entry-icon`,children:t.is_dir?`ðŸ“`:`ðŸŽµ`}),(0,L.jsx)(`span`,{className:`entry-name`,children:t.name})]})},n)})}),(0,L.jsxs)(`div`,{className:`selected-value`,children:[(0,L.jsx)(`strong`,{children:`Selected:`}),` `,e||`(none)`]})]})}function z(){let{confirm:t}=F(),[n,a]=(0,I.useState)(``),[s,c]=(0,I.useState)(null),[f,p]=(0,I.useState)(!1),[h,g]=(0,I.useState)(null),[_,v]=(0,I.useState)(!1),[y,b]=(0,I.useState)(!1),[x,C]=(0,I.useState)(null),w=async e=>{if(e.preventDefault(),n.trim())try{p(!0),g(null),C(null),c(await P(n))}catch(e){g(e instanceof Error?e.message:`Failed to load tags`),c(null),console.error(`[Inspect] Load error:`,e)}finally{p(!1)}},T=async()=>{if(n.trim()&&await t({title:`Remove All Tags?`,message:`Remove all tags from ${n}?\n\nThis cannot be undone!`,severity:`warning`}))try{b(!0),g(null),C(null);let e=await j(n);C(`Removed ${e.removed} tag(s) from ${e.path}`),c(await P(n))}catch(e){g(e instanceof Error?e.message:`Failed to remove tags`),console.error(`[Inspect] Remove error:`,e)}finally{b(!1)}},D=e=>Array.isArray(e)?e.join(`, `):String(e);return(0,L.jsxs)(m,{children:[(0,L.jsx)(k,{title:`Inspect Tags`}),(0,L.jsx)(E,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Debug tool to view and remove tags from individual audio files.`}),(0,L.jsx)(`form`,{onSubmit:w,children:(0,L.jsxs)(e,{spacing:2,children:[(0,L.jsxs)(A,{sx:{display:`flex`,gap:1.25,alignItems:`center`},children:[(0,L.jsx)(r,{label:`File Path`,value:n,onChange:e=>a(e.target.value),placeholder:`/music/artist/album/track.flac`,fullWidth:!0,size:`small`,disabled:f||y}),(0,L.jsx)(S,{type:`button`,variant:`outlined`,onClick:()=>v(!0),disabled:f||y,sx:{whiteSpace:`nowrap`,minWidth:`fit-content`},children:`Browse Files`}),(0,L.jsx)(S,{type:`submit`,variant:`contained`,disabled:!n.trim()||f||y,sx:{whiteSpace:`nowrap`,minWidth:`fit-content`},children:f?`Loading...`:`Show Tags`})]}),h&&(0,L.jsx)(O,{severity:`error`,children:h}),x&&(0,L.jsx)(O,{severity:`success`,children:x}),_&&(0,L.jsx)(A,{sx:{mt:2},children:(0,L.jsx)(R,{value:n,onChange:e=>{a(e),v(!1)},mode:`file`,label:`Select Audio File`})}),s&&(0,L.jsxs)(e,{spacing:2,children:[(0,L.jsxs)(A,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,py:1,px:2,backgroundColor:`action.hover`,borderRadius:1},children:[(0,L.jsxs)(E,{variant:`body2`,children:[(0,L.jsx)(`strong`,{children:`File:`}),` `,s.path]}),(0,L.jsxs)(E,{variant:`body2`,children:[(0,L.jsx)(`strong`,{children:`Tags:`}),` `,s.count]})]}),s.count>0&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(d,{size:`small`,children:[(0,L.jsx)(o,{children:(0,L.jsxs)(u,{children:[(0,L.jsx)(i,{children:(0,L.jsx)(`strong`,{children:`Key`})}),(0,L.jsx)(i,{children:(0,L.jsx)(`strong`,{children:`Value`})})]})}),(0,L.jsx)(l,{children:Object.entries(s.tags).map(([e,t])=>(0,L.jsxs)(u,{children:[(0,L.jsx)(i,{sx:{fontFamily:`monospace`},children:e}),(0,L.jsx)(i,{sx:{wordBreak:`break-all`},children:D(t)})]},e))})]}),(0,L.jsx)(A,{sx:{display:`flex`,justifyContent:`flex-end`},children:(0,L.jsx)(S,{onClick:T,variant:`outlined`,color:`error`,disabled:y,sx:{textTransform:`none`},children:y?`Removing...`:`Remove All Tags`})})]}),s.count===0&&(0,L.jsx)(O,{severity:`info`,children:`No tags found in this file.`})]})]})})]})}function B({onRestart:e,actionLoading:t}){return(0,L.jsxs)(m,{children:[(0,L.jsx)(k,{title:`System Controls`}),(0,L.jsx)(g,{label:`Restart Server`,description:`Stops and restarts the API server. Config changes will take effect. Page will reload automatically after restart.`,onClick:e,disabled:t,variant:`contained`,color:`error`})]})}function V({onPause:t,onResume:n,actionLoading:r}){return(0,L.jsxs)(m,{children:[(0,L.jsx)(k,{title:`Worker Controls`}),(0,L.jsxs)(e,{spacing:1.25,children:[(0,L.jsx)(g,{label:`Pause Worker`,description:`Stops the worker from processing queue jobs. Jobs remain in the queue.`,onClick:t,disabled:r}),(0,L.jsx)(g,{label:`Resume Worker`,description:`Starts the worker to process queue jobs.`,onClick:n,disabled:r})]})]})}function H(){let{showSuccess:e,showError:t}=f(),{confirm:n,isOpen:r,options:i,handleConfirm:a,handleCancel:o}=F(),[s,c]=(0,I.useState)(!1);return{actionLoading:s,handlePauseWorker:async()=>{if(await n({title:`Pause Worker?`,message:`Pause the worker? Processing will stop.`,confirmLabel:`Pause`,severity:`warning`}))try{c(!0),e((await T()).message)}catch(e){t(e instanceof Error?e.message:`Failed to pause worker`)}finally{c(!1)}},handleResumeWorker:async()=>{if(await n({title:`Resume Worker?`,message:`Resume the worker? Processing will start.`,confirmLabel:`Resume`}))try{c(!0),e((await v()).message)}catch(e){t(e instanceof Error?e.message:`Failed to resume worker`)}finally{c(!1)}},handleRestart:async()=>{if(await n({title:`Restart Server?`,message:`Restart the API server? The page will reload in a few seconds.`,confirmLabel:`Restart`,severity:`error`}))try{c(!0),e((await C()).message),setTimeout(()=>{window.location.reload()},3e3)}catch(e){t(e instanceof Error?e.message:`Failed to restart server`),c(!1)}},dialogState:{isOpen:r,options:i,handleConfirm:a,handleCancel:o}}}var U={file_write_mode:{label:`Tag Writing Mode`,description:`Controls which tags are written to audio files`,type:`select`,options:[{value:`none`,label:`None - Tags stored in database only`},{value:`minimal`,label:`Minimal - Essential tags only (artist, album, title, genre)`},{value:`full`,label:`Full - All generated tags written to files`}]},overwrite_tags:{label:`Overwrite Existing Tags`,description:`Whether to overwrite existing tags in audio files`,type:`boolean`},library_auto_tag:{label:`Auto-Tag New Files`,description:`Automatically process new files found during library scans`,type:`boolean`},library_ignore_patterns:{label:`Ignore Patterns`,description:`Comma-separated patterns to ignore during scanning (e.g., */Audiobooks/*,*.tmp)`,type:`text`},tagger_worker_count:{label:`Worker Threads`,description:`Number of parallel worker processes for tagging (0 = auto-detect)`,type:`text`},cache_idle_timeout:{label:`Cache Timeout (seconds)`,description:`How long to keep ML models in memory when idle`,type:`text`},calibrate_heads:{label:`Auto-Calibrate Heads`,description:`Automatically calibrate tag thresholds for optimal results`,type:`boolean`},calibration_repo:{label:`Calibration Repository`,description:`Git repository URL for calibration data downloads`,type:`text`}};function W({configKey:e,value:i,onChange:a,disabled:o}){let s=i==null?``:String(i),c=U[e],l=c?.label||e,u=c?.description,d=c?.type||(typeof i==`boolean`?`boolean`:`text`),f=c?.options||[];return(0,L.jsxs)(A,{sx:{display:`flex`,gap:2,alignItems:`flex-start`,py:1},children:[(0,L.jsxs)(A,{sx:{minWidth:`280px`,flexShrink:0},children:[(0,L.jsx)(E,{variant:`body2`,color:`text.primary`,sx:{fontWeight:500,mb:u?.5:0},children:l}),u&&(0,L.jsx)(E,{variant:`caption`,color:`text.secondary`,sx:{display:`block`},children:u})]}),(0,L.jsx)(A,{sx:{flex:1,maxWidth:`400px`},children:(()=>d===`select`&&f.length>0?(0,L.jsx)(t,{value:s,onChange:t=>a(e,t.target.value),disabled:o,size:`small`,fullWidth:!0,children:f.map(({value:e,label:t})=>(0,L.jsx)(n,{value:e,children:t},e))}):d===`boolean`?(0,L.jsxs)(t,{value:s,onChange:t=>a(e,t.target.value),disabled:o,size:`small`,fullWidth:!0,children:[(0,L.jsx)(n,{value:`true`,children:`true`}),(0,L.jsx)(n,{value:`false`,children:`false`})]}):(0,L.jsx)(r,{type:`text`,value:s,onChange:t=>a(e,t.target.value),disabled:o,size:`small`,fullWidth:!0,placeholder:u}))()})]})}function G({config:t,hasChanges:n,saveLoading:r,onChange:i,onSaveAll:a}){return(0,L.jsxs)(m,{children:[(0,L.jsx)(k,{title:`Settings`}),(0,L.jsx)(E,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Changes are saved to the database and will take effect on server restart. Use "Restart Server" in the Admin section below to apply changes.`}),(0,L.jsx)(e,{spacing:1.875,children:Object.entries(t).map(([e,t])=>(0,L.jsx)(W,{configKey:e,value:t,onChange:i,disabled:r},e))}),(0,L.jsxs)(A,{sx:{mt:3.75,display:`flex`,gap:1.25,alignItems:`center`},children:[(0,L.jsx)(S,{onClick:a,variant:`contained`,disabled:!n||r,sx:{whiteSpace:`nowrap`},children:r?`Saving...`:`Save All Changes`}),n&&(0,L.jsx)(E,{variant:`body2`,color:`warning.main`,children:`Unsaved changes`})]})]})}function K(){let{showSuccess:e,showError:t,showInfo:n}=f(),[r,i]=(0,I.useState)({}),[a,o]=(0,I.useState)({}),[s,c]=(0,I.useState)(!0),[l,u]=(0,I.useState)(null),[d,p]=(0,I.useState)(!1),[m,h]=(0,I.useState)(!1),g=async()=>{try{c(!0),u(null);let e=await y();i(e),o(e),h(!1)}catch(e){u(e instanceof Error?e.message:`Failed to load config`),console.error(`[Config] Load error:`,e)}finally{c(!1)}};return(0,I.useEffect)(()=>{g()},[]),(0,I.useEffect)(()=>{h(Object.keys(r).some(e=>r[e]!==a[e]))},[r,a]),{config:r,loading:s,error:l,saveLoading:d,hasChanges:m,handleSaveAll:async()=>{try{p(!0);let t=[];for(let e of Object.keys(r))if(r[e]!==a[e]){let n=r[e];if(n==null||n===``)continue;await D(e,String(n)),t.push(e)}if(t.length===0){n(`No changes to save`);return}e(`Saved ${t.length} config change(s). Use "Restart Server" in the Admin section to apply.`),await g()}catch(e){t(e instanceof Error?e.message:`Failed to save config`)}finally{p(!1)}},handleChange:(e,t)=>{i(n=>({...n,[e]:t}))}}}function q(){let{config:t,loading:n,error:r,saveLoading:i,hasChanges:o,handleSaveAll:l,handleChange:u}=K(),{actionLoading:d,handlePauseWorker:f,handleResumeWorker:m,handleRestart:g,dialogState:v}=H();return(0,L.jsxs)(_,{title:`Configuration`,children:[n&&(0,L.jsx)(x,{}),r&&(0,L.jsxs)(O,{severity:`error`,children:[`Error: `,r]}),!n&&!r&&(0,L.jsxs)(e,{spacing:2,children:[(0,L.jsxs)(p,{defaultExpanded:!0,disableGutters:!0,children:[(0,L.jsx)(a,{expandIcon:(0,L.jsx)(c,{}),children:(0,L.jsx)(E,{variant:`h6`,sx:{fontWeight:600},children:`Settings`})}),(0,L.jsx)(s,{children:(0,L.jsx)(G,{config:t,hasChanges:o,saveLoading:i,onChange:u,onSaveAll:l})})]}),(0,L.jsxs)(p,{disableGutters:!0,children:[(0,L.jsx)(a,{expandIcon:(0,L.jsx)(c,{}),children:(0,L.jsx)(E,{variant:`h6`,sx:{fontWeight:600},children:`Admin`})}),(0,L.jsx)(s,{children:(0,L.jsxs)(e,{spacing:2.5,children:[(0,L.jsx)(V,{onPause:f,onResume:m,actionLoading:d}),(0,L.jsx)(B,{onRestart:g,actionLoading:d}),(0,L.jsx)(z,{})]})})]})]}),(0,L.jsx)(h,{open:v.isOpen,title:v.options.title,message:v.options.message,confirmLabel:v.options.confirmLabel,cancelLabel:v.options.cancelLabel,severity:v.options.severity,onConfirm:v.handleConfirm,onCancel:v.handleCancel})]})}export{q as ConfigPage};