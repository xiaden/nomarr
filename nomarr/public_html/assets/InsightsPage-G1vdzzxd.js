import{c as e,t}from"./Stack-C1Q7NCGH.js";import{A as n,At as r,D as i,Dt as a,Ft as o,H as s,I as c,J as l,K as u,Mt as d,O as f,Q as p,S as m,St as h,T as g,V as _,X as v,Y as y,Z as b,a as x,bt as S,c as C,ct as w,d as T,et as E,f as ee,h as D,i as te,j as ne,k as re,l as O,m as ie,mt as ae,n as oe,nt as se,o as ce,p as k,q as A,r as le,s as ue,t as de,tt as fe,u as pe,w as j}from"./ChartsWrapper-DC6765Eq.js";import{i as me,o as he,r as ge,t as _e}from"./Select-D82qstJP.js";import{t as ve}from"./ExpandMore-BAi0CQs-.js";import{n as ye,r as be,t as xe}from"./AccordionSummary-BE62jF7q.js";import"./Popper-Bn5-l5C7.js";import{t as M}from"./Chip-BGwQu1ac.js";import{n as Se,t as Ce}from"./ToggleButtonGroup-C-OSokM6.js";import{t as we}from"./TextField-i9-XGgc2.js";import{t as Te}from"./Tooltip-EJvUF5LL.js";import{At as Ee,Dn as N,Dt as De,Kn as Oe,Nn as ke,On as P,Pn as F,Pt as Ae,St as I,Tt as L,Wn as je,X as Me,Y as Ne,Z as Pe,_n as R,d as Fe,it as Ie,kt as Le,lt as Re,nn as ze,pn as Be,qt as z,u as Ve,un as B,ut as He,vn as Ue,xt as We,y as Ge}from"./index-Cn9WoKM-.js";import{t as Ke}from"./Close-DQqXmwrk.js";import{a as qe,i as Je,n as Ye,o as V,r as Xe,s as Ze,t as Qe}from"./ChartsGrid-CGNHHCKi.js";import{n as $e,r as et,t as tt}from"./PieChart-CfYUflDc.js";var H=Oe(je(),1),U=Oe(ke()),nt=ze((0,U.jsx)(`path`,{d:`M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z`}),`SwapHoriz`);function rt(e){this._context=e}rt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function it(e){return new rt(e)}function at(e){return e[0]}function ot(e){return e[1]}function st(e,t){var n=v(!0),r=null,i=it,a=null,o=et(s);e=typeof e==`function`?e:e===void 0?at:v(e),t=typeof t==`function`?t:t===void 0?ot:v(t);function s(s){var l,u=(s=c(s)).length,d,f=!1,p;for(r??(a=i(p=o())),l=0;l<=u;++l)!(l<u&&n(d=s[l],l,s))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+e(d,l,s),+t(d,l,s));if(p)return a=null,p+``||null}return s.x=function(t){return arguments.length?(e=typeof t==`function`?t:v(+t),s):e},s.y=function(e){return arguments.length?(t=typeof e==`function`?e:v(+e),s):t},s.defined=function(e){return arguments.length?(n=typeof e==`function`?e:v(!!e),s):n},s.curve=function(e){return arguments.length?(i=e,r!=null&&(a=i(r)),s):i},s.context=function(e){return arguments.length?(e==null?r=a=null:a=i(r=e),s):r},s}function ct(e,t,n){var r=null,i=v(!0),a=null,o=it,s=null,l=et(u);e=typeof e==`function`?e:e===void 0?at:v(+e),t=typeof t==`function`?t:v(t===void 0?0:+t),n=typeof n==`function`?n:n===void 0?ot:v(+n);function u(u){var d,f,p,m=(u=c(u)).length,h,g=!1,_,v=Array(m),y=Array(m);for(a??(s=o(_=l())),d=0;d<=m;++d){if(!(d<m&&i(h=u[d],d,u))===g)if(g=!g)f=d,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),p=d-1;p>=f;--p)s.point(v[p],y[p]);s.lineEnd(),s.areaEnd()}g&&(v[d]=+e(h,d,u),y[d]=+t(h,d,u),s.point(r?+r(h,d,u):v[d],n?+n(h,d,u):y[d]))}if(_)return s=null,_+``||null}function d(){return st().defined(i).curve(o).context(a)}return u.x=function(t){return arguments.length?(e=typeof t==`function`?t:v(+t),r=null,u):e},u.x0=function(t){return arguments.length?(e=typeof t==`function`?t:v(+t),u):e},u.x1=function(e){return arguments.length?(r=e==null?null:typeof e==`function`?e:v(+e),u):r},u.y=function(e){return arguments.length?(t=typeof e==`function`?e:v(+e),n=null,u):t},u.y0=function(e){return arguments.length?(t=typeof e==`function`?e:v(+e),u):t},u.y1=function(e){return arguments.length?(n=e==null?null:typeof e==`function`?e:v(+e),u):n},u.lineX0=u.lineY0=function(){return d().x(e).y(t)},u.lineY1=function(){return d().x(e).y(n)},u.lineX1=function(){return d().x(r).y(t)},u.defined=function(e){return arguments.length?(i=typeof e==`function`?e:v(!!e),u):i},u.curve=function(e){return arguments.length?(o=e,a!=null&&(s=o(a)),u):o},u.context=function(e){return arguments.length?(e==null?a=s=null:s=o(a=e),u):a},u}var lt=class{constructor(e,t){this._context=e,this._x=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,t,e,t):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+t)/2,e,this._y0,e,t);break}this._x0=e,this._y0=t}};function ut(e){return new lt(e,!0)}function dt(e){return new lt(e,!1)}var ft={draw(e,t){let n=l(t/u);e.moveTo(n,0),e.arc(0,0,n,0,y)}},pt={draw(e,t){let n=l(t/5)/2;e.moveTo(-3*n,-n),e.lineTo(-n,-n),e.lineTo(-n,-3*n),e.lineTo(n,-3*n),e.lineTo(n,-n),e.lineTo(3*n,-n),e.lineTo(3*n,n),e.lineTo(n,n),e.lineTo(n,3*n),e.lineTo(-n,3*n),e.lineTo(-n,n),e.lineTo(-3*n,n),e.closePath()}},mt=l(1/3),ht=mt*2,gt={draw(e,t){let n=l(t/ht),r=n*mt;e.moveTo(0,-n),e.lineTo(r,0),e.lineTo(0,n),e.lineTo(-r,0),e.closePath()}},_t={draw(e,t){let n=l(t),r=-n/2;e.rect(r,r,n,n)}},vt=.8908130915292852,yt=A(u/10)/A(7*u/10),bt=A(y/10)*yt,xt=-_(y/10)*yt,St={draw(e,t){let n=l(t*vt),r=bt*n,i=xt*n;e.moveTo(0,-n),e.lineTo(r,i);for(let t=1;t<5;++t){let a=y*t/5,o=_(a),s=A(a);e.lineTo(s*n,-o*n),e.lineTo(o*r-s*i,s*r+o*i)}e.closePath()}},Ct=l(3),wt={draw(e,t){let n=-l(t/(Ct*3));e.moveTo(0,n*2),e.lineTo(-Ct*n,-n),e.lineTo(Ct*n,-n),e.closePath()}},W=-.5,G=l(3)/2,Tt=1/l(12),Et=(Tt/2+1)*3;const Dt=[ft,pt,gt,_t,St,wt,{draw(e,t){let n=l(t/Et),r=n/2,i=n*Tt,a=r,o=n*Tt+n,s=-a,c=o;e.moveTo(r,i),e.lineTo(a,o),e.lineTo(s,c),e.lineTo(W*r-G*i,G*r+W*i),e.lineTo(W*a-G*o,G*a+W*o),e.lineTo(W*s-G*c,G*s+W*c),e.lineTo(W*r+G*i,W*i-G*r),e.lineTo(W*a+G*o,W*o-G*a),e.lineTo(W*s+G*c,W*c-G*s),e.closePath()}}];function Ot(e,t){let n=null,r=et(i);e=typeof e==`function`?e:v(e||ft),t=typeof t==`function`?t:v(t===void 0?64:+t);function i(){let i;if(n||=i=r(),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),i)return n=null,i+``||null}return i.type=function(t){return arguments.length?(e=typeof t==`function`?t:v(t),i):e},i.size=function(e){return arguments.length?(t=typeof e==`function`?e:v(+e),i):t},i.context=function(e){return arguments.length?(n=e??null,i):n},i}function kt(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function At(e,t){this._context=e,this._k=(1-t)/6}At.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:kt(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:kt(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}},(function e(t){function n(e){return new At(e,t)}return n.tension=function(t){return e(+t)},n})(0);function jt(e,t,n){var r=e._x1,i=e._y1,a=e._x2,o=e._y2;if(e._l01_a>1e-12){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,c=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/c,i=(i*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/c}if(e._l23_a>1e-12){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,u=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*l+e._x1*e._l23_2a-t*e._l12_2a)/u,o=(o*l+e._y1*e._l23_2a-n*e._l12_2a)/u}e._context.bezierCurveTo(r,i,a,o,e._x2,e._y2)}function Mt(e,t){this._context=e,this._alpha=t}Mt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=(n*n+r*r)**+this._alpha)}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:jt(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Nt=(function e(t){function n(e){return t?new Mt(e,t):new At(e,0)}return n.alpha=function(t){return e(+t)},n})(.5);function Pt(e){return e<0?-1:1}function Ft(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),s=(a*i+o*r)/(r+i);return(Pt(a)+Pt(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function It(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Lt(e,t,n){var r=e._x0,i=e._y0,a=e._x1,o=e._y1,s=(a-r)/3;e._context.bezierCurveTo(r+s,i+s*t,a-s,o-s*n,a,o)}function K(e){this._context=e}K.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Lt(this,this._t0,It(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Lt(this,It(this,n=Ft(this,e,t)),n);break;default:Lt(this,this._t0,n=Ft(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function Rt(e){this._context=new zt(e)}(Rt.prototype=Object.create(K.prototype)).point=function(e,t){K.prototype.point.call(this,t,e)};function zt(e){this._context=e}zt.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}};function Bt(e){return new K(e)}function Vt(e){return new Rt(e)}function Ht(e){this._context=e}Ht.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var r=Ut(e),i=Ut(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[o],t[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function Ut(e){var t,n=e.length-1,r,i=Array(n),a=Array(n),o=Array(n);for(i[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<n-1;++t)i[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[n-1]=2,a[n-1]=7,o[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)r=i[t]/a[t-1],a[t]-=r,o[t]-=r*o[t-1];for(i[n-1]=o[n-1]/a[n-1],t=n-2;t>=0;--t)i[t]=(o[t]-i[t+1])/a[t];for(a[n-1]=(e[n]+i[n-1])/2,t=0;t<n-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function Wt(e){return new Ht(e)}function q(e,t){this._context=e,this._t=t}q.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}this._x=e,this._y=t}};function Gt(e){return new q(e,.5)}function Kt(e){return new q(e,0)}function qt(e){return new q(e,1)}function J(){return m(`line`)}function Jt(e){return T({d:e.d},{createInterpolator:(e,t)=>{let n=h(e.d,t.d);return e=>({d:n(e)})},applyProps:(e,{d:t})=>e.setAttribute(`d`,t),transformProps:e=>e,skip:e.skipAnimation,ref:e.ref})}function Yt(e){return T({d:e.d},{createInterpolator:(e,t)=>{let n=h(e.d,t.d);return e=>({d:n(e)})},applyProps:(e,{d:t})=>e.setAttribute(`d`,t),skip:e.skipAnimation,transformProps:e=>e,ref:e.ref})}function Xt({maxValue:e}){return(0,U.jsxs)(I,{sx:{mt:2,pt:2,borderTop:1,borderColor:`divider`,display:`flex`,flexDirection:`column`,gap:.5},children:[(0,U.jsx)(L,{variant:`caption`,color:`text.secondary`,children:`Files matching both tags`}),(0,U.jsxs)(I,{sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,U.jsx)(I,{sx:{width:200,height:12,background:`linear-gradient(to right, #1a1a1a, rgb(74, 158, 255))`,borderRadius:1,border:1,borderColor:`divider`}}),(0,U.jsxs)(I,{sx:{display:`flex`,justifyContent:`space-between`,width:60,fontSize:`0.75rem`,color:`text.secondary`},children:[(0,U.jsx)(`span`,{children:`0`}),(0,U.jsx)(`span`,{children:e})]})]})]})}function Zt({xTag:e,yTag:t,count:n,maxCount:r,bgcolor:i}){let a=Math.round(n/r*100);return(0,U.jsx)(Te,{title:(0,U.jsxs)(I,{sx:{p:.5},children:[(0,U.jsxs)(L,{variant:`body2`,sx:{fontWeight:600},children:[e.key,`: `,e.value]}),(0,U.jsxs)(L,{variant:`body2`,sx:{fontWeight:600},children:[t.key,`: `,t.value]}),(0,U.jsxs)(I,{sx:{borderTop:1,borderColor:`divider`,mt:.5,pt:.5},children:[(0,U.jsxs)(L,{variant:`body2`,children:[n,` file`,n===1?``:`s`]}),(0,U.jsxs)(L,{variant:`body2`,color:`text.secondary`,children:[a,`% of max (`,r,`)`]})]})]}),arrow:!0,placement:`top`,children:(0,U.jsx)(I,{component:`td`,sx:{bgcolor:i,p:1,textAlign:`center`,fontWeight:n>0?600:`normal`,color:n>0?`#fff`:`text.secondary`,cursor:`default`,transition:`transform 0.1s, box-shadow 0.1s`,"&:hover":{transform:`scale(1.1)`,zIndex:10,boxShadow:4}},children:n})})}function Qt({value:e,onChange:t,options:n,placeholder:r=`Type or select...`,disabled:i=!1,...a}){let[o,s]=(0,H.useState)(!1),[c,l]=(0,H.useState)(n),u=(0,H.useRef)(null);(0,H.useEffect)(()=>{l(e?n.filter(t=>t.toLowerCase().includes(e.toLowerCase())):n)},[e,n]),(0,H.useEffect)(()=>{let e=e=>{u.current&&!u.current.contains(e.target)&&s(!1)};return document.addEventListener(`mousedown`,e),()=>document.removeEventListener(`mousedown`,e)},[]);let d=e=>{t(e.target.value),s(!0)},f=e=>{t(e),s(!1)};return(0,U.jsxs)(I,{...a,ref:u,sx:{position:`relative`,...a.sx},children:[(0,U.jsx)(we,{type:`text`,value:e,onChange:d,onFocus:()=>s(!0),placeholder:r,disabled:i,fullWidth:!0,size:`small`,sx:{"& .MuiOutlinedInput-root":{bgcolor:i?`background.paper`:`background.default`}}}),o&&!i&&c.length>0&&(0,U.jsx)(I,{sx:{position:`absolute`,top:`100%`,left:0,right:0,maxHeight:`200px`,overflowY:`auto`,bgcolor:`background.default`,border:1,borderColor:`divider`,borderTop:`none`,borderRadius:`0 0 4px 4px`,boxShadow:2,zIndex:1e3},children:c.map((e,t)=>(0,U.jsx)(I,{onClick:()=>f(e),sx:{p:1.5,cursor:`pointer`,fontSize:`0.875rem`,borderBottom:t<c.length-1?1:`none`,borderColor:`divider`,"&:hover":{bgcolor:`action.hover`}},children:e},t))})]})}const Y={genre:{id:`genre`,label:`Genre`,description:`All unique genre tag values from your library`,fetchStrategy:{tagKey:`genre`,nomarrOnly:!1},maxValues:16},mood:{id:`mood`,label:`Mood`,description:`nom:mood-* tags (presence/absence per file)`,fetchStrategy:{tagKey:null,nomarrOnly:!0,explicitKeys:[`nom:mood-loose`,`nom:mood-regular`,`nom:mood-strict`]},maxValues:16,labelTransform:e=>({"nom:mood-loose":`Mood (Loose)`,"nom:mood-regular":`Mood (Regular)`,"nom:mood-strict":`Mood (Strict)`})[e]??e},year:{id:`year`,label:`Year`,description:`Release year values from your library`,fetchStrategy:{tagKey:`year`,nomarrOnly:!1},maxValues:16},manual:{id:`manual`,label:`Manual`,description:`Select individual tag key/value pairs`,fetchStrategy:{tagKey:null,nomarrOnly:!1},maxValues:16}},$t={preset:`genre`,tags:[],loading:!1,error:null};function en({xTags:e,yTags:n,xIsManual:r,yIsManual:i,onAddToX:a,onAddToY:o,onRemoveFromX:s,onRemoveFromY:c}){let[l,u]=(0,H.useState)([]),[d,f]=(0,H.useState)([]),[p,m]=(0,H.useState)(``),[h,g]=(0,H.useState)(``);(0,H.useEffect)(()=>{(async()=>{try{u((await Ve(!0)).tag_keys)}catch(e){console.error(`[ManualTagSelector] Failed to load tag keys:`,e)}})()},[]),(0,H.useEffect)(()=>{if(!p){f([]),g(``);return}(async()=>{try{let e=await Fe(p,!0),t=new Set;for(let n of e.tag_keys)if(n.startsWith(`[`)&&n.endsWith(`]`))try{let e=JSON.parse(n);if(Array.isArray(e))for(let n of e)t.add(String(n));else t.add(n)}catch{t.add(n)}else t.add(n);f(Array.from(t).sort())}catch(e){console.error(`[ManualTagSelector] Failed to load tag values:`,e),f([])}})()},[p]);let _=(t,r)=>e.some(e=>e.key===t&&e.value===r)||n.some(e=>e.key===t&&e.value===r),v=Y.manual.maxValues,y=r&&p&&h&&e.length<v&&!_(p,h),b=i&&p&&h&&n.length<v&&!_(p,h),x=()=>{y&&a({key:p,value:h})},S=()=>{b&&o({key:p,value:h})};return!r&&!i?(0,U.jsx)(U.Fragment,{}):(0,U.jsxs)(be,{sx:{bgcolor:`background.paper`,"&:before":{display:`none`}},children:[(0,U.jsx)(xe,{expandIcon:(0,U.jsx)(ve,{}),children:(0,U.jsx)(L,{variant:`body2`,sx:{fontWeight:500},children:`Advanced (Manual Tag Selection)`})}),(0,U.jsx)(ye,{children:(0,U.jsxs)(t,{spacing:2,children:[(0,U.jsxs)(I,{sx:{display:`flex`,gap:1.5,alignItems:`flex-end`},children:[(0,U.jsxs)(I,{sx:{flex:1},children:[(0,U.jsx)(L,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:`Tag Key`}),(0,U.jsx)(Qt,{value:p,onChange:m,options:l,placeholder:`Select tag key...`})]}),(0,U.jsxs)(I,{sx:{flex:1},children:[(0,U.jsx)(L,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:`Tag Value`}),(0,U.jsx)(Qt,{value:h,onChange:g,options:d,placeholder:`Select tag value...`,disabled:!p})]}),(0,U.jsx)(We,{onClick:x,disabled:!y,variant:`contained`,size:`small`,children:`Add to X`}),(0,U.jsx)(We,{onClick:S,disabled:!b,variant:`contained`,color:`secondary`,size:`small`,children:`Add to Y`})]}),r&&(0,U.jsxs)(I,{children:[(0,U.jsxs)(L,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:[`X Axis Manual Tags (`,e.length,`/`,v,`)`]}),(0,U.jsxs)(I,{sx:{display:`flex`,flexWrap:`wrap`,gap:1,p:1.5,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minHeight:48},children:[e.length===0&&(0,U.jsx)(L,{variant:`body2`,color:`text.secondary`,children:`No tags added`}),e.map((e,t)=>(0,U.jsx)(M,{label:`${e.key}: ${e.value}`,onDelete:()=>s(t),deleteIcon:(0,U.jsx)(Ke,{}),size:`small`},t))]})]}),i&&(0,U.jsxs)(I,{children:[(0,U.jsxs)(L,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:[`Y Axis Manual Tags (`,n.length,`/`,v,`)`]}),(0,U.jsxs)(I,{sx:{display:`flex`,flexWrap:`wrap`,gap:1,p:1.5,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minHeight:48},children:[n.length===0&&(0,U.jsx)(L,{variant:`body2`,color:`text.secondary`,children:`No tags added`}),n.map((e,t)=>(0,U.jsx)(M,{label:`${e.key}: ${e.value}`,onDelete:()=>c(t),deleteIcon:(0,U.jsx)(Ke,{}),size:`small`},t))]})]})]})})]})}var tn=[`genre`,`mood`,`year`,`manual`];function nn({label:e,value:t,onChange:n,showSwap:r=!1,onSwap:i,loading:a=!1}){return(0,U.jsxs)(I,{sx:{display:`flex`,alignItems:`center`,gap:2},children:[(0,U.jsx)(L,{variant:`body2`,sx:{fontWeight:500,minWidth:60},children:e}),(0,U.jsx)(Ce,{value:t,exclusive:!0,onChange:(e,t)=>{t!==null&&n(t)},size:`small`,disabled:a,sx:{flexGrow:1},children:tn.map(e=>{let t=Y[e];return(0,U.jsx)(Se,{value:e,sx:{px:2,py:.5,textTransform:`none`},children:(0,U.jsx)(Te,{title:t.description,arrow:!0,children:(0,U.jsx)(`span`,{children:t.label})})},e)})}),r&&(0,U.jsx)(Te,{title:`Swap X and Y axes`,arrow:!0,children:(0,U.jsx)(Le,{onClick:i,size:`small`,disabled:a,sx:{ml:1},children:(0,U.jsx)(nt,{})})})]})}function rn(e){let[t,n]=(0,H.useState)([]),[r,i]=(0,H.useState)(!1),[a,o]=(0,H.useState)(null),s=(0,H.useCallback)(async()=>{let{fetchStrategy:t,maxValues:r}=Y[e];if(e===`manual`){n([]),i(!1),o(null);return}if(e===`mood`&&t.explicitKeys){n(t.explicitKeys.map(e=>({key:e,value:`*`})).slice(0,r)),i(!1),o(null);return}if(!t.tagKey){o(`Invalid preset configuration`);return}try{i(!0),o(null);let e=await Fe(t.tagKey,t.nomarrOnly),a=new Set;for(let t of e.tag_keys)if(t.startsWith(`[`)&&t.endsWith(`]`))try{let e=JSON.parse(t);if(Array.isArray(e))for(let t of e)a.add(String(t));else a.add(t)}catch{a.add(t)}else a.add(t);n(Array.from(a).sort().slice(0,r).map(e=>({key:t.tagKey,value:e})))}catch(e){o(e instanceof Error?e.message:`Failed to load preset data`),n([])}finally{i(!1)}},[e]);return(0,H.useEffect)(()=>{s()},[s]),{tags:t,loading:r,error:a,reload:s}}var an={x:{...$t,preset:`genre`},y:{...$t,preset:`year`}};function on(e,t){switch(t.type){case`SELECT_PRESET`:{let n=e[t.axis];return{...e,[t.axis]:{...n,preset:t.presetId,tags:[],loading:t.presetId!==`manual`,error:null}}}case`SET_TAGS`:{let n=e[t.axis];return{...e,[t.axis]:{...n,tags:t.tags,loading:!1}}}case`SET_LOADING`:{let n=e[t.axis];return{...e,[t.axis]:{...n,loading:t.loading}}}case`SET_ERROR`:{let n=e[t.axis];return{...e,[t.axis]:{...n,error:t.error,loading:!1}}}case`SWAP_AXES`:return{x:e.y,y:e.x};case`ADD_MANUAL_TAG`:{let n=e[t.axis];if(n.preset!==`manual`)return e;let r=Y.manual.maxValues;return n.tags.length>=r||n.tags.some(e=>e.key===t.tag.key&&e.value===t.tag.value)||e[t.axis===`x`?`y`:`x`].tags.some(e=>e.key===t.tag.key&&e.value===t.tag.value)?e:{...e,[t.axis]:{...n,tags:[...n.tags,t.tag]}}}case`REMOVE_TAG`:{let n=e[t.axis];return n.preset===`manual`?{...e,[t.axis]:{...n,tags:n.tags.filter((e,n)=>n!==t.index)}}:e}case`CLEAR_AXIS`:{let n=e[t.axis];return{...e,[t.axis]:{...n,tags:[]}}}default:return e}}function sn(){let[e,t]=(0,H.useReducer)(on,an),n=rn(e.x.preset),r=rn(e.y.preset);return(0,H.useEffect)(()=>{!n.loading&&n.tags.length>0&&t({type:`SET_TAGS`,axis:`x`,tags:n.tags}),n.error&&t({type:`SET_ERROR`,axis:`x`,error:n.error})},[n.tags,n.loading,n.error]),(0,H.useEffect)(()=>{!r.loading&&r.tags.length>0&&t({type:`SET_TAGS`,axis:`y`,tags:r.tags}),r.error&&t({type:`SET_ERROR`,axis:`y`,error:r.error})},[r.tags,r.loading,r.error]),(0,H.useEffect)(()=>{t({type:`SET_LOADING`,axis:`x`,loading:n.loading})},[n.loading]),(0,H.useEffect)(()=>{t({type:`SET_LOADING`,axis:`y`,loading:r.loading})},[r.loading]),{state:e,selectPreset:(0,H.useCallback)((e,n)=>{t({type:`SELECT_PRESET`,axis:e,presetId:n})},[]),swapAxes:(0,H.useCallback)(()=>{t({type:`SWAP_AXES`})},[]),addManualTag:(0,H.useCallback)((e,n)=>{t({type:`ADD_MANUAL_TAG`,axis:e,tag:n})},[]),removeTag:(0,H.useCallback)((e,n)=>{t({type:`REMOVE_TAG`,axis:e,index:n})},[]),clearAxis:(0,H.useCallback)(e=>{t({type:`CLEAR_AXIS`,axis:e})},[]),isLoading:e.x.loading||e.y.loading,canBuildMatrix:e.x.tags.length>0&&e.y.tags.length>0}}function cn({libraryId:e}){let{state:n,selectPreset:r,swapAxes:i,addManualTag:a,removeTag:o,isLoading:s,canBuildMatrix:c}=sn(),[l,u]=(0,H.useState)(null),[d,f]=(0,H.useState)(!1),[p,m]=(0,H.useState)(null),h=(0,H.useCallback)(async()=>{if(!c){u(null);return}try{f(!0),m(null),u(await Pe({x:n.x.tags,y:n.y.tags},e))}catch(e){m(e instanceof Error?e.message:`Failed to build matrix`),u(null)}finally{f(!1)}},[c,n.x.tags,n.y.tags,e]);(0,H.useEffect)(()=>{h()},[h]);let g=(e,t)=>{if(e===0)return`#1a1a1a`;let n=Math.min(e/t,1);return`rgb(${Math.floor(30+n*44)}, ${Math.floor(30+n*128)}, ${Math.floor(30+n*225)})`},_=l?.matrix?Math.max(...l.matrix.flat(),1):1,v=s||d;return(0,U.jsxs)(He,{children:[(0,U.jsx)(Re,{title:`Tag Co-Occurrence Grid`}),(0,U.jsxs)(t,{spacing:2,sx:{mb:2},children:[(0,U.jsx)(nn,{label:`X Axis:`,value:n.x.preset,onChange:e=>r(`x`,e),loading:v}),(0,U.jsx)(nn,{label:`Y Axis:`,value:n.y.preset,onChange:e=>r(`y`,e),showSwap:!0,onSwap:i,loading:v}),(0,U.jsx)(en,{xTags:n.x.tags,yTags:n.y.tags,xIsManual:n.x.preset===`manual`,yIsManual:n.y.preset===`manual`,onAddToX:e=>a(`x`,e),onAddToY:e=>a(`y`,e),onRemoveFromX:e=>o(`x`,e),onRemoveFromY:e=>o(`y`,e)})]}),p&&(0,U.jsx)(De,{severity:`error`,sx:{mb:2},children:p}),v&&(0,U.jsx)(I,{sx:{display:`flex`,justifyContent:`center`,alignItems:`center`,py:4},children:(0,U.jsx)(Ee,{size:32})}),!v&&l&&(0,U.jsxs)(I,{sx:{overflowX:`auto`},children:[(0,U.jsxs)(I,{component:`table`,sx:{borderCollapse:`separate`,borderSpacing:0,width:`100%`,minWidth:300,fontSize:`0.875rem`},children:[(0,U.jsx)(I,{component:`thead`,children:(0,U.jsxs)(I,{component:`tr`,children:[(0,U.jsx)(I,{component:`th`,sx:{position:`sticky`,top:0,left:0,zIndex:3,bgcolor:`background.paper`,borderBottom:2,borderRight:2,borderColor:`divider`,p:1,fontWeight:600,minWidth:100},children:`Y \\ X`}),l.x.map((e,t)=>(0,U.jsx)(I,{component:`th`,sx:{position:`sticky`,top:0,zIndex:2,bgcolor:`background.paper`,borderBottom:2,borderColor:`divider`,p:1,fontWeight:600,whiteSpace:`nowrap`,minWidth:80},title:`${e.key}: ${e.value}`,children:e.value},t))]})}),(0,U.jsx)(I,{component:`tbody`,children:l.y.map((e,t)=>(0,U.jsxs)(I,{component:`tr`,children:[(0,U.jsx)(I,{component:`th`,sx:{position:`sticky`,left:0,zIndex:1,bgcolor:`background.paper`,borderRight:2,borderColor:`divider`,p:1,fontWeight:600,textAlign:`left`,whiteSpace:`nowrap`},title:`${e.key}: ${e.value}`,children:e.value}),l.x.map((n,r)=>(0,U.jsx)(Zt,{xTag:n,yTag:e,count:l.matrix[t][r],maxCount:_,bgcolor:g(l.matrix[t][r],_)},r))]},t))})]}),(0,U.jsx)(Xt,{maxValue:_})]}),!v&&!l&&!p&&(0,U.jsx)(I,{sx:{py:4,textAlign:`center`,color:`text.secondary`},children:c?`No matching files found`:`Select presets or add tags to build matrix`})]})}var ln=`nomarr:insights:accordion:`;function un({storageKey:e,title:t,defaultExpanded:n=!0,children:r,secondary:i}){let a=`${ln}${e}`,[o,s]=(0,H.useState)(()=>{try{let e=localStorage.getItem(a);if(e!==null)return e===`true`}catch{}return n}),c=(0,H.useCallback)((e,t)=>{s(t);try{localStorage.setItem(a,String(t))}catch{}},[a]);return(0,H.useEffect)(()=>{let e=e=>{e.key===a&&e.newValue!==null&&s(e.newValue===`true`)};return window.addEventListener(`storage`,e),()=>window.removeEventListener(`storage`,e)},[a]),(0,U.jsxs)(be,{expanded:o,onChange:c,children:[(0,U.jsxs)(xe,{expandIcon:(0,U.jsx)(ve,{}),children:[(0,U.jsx)(L,{variant:`h6`,sx:{flexGrow:1},children:t}),i]}),(0,U.jsx)(ye,{children:r})]})}function X({sectionId:e,title:t,defaultExpanded:n=!0,children:r,secondary:i}){return(0,U.jsx)(Ae,{elevation:1,sx:{mb:2},children:(0,U.jsx)(un,{storageKey:e,title:t,defaultExpanded:n,secondary:i,children:(0,U.jsx)(I,{sx:{px:1},children:r})})})}function dn({libraryId:e}){return(0,U.jsx)(X,{sectionId:`advanced`,title:`Advanced Analytics`,defaultExpanded:!1,children:(0,U.jsx)(cn,{libraryId:e})})}function Z({subsectionId:e,parentId:t,title:n,defaultExpanded:r=!0,children:i,secondary:a}){return(0,U.jsx)(I,{sx:{mb:1},children:(0,U.jsx)(un,{storageKey:`${t}:${e}`,title:n,defaultExpanded:r,secondary:a,children:i})})}var Q=[`#2196f3`,`#4caf50`,`#ff9800`,`#e91e63`,`#9c27b0`,`#00bcd4`,`#ff5722`,`#795548`,`#607d8b`,`#3f51b5`,`#8bc34a`,`#ffc107`,`#673ab7`,`#009688`,`#f44336`,`#03a9f4`,`#cddc39`,`#ffeb3b`,`#9e9e9e`,`#ff4081`];function fn({distribution:e,parentId:n}){let[r,i]=(0,H.useState)(()=>new Set(e.slice(5).map(e=>e.genre))),{pieData:a,visibleCount:o,totalCount:s}=(0,H.useMemo)(()=>{let t=e.filter(e=>!r.has(e.genre));return{pieData:t.map((e,t)=>({id:e.genre,value:e.count,label:e.genre,color:Q[t%Q.length]})),visibleCount:t.length,totalCount:e.length}},[e,r]),c=e=>{i(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})};return e.length===0?(0,U.jsx)(Z,{subsectionId:`genres`,parentId:n,title:`Genres`,children:(0,U.jsx)(L,{color:`text.secondary`,children:`No genre data available`})}):(0,U.jsxs)(Z,{subsectionId:`genres`,parentId:n,title:`Genres`,secondary:(0,U.jsxs)(L,{variant:`body2`,color:`text.secondary`,children:[o,` of `,s,` genres shown`]}),children:[a.length>0?(0,U.jsx)(I,{sx:{height:350,mb:2},children:(0,U.jsx)(tt,{series:[{data:a,innerRadius:40,outerRadius:120,paddingAngle:1,cornerRadius:4,highlightScope:{highlight:`item`,fade:`global`}}],height:350,hideLegend:!0})}):(0,U.jsx)(L,{color:`text.secondary`,sx:{mb:2},children:`All genres hidden. Click chips below to show.`}),(0,U.jsx)(I,{sx:{mb:1},children:(0,U.jsxs)(t,{direction:`row`,spacing:1,sx:{mb:1},children:[(0,U.jsx)(M,{label:`Show All`,size:`small`,variant:`outlined`,onClick:()=>i(new Set),disabled:r.size===0}),(0,U.jsx)(M,{label:`Hide All`,size:`small`,variant:`outlined`,onClick:()=>i(new Set(e.map(e=>e.genre))),disabled:r.size===e.length})]})}),(0,U.jsx)(t,{direction:`row`,flexWrap:`wrap`,gap:.5,children:e.map((e,t)=>{let n=r.has(e.genre),i=Q[t%Q.length];return(0,U.jsx)(M,{label:`${e.genre} (${e.count})`,size:`small`,onClick:()=>c(e.genre),sx:{bgcolor:n?`transparent`:i,color:n?`text.secondary`:`#fff`,border:n?1:0,borderColor:`divider`,textDecoration:n?`line-through`:`none`,opacity:n?.6:1,"&:hover":{bgcolor:n?`action.hover`:i,opacity:1}}},e.genre)})})]})}function pn(e){let t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4);return t>0?`${t}h ${n}m`:`${n}m`}function mn(e){return e>=0xe8d4a51000?`${(e/0xe8d4a51000).toFixed(1)} TB`:e>=1e9?`${(e/1e9).toFixed(1)} GB`:e>=1e6?`${(e/1e6).toFixed(1)} MB`:`${(e/1e3).toFixed(1)} KB`}function $({label:e,value:t}){return(0,U.jsxs)(I,{sx:{textAlign:`center`,py:1,flex:`1 1 25%`,minWidth:100},children:[(0,U.jsx)(L,{variant:`h5`,color:`primary`,children:t}),(0,U.jsx)(L,{variant:`body2`,color:`text.secondary`,children:e})]})}function hn({stats:e,parentId:t}){return(0,U.jsx)(Z,{subsectionId:`stats`,parentId:t,title:`Library Statistics`,children:(0,U.jsxs)(I,{sx:{display:`flex`,flexWrap:`wrap`,gap:2},children:[(0,U.jsx)($,{label:`Tracks`,value:e.file_count.toLocaleString()}),(0,U.jsx)($,{label:`Total Duration`,value:pn(e.total_duration_ms)}),(0,U.jsx)($,{label:`Total Size`,value:mn(e.total_file_size_bytes)}),(0,U.jsx)($,{label:`Avg Track`,value:pn(e.avg_track_length_ms)})]})})}function gn(e){return e.replace(` `,`_`)}const _n=N(`MuiAppearingMask`,[`animate`]);var vn=B(`rect`,{slot:`internal`,shouldForwardProp:void 0})({animationName:`animate-width`,animationTimingFunction:k,animationDuration:`0s`,[`&.${_n.animate}`]:{animationDuration:`300ms`},"@keyframes animate-width":{from:{width:0}}});function yn(e){let t=f(),n=gn(`${i()}-${e.id}`);return(0,U.jsxs)(H.Fragment,{children:[(0,U.jsx)(`clipPath`,{id:n,children:(0,U.jsx)(vn,{className:e.skipAnimation?``:_n.animate,x:0,y:0,width:t.left+t.width+t.right,height:t.top+t.height+t.bottom})}),(0,U.jsx)(`g`,{clipPath:`url(#${n})`,children:e.children})]})}var bn=[`skipAnimation`,`ownerState`];function xn(e){let{skipAnimation:t,ownerState:n}=e,r=z(e,bn),i=Jt(e);return(0,U.jsx)(yn,{skipAnimation:t,id:`${n.id}-area-clip`,children:(0,U.jsx)(`path`,F({fill:n.gradientId?`url(#${n.gradientId})`:n.color,filter:n.isHighlighted?`brightness(140%)`:n.gradientId?void 0:`brightness(120%)`,opacity:n.isFaded?.3:1,stroke:`none`,"data-series":n.id,"data-highlighted":n.isHighlighted||void 0,"data-faded":n.isFaded||void 0},r,i))})}var Sn=[`id`,`classes`,`color`,`gradientId`,`slots`,`slotProps`,`onClick`];function Cn(e){return P(`MuiAreaElement`,e)}const wn=N(`MuiAreaElement`,[`root`,`highlighted`,`faded`,`series`]);var Tn=e=>{let{classes:t,id:n,isFaded:r,isHighlighted:i}=e;return R({root:[`root`,`series-${n}`,i&&`highlighted`,r&&`faded`]},Cn,t)};function En(t){let{id:n,classes:r,color:i,gradientId:a,slots:o,slotProps:s,onClick:c}=t,l=z(t,Sn),u=C({type:`line`,seriesId:n}),{isFaded:d,isHighlighted:f}=D({seriesId:n}),p={id:n,classes:r,color:i,gradientId:a,isFaded:d,isHighlighted:f},m=Tn(p),h=o?.area??xn;return(0,U.jsx)(h,F({},l,e({elementType:h,externalSlotProps:s?.area,additionalProps:F({},u,{onClick:c,cursor:c?`pointer`:`unset`}),className:m.root,ownerState:p})))}function Dn(e){switch(e){case`catmullRom`:return Nt.alpha(.5);case`linear`:return it;case`monotoneX`:return Bt;case`monotoneY`:return Vt;case`natural`:return Wt;case`step`:return Gt;case`stepBefore`:return Kt;case`stepAfter`:return qt;case`bumpY`:return dt;case`bumpX`:return ut;default:return Bt}}function On(e,t){let n=J(),r=j().xAxisIds[0],i=g().yAxisIds[0],a=ie();return H.useMemo(()=>{if(n===void 0)return[];let{series:o,stackingGroups:s}=n,c=[];for(let n of s){let s=n.ids;for(let n=s.length-1;n>=0;--n){let l=s[n],{xAxisId:u=r,yAxisId:d=i,visibleStackedData:f,stackedData:p,data:m,connectNulls:h,baseline:g,curve:_,strictStepCurve:v,area:y}=o[l];if(!y||!(u in e)||!(d in t))continue;let b=e[u].scale,x=V(b),C=t[d].scale,w=e[u].data,T=t[d].colorScale&&a(d)||e[u].colorScale&&a(u)||void 0,E=_?.includes(`step`)&&!v&&S(b),ee=w?.flatMap((e,t)=>{let n=m[t]==null;if(E){let r=[{x:e,y:f[t],nullData:n,isExtension:!1}];return!n&&(t===0||m[t-1]==null)&&r.unshift({x:(b(e)??0)-(b.step()-b.bandwidth())/2,y:f[t],nullData:n,isExtension:!0}),!n&&(t===m.length-1||m[t+1]==null)&&r.push({x:(b(e)??0)+(b.step()+b.bandwidth())/2,y:f[t],nullData:n,isExtension:!0}),r}return{x:e,y:f[t],nullData:n}})??[],D=h?ee.filter(e=>!e.nullData):ee,te=ct().x(e=>e.isExtension?e.x:x(e.x)).defined(e=>h||!e.nullData||!!e.isExtension).y0(e=>{if(typeof g==`number`)return C(g);if(g===`max`)return C.range()[1];if(g===`min`)return C.range()[0];let t=e.y&&C(e.y[0]);return Number.isNaN(t)?C.range()[0]:t}).y1(e=>e.y&&C(e.y[1])).curve(Dn(_))(D)||``;c.push({area:o[l].area,color:o[l].color,gradientId:T,d:te,seriesId:l})}}return c},[n,r,i,e,t,a])}var kn=[`slots`,`slotProps`,`onItemClick`,`skipAnimation`],An=B(`g`,{name:`MuiAreaPlot`,slot:`Root`})({[`& .${wn.root}`]:{transitionProperty:`opacity, fill`,transitionDuration:`300ms`,transitionTimingFunction:k}}),jn=()=>{let{xAxis:e}=j(),{yAxis:t}=g();return On(e,t)};function Mn(e){let{slots:t,slotProps:n,onItemClick:r,skipAnimation:i}=e,a=z(e,kn),o=O(qe()||i);return(0,U.jsx)(An,F({},a,{children:jn().map(({d:e,seriesId:i,color:a,area:s,gradientId:c})=>!!s&&(0,U.jsx)(En,{id:i,d:e,color:a,gradientId:c,slots:t,slotProps:n,onClick:r&&(e=>r(e,{type:`line`,seriesId:i})),skipAnimation:o},i))}))}var Nn=[`skipAnimation`,`ownerState`],Pn=H.forwardRef(function(e,t){let{skipAnimation:n,ownerState:r}=e,i=z(e,Nn),a=Yt({d:e.d,skipAnimation:n,ref:t}),o=r.isFaded?.3:1;return(0,U.jsx)(yn,{skipAnimation:n,id:`${r.id}-line-clip`,children:(0,U.jsx)(`path`,F({stroke:r.gradientId?`url(#${r.gradientId})`:r.color,strokeWidth:2,strokeLinejoin:`round`,fill:`none`,filter:r.isHighlighted?`brightness(120%)`:void 0,opacity:r.hidden?0:o,"data-series":r.id,"data-highlighted":r.isHighlighted||void 0,"data-faded":r.isFaded||void 0},i,a))})}),Fn=[`id`,`classes`,`color`,`gradientId`,`slots`,`slotProps`,`onClick`,`hidden`];function In(e){return P(`MuiLineElement`,e)}const Ln=N(`MuiLineElement`,[`root`,`highlighted`,`faded`,`series`]);var Rn=e=>{let{classes:t,id:n,isFaded:r,isHighlighted:i}=e;return R({root:[`root`,`series-${n}`,i&&`highlighted`,r&&`faded`]},In,t)};function zn(t){let{id:n,classes:r,color:i,gradientId:a,slots:o,slotProps:s,onClick:c,hidden:l}=t,u=z(t,Fn),d=C({type:`line`,seriesId:n}),{isFaded:f,isHighlighted:p}=D({seriesId:n}),m={id:n,classes:r,color:i,gradientId:a,isFaded:f,isHighlighted:p,hidden:l},h=Rn(m),g=o?.line??Pn;return(0,U.jsx)(g,F({},u,e({elementType:g,externalSlotProps:s?.line,additionalProps:F({},d,{onClick:c,cursor:c?`pointer`:`unset`}),className:h.root,ownerState:m})))}function Bn(e,t){let n=J(),r=j().xAxisIds[0],i=g().yAxisIds[0],a=ie();return H.useMemo(()=>{if(n===void 0)return[];let{series:o,stackingGroups:s}=n,c=[];for(let n of s){let s=n.ids;for(let n of s){let{xAxisId:s=r,yAxisId:l=i,stackedData:u,visibleStackedData:d,data:f,connectNulls:p,curve:m,strictStepCurve:h}=o[n];if(!(s in e)||!(l in t))continue;let g=e[s].scale,_=V(g),v=t[l].scale,y=e[s].data,b=t[l].colorScale&&a(l)||e[s].colorScale&&a(s)||void 0,x=m?.includes(`step`)&&!h&&S(g),C=y?.flatMap((e,t)=>{let n=f[t]==null;if(x){let r=[{x:e,y:d[t],nullData:n,isExtension:!1}];return!n&&(t===0||f[t-1]==null)&&r.unshift({x:(g(e)??0)-(g.step()-g.bandwidth())/2,y:d[t],nullData:n,isExtension:!0}),!n&&(t===f.length-1||f[t+1]==null)&&r.push({x:(g(e)??0)+(g.step()+g.bandwidth())/2,y:d[t],nullData:n,isExtension:!0}),r}return{x:e,y:d[t],nullData:n}})??[],w=p?C.filter(e=>!e.nullData):C,T=o[n].hidden,E=st().x(e=>e.isExtension?e.x:_(e.x)).defined(e=>p||!e.nullData||!!e.isExtension).y(e=>v(T?v.domain()[0]:e.y[1])).curve(Dn(m))(w)||``;c.push({color:o[n].color,gradientId:b,d:E,seriesId:n,hidden:o[n].hidden})}}return c},[n,r,i,e,t,a])}var Vn=[`slots`,`slotProps`,`skipAnimation`,`onItemClick`],Hn=B(`g`,{name:`MuiAreaPlot`,slot:`Root`})({[`& .${Ln.root}`]:{transitionProperty:`opacity, fill`,transitionDuration:`300ms`,transitionTimingFunction:k}}),Un=()=>{let{xAxis:e}=j(),{yAxis:t}=g();return Bn(e,t)};function Wn(e){let{slots:t,slotProps:n,skipAnimation:r,onItemClick:i}=e,a=z(e,Vn),o=O(qe()||r);return(0,U.jsx)(Hn,F({},a,{children:Un().map(({d:e,seriesId:r,color:a,gradientId:s,hidden:c})=>(0,U.jsx)(zn,{id:r,d:e,color:a,gradientId:s,hidden:c,skipAnimation:o,slots:t,slotProps:n,onClick:i&&(e=>i(e,{type:`line`,seriesId:r}))},r))}))}function Gn(e){return P(`MuiMarkElement`,e)}const Kn=N(`MuiMarkElement`,[`root`,`highlighted`,`faded`,`animate`,`series`]),qn=e=>{let{classes:t,id:n,isFaded:r,isHighlighted:i,skipAnimation:a}=e;return R({root:[`root`,`series-${n}`,i&&`highlighted`,r&&`faded`,a?void 0:`animate`]},Gn,t)};var Jn=[`x`,`y`,`id`,`classes`,`color`,`dataIndex`,`onClick`,`skipAnimation`,`isFaded`,`isHighlighted`,`shape`,`hidden`],Yn=B(`circle`,{slot:`internal`,shouldForwardProp:void 0})({[`&.${Kn.animate}`]:{transitionDuration:`300ms`,transitionProperty:`cx, cy, opacity`,transitionTimingFunction:k}});function Xn(e){let{x:t,y:n,id:r,classes:i,color:a,dataIndex:o,onClick:s,skipAnimation:c,isFaded:l=!1,isHighlighted:u=!1,hidden:d}=e,f=z(e,Jn),p=Be(),m=C({type:`line`,seriesId:r,dataIndex:o}),h=qn({id:r,classes:i,isHighlighted:u,isFaded:l,skipAnimation:c});return(0,U.jsx)(Yn,F({},f,{cx:t,cy:n,r:5,fill:(p.vars||p).palette.background.paper,stroke:a,strokeWidth:2,className:h.root,onClick:s,cursor:s?`pointer`:`unset`,pointerEvents:d?`none`:void 0},m,{"data-highlighted":u||void 0,"data-faded":l||void 0,opacity:d?0:1}))}function Zn(e){switch(e){case`circle`:return 0;case`cross`:return 1;case`diamond`:return 2;case`square`:return 3;case`star`:return 4;case`triangle`:return 5;case`wye`:return 6;default:return 0}}var Qn=[`x`,`y`,`id`,`classes`,`color`,`shape`,`dataIndex`,`onClick`,`skipAnimation`,`isFaded`,`isHighlighted`,`hidden`,`style`],$n=B(`path`,{name:`MuiMarkElement`,slot:`Root`})(({theme:e})=>({fill:(e.vars||e).palette.background.paper,[`&.${Kn.animate}`]:{transitionDuration:`300ms`,transitionProperty:`transform, transform-origin, opacity`,transitionTimingFunction:k}}));function er(e){let{x:t,y:n,id:r,classes:i,color:a,shape:o,dataIndex:s,onClick:c,skipAnimation:l,isFaded:u=!1,isHighlighted:d=!1,hidden:f,style:p}=e,m=z(e,Qn),h=C({type:`line`,seriesId:r,dataIndex:s}),g={id:r,classes:i,isHighlighted:d,isFaded:u,skipAnimation:l},_=qn(g);return(0,U.jsx)($n,F({},m,{style:F({},p,{transform:`translate(${t}px, ${n}px)`,transformOrigin:`${t}px ${n}px`}),ownerState:g,className:_.root,d:Ot(Dt[Zn(o)])(),onClick:c,cursor:c?`pointer`:`unset`,pointerEvents:f?`none`:void 0},h,{"data-highlighted":d||void 0,"data-faded":u||void 0,opacity:f?0:1,strokeWidth:2,stroke:a}))}function tr(e,t){let r=J(),a=j().xAxisIds[0],o=g().yAxisIds[0],s=i(),{instance:c}=n();return H.useMemo(()=>{if(r===void 0)return[];let{series:n,stackingGroups:i}=r,l=[];for(let r of i){let i=r.ids;for(let r of i){let{xAxisId:i=a,yAxisId:u=o,visibleStackedData:d,data:f,showMark:p=!0,shape:m=`circle`,hidden:h}=n[r];if(p===!1||!(i in e)||!(u in t))continue;let g=V(e[i].scale),_=t[u].scale,v=e[i].data,y=gn(`${s}-${r}-line-clip`),b=ne(n[r],e[i],t[u]),x=[];if(v)for(let e=0;e<v.length;e+=1){let t=v[e],n=f[e]==null?null:d[e][1];if(n===null)continue;let r=_(h?_.domain()[0]:n),i=g(t);c.isPointInside(i,r)&&(p!==!0&&!p({x:i,y:r,index:e,position:t,value:n})||x.push({x:i,y:r,index:e,color:b(e)}))}l.push({seriesId:r,clipId:y,shape:m,xAxisId:i,marks:x,hidden:h})}}return l},[r,a,o,s,e,t,c])}var nr=[`slots`,`slotProps`,`skipAnimation`,`onItemClick`];function rr(e){let{slots:t,slotProps:r,skipAnimation:i,onItemClick:a}=e,o=z(e,nr),s=O(qe()||i),{xAxis:c}=j(),{yAxis:l}=g(),{store:u}=n(),{isFaded:d,isHighlighted:f}=$e(),p=u.use(Ze),m=H.useMemo(()=>{let e={};for(let{dataIndex:t,axisId:n}of p)e[n]===void 0?e[n]=new Set([t]):e[n].add(t);return e},[p]);return(0,U.jsx)(`g`,F({},o,{children:tr(c,l).map(({seriesId:e,clipId:n,shape:i,xAxisId:o,marks:c,hidden:l})=>{let u=t?.mark??(i===`circle`?Xn:er),p=f({seriesId:e}),h=!p&&d({seriesId:e});return(0,U.jsx)(`g`,{clipPath:`url(#${n})`,"data-series":e,children:c.map(({x:t,y:n,index:c,color:d})=>(0,U.jsx)(u,F({id:e,dataIndex:c,shape:i,color:d,x:t,y:n,skipAnimation:s,onClick:a&&(t=>a(t,{type:`line`,seriesId:e,dataIndex:c})),isHighlighted:m[o]?.has(c)||p,isFaded:h,hidden:l},r?.mark),`${e}-${c}`))},e)})}))}var ir=[`x`,`y`,`id`,`classes`,`color`,`shape`];function ar(e){return P(`MuiHighlightElement`,e)}N(`MuiHighlightElement`,[`root`]);var or=e=>{let{classes:t,id:n}=e;return R({root:[`root`,`series-${n}`]},ar,t)};function sr(e){let{x:t,y:n,color:r,shape:i}=e,a=z(e,ir),o=or(e),s=i===`circle`?`circle`:`path`,c=i===`circle`?{cx:0,cy:0,r:a.r===void 0?5:a.r}:{d:Ot(Dt[Zn(i)])()},l=d>18?{transformOrigin:`${t} ${n}`}:{"transform-origin":`${t} ${n}`};return(0,U.jsx)(s,F({pointerEvents:`none`,className:o.root,transform:`translate(${t} ${n})`,fill:r},l,c,a))}var cr=[`slots`,`slotProps`];function lr(e){let{slots:t,slotProps:r}=e,i=z(e,cr),a=J(),{xAxis:o,xAxisIds:s}=j(),{yAxis:c,yAxisIds:l}=g(),{instance:u}=n(),d=re().use(Ze);if(d.length===0||a===void 0)return null;let{series:f,stackingGroups:p}=a,m=s[0],h=l[0],_=t?.lineHighlight??sr;return(0,U.jsx)(`g`,F({},i,{children:d.flatMap(({dataIndex:e,axisId:t})=>p.flatMap(({ids:n})=>n.flatMap(n=>{let{xAxisId:i=m,yAxisId:a=h,visibleStackedData:s,data:l,disableHighlight:d,shape:p=`circle`}=f[n];if(d||l[e]==null||t!==i)return null;let g=V(o[i].scale),v=c[a].scale,y=o[i].data;if(y===void 0)throw Error(`MUI X Charts: ${i===`DEFAULT_X_AXIS_KEY`?"The first `xAxis`":`The x-axis with id "${i}"`} should have data property to be able to display a line plot.`);let b=g(y[e]),x=v(s[e][1]);return u.isPointInside(b,x)?(0,U.jsx)(_,F({id:n,color:ne(f[n],o[i],c[a])(e),x:b,y:x,shape:p},r?.lineHighlight),`${n}`):null})))}))}const ur=[p,se,fe,ae,w,b,a,E];var dr=`xAxis.yAxis.series.width.height.margin.colors.dataset.sx.onAreaClick.onLineClick.onMarkClick.axisHighlight.disableLineItemHighlight.hideLegend.grid.children.slots.slotProps.skipAnimation.loading.highlightedItem.onHighlightChange.className.showToolbar.brushConfig`.split(`.`);const fr=e=>{let{xAxis:t,yAxis:n,series:r,width:i,height:a,margin:o,colors:s,dataset:c,sx:l,onAreaClick:u,onLineClick:d,onMarkClick:f,axisHighlight:p,disableLineItemHighlight:m,grid:h,children:g,slots:_,slotProps:v,skipAnimation:y,loading:b,highlightedItem:x,onHighlightChange:S,className:C,brushConfig:w}=e,T=z(e,dr),E=`${Ue()}-clip-path`,ee=F({},T,{series:H.useMemo(()=>r.map(e=>F({disableHighlight:!!m,type:`line`},e)),[m,r]),width:i,height:a,margin:o,colors:s,dataset:c,xAxis:t??[{id:`DEFAULT_X_AXIS_KEY`,scaleType:`point`,data:Array.from({length:Math.max(...r.map(e=>(e.data??c??[]).length))},(e,t)=>t)}],yAxis:n,highlightedItem:x,onHighlightChange:S,disableAxisListener:v?.tooltip?.trigger!==`axis`&&p?.x===`none`&&p?.y===`none`,className:C,skipAnimation:y,brushConfig:w,plugins:ur}),D={vertical:h?.vertical,horizontal:h?.horizontal},te={clipPath:`url(#${E})`},ne={id:E},re={slots:_,slotProps:v,onItemClick:u},O={slots:_,slotProps:v,onItemClick:d},ie={slots:_,slotProps:v,onItemClick:f,skipAnimation:y},ae={slots:_,slotProps:v,loading:b},oe={slots:_,slotProps:v},se=F({x:`line`},p),ce={slots:_,slotProps:v},k={slots:_,slotProps:v};return{chartsWrapperProps:{sx:l,legendPosition:e.slotProps?.legend?.position,legendDirection:e.slotProps?.legend?.direction,hideLegend:e.hideLegend??!1},chartContainerProps:ee,gridProps:D,clipPathProps:ne,clipPathGroupProps:te,areaPlotProps:re,linePlotProps:O,markPlotProps:ie,overlayProps:ae,chartsAxisProps:oe,axisHighlightProps:se,lineHighlightPlotProps:ce,legendProps:k,children:g}};var pr=6;function mr(){let e=Be(),t=pe(),n=J(),{xAxis:r,xAxisIds:i}=j(),{yAxis:a,yAxisIds:o}=g();if(t===null||t.type!==`line`||!n)return null;let s=n.series[t.seriesId];if(s.data[t.dataIndex]==null)return null;let c=s.xAxisId??i[0],l=s.yAxisId??o[0];return(0,U.jsx)(`rect`,{fill:`none`,stroke:(e.vars??e).palette.text.primary,strokeWidth:2,x:r[c].scale(r[c].data[t.dataIndex])-pr,y:a[l].scale(s.visibleStackedData[t.dataIndex][1])-pr,width:2*pr,height:2*pr,rx:3,ry:3})}var hr=H.forwardRef(function(e,t){let n=o({props:e,name:`MuiLineChart`}),{chartsWrapperProps:r,chartContainerProps:i,gridProps:a,clipPathProps:s,clipPathGroupProps:c,areaPlotProps:l,linePlotProps:u,markPlotProps:d,overlayProps:f,chartsAxisProps:p,axisHighlightProps:m,lineHighlightPlotProps:h,legendProps:g,children:_}=fr(n),{chartDataProviderProps:v,chartsSurfaceProps:y}=oe(i,t),b=n.slots?.tooltip??ue,S=n.slots?.toolbar;return(0,U.jsx)(te,F({},v,{children:(0,U.jsxs)(de,F({},r,{children:[n.showToolbar&&S?(0,U.jsx)(S,F({},n.slotProps?.toolbar)):null,!n.hideLegend&&(0,U.jsx)(ce,F({},g)),(0,U.jsxs)(le,F({},y,{children:[(0,U.jsx)(Qe,F({},a)),(0,U.jsxs)(`g`,F({},c,{children:[(0,U.jsx)(Mn,F({},l)),(0,U.jsx)(Wn,F({},u)),(0,U.jsx)(x,F({},f)),(0,U.jsx)(Xe,F({},m))]})),(0,U.jsx)(mr,{}),(0,U.jsx)(Je,F({},p)),(0,U.jsx)(`g`,{"data-drawing-container":!0,children:(0,U.jsx)(rr,F({},d))}),(0,U.jsx)(lr,F({},h)),(0,U.jsx)(Ye,F({},s)),_]})),!n.loading&&(0,U.jsx)(b,F({},n.slotProps?.tooltip))]}))}))});function gr({distribution:e,parentId:t}){let n=e.filter(e=>String(e.year)!==`1`).sort((e,t)=>Number(e.year)-Number(t.year));if(n.length===0)return(0,U.jsx)(Z,{subsectionId:`years`,parentId:t,title:`Years`,children:(0,U.jsx)(L,{color:`text.secondary`,children:`No year data available`})});let r=n.map(e=>String(e.year)),i=n.map(e=>e.count);return(0,U.jsx)(Z,{subsectionId:`years`,parentId:t,title:`Years`,secondary:(0,U.jsxs)(L,{variant:`body2`,color:`text.secondary`,children:[n.length,` years`]}),children:(0,U.jsx)(hr,{height:250,xAxis:[{scaleType:`point`,data:r}],series:[{data:i,curve:`catmullRom`,showMark:!1}],margin:{left:50,right:20,top:20,bottom:30}})})}function _r({libraryId:e}){let[t,n]=(0,H.useState)(null),[r,i]=(0,H.useState)(!0),[a,o]=(0,H.useState)(null);return(0,H.useEffect)(()=>{(async()=>{try{i(!0),o(null),n(await Ne(e))}catch(e){o(e instanceof Error?e.message:`Failed to load collection overview`),console.error(`[CollectionOverview] Load error:`,e)}finally{i(!1)}})()},[e]),r?(0,U.jsx)(X,{sectionId:`collection-overview`,title:`Collection Overview`,children:(0,U.jsx)(Ee,{size:24})}):a||!t?(0,U.jsx)(X,{sectionId:`collection-overview`,title:`Collection Overview`,children:(0,U.jsx)(De,{severity:`error`,children:a||`Failed to load collection overview`})}):(0,U.jsxs)(X,{sectionId:`collection-overview`,title:`Collection Overview`,secondary:(0,U.jsxs)(L,{variant:`body2`,color:`text.secondary`,children:[t.stats.file_count.toLocaleString(),` tracks`]}),children:[(0,U.jsx)(hn,{stats:t.stats,parentId:`collection-overview`}),(0,U.jsx)(gr,{distribution:t.year_distribution,parentId:`collection-overview`}),(0,U.jsx)(fn,{distribution:t.genre_distribution,parentId:`collection-overview`})]})}function vr({value:e,onChange:t}){let[n,r]=(0,H.useState)([]),[i,a]=(0,H.useState)(!0);return(0,H.useEffect)(()=>{(async()=>{try{r(await Ge(!0))}catch(e){console.error(`[LibraryFilter] Failed to load libraries:`,e)}finally{a(!1)}})()},[]),(0,U.jsxs)(he,{size:`small`,sx:{minWidth:200},children:[(0,U.jsx)(me,{id:`library-filter-label`,children:`Library`}),(0,U.jsxs)(_e,{labelId:`library-filter-label`,id:`library-filter`,value:e??``,label:`Library`,onChange:e=>{let n=e.target.value;t(n===``?void 0:n)},disabled:i,children:[(0,U.jsx)(ge,{value:``,children:`All Libraries`}),n.map(e=>(0,U.jsx)(ge,{value:e.library_id,children:e.name},e.library_id))]})]})}function yr({vibes:e,parentId:t}){return e.length===0?(0,U.jsx)(Z,{subsectionId:`vibes`,parentId:t,title:`Dominant Vibes`,children:(0,U.jsx)(L,{color:`text.secondary`,children:`No mood data available`})}):(0,U.jsx)(Z,{subsectionId:`vibes`,parentId:t,title:`Dominant Vibes`,children:(0,U.jsx)(I,{sx:{display:`flex`,flexWrap:`wrap`,gap:2},children:e.map((e,t)=>(0,U.jsxs)(I,{sx:{textAlign:`center`,flex:`1 1 100px`,p:1,borderRadius:1,bgcolor:t===0?`primary.main`:`action.hover`,color:t===0?`primary.contrastText`:`text.primary`},children:[(0,U.jsxs)(L,{variant:`h6`,children:[e.percentage.toFixed(0),`%`]}),(0,U.jsx)(L,{variant:`body2`,sx:{textTransform:`capitalize`},children:e.mood})]},e.mood))})})}function br({pairs:e,parentId:t,tierSelector:n}){return e.length===0?(0,U.jsx)(Z,{subsectionId:`combos`,parentId:t,title:`Mood Combos`,secondary:(0,U.jsx)(I,{sx:{display:`flex`,alignItems:`center`,gap:1},children:n}),children:(0,U.jsx)(L,{color:`text.secondary`,children:`No mood combinations found`})}):(0,U.jsx)(Z,{subsectionId:`combos`,parentId:t,title:`Mood Combos`,defaultExpanded:!1,secondary:(0,U.jsxs)(I,{sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,U.jsx)(L,{variant:`body2`,color:`text.secondary`,children:`Top pairs`}),n]}),children:(0,U.jsx)(I,{sx:{display:`flex`,flexWrap:`wrap`,gap:1},children:e.map((e,t)=>(0,U.jsx)(M,{label:(0,U.jsxs)(I,{sx:{display:`flex`,alignItems:`center`,gap:.5},children:[(0,U.jsx)(L,{variant:`body2`,component:`span`,sx:{textTransform:`capitalize`},children:e.mood1}),(0,U.jsx)(L,{variant:`body2`,component:`span`,color:`text.secondary`,children:`+`}),(0,U.jsx)(L,{variant:`body2`,component:`span`,sx:{textTransform:`capitalize`},children:e.mood2}),(0,U.jsxs)(L,{variant:`body2`,component:`span`,color:`text.secondary`,sx:{ml:.5},children:[`(`,e.count,`)`]})]}),variant:t<3?`filled`:`outlined`,color:t<3?`primary`:`default`,size:`small`},`${e.mood1}-${e.mood2}`))})})}var xr={strict:`Strict`,regular:`Regular`,loose:`Loose`},Sr=[`strict`,`regular`,`loose`];function Cr({coverage:e,balance:t,parentId:n}){let r=Sr.filter(n=>n in e.tiers||n in t);return(0,U.jsx)(Z,{subsectionId:`coverage`,parentId:n,title:`Mood Coverage`,secondary:(0,U.jsxs)(L,{variant:`body2`,color:`text.secondary`,children:[e.total_files.toLocaleString(),` tracks`]}),children:(0,U.jsx)(I,{sx:{display:`flex`,gap:2,flexWrap:`wrap`,justifyContent:`center`},children:r.map(n=>{let r=e.tiers[n],i=(t[n]||[]).map((e,t)=>({id:t,value:e.count,label:e.mood}));return(0,U.jsxs)(I,{sx:{textAlign:`center`,minWidth:200},children:[(0,U.jsx)(L,{variant:`subtitle2`,children:xr[n]||n}),r&&(0,U.jsxs)(L,{variant:`caption`,color:`text.secondary`,children:[r.tagged.toLocaleString(),` tagged (`,r.percentage.toFixed(1),`%)`]}),i.length>0?(0,U.jsx)(tt,{series:[{data:i,innerRadius:25,outerRadius:80,paddingAngle:1,cornerRadius:3}],height:200,width:250,hideLegend:!0}):(0,U.jsx)(L,{variant:`body2`,color:`text.secondary`,sx:{mt:2},children:`No data`})]},n)})})})}var wr=[{value:`strict`,label:`Strict`},{value:`regular`,label:`Regular`},{value:`loose`,label:`Loose`}];function Tr({libraryId:e}){let[t,n]=(0,H.useState)(null),[r,i]=(0,H.useState)(!0),[a,o]=(0,H.useState)(null),[s,c]=(0,H.useState)(`strict`);return(0,H.useEffect)(()=>{(async()=>{try{i(!0),o(null),n(await Me(e,s))}catch(e){o(e instanceof Error?e.message:`Failed to load mood analysis`),console.error(`[MoodAnalysis] Load error:`,e)}finally{i(!1)}})()},[e,s]),r?(0,U.jsx)(X,{sectionId:`mood-analysis`,title:`Mood Analysis`,children:(0,U.jsx)(Ee,{size:24})}):a||!t?(0,U.jsx)(X,{sectionId:`mood-analysis`,title:`Mood Analysis`,children:(0,U.jsx)(De,{severity:`error`,children:a||`Failed to load mood analysis`})}):(0,U.jsxs)(X,{sectionId:`mood-analysis`,title:`Mood Analysis`,secondary:(0,U.jsxs)(L,{variant:`body2`,color:`text.secondary`,children:[(t.coverage.tiers.strict?.percentage??0).toFixed(0),`% strict coverage`]}),children:[(0,U.jsx)(Cr,{coverage:t.coverage,balance:t.balance,parentId:`mood-analysis`}),(0,U.jsx)(yr,{vibes:t.dominant_vibes,parentId:`mood-analysis`}),(0,U.jsx)(br,{pairs:t.top_pairs,parentId:`mood-analysis`,tierSelector:(0,U.jsxs)(he,{size:`small`,sx:{minWidth:120},onClick:e=>e.stopPropagation(),children:[(0,U.jsx)(me,{id:`mood-tier-label`,children:`Tier`}),(0,U.jsx)(_e,{labelId:`mood-tier-label`,id:`mood-tier-select`,value:s,label:`Tier`,onChange:e=>{c(e.target.value)},children:wr.map(e=>(0,U.jsx)(ge,{value:e.value,children:e.label},e.value))})]})})]})}function Er(){let[e,n]=(0,H.useState)(void 0);return(0,U.jsxs)(t,{spacing:0,sx:{mt:2},children:[(0,U.jsx)(I,{sx:{mb:2},children:(0,U.jsx)(vr,{value:e,onChange:n})}),(0,U.jsx)(_r,{libraryId:e}),(0,U.jsx)(Tr,{libraryId:e}),(0,U.jsx)(dn,{libraryId:e})]})}function Dr(){return(0,U.jsx)(Ie,{title:`Insights`,children:(0,U.jsx)(Er,{})})}export{Dr as InsightsPage};