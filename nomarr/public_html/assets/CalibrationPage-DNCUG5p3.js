import{t as e}from"./Stack-BznY3gmu.js";import{Bt as t,C as n,E as r,Et as i,Ht as a,f as o,i as s,l as c,m as l,n as u,p as d,u as f}from"./index-CnrlnshQ.js";import{t as p}from"./useConfirmDialog-43_SLwEf.js";import{t as m}from"./useNotification-DMPAvq0X.js";var h=a(i(),1);function g({onGenerate:t,onApply:n,onClear:r,actionLoading:i}){return(0,h.jsxs)(l,{children:[(0,h.jsx)(d,{title:`Actions`}),(0,h.jsx)(e,{spacing:2,children:[{label:`Generate New Calibration`,description:`Analyze all files in library to generate optimal calibration values. This will scan the entire library and may take some time.`,onClick:t,color:`primary`,variant:`contained`},{label:`Apply Calibration to Library`,description:`Queue all files for reprocessing with current calibration. This will update all tags based on the current calibration values.`,onClick:n,color:`primary`,variant:`contained`},{label:`Clear Calibration Queue`,description:`Remove all pending calibration jobs from the queue. Running jobs will complete.`,onClick:r,color:`error`,variant:`outlined`}].map(e=>(0,h.jsx)(c,{label:e.label,description:e.description,onClick:e.onClick,disabled:i,variant:e.variant,color:e.color},e.label))})]})}function _({status:e}){let t=[{label:`Pending`,value:e.pending},{label:`Running`,value:e.running},{label:`Completed`,value:e.completed},{label:`Errors`,value:e.errors}];return(0,h.jsxs)(l,{children:[(0,h.jsx)(d,{title:`Calibration Queue Status`}),(0,h.jsx)(f,{minColumnWidth:150,children:t.map(e=>(0,h.jsx)(o,{label:e.label,value:e.value,valueVariant:`h5`,centered:!0},e.label))}),(0,h.jsx)(n,{sx:{mt:2},children:(0,h.jsxs)(r,{variant:`body1`,children:[`Worker:`,` `,(0,h.jsx)(r,{component:`span`,sx:{color:e.worker_alive?`success.main`:`error.main`,fontWeight:600},children:e.worker_alive?`Alive`:`Not Running`}),e.worker_alive&&(0,h.jsxs)(h.Fragment,{children:[` â€¢ `,(0,h.jsx)(r,{component:`span`,sx:{color:e.worker_busy?`info.main`:`success.main`,fontWeight:600},children:e.worker_busy?`Busy`:`Idle`})]})]})})]})}var v=a(t(),1);function y(){let{showSuccess:e,showError:t}=m(),{confirm:n,isOpen:r,options:i,handleConfirm:a,handleCancel:o}=p(),[s,c]=(0,v.useState)(null),[l,d]=(0,v.useState)(!0),[f,h]=(0,v.useState)(null),[g,_]=(0,v.useState)(!1),y=async()=>{try{d(!0),h(null),c(await u.calibration.getStatus())}catch(e){h(e instanceof Error?e.message:`Failed to load status`),console.error(`[Calibration] Load error:`,e)}finally{d(!1)}};return(0,v.useEffect)(()=>{y()},[]),{status:s,loading:l,error:f,actionLoading:g,handleGenerate:async()=>{if(await n({title:`Generate Calibration?`,message:`This analyzes all library files and may take some time.`,confirmLabel:`Generate`,severity:`warning`}))try{_(!0);let t=await u.calibration.generate(!0),n=Object.keys(t.data.calibrations||{}).length,r=t.saved_files?.saved_files||0,i=`Calibration generated! Library: ${t.data.library_size} files, `;i+=`Calibrations: ${n}, Skipped: ${t.data.skipped_tags}`,r>0&&(i+=`, Saved ${r} files`),e(i)}catch(e){t(e instanceof Error?e.message:`Failed to generate calibration`)}finally{_(!1)}},handleApply:async()=>{if(await n({title:`Apply Calibration?`,message:`Apply calibration to entire library? This will queue all files for reprocessing.`,confirmLabel:`Apply`,severity:`warning`}))try{_(!0),e(`Queued ${(await u.calibration.apply()).queued} files for recalibration`),await y()}catch(e){t(e instanceof Error?e.message:`Failed to apply calibration`)}finally{_(!1)}},handleClear:async()=>{if(await n({title:`Clear Calibration Queue?`,message:`Clear all calibration queue jobs?`,confirmLabel:`Clear`,severity:`warning`}))try{_(!0),e(`Cleared ${(await u.calibration.clear()).cleared} jobs`),await y()}catch(e){t(e instanceof Error?e.message:`Failed to clear calibration queue`)}finally{_(!1)}},dialogState:{isOpen:r,options:i,handleConfirm:a,handleCancel:o}}}function b(){let{status:e,loading:t,error:n,actionLoading:r,handleGenerate:i,handleApply:a,handleClear:o,dialogState:c}=y();return(0,h.jsxs)(`div`,{style:{padding:`20px`},children:[(0,h.jsx)(`h1`,{style:{marginBottom:`20px`},children:`Calibration`}),t&&(0,h.jsx)(`p`,{children:`Loading calibration status...`}),n&&(0,h.jsxs)(`p`,{style:{color:`var(--accent-red)`},children:[`Error: `,n]}),e&&(0,h.jsxs)(`div`,{style:{display:`grid`,gap:`20px`},children:[(0,h.jsx)(_,{status:e}),(0,h.jsx)(g,{onGenerate:i,onApply:a,onClear:o,actionLoading:r})]}),(0,h.jsx)(s,{open:c.isOpen,title:c.options.title,message:c.options.message,confirmLabel:c.options.confirmLabel,cancelLabel:c.options.cancelLabel,severity:c.options.severity,onConfirm:c.handleConfirm,onCancel:c.handleCancel})]})}export{b as CalibrationPage};