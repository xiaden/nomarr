import{t as e}from"./Stack-tmSg0kgc.js";import{n as t,t as n}from"./TextField-Bcx-mtW4.js";import"./useSlotProps-DcBbOXHH.js";import{t as r}from"./MenuItem-B_auCfme.js";import{n as i,t as a}from"./config-Rebm0FKy.js";import{C as o,D as s,Dt as c,Et as l,_t as u,g as d,h as f,j as p,k as m,l as h,w as g}from"./index-gBnixkw7.js";import{t as _}from"./useNotification-Dcqd_Pxg.js";var v=c(u(),1);function y({configKey:e,value:i,onChange:a,disabled:o}){let c=i==null?``:String(i);return(0,v.jsxs)(g,{sx:{display:`grid`,gap:1},children:[(0,v.jsx)(s,{variant:`body2`,color:`text.secondary`,sx:{fontWeight:`bold`},children:e}),(0,v.jsx)(g,{sx:{display:`flex`,gap:1.25,alignItems:`center`},children:typeof i==`boolean`?(0,v.jsxs)(t,{value:c,onChange:t=>a(e,t.target.value),disabled:o,size:`small`,fullWidth:!0,children:[(0,v.jsx)(r,{value:`true`,children:`true`}),(0,v.jsx)(r,{value:`false`,children:`false`})]}):(0,v.jsx)(n,{type:`text`,value:c,onChange:t=>a(e,t.target.value),disabled:o,size:`small`,fullWidth:!0})})]})}function b({config:t,hasChanges:n,saveLoading:r,onChange:i,onSaveAll:a}){return(0,v.jsxs)(d,{children:[(0,v.jsx)(f,{title:`Settings`}),(0,v.jsx)(s,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Changes are saved to the database and will take effect on server restart. Use "Restart Server" in Admin page to apply changes.`}),(0,v.jsx)(e,{spacing:1.875,children:Object.entries(t).map(([e,t])=>(0,v.jsx)(y,{configKey:e,value:t,onChange:i,disabled:r},e))}),(0,v.jsxs)(g,{sx:{mt:3.75,display:`flex`,gap:1.25,alignItems:`center`},children:[(0,v.jsx)(o,{onClick:a,variant:`contained`,disabled:!n||r,sx:{whiteSpace:`nowrap`},children:r?`Saving...`:`Save All Changes`}),n&&(0,v.jsx)(s,{variant:`body2`,color:`warning.main`,children:`Unsaved changes`})]})]})}var x=c(l(),1);function S(){let{showSuccess:e,showError:t,showInfo:n}=_(),[r,o]=(0,x.useState)({}),[s,c]=(0,x.useState)({}),[l,u]=(0,x.useState)(!0),[d,f]=(0,x.useState)(null),[p,m]=(0,x.useState)(!1),[h,g]=(0,x.useState)(!1),v=async()=>{try{u(!0),f(null);let e=await a();o(e),c(e),g(!1)}catch(e){f(e instanceof Error?e.message:`Failed to load config`),console.error(`[Config] Load error:`,e)}finally{u(!1)}};return(0,x.useEffect)(()=>{v()},[]),(0,x.useEffect)(()=>{g(Object.keys(r).some(e=>r[e]!==s[e]))},[r,s]),{config:r,loading:l,error:d,saveLoading:p,hasChanges:h,handleSaveAll:async()=>{try{m(!0);let t=[];for(let e of Object.keys(r))if(r[e]!==s[e]){let n=r[e];if(n==null||n===``)continue;await i(e,String(n)),t.push(e)}if(t.length===0){n(`No changes to save`);return}e(`Saved ${t.length} config change(s). Use "Restart Server" in Admin page to apply.`),await v()}catch(e){t(e instanceof Error?e.message:`Failed to save config`)}finally{m(!1)}},handleChange:(e,t)=>{o(n=>({...n,[e]:t}))}}}function C(){let{config:t,loading:n,error:r,saveLoading:i,hasChanges:a,handleSaveAll:o,handleChange:s}=S();return(0,v.jsxs)(h,{title:`Configuration`,children:[n&&(0,v.jsx)(p,{}),r&&(0,v.jsxs)(m,{severity:`error`,children:[`Error: `,r]}),!n&&!r&&(0,v.jsx)(e,{spacing:2.5,children:(0,v.jsx)(b,{config:t,hasChanges:a,saveLoading:i,onChange:s,onSaveAll:o})})]})}export{C as ConfigPage};