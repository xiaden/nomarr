import{t as e}from"./Stack-BDhchy68.js";import{a as t,c as n,d as r,n as i,o as a,s as o,t as s,u as c}from"./TextField-sVggm-mq.js";import{t as l}from"./Popper-CQPicQOh.js";import{a as u,t as d}from"./MenuItem-D4MrsOhR.js";import{$ as f,At as p,Ct as m,E as h,Ft as g,Ht as _,It as v,Jt as y,Lt as b,Mt as x,Ot as S,Sn as C,St as w,U as ee,V as te,Vt as T,W as E,Wt as D,X as O,Xt as ne,Z as re,_ as k,a as A,an as j,b as M,bn as N,dt as P,f as ie,ft as F,g as ae,gt as I,in as L,it as R,ln as oe,lt as z,m as se,mt as ce,o as le,ot as ue,p as de,pt as B,rn as V,rt as H,st as U,v as fe,y as pe,zt as me}from"./index-BXmj0H8O.js";import{t as he}from"./useConfirmDialog-lEDymmpu.js";import{t as ge}from"./ServerFilePicker-CAWFyOvY.js";import{t as W}from"./useNotification-DGTDEf-O.js";function _e(e){return L(`PrivateSwitchBase`,e)}V(`PrivateSwitchBase`,[`root`,`checked`,`disabled`,`input`,`edgeStart`,`edgeEnd`]);var G=C(N()),K=C(oe()),ve=e=>{let{classes:t,checked:n,disabled:r,edge:i}=e;return y({root:[`root`,n&&`checked`,r&&`disabled`,i&&`edge${b(i)}`],input:[`input`]},_e,t)},ye=T(B,{name:`MuiSwitchBase`})({padding:9,borderRadius:`50%`,variants:[{props:{edge:`start`,size:`small`},style:{marginLeft:-3}},{props:({edge:e,ownerState:t})=>e===`start`&&t.size!==`small`,style:{marginLeft:-12}},{props:{edge:`end`,size:`small`},style:{marginRight:-3}},{props:({edge:e,ownerState:t})=>e===`end`&&t.size!==`small`,style:{marginRight:-12}}]}),q=T(`input`,{name:`MuiSwitchBase`,shouldForwardProp:_})({cursor:`inherit`,position:`absolute`,opacity:0,width:`100%`,height:`100%`,top:0,left:0,margin:0,padding:0,zIndex:1}),J=G.forwardRef(function(e,t){let{autoFocus:n,checked:i,checkedIcon:a,defaultChecked:s,disabled:c,disableFocusRipple:l=!1,edge:u=!1,icon:d,id:f,inputProps:p,inputRef:m,name:h,onBlur:g,onChange:_,onFocus:v,readOnly:y,required:b=!1,tabIndex:x,type:S,value:C,slots:w={},slotProps:ee={},...te}=e,[T,E]=r({controlled:i,default:!!s,name:`SwitchBase`,state:`checked`}),D=o(),O=e=>{v&&v(e),D&&D.onFocus&&D.onFocus(e)},ne=e=>{g&&g(e),D&&D.onBlur&&D.onBlur(e)},re=e=>{if(e.nativeEvent.defaultPrevented)return;let t=e.target.checked;E(t),_&&_(e,t)},k=c;D&&k===void 0&&(k=D.disabled);let A=S===`checkbox`||S===`radio`,j={...e,checked:T,disabled:k,disableFocusRipple:l,edge:u},M=ve(j),N={slots:w,slotProps:{input:p,...ee}},[P,ie]=I(`root`,{ref:t,elementType:ye,className:M.root,shouldForwardComponentProp:!0,externalForwardedProps:{...N,component:`span`,...te},getSlotProps:e=>({...e,onFocus:t=>{e.onFocus?.(t),O(t)},onBlur:t=>{e.onBlur?.(t),ne(t)}}),ownerState:j,additionalProps:{centerRipple:!0,focusRipple:!l,disabled:k,role:void 0,tabIndex:null}}),[F,ae]=I(`input`,{ref:m,elementType:q,className:M.input,externalForwardedProps:N,getSlotProps:e=>({...e,onChange:t=>{e.onChange?.(t),re(t)}}),ownerState:j,additionalProps:{autoFocus:n,checked:i,defaultChecked:s,disabled:k,id:A?f:void 0,name:h,readOnly:y,required:b,tabIndex:x,type:S,...S===`checkbox`&&C===void 0?{}:{value:C}}});return(0,K.jsxs)(P,{...ie,children:[(0,K.jsx)(F,{...ae}),T?a:d]})}),be=g((0,K.jsx)(`path`,{d:`M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z`}),`CheckBoxOutlineBlank`),Y=g((0,K.jsx)(`path`,{d:`M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z`}),`CheckBox`),xe=g((0,K.jsx)(`path`,{d:`M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z`}),`IndeterminateCheckBox`);function Se(e){return L(`MuiCheckbox`,e)}var Ce=V(`MuiCheckbox`,[`root`,`checked`,`disabled`,`indeterminate`,`colorPrimary`,`colorSecondary`,`sizeSmall`,`sizeMedium`]),we=e=>{let{classes:t,indeterminate:n,color:r,size:i}=e,a=y({root:[`root`,n&&`indeterminate`,`color${b(r)}`,`size${b(i)}`]},Se,t);return{...t,...a}},Te=T(J,{shouldForwardProp:e=>_(e)||e===`classes`,name:`MuiCheckbox`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${b(n.size)}`],n.color!==`default`&&t[`color${b(n.color)}`]]}})(v(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:`default`,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(F()).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(F()).map(([t])=>({props:{color:t},style:{[`&.${Ce.checked}, &.${Ce.indeterminate}`]:{color:(e.vars||e).palette[t].main},[`&.${Ce.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:`transparent`}}}}]}))),Ee=(0,K.jsx)(Y,{}),De=(0,K.jsx)(be,{}),Oe=(0,K.jsx)(xe,{}),ke=G.forwardRef(function(e,t){let n=me({props:e,name:`MuiCheckbox`}),{checkedIcon:r=Ee,color:i=`primary`,icon:a=De,indeterminate:o=!1,indeterminateIcon:s=Oe,inputProps:l,size:u=`medium`,disableRipple:d=!1,className:f,slots:p={},slotProps:m={},...h}=n,g=o?s:a,_=o?s:r,v={...n,disableRipple:d,color:i,indeterminate:o,size:u},y=we(v),b=m.input??l,[x,S]=I(`root`,{ref:t,elementType:Te,className:j(y.root,f),shouldForwardComponentProp:!0,externalForwardedProps:{slots:p,slotProps:m,...h},ownerState:v,additionalProps:{type:`checkbox`,icon:G.cloneElement(g,{fontSize:g.props.fontSize??u}),checkedIcon:G.cloneElement(_,{fontSize:_.props.fontSize??u}),disableRipple:d,slots:p,slotProps:{input:c(typeof b==`function`?b(v):b,{"data-indeterminate":o})}}});return(0,K.jsx)(x,{...S,classes:y})});function Ae(e){return L(`MuiFormControlLabel`,e)}var X=V(`MuiFormControlLabel`,[`root`,`labelPlacementStart`,`labelPlacementTop`,`labelPlacementBottom`,`disabled`,`label`,`error`,`required`,`asterisk`]),Z=e=>{let{classes:t,disabled:n,labelPlacement:r,error:i,required:a}=e;return y({root:[`root`,n&&`disabled`,`labelPlacement${b(r)}`,i&&`error`,a&&`required`],label:[`label`,n&&`disabled`],asterisk:[`asterisk`,i&&`error`]},Ae,t)};const je=T(`label`,{name:`MuiFormControlLabel`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${X.label}`]:t.label},t.root,t[`labelPlacement${b(n.labelPlacement)}`]]}})(v(({theme:e})=>({display:`inline-flex`,alignItems:`center`,cursor:`pointer`,verticalAlign:`middle`,WebkitTapHighlightColor:`transparent`,marginLeft:-11,marginRight:16,[`&.${X.disabled}`]:{cursor:`default`},[`& .${X.label}`]:{[`&.${X.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:`start`},style:{flexDirection:`row-reverse`,marginRight:-11}},{props:{labelPlacement:`top`},style:{flexDirection:`column-reverse`}},{props:{labelPlacement:`bottom`},style:{flexDirection:`column`}},{props:({labelPlacement:e})=>e===`start`||e===`top`||e===`bottom`,style:{marginLeft:16}}]})));var Q=T(`span`,{name:`MuiFormControlLabel`,slot:`Asterisk`})(v(({theme:e})=>({[`&.${X.error}`]:{color:(e.vars||e).palette.error.main}}))),Me=G.forwardRef(function(e,t){let r=me({props:e,name:`MuiFormControlLabel`}),{checked:i,className:a,componentsProps:s={},control:c,disabled:l,disableTypography:u,inputRef:d,label:f,labelPlacement:p=`end`,name:m,onChange:h,required:g,slots:_={},slotProps:v={},value:y,...b}=r,x=o(),S=l??c.props.disabled??x?.disabled,C=g??c.props.required,w={disabled:S,required:C};[`checked`,`name`,`onChange`,`value`,`inputRef`].forEach(e=>{c.props[e]===void 0&&r[e]!==void 0&&(w[e]=r[e])});let ee=n({props:r,muiFormControl:x,states:[`error`]}),te={...r,disabled:S,labelPlacement:p,required:C,error:ee.error},T=Z(te),[E,D]=I(`typography`,{elementType:U,externalForwardedProps:{slots:_,slotProps:{...s,...v}},ownerState:te}),O=f;return O!=null&&O.type!==U&&!u&&(O=(0,K.jsx)(E,{component:`span`,...D,className:j(T.label,D?.className),children:O})),(0,K.jsxs)(je,{className:j(T.root,a),ownerState:te,ref:t,...b,children:[G.cloneElement(c,w),C?(0,K.jsxs)(`div`,{children:[O,(0,K.jsxs)(Q,{ownerState:te,"aria-hidden":!0,className:T.asterisk,children:[` `,`*`]})]}):O]})});function Ne(e){return L(`MuiTooltip`,e)}var $=V(`MuiTooltip`,[`popper`,`popperInteractive`,`popperArrow`,`popperClose`,`tooltip`,`tooltipArrow`,`touch`,`tooltipPlacementLeft`,`tooltipPlacementRight`,`tooltipPlacementTop`,`tooltipPlacementBottom`,`arrow`]);function Pe(e){return Math.round(e*1e5)/1e5}var Fe=e=>{let{classes:t,disableInteractive:n,arrow:r,touch:i,placement:a}=e;return y({popper:[`popper`,!n&&`popperInteractive`,r&&`popperArrow`],tooltip:[`tooltip`,r&&`tooltipArrow`,i&&`touch`,`tooltipPlacement${b(a.split(`-`)[0])}`],arrow:[`arrow`]},Ne,t)},Ie=T(l,{name:`MuiTooltip`,slot:`Popper`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.popper,!n.disableInteractive&&t.popperInteractive,n.arrow&&t.popperArrow,!n.open&&t.popperClose]}})(v(({theme:e})=>({zIndex:(e.vars||e).zIndex.tooltip,pointerEvents:`none`,variants:[{props:({ownerState:e})=>!e.disableInteractive,style:{pointerEvents:`auto`}},{props:({open:e})=>!e,style:{pointerEvents:`none`}},{props:({ownerState:e})=>e.arrow,style:{[`&[data-popper-placement*="bottom"] .${$.arrow}`]:{top:0,marginTop:`-0.71em`,"&::before":{transformOrigin:`0 100%`}},[`&[data-popper-placement*="top"] .${$.arrow}`]:{bottom:0,marginBottom:`-0.71em`,"&::before":{transformOrigin:`100% 0`}},[`&[data-popper-placement*="right"] .${$.arrow}`]:{height:`1em`,width:`0.71em`,"&::before":{transformOrigin:`100% 100%`}},[`&[data-popper-placement*="left"] .${$.arrow}`]:{height:`1em`,width:`0.71em`,"&::before":{transformOrigin:`0 0`}}}},{props:({ownerState:e})=>e.arrow&&!e.isRtl,style:{[`&[data-popper-placement*="right"] .${$.arrow}`]:{left:0,marginLeft:`-0.71em`}}},{props:({ownerState:e})=>e.arrow&&!!e.isRtl,style:{[`&[data-popper-placement*="right"] .${$.arrow}`]:{right:0,marginRight:`-0.71em`}}},{props:({ownerState:e})=>e.arrow&&!e.isRtl,style:{[`&[data-popper-placement*="left"] .${$.arrow}`]:{right:0,marginRight:`-0.71em`}}},{props:({ownerState:e})=>e.arrow&&!!e.isRtl,style:{[`&[data-popper-placement*="left"] .${$.arrow}`]:{left:0,marginLeft:`-0.71em`}}}]}))),Le=T(`div`,{name:`MuiTooltip`,slot:`Tooltip`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.tooltip,n.touch&&t.touch,n.arrow&&t.tooltipArrow,t[`tooltipPlacement${b(n.placement.split(`-`)[0])}`]]}})(v(({theme:e})=>({backgroundColor:e.vars?e.vars.palette.Tooltip.bg:e.alpha(e.palette.grey[700],.92),borderRadius:(e.vars||e).shape.borderRadius,color:(e.vars||e).palette.common.white,fontFamily:e.typography.fontFamily,padding:`4px 8px`,fontSize:e.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:`break-word`,fontWeight:e.typography.fontWeightMedium,[`.${$.popper}[data-popper-placement*="left"] &`]:{transformOrigin:`right center`},[`.${$.popper}[data-popper-placement*="right"] &`]:{transformOrigin:`left center`},[`.${$.popper}[data-popper-placement*="top"] &`]:{transformOrigin:`center bottom`,marginBottom:`14px`},[`.${$.popper}[data-popper-placement*="bottom"] &`]:{transformOrigin:`center top`,marginTop:`14px`},variants:[{props:({ownerState:e})=>e.arrow,style:{position:`relative`,margin:0}},{props:({ownerState:e})=>e.touch,style:{padding:`8px 16px`,fontSize:e.typography.pxToRem(14),lineHeight:`${Pe(16/14)}em`,fontWeight:e.typography.fontWeightRegular}},{props:({ownerState:e})=>!e.isRtl,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginRight:`14px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginLeft:`14px`}}},{props:({ownerState:e})=>!e.isRtl&&e.touch,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginRight:`24px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginLeft:`24px`}}},{props:({ownerState:e})=>!!e.isRtl,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginLeft:`14px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginRight:`14px`}}},{props:({ownerState:e})=>!!e.isRtl&&e.touch,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginLeft:`24px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginRight:`24px`}}},{props:({ownerState:e})=>e.touch,style:{[`.${$.popper}[data-popper-placement*="top"] &`]:{marginBottom:`24px`}}},{props:({ownerState:e})=>e.touch,style:{[`.${$.popper}[data-popper-placement*="bottom"] &`]:{marginTop:`24px`}}}]}))),Re=T(`span`,{name:`MuiTooltip`,slot:`Arrow`})(v(({theme:e})=>({overflow:`hidden`,position:`absolute`,width:`1em`,height:`0.71em`,boxSizing:`border-box`,color:e.vars?e.vars.palette.Tooltip.bg:e.alpha(e.palette.grey[700],.9),"&::before":{content:`""`,margin:`auto`,display:`block`,width:`100%`,height:`100%`,backgroundColor:`currentColor`,transform:`rotate(45deg)`}}))),ze=!1,Be=new w,Ve={x:0,y:0};function He(e,t){return(n,...r)=>{t&&t(n,...r),e(n,...r)}}var Ue=G.forwardRef(function(e,t){let n=me({props:e,name:`MuiTooltip`}),{arrow:i=!1,children:a,classes:o,components:s={},componentsProps:c={},describeChild:u=!1,disableFocusListener:d=!1,disableHoverListener:h=!1,disableInteractive:g=!1,disableTouchListener:_=!1,enterDelay:v=100,enterNextDelay:y=0,enterTouchDelay:b=700,followCursor:C=!1,id:w,leaveDelay:ee=0,leaveTouchDelay:te=1500,onClose:T,onOpen:E,open:O,placement:re=`bottom`,PopperComponent:k,PopperProps:A={},slotProps:M={},slots:N={},title:P,TransitionComponent:ie,TransitionProps:F,...ae}=n,L=G.isValidElement(a)?a:(0,K.jsx)(`span`,{children:a}),R=D(),oe=ne(),[z,se]=G.useState(),[le,de]=G.useState(null),B=G.useRef(!1),V=g||C,H=m(),U=m(),fe=m(),pe=m(),[he,ge]=r({controlled:O,default:!1,name:`Tooltip`,state:`open`}),W=he,_e=x(w),ve=G.useRef(),ye=p(()=>{ve.current!==void 0&&(document.body.style.WebkitUserSelect=ve.current,ve.current=void 0),pe.clear()});G.useEffect(()=>ye,[ye]);let q=e=>{Be.clear(),ze=!0,ge(!0),E&&!W&&E(e)},J=p(e=>{Be.start(800+ee,()=>{ze=!1}),ge(!1),T&&W&&T(e),H.start(R.transitions.duration.shortest,()=>{B.current=!1})}),be=e=>{B.current&&e.type!==`touchstart`||(z&&z.removeAttribute(`title`),U.clear(),fe.clear(),v||ze&&y?U.start(ze?y:v,()=>{q(e)}):q(e))},Y=e=>{U.clear(),fe.start(ee,()=>{J(e)})},[,xe]=G.useState(!1),Se=e=>{ce(e.target)||(xe(!1),Y(e))},Ce=e=>{z||se(e.currentTarget),ce(e.target)&&(xe(!0),be(e))},we=e=>{B.current=!0;let t=L.props;t.onTouchStart&&t.onTouchStart(e)},Te=e=>{we(e),fe.clear(),H.clear(),ye(),ve.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect=`none`,pe.start(b,()=>{document.body.style.WebkitUserSelect=ve.current,be(e)})},Ee=e=>{L.props.onTouchEnd&&L.props.onTouchEnd(e),ye(),fe.start(te,()=>{J(e)})};G.useEffect(()=>{if(!W)return;function e(e){e.key===`Escape`&&J(e)}return document.addEventListener(`keydown`,e),()=>{document.removeEventListener(`keydown`,e)}},[J,W]);let De=S(ue(L),se,t);!P&&P!==0&&(W=!1);let Oe=G.useRef(),ke=e=>{let t=L.props;t.onMouseMove&&t.onMouseMove(e),Ve={x:e.clientX,y:e.clientY},Oe.current&&Oe.current.update()},Ae={},X=typeof P==`string`;u?(Ae.title=!W&&X&&!h?P:null,Ae[`aria-describedby`]=W?_e:null):(Ae[`aria-label`]=X?P:null,Ae[`aria-labelledby`]=W&&!X?_e:null);let Z={...Ae,...ae,...L.props,className:j(ae.className,L.props.className),onTouchStart:we,ref:De,...C?{onMouseMove:ke}:{}},je={};_||(Z.onTouchStart=Te,Z.onTouchEnd=Ee),h||(Z.onMouseOver=He(be,Z.onMouseOver),Z.onMouseLeave=He(Y,Z.onMouseLeave),V||(je.onMouseOver=be,je.onMouseLeave=Y)),d||(Z.onFocus=He(Ce,Z.onFocus),Z.onBlur=He(Se,Z.onBlur),V||(je.onFocus=Ce,je.onBlur=Se));let Q={...n,isRtl:oe,arrow:i,disableInteractive:V,placement:re,PopperComponentProp:k,touch:B.current},Me=typeof M.popper==`function`?M.popper(Q):M.popper,Ne=G.useMemo(()=>{let e=[{name:`arrow`,enabled:!!le,options:{element:le,padding:4}}];return A.popperOptions?.modifiers&&(e=e.concat(A.popperOptions.modifiers)),Me?.popperOptions?.modifiers&&(e=e.concat(Me.popperOptions.modifiers)),{...A.popperOptions,...Me?.popperOptions,modifiers:e}},[le,A.popperOptions,Me?.popperOptions]),$=Fe(Q),Pe=typeof M.transition==`function`?M.transition(Q):M.transition,Ue={slots:{popper:s.Popper,transition:s.Transition??ie,tooltip:s.Tooltip,arrow:s.Arrow,...N},slotProps:{arrow:M.arrow??c.arrow,popper:{...A,...Me??c.popper},tooltip:M.tooltip??c.tooltip,transition:{...F,...Pe??c.transition}}},[We,Ge]=I(`popper`,{elementType:Ie,externalForwardedProps:Ue,ownerState:Q,className:j($.popper,A?.className)}),[Ke,qe]=I(`transition`,{elementType:f,externalForwardedProps:Ue,ownerState:Q}),[Je,Ye]=I(`tooltip`,{elementType:Le,className:$.tooltip,externalForwardedProps:Ue,ownerState:Q}),[Xe,Ze]=I(`arrow`,{elementType:Re,className:$.arrow,externalForwardedProps:Ue,ownerState:Q,ref:de});return(0,K.jsxs)(G.Fragment,{children:[G.cloneElement(L,Z),(0,K.jsx)(We,{as:k??l,placement:re,anchorEl:C?{getBoundingClientRect:()=>({top:Ve.y,left:Ve.x,right:Ve.x,bottom:Ve.y,width:0,height:0})}:z,popperRef:Oe,open:z?W:!1,id:_e,transition:!0,...je,...Ge,popperOptions:Ne,children:({TransitionProps:e})=>(0,K.jsx)(Ke,{timeout:R.transitions.duration.shorter,...e,...qe,children:(0,K.jsxs)(Je,{...Ye,children:[P,i?(0,K.jsx)(Xe,{...Ze}):null]})})})]})});function We(){let{showSuccess:n}=W(),{confirm:r,isOpen:o,options:c,handleConfirm:l,handleCancel:f}=he(),[p,m]=(0,G.useState)([]),[g,_]=(0,G.useState)(!0),[v,y]=(0,G.useState)(null),[b,x]=(0,G.useState)(!1),[S,C]=(0,G.useState)(null),[w,T]=(0,G.useState)(null),[E,D]=(0,G.useState)(null),[ne,j]=(0,G.useState)(``),[N,P]=(0,G.useState)(``),[F,I]=(0,G.useState)(!0),[L,oe]=(0,G.useState)(`off`),[z,ce]=(0,G.useState)(`full`),[le,ue]=(0,G.useState)(!1),[B,V]=(0,G.useState)(null),[me,_e]=(0,G.useState)({}),[ve,ye]=(0,G.useState)(`full`),q=(0,G.useCallback)(async()=>{try{_(!0),y(null),m(await ae())}catch(e){y(e instanceof Error?e.message:`Failed to load libraries`),console.error(`[LibraryManagement] Load error:`,e)}finally{_(!1)}},[]),J=(0,G.useCallback)(async()=>{try{let e=await ae();m(t=>{if(t.length!==e.length)return e;let n=new Map(e.map(e=>[e.library_id,e])),r=!1;for(let e of t){let t=n.get(e.library_id);if(!t){r=!0;break}if(e.scanStatus!==t.scanStatus||e.scanProgress!==t.scanProgress||e.scanTotal!==t.scanTotal||e.scanError!==t.scanError||e.scannedAt!==t.scannedAt||e.fileCount!==t.fileCount||e.folderCount!==t.folderCount){r=!0;break}}return r?t.map(e=>{let t=n.get(e.library_id);return!t||e.scanStatus===t.scanStatus&&e.scanProgress===t.scanProgress&&e.scanTotal===t.scanTotal&&e.scanError===t.scanError&&e.scannedAt===t.scannedAt&&e.fileCount===t.fileCount&&e.folderCount===t.folderCount?e:t}):t})}catch(e){console.error(`[LibraryManagement] Refresh error:`,e)}},[]),be=async()=>{try{D((await A()).library_root||null)}catch(e){console.error(`[LibraryManagement] Failed to load config:`,e)}};(0,G.useEffect)(()=>{q(),be()},[q]),(0,G.useEffect)(()=>{let e=!0,t=null,n=async()=>{try{let n=await h();if(!e)return;n.is_busy?t||=setInterval(()=>{J()},500):t&&(clearInterval(t),t=null,J())}catch(e){console.error(`[LibraryManagement] Failed to check work status:`,e)}};n();let r=setInterval(n,5e3);return()=>{e=!1,t&&clearInterval(t),clearInterval(r)}},[J]);let Y=e=>{if(!E)return!1;let t=E.replace(/\/+$/,``);return!e.replace(/\/+$/,``).startsWith(t)},xe=()=>{j(``),P(``),I(!0),oe(`off`),ce(`full`),ye(`full`),ue(!1),x(!1),C(null)},Se=()=>{xe(),x(!0)},Ce=e=>{j(e.name),P(e.rootPath),I(e.isEnabled),oe(e.watchMode),ce(e.fileWriteMode),ye(e.fileWriteMode),C(e.library_id),x(!1)},we=async()=>{if(!N.trim()){y(`Path is required`);return}try{y(null),await ie({name:ne.trim()||null,rootPath:N,isEnabled:F,watchMode:L,fileWriteMode:z}),await q(),xe()}catch(e){y(e instanceof Error?e.message:`Failed to create library`)}},Te=async()=>{if(S===null)return;if(!N.trim()){y(`Path is required`);return}let e=z!==ve;try{if(y(null),await pe(S,{name:ne.trim()||void 0,rootPath:N,isEnabled:F,watchMode:L,...e?{}:{fileWriteMode:z}}),e){let e=await M(S,z);e.requires_reconciliation&&e.affected_file_count>0&&await r({title:`Reconcile Tags?`,message:`${e.affected_file_count} files need to be rewritten with the new tag format. Reconcile now?`,severity:`info`})&&await Q(S)}await q(),xe()}catch(e){y(e instanceof Error?e.message:`Failed to update library`)}},Ee=async(e,t)=>{try{y(null),T(e);let r=await fe(e,t);n(r.message||`Library scan started (${r.stats?.files_queued??0} files)`),await q()}catch(e){y(e instanceof Error?e.message:`Failed to scan library`)}finally{T(null)}},De=async(e,t)=>{if(await r({title:`Delete Library?`,message:`Delete library "${t}"?\n\nThis will remove the library entry but will NOT delete files on disk.`,severity:`warning`}))try{y(null),await de(e),await q()}catch(e){y(e instanceof Error?e.message:`Failed to delete library`)}},Oe=async(e,t)=>{try{y(null),await pe(e,{watchMode:t}),await q(),n(`File watching mode changed to ${t}`)}catch(e){y(e instanceof Error?e.message:`Failed to change watch mode`)}},Ae=e=>{switch(e){case`event`:return`Event`;case`poll`:return`Poll`;default:return`Off`}},X=e=>{switch(e){case`event`:return`success`;case`poll`:return`warning`;default:return`default`}},Z=e=>{switch(e){case`none`:return`None`;case`minimal`:return`Minimal`;case`full`:return`Full`}},je=e=>{switch(e){case`none`:return`default`;case`minimal`:return`secondary`;case`full`:return`primary`}},Q=async e=>{try{y(null),V(e);let t=await k(e);n(`Reconciled ${t.processed} files (${t.remaining} remaining, ${t.failed} failed)`);let r=await se(e);_e(t=>({...t,[e]:{pending:r.pending_count,inProgress:r.in_progress}}))}catch(e){y(e instanceof Error?e.message:`Failed to reconcile tags`)}finally{V(null)}},Ne=async e=>{try{let t=await se(e);_e(n=>({...n,[e]:{pending:t.pending_count,inProgress:t.in_progress}}))}catch{}},$=b||S!==null;return(0,K.jsxs)(e,{spacing:2.5,children:[(0,K.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`center`,children:[(0,K.jsx)(U,{variant:`h5`,children:`Libraries`}),!$&&(0,K.jsx)(H,{variant:`contained`,onClick:Se,children:`+ Add Library`})]}),v&&(0,K.jsx)(ee,{children:v}),$&&(0,K.jsxs)(re,{children:[(0,K.jsx)(O,{title:b?`Create Library`:`Edit Library`}),(0,K.jsxs)(e,{spacing:2,children:[(0,K.jsxs)(R,{children:[(0,K.jsx)(U,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Name (optional)`}),(0,K.jsx)(s,{value:ne,onChange:e=>j(e.target.value),placeholder:`Auto-generated from path if left empty`,fullWidth:!0})]}),(0,K.jsxs)(R,{children:[(0,K.jsx)(U,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Root Path`}),(0,K.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,K.jsx)(s,{value:N,onChange:e=>P(e.target.value),placeholder:`/music`,fullWidth:!0}),(0,K.jsx)(H,{variant:`outlined`,onClick:()=>ue(!le),sx:{minWidth:120},children:le?`Hide Picker`:`Browse...`})]}),le&&(0,K.jsx)(R,{sx:{mt:1.25,p:2,bgcolor:`background.default`,borderRadius:1,border:1,borderColor:`divider`},children:(0,K.jsx)(ge,{value:N,onChange:e=>{P(e),ue(!1)},mode:`directory`,label:`Select Library Root Directory`})})]}),(0,K.jsx)(Me,{control:(0,K.jsx)(ke,{checked:F,onChange:e=>I(e.target.checked)}),label:`Enabled`}),(0,K.jsx)(R,{children:(0,K.jsxs)(a,{fullWidth:!0,children:[(0,K.jsx)(t,{id:`watch-mode-label`,children:`File Watching`}),(0,K.jsxs)(i,{labelId:`watch-mode-label`,value:L,label:`File Watching`,onChange:e=>oe(e.target.value),children:[(0,K.jsx)(d,{value:`off`,children:(0,K.jsxs)(e,{children:[(0,K.jsxs)(U,{children:[(0,K.jsx)(`strong`,{children:`Off`}),` - No automatic scanning`]}),(0,K.jsx)(U,{variant:`caption`,color:`text.secondary`,children:`Manual scans only`})]})}),(0,K.jsx)(d,{value:`event`,children:(0,K.jsxs)(e,{children:[(0,K.jsxs)(U,{children:[(0,K.jsx)(`strong`,{children:`Event`}),` - Real-time file watching`]}),(0,K.jsx)(U,{variant:`caption`,color:`text.secondary`,children:`Fast (2-5s response), local filesystems only`})]})}),(0,K.jsx)(d,{value:`poll`,children:(0,K.jsxs)(e,{children:[(0,K.jsxs)(U,{children:[(0,K.jsx)(`strong`,{children:`Poll`}),` - Periodic scanning`]}),(0,K.jsx)(U,{variant:`caption`,color:`text.secondary`,children:`Slower (60s interval), network-mount-safe`})]})})]})]})}),(0,K.jsx)(R,{children:(0,K.jsxs)(a,{fullWidth:!0,children:[(0,K.jsx)(t,{id:`write-mode-label`,children:`Tag Writing Mode`}),(0,K.jsxs)(i,{labelId:`write-mode-label`,value:z,label:`Tag Writing Mode`,onChange:e=>ce(e.target.value),children:[(0,K.jsx)(d,{value:`none`,children:(0,K.jsxs)(e,{children:[(0,K.jsxs)(U,{children:[(0,K.jsx)(`strong`,{children:`None`}),` - Don't write tags to files`]}),(0,K.jsx)(U,{variant:`caption`,color:`text.secondary`,children:`DB is source of truth; clears existing nomarr tags`})]})}),(0,K.jsx)(d,{value:`minimal`,children:(0,K.jsxs)(e,{children:[(0,K.jsxs)(U,{children:[(0,K.jsx)(`strong`,{children:`Minimal`}),` - Mood tags only`]}),(0,K.jsx)(U,{variant:`caption`,color:`text.secondary`,children:`Write mood-strict, mood-regular, mood-loose`})]})}),(0,K.jsx)(d,{value:`full`,children:(0,K.jsxs)(e,{children:[(0,K.jsxs)(U,{children:[(0,K.jsx)(`strong`,{children:`Full`}),` - All tags`]}),(0,K.jsx)(U,{variant:`caption`,color:`text.secondary`,children:`Write all ML-derived tags to audio files`})]})})]})]})}),(0,K.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,K.jsx)(H,{variant:`contained`,onClick:b?we:Te,children:b?`Create`:`Update`}),(0,K.jsx)(H,{variant:`outlined`,onClick:xe,children:`Cancel`})]})]})]}),g&&(0,K.jsx)(U,{children:`Loading libraries...`}),!g&&!$&&p.length===0&&(0,K.jsx)(re,{children:(0,K.jsx)(U,{color:`text.secondary`,textAlign:`center`,fontStyle:`italic`,children:`No libraries configured. Click "Add Library" to get started.`})}),!g&&!$&&p.length>0&&(0,K.jsx)(e,{spacing:2,children:p.map(t=>(0,K.jsxs)(re,{children:[(0,K.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`flex-start`,sx:{mb:2},children:[(0,K.jsxs)(R,{children:[(0,K.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1.25,sx:{mb:.5},children:[(0,K.jsx)(U,{variant:`h6`,children:t.name}),Y(t.rootPath)&&(0,K.jsx)(u,{label:`Outside library_root`,color:`warning`,size:`small`})]}),(0,K.jsx)(U,{variant:`body2`,color:`text.secondary`,sx:{fontFamily:`monospace`},children:t.rootPath}),(0,K.jsxs)(e,{direction:`row`,spacing:2,sx:{mt:.5},children:[(0,K.jsxs)(U,{variant:`body2`,color:`text.secondary`,children:[(0,K.jsx)(`strong`,{children:t.fileCount.toLocaleString()}),` files`]}),(0,K.jsxs)(U,{variant:`body2`,color:`text.secondary`,children:[(0,K.jsx)(`strong`,{children:t.folderCount.toLocaleString()}),` folders`]})]}),t.scanStatus===`scanning`&&(0,K.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:.5},children:[(0,K.jsx)(u,{label:`Scanning...`,color:`info`,size:`small`,sx:{animation:`pulse 1.5s infinite`}}),t.scanProgress!=null&&t.scanTotal!=null&&t.scanTotal>0&&(0,K.jsxs)(U,{variant:`body2`,color:`info.main`,children:[t.scanProgress.toLocaleString(),` / `,t.scanTotal.toLocaleString(),` files`,` `,`(`,Math.round(t.scanProgress/t.scanTotal*100),`%)`]})]}),t.scanStatus===`error`&&t.scanError&&(0,K.jsxs)(U,{variant:`caption`,color:`error.main`,sx:{mt:.5},children:[`⚠ Scan error: `,t.scanError]}),Y(t.rootPath)&&(0,K.jsxs)(U,{variant:`caption`,color:`warning.main`,sx:{mt:.5},children:[`⚠ This library is outside the configured library_root (`,E,`)`]}),(0,K.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:1},children:[(0,K.jsx)(U,{variant:`caption`,color:`text.secondary`,children:`File Watching:`}),(0,K.jsx)(a,{size:`small`,sx:{minWidth:120},children:(0,K.jsxs)(i,{value:t.watchMode,onChange:e=>Oe(t.library_id,e.target.value),size:`small`,sx:{fontSize:`0.75rem`},disabled:w===t.library_id,children:[(0,K.jsx)(d,{value:`off`,children:`Off`}),(0,K.jsx)(d,{value:`event`,children:`Event`}),(0,K.jsx)(d,{value:`poll`,children:`Poll`})]})}),(0,K.jsx)(Ue,{title:t.watchMode===`event`?`Real-time file watching (local filesystems)`:t.watchMode===`poll`?`Periodic scanning (network-mount-safe)`:`No automatic file watching`,children:(0,K.jsx)(u,{label:Ae(t.watchMode),color:X(t.watchMode),size:`small`})})]}),(0,K.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:.5},children:[(0,K.jsx)(U,{variant:`caption`,color:`text.secondary`,children:`Tag Writing:`}),(0,K.jsx)(Ue,{title:t.fileWriteMode===`full`?`All ML-derived tags written to audio files`:t.fileWriteMode===`minimal`?`Only mood tags written to audio files`:`No tags written to audio files (DB only)`,children:(0,K.jsx)(u,{label:Z(t.fileWriteMode),color:je(t.fileWriteMode),size:`small`})}),me[t.library_id]?.pending>0&&(0,K.jsx)(u,{label:`${me[t.library_id].pending} pending`,color:`warning`,size:`small`})]})]}),(0,K.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,children:[(0,K.jsx)(R,{sx:{width:8,height:8,borderRadius:`50%`,bgcolor:t.isEnabled?`success.main`:`text.disabled`}}),(0,K.jsx)(U,{variant:`body2`,color:`text.secondary`,children:t.isEnabled?`Enabled`:`Disabled`})]})]}),(0,K.jsxs)(e,{direction:`row`,spacing:1.25,flexWrap:`wrap`,children:[(0,K.jsx)(H,{variant:`outlined`,size:`small`,onClick:()=>Ce(t),disabled:w===t.library_id,children:`Edit`}),(0,K.jsx)(H,{variant:`outlined`,color:`success`,size:`small`,onClick:()=>Ee(t.library_id,`quick`),disabled:!t.isEnabled||w===t.library_id||t.scanStatus===`scanning`||Y(t.rootPath)||!t.scannedAt,title:t.scannedAt?t.scanStatus===`scanning`?`Scan already in progress`:Y(t.rootPath)?`Cannot scan: library is outside library_root`:`Scan only new and modified files`:`Run a Full Scan first before using Quick Scan`,children:w===t.library_id||t.scanStatus===`scanning`?`Scanning...`:`Quick Scan`}),(0,K.jsx)(H,{variant:`contained`,color:`success`,size:`small`,onClick:()=>Ee(t.library_id,`full`),disabled:!t.isEnabled||w===t.library_id||t.scanStatus===`scanning`||Y(t.rootPath),title:t.scanStatus===`scanning`?`Scan already in progress`:Y(t.rootPath)?`Cannot scan: library is outside library_root`:`Rescan all files in the library`,children:w===t.library_id||t.scanStatus===`scanning`?`Scanning...`:`Full Scan`}),(0,K.jsx)(H,{variant:`outlined`,color:`secondary`,size:`small`,onClick:()=>Q(t.library_id),disabled:!t.isEnabled||B===t.library_id||t.scanStatus===`scanning`,title:B===t.library_id?`Reconciling tags...`:`Write tags from database to audio files`,onMouseEnter:()=>Ne(t.library_id),children:B===t.library_id?`Reconciling...`:`Reconcile Tags`}),(0,K.jsx)(H,{variant:`contained`,color:`error`,size:`small`,onClick:()=>De(t.library_id,t.name),disabled:w===t.library_id,children:`Delete`})]})]},t.library_id))}),(0,K.jsx)(te,{open:o,title:c.title,message:c.message,confirmLabel:c.confirmLabel,cancelLabel:c.cancelLabel,severity:c.severity,onConfirm:l,onCancel:f})]})}var Ge={file_write_mode:{label:`Tag Writing Mode`,description:`Controls which tags are written to audio files`,type:`select`,options:[{value:`none`,label:`None - Tags stored in database only`},{value:`minimal`,label:`Minimal - Essential tags only (artist, album, title, genre)`},{value:`full`,label:`Full - All generated tags written to files`}]},overwrite_tags:{label:`Overwrite Existing Tags`,description:`Whether to overwrite existing tags in audio files`,type:`boolean`},library_auto_tag:{label:`Auto-Tag New Files`,description:`Automatically process new files found during library scans`,type:`boolean`},library_ignore_patterns:{label:`Ignore Patterns`,description:`Comma-separated patterns to ignore during scanning (e.g., */Audiobooks/*,*.tmp)`,type:`text`},tagger_worker_count:{label:`Worker Threads`,description:`Number of parallel worker processes for tagging (0 = auto-detect)`,type:`text`},cache_idle_timeout:{label:`Cache Timeout (seconds)`,description:`How long to keep ML models in memory when idle`,type:`text`},calibrate_heads:{label:`Auto-Calibrate Heads`,description:`Automatically calibrate tag thresholds for optimal results`,type:`boolean`},calibration_repo:{label:`Calibration Repository`,description:`Git repository URL for calibration data downloads`,type:`text`}};function Ke({configKey:e,value:t,onChange:n,disabled:r}){let a=t==null?``:String(t),o=Ge[e],c=o?.label||e,l=o?.description,u=o?.type||(typeof t==`boolean`?`boolean`:`text`),f=o?.options||[];return(0,K.jsxs)(R,{sx:{display:`flex`,gap:2,alignItems:`flex-start`,py:1},children:[(0,K.jsxs)(R,{sx:{minWidth:`280px`,flexShrink:0},children:[(0,K.jsx)(U,{variant:`body2`,color:`text.primary`,sx:{fontWeight:500,mb:l?.5:0},children:c}),l&&(0,K.jsx)(U,{variant:`caption`,color:`text.secondary`,sx:{display:`block`},children:l})]}),(0,K.jsx)(R,{sx:{flex:1,maxWidth:`400px`},children:(()=>u===`select`&&f.length>0?(0,K.jsx)(i,{value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0,children:f.map(({value:e,label:t})=>(0,K.jsx)(d,{value:e,children:t},e))}):u===`boolean`?(0,K.jsxs)(i,{value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0,children:[(0,K.jsx)(d,{value:`true`,children:`true`}),(0,K.jsx)(d,{value:`false`,children:`false`})]}):(0,K.jsx)(s,{type:`text`,value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0,placeholder:l}))()})]})}function qe({config:t,hasChanges:n,saveLoading:r,onChange:i,onSaveAll:a}){return(0,K.jsxs)(re,{children:[(0,K.jsx)(O,{title:`Settings`}),(0,K.jsx)(U,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Changes are saved to the database and will take effect on server restart. Use "Restart Server" in Admin page to apply changes.`}),(0,K.jsx)(e,{spacing:1.875,children:Object.entries(t).map(([e,t])=>(0,K.jsx)(Ke,{configKey:e,value:t,onChange:i,disabled:r},e))}),(0,K.jsxs)(R,{sx:{mt:3.75,display:`flex`,gap:1.25,alignItems:`center`},children:[(0,K.jsx)(H,{onClick:a,variant:`contained`,disabled:!n||r,sx:{whiteSpace:`nowrap`},children:r?`Saving...`:`Save All Changes`}),n&&(0,K.jsx)(U,{variant:`body2`,color:`warning.main`,children:`Unsaved changes`})]})]})}function Je(){let{showSuccess:e,showError:t,showInfo:n}=W(),[r,i]=(0,G.useState)({}),[a,o]=(0,G.useState)({}),[s,c]=(0,G.useState)(!0),[l,u]=(0,G.useState)(null),[d,f]=(0,G.useState)(!1),[p,m]=(0,G.useState)(!1),h=async()=>{try{c(!0),u(null);let e=await A();i(e),o(e),m(!1)}catch(e){u(e instanceof Error?e.message:`Failed to load config`),console.error(`[Config] Load error:`,e)}finally{c(!1)}};return(0,G.useEffect)(()=>{h()},[]),(0,G.useEffect)(()=>{m(Object.keys(r).some(e=>r[e]!==a[e]))},[r,a]),{config:r,loading:s,error:l,saveLoading:d,hasChanges:p,handleSaveAll:async()=>{try{f(!0);let t=[];for(let e of Object.keys(r))if(r[e]!==a[e]){let n=r[e];if(n==null||n===``)continue;await le(e,String(n)),t.push(e)}if(t.length===0){n(`No changes to save`);return}e(`Saved ${t.length} config change(s). Use "Restart Server" in Admin page to apply.`),await h()}catch(e){t(e instanceof Error?e.message:`Failed to save config`)}finally{f(!1)}},handleChange:(e,t)=>{i(n=>({...n,[e]:t}))}}}function Ye(){let{config:t,loading:n,error:r,saveLoading:i,hasChanges:a,handleSaveAll:o,handleChange:s}=Je();return(0,K.jsxs)(E,{title:`Configuration`,children:[n&&(0,K.jsx)(P,{}),r&&(0,K.jsxs)(z,{severity:`error`,children:[`Error: `,r]}),!n&&!r&&(0,K.jsxs)(e,{spacing:2.5,children:[(0,K.jsx)(We,{}),(0,K.jsx)(qe,{config:t,hasChanges:a,saveLoading:i,onChange:s,onSaveAll:o})]})]})}export{Ye as ConfigPage};