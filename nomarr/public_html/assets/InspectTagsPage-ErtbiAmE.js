import{t as e}from"./Stack-DS0XiVJ0.js";import{t}from"./TextField-DcSRkFKR.js";import"./useSlotProps-Bg9NAW4i.js";import{a as n,i as r,n as i,r as a,t as o}from"./TableRow-CL1pHeuD.js";import{t as s}from"./ServerFilePicker-8-af5wdn.js";import{C as c,D as l,Dt as u,Et as d,_t as f,c as p,g as m,h,l as g,n as _,o as v,r as y,w as b}from"./index-C8GqTif5.js";import{t as x}from"./useConfirmDialog-B3_A-pyC.js";var S=u(d(),1);async function C(e){return y(`/api/web/tags/show-tags?path=${encodeURIComponent(e)}`)}async function w(e){return _(`/api/web/tags/remove-tags?path=${encodeURIComponent(e)}`)}var T=u(f(),1);function E(){let{confirm:u,isOpen:d,options:f,handleConfirm:_,handleCancel:y}=x(),[E,D]=(0,S.useState)(``),[O,k]=(0,S.useState)(null),[A,j]=(0,S.useState)(!1),[M,N]=(0,S.useState)(null),[P,F]=(0,S.useState)(!1),[I,L]=(0,S.useState)(!1),[R,z]=(0,S.useState)(null),B=async e=>{if(e.preventDefault(),E.trim())try{j(!0),N(null),z(null),k(await C(E))}catch(e){N(e instanceof Error?e.message:`Failed to load tags`),k(null),console.error(`[Inspect] Load error:`,e)}finally{j(!1)}},V=async()=>{if(E.trim()&&await u({title:`Remove All Tags?`,message:`Remove all tags from ${E}?\n\nThis cannot be undone!`,severity:`warning`}))try{L(!0),N(null),z(null);let e=await w(E);z(`Removed ${e.removed} tag(s) from ${e.path}`),k(await C(E))}catch(e){N(e instanceof Error?e.message:`Failed to remove tags`),console.error(`[Inspect] Remove error:`,e)}finally{L(!1)}},H=e=>Array.isArray(e)?e.join(`, `):String(e);return(0,T.jsxs)(g,{title:`Inspect Tags`,children:[(0,T.jsxs)(m,{children:[(0,T.jsx)(h,{title:`File Path`}),(0,T.jsx)(b,{component:`form`,onSubmit:B,children:(0,T.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,T.jsx)(t,{value:E,onChange:e=>D(e.target.value),placeholder:`Enter relative path to audio file`,disabled:A,fullWidth:!0}),(0,T.jsx)(c,{onClick:()=>F(!P),variant:`outlined`,disabled:A,sx:{minWidth:100},children:P?`Hide`:`Browse...`}),(0,T.jsx)(c,{type:`submit`,variant:`contained`,disabled:A||!E.trim(),sx:{minWidth:100},children:A?`Loading...`:`Inspect`})]})}),P&&(0,T.jsx)(b,{sx:{mt:2},children:(0,T.jsx)(s,{value:E,onChange:e=>{D(e),F(!1)},mode:`file`,label:`Select Audio File`})})]}),M&&(0,T.jsx)(m,{children:(0,T.jsxs)(p,{children:[`Error: `,M]})}),R&&(0,T.jsx)(m,{children:(0,T.jsx)(l,{color:`primary`,children:R})}),O&&(0,T.jsxs)(e,{spacing:2.5,children:[(0,T.jsxs)(m,{children:[(0,T.jsx)(h,{title:`File Metadata`,action:O.count>0?(0,T.jsx)(c,{onClick:V,disabled:I,variant:`contained`,color:`error`,size:`small`,title:`Remove all tags from this file`,children:I?`Removing...`:`Remove All Tags`}):void 0}),(0,T.jsxs)(e,{spacing:1.25,children:[(0,T.jsxs)(b,{children:[(0,T.jsx)(l,{component:`span`,fontWeight:`bold`,color:`text.secondary`,sx:{mr:1.25},children:`Path:`}),(0,T.jsx)(l,{component:`span`,children:O.path})]}),(0,T.jsxs)(b,{children:[(0,T.jsx)(l,{component:`span`,fontWeight:`bold`,color:`text.secondary`,sx:{mr:1.25},children:`Namespace:`}),(0,T.jsx)(l,{component:`span`,children:O.namespace})]}),(0,T.jsxs)(b,{children:[(0,T.jsx)(l,{component:`span`,fontWeight:`bold`,color:`text.secondary`,sx:{mr:1.25},children:`Tag Count:`}),(0,T.jsx)(l,{component:`span`,children:O.count})]})]})]}),(0,T.jsxs)(m,{children:[(0,T.jsx)(h,{title:`Tags`}),O.count===0?(0,T.jsx)(l,{color:`text.secondary`,fontStyle:`italic`,children:`No tags found in this file.`}):(0,T.jsx)(b,{sx:{overflowX:`auto`},children:(0,T.jsxs)(n,{children:[(0,T.jsx)(i,{children:(0,T.jsxs)(o,{children:[(0,T.jsx)(a,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Tag Key`}),(0,T.jsx)(a,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Value`})]})}),(0,T.jsx)(r,{children:Object.entries(O.tags).map(([e,t])=>(0,T.jsxs)(o,{children:[(0,T.jsx)(a,{sx:{borderColor:`divider`,wordBreak:`break-word`},children:e}),(0,T.jsx)(a,{sx:{borderColor:`divider`,wordBreak:`break-word`},children:H(t)})]},e))})]})})]})]}),!O&&!M&&(0,T.jsx)(m,{children:(0,T.jsx)(l,{color:`text.secondary`,fontStyle:`italic`,children:`Enter a file path above to inspect its tags.`})}),(0,T.jsx)(v,{open:d,title:f.title,message:f.message,confirmLabel:f.confirmLabel,cancelLabel:f.cancelLabel,severity:f.severity,onConfirm:_,onCancel:y})]})}export{E as InspectTagsPage};