import{t as e}from"./Stack-B65G-2W0.js";import"./useSlotProps-CB3aTem6.js";import{t}from"./Tooltip-jSayCkWx.js";import{t as n}from"./Chip-BlysArp3.js";import{At as r,C as i,D as a,E as o,Gt as s,H as c,Ht as l,Kt as u,Mt as d,Ot as f,Pt as p,Rt as m,S as h,T as g,V as _,Wt as v,Y as y,Yt as b,an as x,at as S,ct as C,dt as w,in as T,kt as E,nt as D,tt as O,ut as k,w as A,z as j}from"./index-C-W2loPz.js";import{t as M}from"./useConfirmDialog-DCMdHl76.js";import{t as N}from"./useNotification-DVBm8Skm.js";var P=x(T());function F(e){return P.Children.toArray(e).filter(e=>P.isValidElement(e))}function I(e){return s(`MuiToggleButton`,e)}var L=v(`MuiToggleButton`,[`root`,`disabled`,`selected`,`standard`,`primary`,`secondary`,`sizeSmall`,`sizeMedium`,`sizeLarge`,`fullWidth`]),R=P.createContext({}),z=P.createContext(void 0);function B(e,t){return t===void 0||e===void 0?!1:Array.isArray(t)?t.includes(e):e===t}var V=x(b()),H=e=>{let{classes:t,fullWidth:n,selected:i,disabled:a,size:o,color:s}=e;return m({root:[`root`,i&&`selected`,a&&`disabled`,n&&`fullWidth`,`size${r(o)}`,s]},I,t)},U=p(w,{name:`MuiToggleButton`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t[`size${r(n.size)}`]]}})(E(({theme:e})=>({...e.typography.button,borderRadius:(e.vars||e).shape.borderRadius,padding:11,border:`1px solid ${(e.vars||e).palette.divider}`,color:(e.vars||e).palette.action.active,[`&.${L.disabled}`]:{color:(e.vars||e).palette.action.disabled,border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`},"&:hover":{textDecoration:`none`,backgroundColor:e.alpha((e.vars||e).palette.text.primary,(e.vars||e).palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:`transparent`}},variants:[{props:{color:`standard`},style:{[`&.${L.selected}`]:{color:(e.vars||e).palette.text.primary,backgroundColor:e.alpha((e.vars||e).palette.text.primary,(e.vars||e).palette.action.selectedOpacity),"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.text.primary,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:e.alpha((e.vars||e).palette.text.primary,(e.vars||e).palette.action.selectedOpacity)}}}}},...Object.entries(e.palette).filter(k()).map(([t])=>({props:{color:t},style:{[`&.${L.selected}`]:{color:(e.vars||e).palette[t].main,backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.selectedOpacity),"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.selectedOpacity)}}}}})),{props:{fullWidth:!0},style:{width:`100%`}},{props:{size:`small`},style:{padding:7,fontSize:e.typography.pxToRem(13)}},{props:{size:`large`},style:{padding:15,fontSize:e.typography.pxToRem(15)}}]}))),W=P.forwardRef(function(e,t){let{value:n,...r}=P.useContext(R),i=P.useContext(z),a=d({props:l({...r,selected:B(e.value,n)},e),name:`MuiToggleButton`}),{children:o,className:s,color:c=`standard`,disabled:f=!1,disableFocusRipple:p=!1,fullWidth:m=!1,onChange:h,onClick:g,selected:_,size:v=`medium`,value:y,...b}=a,x={...a,color:c,disabled:f,disableFocusRipple:p,fullWidth:m,size:v},S=H(x),C=e=>{g&&(g(e,y),e.defaultPrevented)||h&&h(e,y)},w=i||``;return(0,V.jsx)(U,{className:u(r.className,S.root,s,w),disabled:f,focusRipple:!p,ref:t,onClick:C,onChange:h,value:y,ownerState:x,"aria-pressed":_,...b,children:o})});function G(e){return s(`MuiToggleButtonGroup`,e)}var K=v(`MuiToggleButtonGroup`,[`root`,`selected`,`horizontal`,`vertical`,`disabled`,`grouped`,`groupedHorizontal`,`groupedVertical`,`fullWidth`,`firstButton`,`lastButton`,`middleButton`]),q=e=>{let{classes:t,orientation:n,fullWidth:i,disabled:a}=e;return m({root:[`root`,n,i&&`fullWidth`],grouped:[`grouped`,`grouped${r(n)}`,a&&`disabled`],firstButton:[`firstButton`],lastButton:[`lastButton`],middleButton:[`middleButton`]},G,t)},J=p(`div`,{name:`MuiToggleButtonGroup`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${K.grouped}`]:t.grouped},{[`& .${K.grouped}`]:t[`grouped${r(n.orientation)}`]},{[`& .${K.firstButton}`]:t.firstButton},{[`& .${K.lastButton}`]:t.lastButton},{[`& .${K.middleButton}`]:t.middleButton},t.root,n.orientation===`vertical`&&t.vertical,n.fullWidth&&t.fullWidth]}})(E(({theme:e})=>({display:`inline-flex`,borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{orientation:`vertical`},style:{flexDirection:`column`,[`& .${K.grouped}`]:{[`&.${K.selected} + .${K.grouped}.${K.selected}`]:{borderTop:0,marginTop:0}},[`& .${K.firstButton},& .${K.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${K.lastButton},& .${K.middleButton}`]:{marginTop:-1,borderTop:`1px solid transparent`,borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${K.lastButton}.${L.disabled},& .${K.middleButton}.${L.disabled}`]:{borderTop:`1px solid transparent`}}},{props:{fullWidth:!0},style:{width:`100%`}},{props:{orientation:`horizontal`},style:{[`& .${K.grouped}`]:{[`&.${K.selected} + .${K.grouped}.${K.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${K.firstButton},& .${K.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${K.lastButton},& .${K.middleButton}`]:{marginLeft:-1,borderLeft:`1px solid transparent`,borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${K.lastButton}.${L.disabled},& .${K.middleButton}.${L.disabled}`]:{borderLeft:`1px solid transparent`}}}]}))),Y=P.forwardRef(function(e,t){let n=d({props:e,name:`MuiToggleButtonGroup`}),{children:r,className:i,color:a=`standard`,disabled:o=!1,exclusive:s=!1,fullWidth:c=!1,onChange:l,orientation:f=`horizontal`,size:p=`medium`,value:m,...h}=n,g={...n,disabled:o,fullWidth:c,orientation:f,size:p},_=q(g),v=P.useCallback((e,t)=>{if(!l)return;let n=m&&m.indexOf(t),r;m&&n>=0?(r=m.slice(),r.splice(n,1)):r=m?m.concat(t):[t],l(e,r)},[l,m]),y=P.useCallback((e,t)=>{l&&l(e,m===t?null:t)},[l,m]),b=P.useMemo(()=>({className:_.grouped,onChange:s?y:v,value:m,size:p,fullWidth:c,color:a,disabled:o}),[_.grouped,s,y,v,m,p,c,a,o]),x=F(r),S=x.length,C=e=>{let t=e===0,n=e===S-1;return t&&n?``:t?_.firstButton:n?_.lastButton:_.middleButton};return(0,V.jsx)(J,{role:`group`,className:u(_.root,i),ref:t,ownerState:g,...h,children:(0,V.jsx)(R.Provider,{value:b,children:x.map((e,t)=>(0,V.jsx)(z.Provider,{value:C(t),children:e},t))})})}),X=f((0,V.jsx)(`path`,{d:`M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z`}),`Delete`),Z=f((0,V.jsx)(`path`,{d:`M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z`}),`Refresh`);function Q({statusFilter:t,onFilterChange:n,loading:r,actionLoading:i,summary:a,onRefresh:o,onClearCompleted:s,onClearErrors:c,onClearAll:l}){return(0,V.jsx)(y,{children:(0,V.jsxs)(e,{direction:`row`,spacing:2,alignItems:`center`,justifyContent:`space-between`,flexWrap:`wrap`,gap:2,children:[(0,V.jsx)(Y,{value:t,exclusive:!0,onChange:(e,t)=>t&&n(t),size:`small`,disabled:r,children:[`all`,`pending`,`running`,`done`,`error`].map(e=>(0,V.jsx)(W,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),(0,V.jsxs)(e,{direction:`row`,spacing:1,children:[(0,V.jsx)(O,{onClick:o,disabled:r||i,variant:`outlined`,size:`small`,startIcon:(0,V.jsx)(Z,{}),children:`Refresh`}),(0,V.jsx)(O,{onClick:s,disabled:r||i||a.completed===0,variant:`outlined`,size:`small`,children:`Clear Completed`}),(0,V.jsx)(O,{onClick:c,disabled:r||i||a.errors===0,variant:`outlined`,size:`small`,children:`Clear Errors`}),(0,V.jsx)(O,{onClick:l,disabled:r||i,variant:`outlined`,color:`error`,size:`small`,children:`Clear All`})]})]})})}function $({jobs:r,total:i,currentPage:a,totalPages:o,onRemoveJob:s,onNextPage:c,onPrevPage:l,statusFilter:u}){let d=e=>e?new Date(e*1e3).toLocaleString():`-`,f=(e,t=80)=>{if(e.length<=t)return e;let n=e.substring(0,40),r=e.substring(e.length-37);return n+`...`+r},p=e=>e===`running`?`warning`:e===`done`?`success`:e===`error`?`error`:`default`;return r.length===0&&i===0?(0,V.jsx)(y,{children:(0,V.jsx)(S,{color:`text.secondary`,textAlign:`center`,py:8,children:u===`all`?`Queue is empty`:`No ${u} jobs found`})}):(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(e,{spacing:1,children:r.map(r=>(0,V.jsxs)(D,{sx:{bgcolor:`background.paper`,border:1,borderColor:`divider`,borderRadius:1,p:2,display:`flex`,justifyContent:`space-between`,alignItems:`flex-start`},children:[(0,V.jsxs)(D,{sx:{flex:1,minWidth:0},children:[(0,V.jsxs)(e,{direction:`row`,spacing:1,alignItems:`center`,sx:{mb:1},children:[(0,V.jsxs)(S,{variant:`caption`,color:`text.disabled`,sx:{fontFamily:`monospace`},children:[`#`,r.id]}),(0,V.jsx)(n,{label:r.status,size:`small`,color:p(r.status),sx:{height:20,fontSize:`0.7rem`}})]}),(0,V.jsx)(t,{title:r.path,placement:`top`,children:(0,V.jsx)(S,{variant:`body2`,sx:{fontFamily:`monospace`,fontSize:`0.85rem`,mb:.5,wordBreak:`break-all`},children:f(r.path)})}),(0,V.jsxs)(e,{direction:`row`,spacing:2,sx:{mt:1},children:[(0,V.jsxs)(S,{variant:`caption`,color:`text.secondary`,children:[`Created: `,d(r.created_at)]}),r.started_at&&(0,V.jsxs)(S,{variant:`caption`,color:`text.secondary`,children:[`Started: `,d(r.started_at)]})]}),r.error_message&&(0,V.jsx)(S,{variant:`caption`,color:`error`,sx:{display:`block`,mt:1,p:1,bgcolor:`error.dark`,borderRadius:.5},children:r.error_message})]}),(0,V.jsx)(C,{onClick:()=>s(r.id),disabled:r.status===`running`,color:`error`,size:`small`,sx:{ml:2},children:(0,V.jsx)(X,{fontSize:`small`})})]},r.id))}),o>1&&(0,V.jsx)(D,{sx:{mt:3},children:(0,V.jsxs)(e,{direction:`row`,spacing:2,alignItems:`center`,justifyContent:`center`,children:[(0,V.jsx)(O,{variant:`outlined`,onClick:l,disabled:a===1,children:`Previous`}),(0,V.jsxs)(S,{color:`text.secondary`,children:[`Page `,a,` of `,o,` (`,i.toLocaleString(),` total)`]}),(0,V.jsx)(O,{variant:`outlined`,onClick:c,disabled:a===o,children:`Next`})]})})]})}function ee({summary:t}){return(0,V.jsx)(y,{children:(0,V.jsxs)(e,{direction:`row`,spacing:2,flexWrap:`wrap`,children:[(0,V.jsxs)(D,{sx:{display:`flex`,flexDirection:`column`,alignItems:`center`,p:2,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minWidth:100},children:[(0,V.jsx)(S,{variant:`h4`,fontWeight:`bold`,children:t.pending}),(0,V.jsx)(S,{variant:`caption`,color:`text.secondary`,children:`Pending`})]}),(0,V.jsxs)(D,{sx:{display:`flex`,flexDirection:`column`,alignItems:`center`,p:2,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minWidth:100},children:[(0,V.jsx)(S,{variant:`h4`,fontWeight:`bold`,children:t.running}),(0,V.jsx)(S,{variant:`caption`,color:`text.secondary`,children:`Running`})]}),(0,V.jsxs)(D,{sx:{display:`flex`,flexDirection:`column`,alignItems:`center`,p:2,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minWidth:100},children:[(0,V.jsx)(S,{variant:`h4`,fontWeight:`bold`,children:t.completed}),(0,V.jsx)(S,{variant:`caption`,color:`text.secondary`,children:`Completed`})]}),(0,V.jsxs)(D,{sx:{display:`flex`,flexDirection:`column`,alignItems:`center`,p:2,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minWidth:100},children:[(0,V.jsx)(S,{variant:`h4`,fontWeight:`bold`,children:t.errors}),(0,V.jsx)(S,{variant:`caption`,color:`text.secondary`,children:`Errors`})]})]})})}function te(){let{showSuccess:e,showError:t}=N(),{confirm:n,isOpen:r,options:s,handleConfirm:c,handleCancel:l}=M(),[u,d]=(0,P.useState)([]),[f,p]=(0,P.useState)({pending:0,running:0,completed:0,errors:0}),[m,_]=(0,P.useState)(0),[v,y]=(0,P.useState)(!0),[b,x]=(0,P.useState)(null),[S,C]=(0,P.useState)(!1),[w,T]=(0,P.useState)(`all`),[E]=(0,P.useState)(50),[D,O]=(0,P.useState)(0),k=Math.floor(D/E)+1,j=Math.ceil(m/E),F=async()=>{try{y(!0),x(null);let e={limit:E,offset:D};w!==`all`&&(e.status=w);let t=await o(e);d(t.jobs),_(t.total),p(await g())}catch(e){x(e instanceof Error?e.message:`Failed to load queue`),console.error(`[Queue] Load error:`,e)}finally{y(!1)}};return(0,P.useEffect)(()=>{F()},[w,D]),(0,P.useEffect)(()=>{let e=m>0||f.pending>0||f.running>0?1e3:3e4,t=setInterval(async()=>{try{if(p(await g()),!v){let e={limit:E,offset:D};w!==`all`&&(e.status=w);let t=await o(e);d(t.jobs),_(t.total)}}catch(e){console.error(`[Queue] Failed to poll queue status:`,e)}},e);return()=>clearInterval(t)},[m,f,v,w,D,E]),{jobs:u,summary:f,total:m,loading:v,error:b,actionLoading:S,statusFilter:w,currentPage:k,totalPages:j,loadQueue:F,removeJob:async e=>{if(await n({title:`Remove Job`,message:`Remove job ${e}?`,severity:`warning`}))try{C(!0),await a({job_id:e}),await F()}catch(e){t(e instanceof Error?e.message:`Failed to remove job`)}finally{C(!1)}},clearCompleted:async()=>{if(await n({title:`Clear Completed Jobs`,message:`Clear all completed jobs?`,severity:`warning`}))try{C(!0),e(`Removed ${(await i()).removed} completed job(s)`),await F()}catch(e){t(e instanceof Error?e.message:`Failed to clear completed`)}finally{C(!1)}},clearErrors:async()=>{if(await n({title:`Clear Error Jobs`,message:`Clear all error jobs?`,severity:`error`}))try{C(!0),e(`Removed ${(await A()).removed} error job(s)`),await F()}catch(e){t(e instanceof Error?e.message:`Failed to clear errors`)}finally{C(!1)}},clearAll:async()=>{if(await n({title:`Clear All Jobs`,message:`Clear ALL jobs (except running)?`,severity:`error`}))try{C(!0),e(`Removed ${(await h()).removed} job(s)`),await F()}catch(e){t(e instanceof Error?e.message:`Failed to clear all`)}finally{C(!1)}},handleFilterChange:e=>{T(e),O(0)},nextPage:()=>{k<j&&O(D+E)},prevPage:()=>{k>1&&O(Math.max(0,D-E))},dialogState:{isOpen:r,options:s,handleConfirm:c,handleCancel:l}}}function ne(){let{jobs:e,summary:t,total:n,loading:r,error:i,actionLoading:a,statusFilter:o,currentPage:s,totalPages:l,loadQueue:u,removeJob:d,clearCompleted:f,clearErrors:p,clearAll:m,handleFilterChange:h,nextPage:g,prevPage:v,dialogState:y}=te();return(0,V.jsxs)(c,{title:`Tagger Status`,children:[(0,V.jsx)(ee,{summary:t}),(0,V.jsx)(Q,{statusFilter:o,onFilterChange:h,loading:r,actionLoading:a,summary:t,onRefresh:u,onClearCompleted:f,onClearErrors:p,onClearAll:m}),r&&(0,V.jsx)(S,{textAlign:`center`,py:5,color:`text.secondary`,children:`Loading tagger status...`}),i&&(0,V.jsx)(_,{children:i}),!r&&!i&&(0,V.jsx)($,{jobs:e,total:n,currentPage:s,totalPages:l,onRemoveJob:d,onNextPage:g,onPrevPage:v,statusFilter:o}),(0,V.jsx)(j,{open:y.isOpen,title:y.options.title,message:y.options.message,confirmLabel:y.options.confirmLabel,cancelLabel:y.options.cancelLabel,severity:y.options.severity,onConfirm:y.handleConfirm,onCancel:y.handleCancel})]})}export{ne as TaggerStatusPage};