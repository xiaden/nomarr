import{t as e}from"./Stack-9vsGVU2g.js";import{a as t,o as n,s as r,t as i}from"./TextField-C_V-Uu3c.js";import{n as a}from"./useSlotProps-CxWW9SbF.js";import{t as o}from"./Chip-qTWPDVbu.js";import{D as s,G as c,K as l,O as u,Q as d,St as f,Y as p,Z as m,b as h,ct as g,f as _,ft as v,i as y,j as b,lt as x,m as S,n as C,o as w,p as T,q as E,s as D,st as O,tt as k,u as A,w as j,x as M,xt as N}from"./index-BGuWRyLI.js";import{t as P}from"./useConfirmDialog-CluKfLUb.js";import{t as ee}from"./useNotification-pFUOPVYo.js";import{t as F}from"./ServerFilePicker-gYggDbCs.js";function I(e){return g(`PrivateSwitchBase`,e)}O(`PrivateSwitchBase`,[`root`,`checked`,`disabled`,`input`,`edgeStart`,`edgeEnd`]);var L=f(N()),R=f(v()),z=e=>{let{classes:t,checked:n,disabled:r,edge:i}=e;return k({root:[`root`,n&&`checked`,r&&`disabled`,i&&`edge${E(i)}`],input:[`input`]},I,t)},B=m(u,{name:`MuiSwitchBase`})({padding:9,borderRadius:`50%`,variants:[{props:{edge:`start`,size:`small`},style:{marginLeft:-3}},{props:({edge:e,ownerState:t})=>e===`start`&&t.size!==`small`,style:{marginLeft:-12}},{props:{edge:`end`,size:`small`},style:{marginRight:-3}},{props:({edge:e,ownerState:t})=>e===`end`&&t.size!==`small`,style:{marginRight:-12}}]}),V=m(`input`,{name:`MuiSwitchBase`,shouldForwardProp:d})({cursor:`inherit`,position:`absolute`,opacity:0,width:`100%`,height:`100%`,top:0,left:0,margin:0,padding:0,zIndex:1}),H=L.forwardRef(function(e,n){let{autoFocus:r,checked:i,checkedIcon:o,defaultChecked:s,disabled:c,disableFocusRipple:l=!1,edge:u=!1,icon:d,id:f,inputProps:p,inputRef:m,name:h,onBlur:g,onChange:_,onFocus:v,readOnly:y,required:x=!1,tabIndex:S,type:C,value:w,slots:T={},slotProps:E={},...D}=e,[O,k]=a({controlled:i,default:!!s,name:`SwitchBase`,state:`checked`}),A=t(),j=e=>{v&&v(e),A&&A.onFocus&&A.onFocus(e)},M=e=>{g&&g(e),A&&A.onBlur&&A.onBlur(e)},N=e=>{if(e.nativeEvent.defaultPrevented)return;let t=e.target.checked;k(t),_&&_(e,t)},P=c;A&&P===void 0&&(P=A.disabled);let ee=C===`checkbox`||C===`radio`,F={...e,checked:O,disabled:P,disableFocusRipple:l,edge:u},I=z(F),L={slots:T,slotProps:{input:p,...E}},[H,U]=b(`root`,{ref:n,elementType:B,className:I.root,shouldForwardComponentProp:!0,externalForwardedProps:{...L,component:`span`,...D},getSlotProps:e=>({...e,onFocus:t=>{e.onFocus?.(t),j(t)},onBlur:t=>{e.onBlur?.(t),M(t)}}),ownerState:F,additionalProps:{centerRipple:!0,focusRipple:!l,disabled:P,role:void 0,tabIndex:null}}),[W,G]=b(`input`,{ref:m,elementType:V,className:I.input,externalForwardedProps:L,getSlotProps:e=>({...e,onChange:t=>{e.onChange?.(t),N(t)}}),ownerState:F,additionalProps:{autoFocus:r,checked:i,defaultChecked:s,disabled:P,id:ee?f:void 0,name:h,readOnly:y,required:x,tabIndex:S,type:C,...C===`checkbox`&&w===void 0?{}:{value:w}}});return(0,R.jsxs)(H,{...U,children:[(0,R.jsx)(W,{...G}),O?o:d]})}),U=c((0,R.jsx)(`path`,{d:`M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z`}),`CheckBoxOutlineBlank`),W=c((0,R.jsx)(`path`,{d:`M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z`}),`CheckBox`),G=c((0,R.jsx)(`path`,{d:`M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z`}),`IndeterminateCheckBox`);function K(e){return g(`MuiCheckbox`,e)}var q=O(`MuiCheckbox`,[`root`,`checked`,`disabled`,`indeterminate`,`colorPrimary`,`colorSecondary`,`sizeSmall`,`sizeMedium`]),J=e=>{let{classes:t,indeterminate:n,color:r,size:i}=e,a=k({root:[`root`,n&&`indeterminate`,`color${E(r)}`,`size${E(i)}`]},K,t);return{...t,...a}},te=m(H,{shouldForwardProp:e=>d(e)||e===`classes`,name:`MuiCheckbox`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${E(n.size)}`],n.color!==`default`&&t[`color${E(n.color)}`]]}})(l(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:`default`,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(s()).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(s()).map(([t])=>({props:{color:t},style:{[`&.${q.checked}, &.${q.indeterminate}`]:{color:(e.vars||e).palette[t].main},[`&.${q.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:`transparent`}}}}]}))),Y=(0,R.jsx)(W,{}),X=(0,R.jsx)(U,{}),ne=(0,R.jsx)(G,{}),re=L.forwardRef(function(e,t){let n=p({props:e,name:`MuiCheckbox`}),{checkedIcon:i=Y,color:a=`primary`,icon:o=X,indeterminate:s=!1,indeterminateIcon:c=ne,inputProps:l,size:u=`medium`,disableRipple:d=!1,className:f,slots:m={},slotProps:h={},...g}=n,_=s?c:o,v=s?c:i,y={...n,disableRipple:d,color:a,indeterminate:s,size:u},S=J(y),C=h.input??l,[w,T]=b(`root`,{ref:t,elementType:te,className:x(S.root,f),shouldForwardComponentProp:!0,externalForwardedProps:{slots:m,slotProps:h,...g},ownerState:y,additionalProps:{type:`checkbox`,icon:L.cloneElement(_,{fontSize:_.props.fontSize??u}),checkedIcon:L.cloneElement(v,{fontSize:v.props.fontSize??u}),disableRipple:d,slots:m,slotProps:{input:r(typeof C==`function`?C(y):C,{"data-indeterminate":s})}}});return(0,R.jsx)(w,{...T,classes:S})});function Z(e){return g(`MuiFormControlLabel`,e)}var Q=O(`MuiFormControlLabel`,[`root`,`labelPlacementStart`,`labelPlacementTop`,`labelPlacementBottom`,`disabled`,`label`,`error`,`required`,`asterisk`]),ie=e=>{let{classes:t,disabled:n,labelPlacement:r,error:i,required:a}=e;return k({root:[`root`,n&&`disabled`,`labelPlacement${E(r)}`,i&&`error`,a&&`required`],label:[`label`,n&&`disabled`],asterisk:[`asterisk`,i&&`error`]},Z,t)};const ae=m(`label`,{name:`MuiFormControlLabel`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${Q.label}`]:t.label},t.root,t[`labelPlacement${E(n.labelPlacement)}`]]}})(l(({theme:e})=>({display:`inline-flex`,alignItems:`center`,cursor:`pointer`,verticalAlign:`middle`,WebkitTapHighlightColor:`transparent`,marginLeft:-11,marginRight:16,[`&.${Q.disabled}`]:{cursor:`default`},[`& .${Q.label}`]:{[`&.${Q.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:`start`},style:{flexDirection:`row-reverse`,marginRight:-11}},{props:{labelPlacement:`top`},style:{flexDirection:`column-reverse`}},{props:{labelPlacement:`bottom`},style:{flexDirection:`column`}},{props:({labelPlacement:e})=>e===`start`||e===`top`||e===`bottom`,style:{marginLeft:16}}]})));var oe=m(`span`,{name:`MuiFormControlLabel`,slot:`Asterisk`})(l(({theme:e})=>({[`&.${Q.error}`]:{color:(e.vars||e).palette.error.main}}))),se=L.forwardRef(function(e,r){let i=p({props:e,name:`MuiFormControlLabel`}),{checked:a,className:o,componentsProps:s={},control:c,disabled:l,disableTypography:u,inputRef:d,label:f,labelPlacement:m=`end`,name:h,onChange:g,required:_,slots:v={},slotProps:y={},value:S,...C}=i,w=t(),T=l??c.props.disabled??w?.disabled,E=_??c.props.required,D={disabled:T,required:E};[`checked`,`name`,`onChange`,`value`,`inputRef`].forEach(e=>{c.props[e]===void 0&&i[e]!==void 0&&(D[e]=i[e])});let O=n({props:i,muiFormControl:w,states:[`error`]}),k={...i,disabled:T,labelPlacement:m,required:E,error:O.error},A=ie(k),[M,N]=b(`typography`,{elementType:j,externalForwardedProps:{slots:v,slotProps:{...s,...y}},ownerState:k}),P=f;return P!=null&&P.type!==j&&!u&&(P=(0,R.jsx)(M,{component:`span`,...N,className:x(A.label,N?.className),children:P})),(0,R.jsxs)(ae,{className:x(A.root,o),ownerState:k,ref:r,...C,children:[L.cloneElement(c,D),E?(0,R.jsxs)(`div`,{children:[P,(0,R.jsxs)(oe,{ownerState:k,"aria-hidden":!0,className:A.asterisk,children:[` `,`*`]})]}):P]})});function ce(){let{showSuccess:t}=ee(),{confirm:n,isOpen:r,options:a,handleConfirm:s,handleCancel:c}=P(),[l,u]=(0,L.useState)([]),[d,f]=(0,L.useState)(!0),[p,m]=(0,L.useState)(null),[g,_]=(0,L.useState)(!1),[v,b]=(0,L.useState)(null),[x,E]=(0,L.useState)(null),[D,O]=(0,L.useState)(null),[k,A]=(0,L.useState)(null),[N,I]=(0,L.useState)(``),[z,B]=(0,L.useState)(``),[V,H]=(0,L.useState)(!0),[U,W]=(0,L.useState)(!1),[G,K]=(0,L.useState)(!1),[q,J]=(0,L.useState)(null),[te,Y]=(0,L.useState)(!1),X=async()=>{try{f(!0),m(null),u(await C.library.list())}catch(e){m(e instanceof Error?e.message:`Failed to load libraries`),console.error(`[LibraryManagement] Load error:`,e)}finally{f(!1)}},ne=async()=>{try{A((await C.config.get()).library_root||null)}catch(e){console.error(`[LibraryManagement] Failed to load config:`,e)}};(0,L.useEffect)(()=>{X(),ne()},[]);let Z=e=>{if(!k)return!1;let t=k.replace(/\/+$/,``);return!e.replace(/\/+$/,``).startsWith(t)},Q=()=>{I(``),B(``),H(!0),W(!1),K(!1),J(null),Y(!1),_(!1),b(null)},ie=()=>{Q(),_(!0)},ae=e=>{I(e.name),B(e.rootPath),H(e.isEnabled),W(e.isDefault),b(e.id),_(!1),J(null),Y(!1)},oe=async()=>{if(!z.trim()){m(`Path is required for preview`);return}if(v===null){m(`Create the library first to preview file count`);return}try{m(null),Y(!0),J((await C.library.preview(v,{recursive:!0})).file_count)}catch(e){m(e instanceof Error?e.message:`Failed to preview library`)}finally{Y(!1)}},ce=async()=>{if(!N.trim()||!z.trim()){m(`Name and path are required`);return}try{m(null),await C.library.create({name:N,rootPath:z,isEnabled:V,isDefault:U}),await X(),Q()}catch(e){m(e instanceof Error?e.message:`Failed to create library`)}},le=async()=>{if(v!==null){if(!N.trim()||!z.trim()){m(`Name and path are required`);return}try{m(null),await C.library.update(v,{name:N,rootPath:z,isEnabled:V,isDefault:U}),await X(),Q()}catch(e){m(e instanceof Error?e.message:`Failed to update library`)}}},ue=async e=>{try{m(null),await C.library.setDefault(e),await X()}catch(e){m(e instanceof Error?e.message:`Failed to set default library`)}},de=async e=>{try{if(m(null),E(e),O(`preparing`),!await n({title:`Start Library Scan?`,message:`Found ${(await C.library.preview(e,{recursive:!0})).file_count.toLocaleString()} audio files. Start scan?`}))return;O(`queueing`);let r=await C.library.scan(e,{recursive:!0,force:!1,cleanMissing:!0});t(`Scan ${r.status}: ${r.message||`Library scan queued`}`),await X()}catch(e){m(e instanceof Error?e.message:`Failed to scan library`)}finally{E(null),O(null)}},fe=async(e,t,r)=>{if(r){m(`Cannot delete the default library. Set another library as default first.`);return}if(await n({title:`Delete Library?`,message:`Delete library "${t}"?\n\nThis will remove the library entry but will NOT delete files on disk.`,severity:`warning`}))try{m(null),await C.library.delete(e),await X()}catch(e){m(e instanceof Error?e.message:`Failed to delete library`)}},$=g||v!==null;return(0,R.jsxs)(e,{spacing:2.5,children:[(0,R.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`center`,children:[(0,R.jsx)(j,{variant:`h5`,children:`Libraries`}),!$&&(0,R.jsx)(h,{variant:`contained`,onClick:ie,children:`+ Add Library`})]}),p&&(0,R.jsx)(w,{children:p}),$&&(0,R.jsxs)(S,{children:[(0,R.jsx)(T,{title:g?`Create Library`:`Edit Library`}),(0,R.jsxs)(e,{spacing:2,children:[(0,R.jsxs)(M,{children:[(0,R.jsx)(j,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Name`}),(0,R.jsx)(i,{value:N,onChange:e=>I(e.target.value),placeholder:`My Music Library`,fullWidth:!0})]}),(0,R.jsxs)(M,{children:[(0,R.jsx)(j,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Root Path`}),(0,R.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,R.jsx)(i,{value:z,onChange:e=>B(e.target.value),placeholder:`/music`,fullWidth:!0}),(0,R.jsx)(h,{variant:`outlined`,onClick:()=>K(!G),sx:{minWidth:120},children:G?`Hide Picker`:`Browse...`})]}),G&&(0,R.jsx)(M,{sx:{mt:1.25,p:2,bgcolor:`background.default`,borderRadius:1,border:1,borderColor:`divider`},children:(0,R.jsx)(F,{value:z,onChange:e=>{B(e),K(!1)},mode:`directory`,label:`Select Library Root Directory`})})]}),(0,R.jsx)(se,{control:(0,R.jsx)(re,{checked:V,onChange:e=>H(e.target.checked)}),label:`Enabled`}),(0,R.jsx)(se,{control:(0,R.jsx)(re,{checked:U,onChange:e=>W(e.target.checked)}),label:`Default Library`}),v!==null&&(0,R.jsxs)(M,{children:[(0,R.jsx)(h,{variant:`outlined`,onClick:oe,disabled:!z.trim()||te,children:te?`Checking...`:`Preview File Count`}),q!==null&&(0,R.jsx)(M,{sx:{mt:1,p:1.5,bgcolor:`background.paper`,borderRadius:1,border:1,borderColor:`divider`},children:(0,R.jsxs)(j,{children:[(0,R.jsx)(`strong`,{children:q.toLocaleString()}),` audio files found`]})})]}),(0,R.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,R.jsx)(h,{variant:`contained`,onClick:g?ce:le,children:g?`Create`:`Update`}),(0,R.jsx)(h,{variant:`outlined`,onClick:Q,children:`Cancel`})]})]})]}),d&&(0,R.jsx)(j,{children:`Loading libraries...`}),!d&&!$&&l.length===0&&(0,R.jsx)(S,{children:(0,R.jsx)(j,{color:`text.secondary`,textAlign:`center`,fontStyle:`italic`,children:`No libraries configured. Click "Add Library" to get started.`})}),!d&&!$&&l.length>0&&(0,R.jsx)(e,{spacing:2,children:l.map(t=>(0,R.jsxs)(S,{children:[(0,R.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`flex-start`,sx:{mb:2},children:[(0,R.jsxs)(M,{children:[(0,R.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1.25,sx:{mb:.5},children:[(0,R.jsx)(j,{variant:`h6`,children:t.name}),t.isDefault&&(0,R.jsx)(o,{label:`Default`,color:`primary`,size:`small`}),Z(t.rootPath)&&(0,R.jsx)(o,{label:`Outside library_root`,color:`warning`,size:`small`})]}),(0,R.jsx)(j,{variant:`body2`,color:`text.secondary`,sx:{fontFamily:`monospace`},children:t.rootPath}),Z(t.rootPath)&&(0,R.jsxs)(j,{variant:`caption`,color:`warning.main`,sx:{mt:.5},children:[`⚠ This library is outside the configured library_root (`,k,`)`]})]}),(0,R.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,children:[(0,R.jsx)(M,{sx:{width:8,height:8,borderRadius:`50%`,bgcolor:t.isEnabled?`success.main`:`text.disabled`}}),(0,R.jsx)(j,{variant:`body2`,color:`text.secondary`,children:t.isEnabled?`Enabled`:`Disabled`})]})]}),(0,R.jsxs)(e,{direction:`row`,spacing:1.25,flexWrap:`wrap`,children:[(0,R.jsx)(h,{variant:`outlined`,size:`small`,onClick:()=>ae(t),disabled:x===t.id,children:`Edit`}),!t.isDefault&&(0,R.jsx)(h,{variant:`outlined`,size:`small`,onClick:()=>ue(t.id),disabled:x===t.id,children:`Set Default`}),(0,R.jsx)(h,{variant:`contained`,color:`success`,size:`small`,onClick:()=>de(t.id),disabled:!t.isEnabled||x===t.id||Z(t.rootPath),title:Z(t.rootPath)?`Cannot scan: library is outside library_root`:void 0,children:x===t.id?D===`preparing`?`Preparing...`:`Queueing...`:`Scan`}),(0,R.jsx)(h,{variant:`contained`,color:`error`,size:`small`,onClick:()=>fe(t.id,t.name,t.isDefault),disabled:x===t.id,children:`Delete`})]})]},t.id))}),(0,R.jsx)(y,{open:r,title:a.title,message:a.message,confirmLabel:a.confirmLabel,cancelLabel:a.cancelLabel,severity:a.severity,onConfirm:s,onCancel:c})]})}function le({stats:e}){let t=[{label:`Total Files`,value:e.total_files},{label:`Artists`,value:e.unique_artists},{label:`Albums`,value:e.unique_albums},{label:`Total Duration`,value:(e=>`${Math.floor(e/3600)}h ${Math.floor(e%3600/60)}m`)(e.total_duration_seconds)}];return(0,R.jsxs)(S,{children:[(0,R.jsx)(T,{title:`Library Statistics`}),(0,R.jsx)(A,{minColumnWidth:200,children:t.map(e=>(0,R.jsx)(_,{label:e.label,value:e.value},e.label))})]})}function ue(){let[e,t]=(0,L.useState)(null),[n,r]=(0,L.useState)(!0),[i,a]=(0,L.useState)(null),o=async()=>{try{r(!0),a(null),t(await C.library.getStats())}catch(e){a(e instanceof Error?e.message:`Failed to load stats`),console.error(`[Library] Load error:`,e)}finally{r(!1)}};return(0,L.useEffect)(()=>{o()},[]),{stats:e,loading:n,error:i}}function de(){let{stats:t,loading:n,error:r}=ue();return(0,R.jsxs)(D,{title:`Library Management`,children:[n&&(0,R.jsx)(j,{children:`Loading library statistics...`}),r&&(0,R.jsxs)(w,{children:[`Error: `,r]}),t&&(0,R.jsxs)(e,{spacing:2.5,children:[(0,R.jsx)(le,{stats:t}),(0,R.jsx)(S,{children:(0,R.jsx)(ce,{})})]})]})}export{de as LibraryPage};