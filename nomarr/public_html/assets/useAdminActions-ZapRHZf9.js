import{t as e}from"./Stack-C1Q7NCGH.js";import{i as t,o as n,r,t as i}from"./Select-D82qstJP.js";import{t as a}from"./TextField-i9-XGgc2.js";import{a as o,i as s,n as c,r as l,t as u}from"./TableRow-DtgsSp99.js";import{A as d,At as f,D as p,Dt as m,E as h,Kn as g,M as _,N as v,Nn as y,Pt as b,Q as x,St as S,T as C,Tt as w,Wn as T,at as E,j as D,k as O,lt as k,ut as A,xt as j}from"./index-Cn9WoKM-.js";import{t as M}from"./useConfirmDialog-D2PdtdKy.js";import{t as N}from"./ServerFilePicker-B6wGst9g.js";import{t as P}from"./useNotification-P3jqWpUZ.js";var F=g(T(),1),I=g(y(),1);function L(){let{confirm:t}=M(),[n,r]=(0,F.useState)(``),[i,d]=(0,F.useState)(null),[f,p]=(0,F.useState)(!1),[h,g]=(0,F.useState)(null),[y,b]=(0,F.useState)(!1),[x,C]=(0,F.useState)(!1),[T,E]=(0,F.useState)(null),D=async e=>{if(e.preventDefault(),n.trim())try{p(!0),g(null),E(null),d(await v(n))}catch(e){g(e instanceof Error?e.message:`Failed to load tags`),d(null),console.error(`[Inspect] Load error:`,e)}finally{p(!1)}},O=async()=>{if(n.trim()&&await t({title:`Remove All Tags?`,message:`Remove all tags from ${n}?\n\nThis cannot be undone!`,severity:`warning`}))try{C(!0),g(null),E(null);let e=await _(n);E(`Removed ${e.removed} tag(s) from ${e.path}`),d(await v(n))}catch(e){g(e instanceof Error?e.message:`Failed to remove tags`),console.error(`[Inspect] Remove error:`,e)}finally{C(!1)}},P=e=>Array.isArray(e)?e.join(`, `):String(e);return(0,I.jsxs)(A,{children:[(0,I.jsx)(k,{title:`Inspect Tags`}),(0,I.jsx)(w,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Debug tool to view and remove tags from individual audio files.`}),(0,I.jsx)(`form`,{onSubmit:D,children:(0,I.jsxs)(e,{spacing:2,children:[(0,I.jsxs)(S,{sx:{display:`flex`,gap:1.25,alignItems:`center`},children:[(0,I.jsx)(a,{label:`File Path`,value:n,onChange:e=>r(e.target.value),placeholder:`/music/artist/album/track.flac`,fullWidth:!0,size:`small`,disabled:f||x}),(0,I.jsx)(j,{type:`button`,variant:`outlined`,onClick:()=>b(!0),disabled:f||x,sx:{whiteSpace:`nowrap`,minWidth:`fit-content`},children:`Browse Files`}),(0,I.jsx)(j,{type:`submit`,variant:`contained`,disabled:!n.trim()||f||x,sx:{whiteSpace:`nowrap`,minWidth:`fit-content`},children:f?`Loading...`:`Show Tags`})]}),h&&(0,I.jsx)(m,{severity:`error`,children:h}),T&&(0,I.jsx)(m,{severity:`success`,children:T}),y&&(0,I.jsx)(S,{sx:{mt:2},children:(0,I.jsx)(N,{value:n,onChange:e=>{r(e),b(!1)},mode:`file`,label:`Select Audio File`})}),i&&(0,I.jsxs)(e,{spacing:2,children:[(0,I.jsxs)(S,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,py:1,px:2,backgroundColor:`action.hover`,borderRadius:1},children:[(0,I.jsxs)(w,{variant:`body2`,children:[(0,I.jsx)(`strong`,{children:`File:`}),` `,i.path]}),(0,I.jsxs)(w,{variant:`body2`,children:[(0,I.jsx)(`strong`,{children:`Tags:`}),` `,i.count]})]}),i.count>0&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(o,{size:`small`,children:[(0,I.jsx)(c,{children:(0,I.jsxs)(u,{children:[(0,I.jsx)(l,{children:(0,I.jsx)(`strong`,{children:`Key`})}),(0,I.jsx)(l,{children:(0,I.jsx)(`strong`,{children:`Value`})})]})}),(0,I.jsx)(s,{children:Object.entries(i.tags).map(([e,t])=>(0,I.jsxs)(u,{children:[(0,I.jsx)(l,{sx:{fontFamily:`monospace`},children:e}),(0,I.jsx)(l,{sx:{wordBreak:`break-all`},children:P(t)})]},e))})]}),(0,I.jsx)(S,{sx:{display:`flex`,justifyContent:`flex-end`},children:(0,I.jsx)(j,{onClick:O,variant:`outlined`,color:`error`,disabled:x,sx:{textTransform:`none`},children:x?`Removing...`:`Remove All Tags`})})]}),i.count===0&&(0,I.jsx)(m,{severity:`info`,children:`No tags found in this file.`})]})]})})]})}function R({onRestart:e,actionLoading:t}){return(0,I.jsxs)(A,{children:[(0,I.jsx)(k,{title:`System Controls`}),(0,I.jsx)(E,{label:`Restart Server`,description:`Stops and restarts the API server. Config changes will take effect. Page will reload automatically after restart.`,onClick:e,disabled:t,variant:`contained`,color:`error`})]})}function z(){let[d,g]=(0,F.useState)([]),[_,v]=(0,F.useState)(null),[y,T]=(0,F.useState)(!1),[E,D]=(0,F.useState)(null),[O,M]=(0,F.useState)(``),[N,P]=(0,F.useState)(``),[L,R]=(0,F.useState)(!1),[z,B]=(0,F.useState)(null),[V,H]=(0,F.useState)(null),U=(0,F.useCallback)(async()=>{T(!0),D(null);try{v((await C()).stats)}catch(e){e instanceof x?D(`API Error (${e.status}): ${e.message}`):e instanceof Error?D(e.message):D(`Unknown error`)}finally{T(!1)}},[]);(0,F.useEffect)(()=>{U()},[U]),(0,F.useEffect)(()=>{(async()=>{try{let e=await h();g(e.backbones),e.backbones.length>0&&M(t=>t||e.backbones[0])}catch(e){console.error(`Failed to fetch backbones:`,e)}})()},[]);let W=(0,F.useCallback)(async()=>{R(!0),H(null),B(null);try{B((await p(O,N?parseInt(N,10):null)).message),U()}catch(e){e instanceof x?H(`API Error (${e.status}): ${e.message}`):e instanceof Error?H(e.message):H(`Unknown error`)}finally{R(!1)}},[O,N,U]);return(0,I.jsxs)(A,{children:[(0,I.jsx)(k,{title:`Vector Store`}),(0,I.jsxs)(e,{spacing:3,children:[(0,I.jsxs)(S,{children:[(0,I.jsxs)(S,{sx:{display:`flex`,alignItems:`center`,justifyContent:`space-between`,mb:1},children:[(0,I.jsx)(w,{variant:`subtitle2`,children:`Hot/Cold Stats`}),(0,I.jsx)(j,{size:`small`,onClick:()=>void U(),disabled:y,children:y?(0,I.jsx)(f,{size:16}):`Refresh`})]}),E&&(0,I.jsx)(m,{severity:`error`,sx:{mb:1},children:E}),_&&(0,I.jsx)(b,{variant:`outlined`,children:(0,I.jsxs)(o,{size:`small`,children:[(0,I.jsx)(c,{children:(0,I.jsxs)(u,{children:[(0,I.jsx)(l,{children:`Backbone`}),(0,I.jsx)(l,{align:`right`,children:`Hot`}),(0,I.jsx)(l,{align:`right`,children:`Cold`})]})}),(0,I.jsx)(s,{children:_.map(e=>(0,I.jsxs)(u,{children:[(0,I.jsx)(l,{children:e.backbone_id}),(0,I.jsx)(l,{align:`right`,children:e.hot_count}),(0,I.jsx)(l,{align:`right`,children:e.cold_count})]},e.backbone_id))})]})})]}),(0,I.jsxs)(S,{children:[(0,I.jsx)(w,{variant:`subtitle2`,gutterBottom:!0,children:`Promote Vectors`}),(0,I.jsxs)(e,{spacing:1.5,children:[(0,I.jsxs)(n,{fullWidth:!0,size:`small`,children:[(0,I.jsx)(t,{children:`Backbone`}),(0,I.jsx)(i,{value:O,label:`Backbone`,onChange:e=>M(e.target.value),children:d.map(e=>(0,I.jsx)(r,{value:e,children:e},e))})]}),(0,I.jsx)(a,{label:`HNSW nlists (optional)`,placeholder:`Auto-calculated if empty`,value:N,onChange:e=>P(e.target.value),size:`small`,fullWidth:!0,type:`number`,inputProps:{min:1},helperText:`Number of HNSW graph lists. Leave empty for auto.`}),(0,I.jsx)(j,{variant:`contained`,onClick:()=>void W(),disabled:L,children:L?(0,I.jsx)(f,{size:24}):`Promote & Rebuild`}),V&&(0,I.jsx)(m,{severity:`error`,children:V}),z&&(0,I.jsx)(m,{severity:`success`,children:z})]})]})]})]})}function B({onPause:t,onResume:n,actionLoading:r}){return(0,I.jsxs)(A,{children:[(0,I.jsx)(k,{title:`Worker Controls`}),(0,I.jsxs)(e,{spacing:1.25,children:[(0,I.jsx)(E,{label:`Pause Worker`,description:`Stops the worker from processing queue jobs. Jobs remain in the queue.`,onClick:t,disabled:r}),(0,I.jsx)(E,{label:`Resume Worker`,description:`Starts the worker to process queue jobs.`,onClick:n,disabled:r})]})]})}function V(){let{showSuccess:e,showError:t}=P(),{confirm:n,isOpen:r,options:i,handleConfirm:a,handleCancel:o}=M(),[s,c]=(0,F.useState)(!1);return{actionLoading:s,handlePauseWorker:async()=>{if(await n({title:`Pause Worker?`,message:`Pause the worker? Processing will stop.`,confirmLabel:`Pause`,severity:`warning`}))try{c(!0),e((await O()).message)}catch(e){t(e instanceof Error?e.message:`Failed to pause worker`)}finally{c(!1)}},handleResumeWorker:async()=>{if(await n({title:`Resume Worker?`,message:`Resume the worker? Processing will start.`,confirmLabel:`Resume`}))try{c(!0),e((await D()).message)}catch(e){t(e instanceof Error?e.message:`Failed to resume worker`)}finally{c(!1)}},handleRestart:async()=>{if(await n({title:`Restart Server?`,message:`Restart the API server? The page will reload in a few seconds.`,confirmLabel:`Restart`,severity:`error`}))try{c(!0),e((await d()).message),setTimeout(()=>{window.location.reload()},3e3)}catch(e){t(e instanceof Error?e.message:`Failed to restart server`),c(!1)}},dialogState:{isOpen:r,options:i,handleConfirm:a,handleCancel:o}}}export{L as a,R as i,B as n,z as r,V as t};