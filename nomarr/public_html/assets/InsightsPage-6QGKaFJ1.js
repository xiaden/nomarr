import{c as e,t}from"./Stack-CkUmHJEx.js";import{A as n,At as r,D as i,Dt as a,Ft as o,H as s,I as c,J as l,K as u,Mt as d,O as f,Q as p,S as m,St as h,T as g,V as _,X as v,Y as y,Z as b,a as x,bt as S,c as C,ct as w,d as T,et as E,f as D,h as O,i as k,j as ee,k as te,l as A,m as ne,mt as re,n as ie,nt as ae,o as oe,p as j,q as M,r as se,s as ce,t as le,tt as ue,u as de,w as N}from"./ChartsWrapper-BOv86Dbu.js";import{a as fe,i as pe,n as me,s as he,t as ge}from"./ExpandMore-CL1N8Z9X.js";import{n as _e,r as ve,t as ye}from"./AccordionSummary-CLlb4YLa.js";import"./Popper-prfTDglz.js";import{t as P}from"./Chip-JO0uinvj.js";import{t as be}from"./TextField-BcvKNzOW.js";import{a as xe,i as Se,n as Ce,r as F,t as we}from"./TableRow-FDqLkAiy.js";import{Cn as Te,Ct as Ee,Dt as De,G as Oe,In as ke,Pn as Ae,U as je,W as Me,Z as Ne,_n as I,bt as Pe,cn as L,d as Fe,ht as R,in as Ie,ln as Le,mt as Re,nt as ze,rt as Be,tn as z,u as Ve,vn as B,vt as V,wn as H,y as He,zt as U}from"./index-DT4CdTek.js";import{t as Ue}from"./Close-BA8FSoPC.js";import{a as We,c as Ge,i as Ke,n as qe,o as Je,r as Ye,s as W,t as Xe}from"./BarChart-78Xp3Yt5.js";import{n as Ze,r as Qe,t as $e}from"./PieChart-SWXLVunZ.js";function et(e){this._context=e}et.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function tt(e){return new et(e)}function nt(e){return e[0]}function rt(e){return e[1]}function it(e,t){var n=v(!0),r=null,i=tt,a=null,o=Qe(s);e=typeof e==`function`?e:e===void 0?nt:v(e),t=typeof t==`function`?t:t===void 0?rt:v(t);function s(s){var l,u=(s=c(s)).length,d,f=!1,p;for(r??(a=i(p=o())),l=0;l<=u;++l)!(l<u&&n(d=s[l],l,s))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+e(d,l,s),+t(d,l,s));if(p)return a=null,p+``||null}return s.x=function(t){return arguments.length?(e=typeof t==`function`?t:v(+t),s):e},s.y=function(e){return arguments.length?(t=typeof e==`function`?e:v(+e),s):t},s.defined=function(e){return arguments.length?(n=typeof e==`function`?e:v(!!e),s):n},s.curve=function(e){return arguments.length?(i=e,r!=null&&(a=i(r)),s):i},s.context=function(e){return arguments.length?(e==null?r=a=null:a=i(r=e),s):r},s}function at(e,t,n){var r=null,i=v(!0),a=null,o=tt,s=null,l=Qe(u);e=typeof e==`function`?e:e===void 0?nt:v(+e),t=typeof t==`function`?t:v(t===void 0?0:+t),n=typeof n==`function`?n:n===void 0?rt:v(+n);function u(u){var d,f,p,m=(u=c(u)).length,h,g=!1,_,v=Array(m),y=Array(m);for(a??(s=o(_=l())),d=0;d<=m;++d){if(!(d<m&&i(h=u[d],d,u))===g)if(g=!g)f=d,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),p=d-1;p>=f;--p)s.point(v[p],y[p]);s.lineEnd(),s.areaEnd()}g&&(v[d]=+e(h,d,u),y[d]=+t(h,d,u),s.point(r?+r(h,d,u):v[d],n?+n(h,d,u):y[d]))}if(_)return s=null,_+``||null}function d(){return it().defined(i).curve(o).context(a)}return u.x=function(t){return arguments.length?(e=typeof t==`function`?t:v(+t),r=null,u):e},u.x0=function(t){return arguments.length?(e=typeof t==`function`?t:v(+t),u):e},u.x1=function(e){return arguments.length?(r=e==null?null:typeof e==`function`?e:v(+e),u):r},u.y=function(e){return arguments.length?(t=typeof e==`function`?e:v(+e),n=null,u):t},u.y0=function(e){return arguments.length?(t=typeof e==`function`?e:v(+e),u):t},u.y1=function(e){return arguments.length?(n=e==null?null:typeof e==`function`?e:v(+e),u):n},u.lineX0=u.lineY0=function(){return d().x(e).y(t)},u.lineY1=function(){return d().x(e).y(n)},u.lineX1=function(){return d().x(r).y(t)},u.defined=function(e){return arguments.length?(i=typeof e==`function`?e:v(!!e),u):i},u.curve=function(e){return arguments.length?(o=e,a!=null&&(s=o(a)),u):o},u.context=function(e){return arguments.length?(e==null?a=s=null:s=o(a=e),u):a},u}var ot=class{constructor(e,t){this._context=e,this._x=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,t,e,t):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+t)/2,e,this._y0,e,t);break}this._x0=e,this._y0=t}};function st(e){return new ot(e,!0)}function ct(e){return new ot(e,!1)}var lt={draw(e,t){let n=l(t/u);e.moveTo(n,0),e.arc(0,0,n,0,y)}},ut={draw(e,t){let n=l(t/5)/2;e.moveTo(-3*n,-n),e.lineTo(-n,-n),e.lineTo(-n,-3*n),e.lineTo(n,-3*n),e.lineTo(n,-n),e.lineTo(3*n,-n),e.lineTo(3*n,n),e.lineTo(n,n),e.lineTo(n,3*n),e.lineTo(-n,3*n),e.lineTo(-n,n),e.lineTo(-3*n,n),e.closePath()}},dt=l(1/3),ft=dt*2,pt={draw(e,t){let n=l(t/ft),r=n*dt;e.moveTo(0,-n),e.lineTo(r,0),e.lineTo(0,n),e.lineTo(-r,0),e.closePath()}},mt={draw(e,t){let n=l(t),r=-n/2;e.rect(r,r,n,n)}},ht=.8908130915292852,gt=M(u/10)/M(7*u/10),_t=M(y/10)*gt,vt=-_(y/10)*gt,yt={draw(e,t){let n=l(t*ht),r=_t*n,i=vt*n;e.moveTo(0,-n),e.lineTo(r,i);for(let t=1;t<5;++t){let a=y*t/5,o=_(a),s=M(a);e.lineTo(s*n,-o*n),e.lineTo(o*r-s*i,s*r+o*i)}e.closePath()}},bt=l(3),xt={draw(e,t){let n=-l(t/(bt*3));e.moveTo(0,n*2),e.lineTo(-bt*n,-n),e.lineTo(bt*n,-n),e.closePath()}},G=-.5,K=l(3)/2,St=1/l(12),Ct=(St/2+1)*3;const wt=[lt,ut,pt,mt,yt,xt,{draw(e,t){let n=l(t/Ct),r=n/2,i=n*St,a=r,o=n*St+n,s=-a,c=o;e.moveTo(r,i),e.lineTo(a,o),e.lineTo(s,c),e.lineTo(G*r-K*i,K*r+G*i),e.lineTo(G*a-K*o,K*a+G*o),e.lineTo(G*s-K*c,K*s+G*c),e.lineTo(G*r+K*i,G*i-K*r),e.lineTo(G*a+K*o,G*o-K*a),e.lineTo(G*s+K*c,G*c-K*s),e.closePath()}}];function Tt(e,t){let n=null,r=Qe(i);e=typeof e==`function`?e:v(e||lt),t=typeof t==`function`?t:v(t===void 0?64:+t);function i(){let i;if(n||=i=r(),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),i)return n=null,i+``||null}return i.type=function(t){return arguments.length?(e=typeof t==`function`?t:v(t),i):e},i.size=function(e){return arguments.length?(t=typeof e==`function`?e:v(+e),i):t},i.context=function(e){return arguments.length?(n=e??null,i):n},i}function Et(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Dt(e,t){this._context=e,this._k=(1-t)/6}Dt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Et(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Et(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}},(function e(t){function n(e){return new Dt(e,t)}return n.tension=function(t){return e(+t)},n})(0);function Ot(e,t,n){var r=e._x1,i=e._y1,a=e._x2,o=e._y2;if(e._l01_a>1e-12){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,c=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/c,i=(i*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/c}if(e._l23_a>1e-12){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,u=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*l+e._x1*e._l23_2a-t*e._l12_2a)/u,o=(o*l+e._y1*e._l23_2a-n*e._l12_2a)/u}e._context.bezierCurveTo(r,i,a,o,e._x2,e._y2)}function kt(e,t){this._context=e,this._alpha=t}kt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=(n*n+r*r)**+this._alpha)}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Ot(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var At=(function e(t){function n(e){return t?new kt(e,t):new Dt(e,0)}return n.alpha=function(t){return e(+t)},n})(.5);function jt(e){return e<0?-1:1}function Mt(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),s=(a*i+o*r)/(r+i);return(jt(a)+jt(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function Nt(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Pt(e,t,n){var r=e._x0,i=e._y0,a=e._x1,o=e._y1,s=(a-r)/3;e._context.bezierCurveTo(r+s,i+s*t,a-s,o-s*n,a,o)}function q(e){this._context=e}q.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Pt(this,this._t0,Nt(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Pt(this,Nt(this,n=Mt(this,e,t)),n);break;default:Pt(this,this._t0,n=Mt(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function Ft(e){this._context=new It(e)}(Ft.prototype=Object.create(q.prototype)).point=function(e,t){q.prototype.point.call(this,t,e)};function It(e){this._context=e}It.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}};function Lt(e){return new q(e)}function Rt(e){return new Ft(e)}function zt(e){this._context=e}zt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var r=Bt(e),i=Bt(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[o],t[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function Bt(e){var t,n=e.length-1,r,i=Array(n),a=Array(n),o=Array(n);for(i[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<n-1;++t)i[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[n-1]=2,a[n-1]=7,o[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)r=i[t]/a[t-1],a[t]-=r,o[t]-=r*o[t-1];for(i[n-1]=o[n-1]/a[n-1],t=n-2;t>=0;--t)i[t]=(o[t]-i[t+1])/a[t];for(a[n-1]=(e[n]+i[n-1])/2,t=0;t<n-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function Vt(e){return new zt(e)}function J(e,t){this._context=e,this._t=t}J.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}this._x=e,this._y=t}};function Ht(e){return new J(e,.5)}function Ut(e){return new J(e,0)}function Wt(e){return new J(e,1)}function Y(){return m(`line`)}function Gt(e){return T({d:e.d},{createInterpolator:(e,t)=>{let n=h(e.d,t.d);return e=>({d:n(e)})},applyProps:(e,{d:t})=>e.setAttribute(`d`,t),transformProps:e=>e,skip:e.skipAnimation,ref:e.ref})}function Kt(e){return T({d:e.d},{createInterpolator:(e,t)=>{let n=h(e.d,t.d);return e=>({d:n(e)})},applyProps:(e,{d:t})=>e.setAttribute(`d`,t),skip:e.skipAnimation,transformProps:e=>e,ref:e.ref})}var X=ke(Ae(),1),Z=ke(Te(),1);function qt({value:e,onChange:t,options:n,placeholder:r=`Type or select...`,disabled:i=!1,...a}){let[o,s]=(0,X.useState)(!1),[c,l]=(0,X.useState)(n),u=(0,X.useRef)(null);(0,X.useEffect)(()=>{l(e?n.filter(t=>t.toLowerCase().includes(e.toLowerCase())):n)},[e,n]),(0,X.useEffect)(()=>{let e=e=>{u.current&&!u.current.contains(e.target)&&s(!1)};return document.addEventListener(`mousedown`,e),()=>document.removeEventListener(`mousedown`,e)},[]);let d=e=>{t(e.target.value),s(!0)},f=e=>{t(e),s(!1)};return(0,Z.jsxs)(R,{...a,ref:u,sx:{position:`relative`,...a.sx},children:[(0,Z.jsx)(be,{type:`text`,value:e,onChange:d,onFocus:()=>s(!0),placeholder:r,disabled:i,fullWidth:!0,size:`small`,sx:{"& .MuiOutlinedInput-root":{bgcolor:i?`background.paper`:`background.default`}}}),o&&!i&&c.length>0&&(0,Z.jsx)(R,{sx:{position:`absolute`,top:`100%`,left:0,right:0,maxHeight:`200px`,overflowY:`auto`,bgcolor:`background.default`,border:1,borderColor:`divider`,borderTop:`none`,borderRadius:`0 0 4px 4px`,boxShadow:2,zIndex:1e3},children:c.map((e,t)=>(0,Z.jsx)(R,{onClick:()=>f(e),sx:{p:1.5,cursor:`pointer`,fontSize:`0.875rem`,borderBottom:t<c.length-1?1:`none`,borderColor:`divider`,"&:hover":{bgcolor:`action.hover`}},children:e},t))})]})}function Jt({libraryId:e}){let[n,r]=(0,X.useState)([]),[i,a]=(0,X.useState)([]),[o,s]=(0,X.useState)(``),[c,l]=(0,X.useState)(``),[u,d]=(0,X.useState)([]),[f,p]=(0,X.useState)([]),[m,h]=(0,X.useState)(null),[g,_]=(0,X.useState)(!1),[v,y]=(0,X.useState)(null);(0,X.useEffect)(()=>{b()},[]),(0,X.useEffect)(()=>{o?x(o):(a([]),l(``))},[o]);let b=async()=>{try{r((await Ve(!0)).tag_keys)}catch(e){console.error(`[TagCoOccurrence] Failed to load tag keys:`,e)}},x=async e=>{try{let t=await Fe(e,!0),n=new Set;for(let e of t.tag_keys)if(e.startsWith(`[`)&&e.endsWith(`]`))try{let t=JSON.parse(e);Array.isArray(t)?t.forEach(e=>n.add(String(e))):n.add(e)}catch{n.add(e)}else n.add(e);a(Array.from(n).sort())}catch(e){console.error(`[TagCoOccurrence] Failed to load tag values:`,e),a([])}},S=(e,t)=>u.some(n=>n.key===e&&n.value===t)||f.some(n=>n.key===e&&n.value===t),C=()=>{o&&c&&!u.some(e=>e.key===o&&e.value===c)&&u.length<16&&d([...u,{key:o,value:c}])},w=()=>{o&&c&&!f.some(e=>e.key===o&&e.value===c)&&f.length<16&&p([...f,{key:o,value:c}])},T=e=>{d(u.filter((t,n)=>n!==e))},E=e=>{p(f.filter((t,n)=>n!==e))},D=async()=>{if(u.length===0||f.length===0){y(`Both X and Y axes must have at least one tag`);return}try{_(!0),y(null),h(await Oe({x:u,y:f},e))}catch(e){y(e instanceof Error?e.message:`Failed to build matrix`),console.error(`[TagCoOccurrence] Matrix build error:`,e)}finally{_(!1)}},O=(e,t)=>{if(e===0)return`#1a1a1a`;let n=Math.min(e/t,1);return`rgb(${Math.floor(30+n*44)}, ${Math.floor(30+n*128)}, ${Math.floor(30+n*225)})`},k=m?.matrix?Math.max(...m.matrix.flat(),1):1;return(0,Z.jsxs)(Be,{children:[(0,Z.jsx)(ze,{title:`Tag Co-Occurrence Matrix`}),(0,Z.jsxs)(t,{spacing:2,sx:{mb:2.5},children:[(0,Z.jsxs)(R,{sx:{display:`flex`,gap:1.5,alignItems:`flex-end`},children:[(0,Z.jsxs)(R,{sx:{flex:1},children:[(0,Z.jsx)(V,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:`Tag Key`}),(0,Z.jsx)(qt,{value:o,onChange:s,options:n,placeholder:`Select tag key...`})]}),(0,Z.jsxs)(R,{sx:{flex:1},children:[(0,Z.jsx)(V,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:`Tag Value`}),(0,Z.jsx)(qt,{value:c,onChange:l,options:i,placeholder:`Select tag value...`,disabled:!o})]}),(0,Z.jsx)(Re,{onClick:C,disabled:!o||!c||u.length>=16||S(o,c),variant:`contained`,size:`small`,children:`Add to X`}),(0,Z.jsx)(Re,{onClick:w,disabled:!o||!c||f.length>=16||S(o,c),variant:`contained`,color:`secondary`,size:`small`,children:`Add to Y`})]}),(0,Z.jsxs)(R,{children:[(0,Z.jsxs)(V,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:[`X Axis (`,u.length,`/16)`]}),(0,Z.jsxs)(R,{sx:{display:`flex`,flexWrap:`wrap`,gap:1,p:1.5,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minHeight:80},children:[u.length===0&&(0,Z.jsx)(V,{variant:`body2`,color:`text.secondary`,children:`No tags added to X axis yet`}),u.map((e,t)=>(0,Z.jsx)(P,{label:`${e.key}: ${e.value}`,onDelete:()=>T(t),deleteIcon:(0,Z.jsx)(Ue,{}),size:`small`},t))]})]}),(0,Z.jsxs)(R,{children:[(0,Z.jsxs)(V,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:[`Y Axis (`,f.length,`/16)`]}),(0,Z.jsxs)(R,{sx:{display:`flex`,flexWrap:`wrap`,gap:1,p:1.5,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minHeight:80},children:[f.length===0&&(0,Z.jsx)(V,{variant:`body2`,color:`text.secondary`,children:`No tags added to Y axis yet`}),f.map((e,t)=>(0,Z.jsx)(P,{label:`${e.key}: ${e.value}`,onDelete:()=>E(t),deleteIcon:(0,Z.jsx)(Ue,{}),size:`small`},t))]})]}),(0,Z.jsx)(Re,{onClick:D,disabled:g||u.length===0||f.length===0,variant:`contained`,fullWidth:!0,children:g?`Building Matrix...`:`Build Matrix`})]}),v&&(0,Z.jsx)(V,{color:`error`,sx:{mb:2},children:v}),m&&(0,Z.jsx)(R,{sx:{overflowX:`auto`,mt:2.5},children:(0,Z.jsxs)(xe,{size:`small`,sx:{minWidth:300},children:[(0,Z.jsx)(Ce,{children:(0,Z.jsxs)(we,{children:[(0,Z.jsx)(F,{sx:{bgcolor:`background.default`,borderBottom:2,borderColor:`divider`,fontWeight:600},children:`Y \\ X`}),m.x.map((e,t)=>(0,Z.jsxs)(F,{sx:{bgcolor:`background.default`,borderBottom:2,borderColor:`divider`,fontWeight:600},children:[e.key,`:`,(0,Z.jsx)(`br`,{}),e.value]},t))]})}),(0,Z.jsx)(Se,{children:m.y.map((e,t)=>(0,Z.jsxs)(we,{children:[(0,Z.jsxs)(F,{sx:{borderColor:`divider`,fontWeight:600},children:[e.key,`: `,e.value]}),m.x.map((e,n)=>(0,Z.jsx)(F,{align:`center`,sx:{borderColor:`divider`,bgcolor:O(m.matrix[t][n],k),fontWeight:m.matrix[t][n]>0?600:`normal`},children:m.matrix[t][n]},n))]},t))})]})})]})}var Yt=`nomarr:insights:accordion:`;function Xt({storageKey:e,title:t,defaultExpanded:n=!0,children:r,secondary:i}){let a=`${Yt}${e}`,[o,s]=(0,X.useState)(()=>{try{let e=localStorage.getItem(a);if(e!==null)return e===`true`}catch{}return n}),c=(0,X.useCallback)((e,t)=>{s(t);try{localStorage.setItem(a,String(t))}catch{}},[a]);return(0,X.useEffect)(()=>{let e=e=>{e.key===a&&e.newValue!==null&&s(e.newValue===`true`)};return window.addEventListener(`storage`,e),()=>window.removeEventListener(`storage`,e)},[a]),(0,Z.jsxs)(ve,{expanded:o,onChange:c,children:[(0,Z.jsxs)(ye,{expandIcon:(0,Z.jsx)(ge,{}),children:[(0,Z.jsx)(V,{variant:`h6`,sx:{flexGrow:1},children:t}),i]}),(0,Z.jsx)(_e,{children:r})]})}function Q({sectionId:e,title:t,defaultExpanded:n=!0,children:r,secondary:i}){return(0,Z.jsx)(De,{elevation:1,sx:{mb:2},children:(0,Z.jsx)(Xt,{storageKey:e,title:t,defaultExpanded:n,secondary:i,children:(0,Z.jsx)(R,{sx:{px:1},children:r})})})}function Zt({libraryId:e}){return(0,Z.jsx)(Q,{sectionId:`advanced`,title:`Advanced Analytics`,defaultExpanded:!1,children:(0,Z.jsx)(Jt,{libraryId:e})})}function $({subsectionId:e,parentId:t,title:n,defaultExpanded:r=!0,children:i,secondary:a}){return(0,Z.jsx)(R,{sx:{mb:1},children:(0,Z.jsx)(Xt,{storageKey:`${t}:${e}`,title:n,defaultExpanded:r,secondary:a,children:i})})}function Qt({distribution:e,parentId:t}){let{top_artists:n,others_count:r,total_artists:i}=e;if(n.length===0)return(0,Z.jsx)($,{subsectionId:`artists`,parentId:t,title:`Artists`,children:(0,Z.jsx)(V,{color:`text.secondary`,children:`No artist data available`})});let a=n.map(e=>e.artist),o=n.map(e=>e.count);return(0,Z.jsxs)($,{subsectionId:`artists`,parentId:t,title:`Artists`,secondary:(0,Z.jsxs)(V,{variant:`body2`,color:`text.secondary`,children:[i,` artists`]}),children:[(0,Z.jsx)(Xe,{height:300,xAxis:[{scaleType:`band`,data:a,tickLabelStyle:{angle:-45,textAnchor:`end`,fontSize:11}}],series:[{data:o}],margin:{left:50,right:20,top:20,bottom:80}}),r>0&&(0,Z.jsxs)(V,{variant:`body2`,color:`text.secondary`,sx:{fontStyle:`italic`,mt:1},children:[`+ `,r,` tracks from `,i-n.length,` `,`other artists`]})]})}var $t=[`#2196f3`,`#4caf50`,`#ff9800`,`#e91e63`,`#9c27b0`,`#00bcd4`,`#ff5722`,`#795548`,`#607d8b`,`#3f51b5`,`#8bc34a`,`#ffc107`,`#673ab7`,`#009688`,`#f44336`,`#03a9f4`,`#cddc39`,`#ffeb3b`,`#9e9e9e`,`#ff4081`];function en({distribution:e,parentId:n}){let[r,i]=(0,X.useState)(new Set),{pieData:a,visibleCount:o,totalCount:s}=(0,X.useMemo)(()=>{let t=e.filter(e=>!r.has(e.genre));return{pieData:t.map((e,t)=>({id:e.genre,value:e.count,label:e.genre,color:$t[t%$t.length]})),visibleCount:t.length,totalCount:e.length}},[e,r]),c=e=>{i(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})};return e.length===0?(0,Z.jsx)($,{subsectionId:`genres`,parentId:n,title:`Genres`,children:(0,Z.jsx)(V,{color:`text.secondary`,children:`No genre data available`})}):(0,Z.jsxs)($,{subsectionId:`genres`,parentId:n,title:`Genres`,secondary:(0,Z.jsxs)(V,{variant:`body2`,color:`text.secondary`,children:[o,` of `,s,` genres shown`]}),children:[a.length>0?(0,Z.jsx)(R,{sx:{height:350,mb:2},children:(0,Z.jsx)($e,{series:[{data:a,innerRadius:40,outerRadius:120,paddingAngle:1,cornerRadius:4,highlightScope:{highlight:`item`,fade:`global`}}],height:350,hideLegend:!0})}):(0,Z.jsx)(V,{color:`text.secondary`,sx:{mb:2},children:`All genres hidden. Click chips below to show.`}),(0,Z.jsx)(R,{sx:{mb:1},children:(0,Z.jsxs)(t,{direction:`row`,spacing:1,sx:{mb:1},children:[(0,Z.jsx)(P,{label:`Show All`,size:`small`,variant:`outlined`,onClick:()=>i(new Set),disabled:r.size===0}),(0,Z.jsx)(P,{label:`Hide All`,size:`small`,variant:`outlined`,onClick:()=>i(new Set(e.map(e=>e.genre))),disabled:r.size===e.length})]})}),(0,Z.jsx)(t,{direction:`row`,flexWrap:`wrap`,gap:.5,children:e.map((e,t)=>{let n=r.has(e.genre),i=$t[t%$t.length];return(0,Z.jsx)(P,{label:`${e.genre} (${e.count})`,size:`small`,onClick:()=>c(e.genre),sx:{bgcolor:n?`transparent`:i,color:n?`text.secondary`:`#fff`,border:n?1:0,borderColor:`divider`,textDecoration:n?`line-through`:`none`,opacity:n?.6:1,"&:hover":{bgcolor:n?`action.hover`:i,opacity:1}}},e.genre)})})]})}function tn(e){let t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4);return t>0?`${t}h ${n}m`:`${n}m`}function nn(e){return e>=0xe8d4a51000?`${(e/0xe8d4a51000).toFixed(1)} TB`:e>=1e9?`${(e/1e9).toFixed(1)} GB`:e>=1e6?`${(e/1e6).toFixed(1)} MB`:`${(e/1e3).toFixed(1)} KB`}function rn({label:e,value:t}){return(0,Z.jsxs)(R,{sx:{textAlign:`center`,py:1,flex:`1 1 25%`,minWidth:100},children:[(0,Z.jsx)(V,{variant:`h5`,color:`primary`,children:t}),(0,Z.jsx)(V,{variant:`body2`,color:`text.secondary`,children:e})]})}function an({stats:e,parentId:t}){return(0,Z.jsx)($,{subsectionId:`stats`,parentId:t,title:`Library Statistics`,children:(0,Z.jsxs)(R,{sx:{display:`flex`,flexWrap:`wrap`,gap:2},children:[(0,Z.jsx)(rn,{label:`Tracks`,value:e.file_count.toLocaleString()}),(0,Z.jsx)(rn,{label:`Total Duration`,value:tn(e.total_duration_ms)}),(0,Z.jsx)(rn,{label:`Total Size`,value:nn(e.total_file_size_bytes)}),(0,Z.jsx)(rn,{label:`Avg Track`,value:tn(e.avg_track_length_ms)})]})})}function on(e){return e.replace(` `,`_`)}const sn=I(`MuiAppearingMask`,[`animate`]);var cn=z(`rect`,{slot:`internal`,shouldForwardProp:void 0})({animationName:`animate-width`,animationTimingFunction:j,animationDuration:`0s`,[`&.${sn.animate}`]:{animationDuration:`300ms`},"@keyframes animate-width":{from:{width:0}}});function ln(e){let t=f(),n=on(`${i()}-${e.id}`);return(0,Z.jsxs)(X.Fragment,{children:[(0,Z.jsx)(`clipPath`,{id:n,children:(0,Z.jsx)(cn,{className:e.skipAnimation?``:sn.animate,x:0,y:0,width:t.left+t.width+t.right,height:t.top+t.height+t.bottom})}),(0,Z.jsx)(`g`,{clipPath:`url(#${n})`,children:e.children})]})}var un=[`skipAnimation`,`ownerState`];function dn(e){let{skipAnimation:t,ownerState:n}=e,r=U(e,un),i=Gt(e);return(0,Z.jsx)(ln,{skipAnimation:t,id:`${n.id}-area-clip`,children:(0,Z.jsx)(`path`,H({fill:n.gradientId?`url(#${n.gradientId})`:n.color,filter:n.isHighlighted?`brightness(140%)`:n.gradientId?void 0:`brightness(120%)`,opacity:n.isFaded?.3:1,stroke:`none`,"data-series":n.id,"data-highlighted":n.isHighlighted||void 0,"data-faded":n.isFaded||void 0},r,i))})}var fn=[`id`,`classes`,`color`,`gradientId`,`slots`,`slotProps`,`onClick`];function pn(e){return B(`MuiAreaElement`,e)}const mn=I(`MuiAreaElement`,[`root`,`highlighted`,`faded`,`series`]);var hn=e=>{let{classes:t,id:n,isFaded:r,isHighlighted:i}=e;return L({root:[`root`,`series-${n}`,i&&`highlighted`,r&&`faded`]},pn,t)};function gn(t){let{id:n,classes:r,color:i,gradientId:a,slots:o,slotProps:s,onClick:c}=t,l=U(t,fn),u=C({type:`line`,seriesId:n}),{isFaded:d,isHighlighted:f}=O({seriesId:n}),p={id:n,classes:r,color:i,gradientId:a,isFaded:d,isHighlighted:f},m=hn(p),h=o?.area??dn;return(0,Z.jsx)(h,H({},l,e({elementType:h,externalSlotProps:s?.area,additionalProps:H({},u,{onClick:c,cursor:c?`pointer`:`unset`}),className:m.root,ownerState:p})))}function _n(e){switch(e){case`catmullRom`:return At.alpha(.5);case`linear`:return tt;case`monotoneX`:return Lt;case`monotoneY`:return Rt;case`natural`:return Vt;case`step`:return Ht;case`stepBefore`:return Ut;case`stepAfter`:return Wt;case`bumpY`:return ct;case`bumpX`:return st;default:return Lt}}function vn(e,t){let n=Y(),r=N().xAxisIds[0],i=g().yAxisIds[0],a=ne();return X.useMemo(()=>{if(n===void 0)return[];let{series:o,stackingGroups:s}=n,c=[];for(let n of s){let s=n.ids;for(let n=s.length-1;n>=0;--n){let l=s[n],{xAxisId:u=r,yAxisId:d=i,visibleStackedData:f,stackedData:p,data:m,connectNulls:h,baseline:g,curve:_,strictStepCurve:v,area:y}=o[l];if(!y||!(u in e)||!(d in t))continue;let b=e[u].scale,x=W(b),C=t[d].scale,w=e[u].data,T=t[d].colorScale&&a(d)||e[u].colorScale&&a(u)||void 0,E=_?.includes(`step`)&&!v&&S(b),D=w?.flatMap((e,t)=>{let n=m[t]==null;if(E){let r=[{x:e,y:f[t],nullData:n,isExtension:!1}];return!n&&(t===0||m[t-1]==null)&&r.unshift({x:(b(e)??0)-(b.step()-b.bandwidth())/2,y:f[t],nullData:n,isExtension:!0}),!n&&(t===m.length-1||m[t+1]==null)&&r.push({x:(b(e)??0)+(b.step()+b.bandwidth())/2,y:f[t],nullData:n,isExtension:!0}),r}return{x:e,y:f[t],nullData:n}})??[],O=h?D.filter(e=>!e.nullData):D,k=at().x(e=>e.isExtension?e.x:x(e.x)).defined(e=>h||!e.nullData||!!e.isExtension).y0(e=>{if(typeof g==`number`)return C(g);if(g===`max`)return C.range()[1];if(g===`min`)return C.range()[0];let t=e.y&&C(e.y[0]);return Number.isNaN(t)?C.range()[0]:t}).y1(e=>e.y&&C(e.y[1])).curve(_n(_))(O)||``;c.push({area:o[l].area,color:o[l].color,gradientId:T,d:k,seriesId:l})}}return c},[n,r,i,e,t,a])}var yn=[`slots`,`slotProps`,`onItemClick`,`skipAnimation`],bn=z(`g`,{name:`MuiAreaPlot`,slot:`Root`})({[`& .${mn.root}`]:{transitionProperty:`opacity, fill`,transitionDuration:`300ms`,transitionTimingFunction:j}}),xn=()=>{let{xAxis:e}=N(),{yAxis:t}=g();return vn(e,t)};function Sn(e){let{slots:t,slotProps:n,onItemClick:r,skipAnimation:i}=e,a=U(e,yn),o=A(Je()||i);return(0,Z.jsx)(bn,H({},a,{children:xn().map(({d:e,seriesId:i,color:a,area:s,gradientId:c})=>!!s&&(0,Z.jsx)(gn,{id:i,d:e,color:a,gradientId:c,slots:t,slotProps:n,onClick:r&&(e=>r(e,{type:`line`,seriesId:i})),skipAnimation:o},i))}))}var Cn=[`skipAnimation`,`ownerState`],wn=X.forwardRef(function(e,t){let{skipAnimation:n,ownerState:r}=e,i=U(e,Cn),a=Kt({d:e.d,skipAnimation:n,ref:t}),o=r.isFaded?.3:1;return(0,Z.jsx)(ln,{skipAnimation:n,id:`${r.id}-line-clip`,children:(0,Z.jsx)(`path`,H({stroke:r.gradientId?`url(#${r.gradientId})`:r.color,strokeWidth:2,strokeLinejoin:`round`,fill:`none`,filter:r.isHighlighted?`brightness(120%)`:void 0,opacity:r.hidden?0:o,"data-series":r.id,"data-highlighted":r.isHighlighted||void 0,"data-faded":r.isFaded||void 0},i,a))})}),Tn=[`id`,`classes`,`color`,`gradientId`,`slots`,`slotProps`,`onClick`,`hidden`];function En(e){return B(`MuiLineElement`,e)}const Dn=I(`MuiLineElement`,[`root`,`highlighted`,`faded`,`series`]);var On=e=>{let{classes:t,id:n,isFaded:r,isHighlighted:i}=e;return L({root:[`root`,`series-${n}`,i&&`highlighted`,r&&`faded`]},En,t)};function kn(t){let{id:n,classes:r,color:i,gradientId:a,slots:o,slotProps:s,onClick:c,hidden:l}=t,u=U(t,Tn),d=C({type:`line`,seriesId:n}),{isFaded:f,isHighlighted:p}=O({seriesId:n}),m={id:n,classes:r,color:i,gradientId:a,isFaded:f,isHighlighted:p,hidden:l},h=On(m),g=o?.line??wn;return(0,Z.jsx)(g,H({},u,e({elementType:g,externalSlotProps:s?.line,additionalProps:H({},d,{onClick:c,cursor:c?`pointer`:`unset`}),className:h.root,ownerState:m})))}function An(e,t){let n=Y(),r=N().xAxisIds[0],i=g().yAxisIds[0],a=ne();return X.useMemo(()=>{if(n===void 0)return[];let{series:o,stackingGroups:s}=n,c=[];for(let n of s){let s=n.ids;for(let n of s){let{xAxisId:s=r,yAxisId:l=i,stackedData:u,visibleStackedData:d,data:f,connectNulls:p,curve:m,strictStepCurve:h}=o[n];if(!(s in e)||!(l in t))continue;let g=e[s].scale,_=W(g),v=t[l].scale,y=e[s].data,b=t[l].colorScale&&a(l)||e[s].colorScale&&a(s)||void 0,x=m?.includes(`step`)&&!h&&S(g),C=y?.flatMap((e,t)=>{let n=f[t]==null;if(x){let r=[{x:e,y:d[t],nullData:n,isExtension:!1}];return!n&&(t===0||f[t-1]==null)&&r.unshift({x:(g(e)??0)-(g.step()-g.bandwidth())/2,y:d[t],nullData:n,isExtension:!0}),!n&&(t===f.length-1||f[t+1]==null)&&r.push({x:(g(e)??0)+(g.step()+g.bandwidth())/2,y:d[t],nullData:n,isExtension:!0}),r}return{x:e,y:d[t],nullData:n}})??[],w=p?C.filter(e=>!e.nullData):C,T=o[n].hidden,E=it().x(e=>e.isExtension?e.x:_(e.x)).defined(e=>p||!e.nullData||!!e.isExtension).y(e=>v(T?v.domain()[0]:e.y[1])).curve(_n(m))(w)||``;c.push({color:o[n].color,gradientId:b,d:E,seriesId:n,hidden:o[n].hidden})}}return c},[n,r,i,e,t,a])}var jn=[`slots`,`slotProps`,`skipAnimation`,`onItemClick`],Mn=z(`g`,{name:`MuiAreaPlot`,slot:`Root`})({[`& .${Dn.root}`]:{transitionProperty:`opacity, fill`,transitionDuration:`300ms`,transitionTimingFunction:j}}),Nn=()=>{let{xAxis:e}=N(),{yAxis:t}=g();return An(e,t)};function Pn(e){let{slots:t,slotProps:n,skipAnimation:r,onItemClick:i}=e,a=U(e,jn),o=A(Je()||r);return(0,Z.jsx)(Mn,H({},a,{children:Nn().map(({d:e,seriesId:r,color:a,gradientId:s,hidden:c})=>(0,Z.jsx)(kn,{id:r,d:e,color:a,gradientId:s,hidden:c,skipAnimation:o,slots:t,slotProps:n,onClick:i&&(e=>i(e,{type:`line`,seriesId:r}))},r))}))}function Fn(e){return B(`MuiMarkElement`,e)}const In=I(`MuiMarkElement`,[`root`,`highlighted`,`faded`,`animate`,`series`]),Ln=e=>{let{classes:t,id:n,isFaded:r,isHighlighted:i,skipAnimation:a}=e;return L({root:[`root`,`series-${n}`,i&&`highlighted`,r&&`faded`,a?void 0:`animate`]},Fn,t)};var Rn=[`x`,`y`,`id`,`classes`,`color`,`dataIndex`,`onClick`,`skipAnimation`,`isFaded`,`isHighlighted`,`shape`,`hidden`],zn=z(`circle`,{slot:`internal`,shouldForwardProp:void 0})({[`&.${In.animate}`]:{transitionDuration:`300ms`,transitionProperty:`cx, cy, opacity`,transitionTimingFunction:j}});function Bn(e){let{x:t,y:n,id:r,classes:i,color:a,dataIndex:o,onClick:s,skipAnimation:c,isFaded:l=!1,isHighlighted:u=!1,hidden:d}=e,f=U(e,Rn),p=Ie(),m=C({type:`line`,seriesId:r,dataIndex:o}),h=Ln({id:r,classes:i,isHighlighted:u,isFaded:l,skipAnimation:c});return(0,Z.jsx)(zn,H({},f,{cx:t,cy:n,r:5,fill:(p.vars||p).palette.background.paper,stroke:a,strokeWidth:2,className:h.root,onClick:s,cursor:s?`pointer`:`unset`,pointerEvents:d?`none`:void 0},m,{"data-highlighted":u||void 0,"data-faded":l||void 0,opacity:d?0:1}))}function Vn(e){switch(e){case`circle`:return 0;case`cross`:return 1;case`diamond`:return 2;case`square`:return 3;case`star`:return 4;case`triangle`:return 5;case`wye`:return 6;default:return 0}}var Hn=[`x`,`y`,`id`,`classes`,`color`,`shape`,`dataIndex`,`onClick`,`skipAnimation`,`isFaded`,`isHighlighted`,`hidden`,`style`],Un=z(`path`,{name:`MuiMarkElement`,slot:`Root`})(({theme:e})=>({fill:(e.vars||e).palette.background.paper,[`&.${In.animate}`]:{transitionDuration:`300ms`,transitionProperty:`transform, transform-origin, opacity`,transitionTimingFunction:j}}));function Wn(e){let{x:t,y:n,id:r,classes:i,color:a,shape:o,dataIndex:s,onClick:c,skipAnimation:l,isFaded:u=!1,isHighlighted:d=!1,hidden:f,style:p}=e,m=U(e,Hn),h=C({type:`line`,seriesId:r,dataIndex:s}),g={id:r,classes:i,isHighlighted:d,isFaded:u,skipAnimation:l},_=Ln(g);return(0,Z.jsx)(Un,H({},m,{style:H({},p,{transform:`translate(${t}px, ${n}px)`,transformOrigin:`${t}px ${n}px`}),ownerState:g,className:_.root,d:Tt(wt[Vn(o)])(),onClick:c,cursor:c?`pointer`:`unset`,pointerEvents:f?`none`:void 0},h,{"data-highlighted":d||void 0,"data-faded":u||void 0,opacity:f?0:1,strokeWidth:2,stroke:a}))}function Gn(e,t){let r=Y(),a=N().xAxisIds[0],o=g().yAxisIds[0],s=i(),{instance:c}=n();return X.useMemo(()=>{if(r===void 0)return[];let{series:n,stackingGroups:i}=r,l=[];for(let r of i){let i=r.ids;for(let r of i){let{xAxisId:i=a,yAxisId:u=o,visibleStackedData:d,data:f,showMark:p=!0,shape:m=`circle`,hidden:h}=n[r];if(p===!1||!(i in e)||!(u in t))continue;let g=W(e[i].scale),_=t[u].scale,v=e[i].data,y=on(`${s}-${r}-line-clip`),b=ee(n[r],e[i],t[u]),x=[];if(v)for(let e=0;e<v.length;e+=1){let t=v[e],n=f[e]==null?null:d[e][1];if(n===null)continue;let r=_(h?_.domain()[0]:n),i=g(t);c.isPointInside(i,r)&&(p!==!0&&!p({x:i,y:r,index:e,position:t,value:n})||x.push({x:i,y:r,index:e,color:b(e)}))}l.push({seriesId:r,clipId:y,shape:m,xAxisId:i,marks:x,hidden:h})}}return l},[r,a,o,s,e,t,c])}var Kn=[`slots`,`slotProps`,`skipAnimation`,`onItemClick`];function qn(e){let{slots:t,slotProps:r,skipAnimation:i,onItemClick:a}=e,o=U(e,Kn),s=A(Je()||i),{xAxis:c}=N(),{yAxis:l}=g(),{store:u}=n(),{isFaded:d,isHighlighted:f}=Ze(),p=u.use(Ge),m=X.useMemo(()=>{let e={};for(let{dataIndex:t,axisId:n}of p)e[n]===void 0?e[n]=new Set([t]):e[n].add(t);return e},[p]);return(0,Z.jsx)(`g`,H({},o,{children:Gn(c,l).map(({seriesId:e,clipId:n,shape:i,xAxisId:o,marks:c,hidden:l})=>{let u=t?.mark??(i===`circle`?Bn:Wn),p=f({seriesId:e}),h=!p&&d({seriesId:e});return(0,Z.jsx)(`g`,{clipPath:`url(#${n})`,"data-series":e,children:c.map(({x:t,y:n,index:c,color:d})=>(0,Z.jsx)(u,H({id:e,dataIndex:c,shape:i,color:d,x:t,y:n,skipAnimation:s,onClick:a&&(t=>a(t,{type:`line`,seriesId:e,dataIndex:c})),isHighlighted:m[o]?.has(c)||p,isFaded:h,hidden:l},r?.mark),`${e}-${c}`))},e)})}))}var Jn=[`x`,`y`,`id`,`classes`,`color`,`shape`];function Yn(e){return B(`MuiHighlightElement`,e)}I(`MuiHighlightElement`,[`root`]);var Xn=e=>{let{classes:t,id:n}=e;return L({root:[`root`,`series-${n}`]},Yn,t)};function Zn(e){let{x:t,y:n,color:r,shape:i}=e,a=U(e,Jn),o=Xn(e),s=i===`circle`?`circle`:`path`,c=i===`circle`?{cx:0,cy:0,r:a.r===void 0?5:a.r}:{d:Tt(wt[Vn(i)])()},l=d>18?{transformOrigin:`${t} ${n}`}:{"transform-origin":`${t} ${n}`};return(0,Z.jsx)(s,H({pointerEvents:`none`,className:o.root,transform:`translate(${t} ${n})`,fill:r},l,c,a))}var Qn=[`slots`,`slotProps`];function $n(e){let{slots:t,slotProps:r}=e,i=U(e,Qn),a=Y(),{xAxis:o,xAxisIds:s}=N(),{yAxis:c,yAxisIds:l}=g(),{instance:u}=n(),d=te().use(Ge);if(d.length===0||a===void 0)return null;let{series:f,stackingGroups:p}=a,m=s[0],h=l[0],_=t?.lineHighlight??Zn;return(0,Z.jsx)(`g`,H({},i,{children:d.flatMap(({dataIndex:e,axisId:t})=>p.flatMap(({ids:n})=>n.flatMap(n=>{let{xAxisId:i=m,yAxisId:a=h,visibleStackedData:s,data:l,disableHighlight:d,shape:p=`circle`}=f[n];if(d||l[e]==null||t!==i)return null;let g=W(o[i].scale),v=c[a].scale,y=o[i].data;if(y===void 0)throw Error(`MUI X Charts: ${i===`DEFAULT_X_AXIS_KEY`?"The first `xAxis`":`The x-axis with id "${i}"`} should have data property to be able to display a line plot.`);let b=g(y[e]),x=v(s[e][1]);return u.isPointInside(b,x)?(0,Z.jsx)(_,H({id:n,color:ee(f[n],o[i],c[a])(e),x:b,y:x,shape:p},r?.lineHighlight),`${n}`):null})))}))}const er=[p,ae,ue,re,w,b,a,E];var tr=`xAxis.yAxis.series.width.height.margin.colors.dataset.sx.onAreaClick.onLineClick.onMarkClick.axisHighlight.disableLineItemHighlight.hideLegend.grid.children.slots.slotProps.skipAnimation.loading.highlightedItem.onHighlightChange.className.showToolbar.brushConfig`.split(`.`);const nr=e=>{let{xAxis:t,yAxis:n,series:r,width:i,height:a,margin:o,colors:s,dataset:c,sx:l,onAreaClick:u,onLineClick:d,onMarkClick:f,axisHighlight:p,disableLineItemHighlight:m,grid:h,children:g,slots:_,slotProps:v,skipAnimation:y,loading:b,highlightedItem:x,onHighlightChange:S,className:C,brushConfig:w}=e,T=U(e,tr),E=`${Le()}-clip-path`,D=H({},T,{series:X.useMemo(()=>r.map(e=>H({disableHighlight:!!m,type:`line`},e)),[m,r]),width:i,height:a,margin:o,colors:s,dataset:c,xAxis:t??[{id:`DEFAULT_X_AXIS_KEY`,scaleType:`point`,data:Array.from({length:Math.max(...r.map(e=>(e.data??c??[]).length))},(e,t)=>t)}],yAxis:n,highlightedItem:x,onHighlightChange:S,disableAxisListener:v?.tooltip?.trigger!==`axis`&&p?.x===`none`&&p?.y===`none`,className:C,skipAnimation:y,brushConfig:w,plugins:er}),O={vertical:h?.vertical,horizontal:h?.horizontal},k={clipPath:`url(#${E})`},ee={id:E},te={slots:_,slotProps:v,onItemClick:u},A={slots:_,slotProps:v,onItemClick:d},ne={slots:_,slotProps:v,onItemClick:f,skipAnimation:y},re={slots:_,slotProps:v,loading:b},ie={slots:_,slotProps:v},ae=H({x:`line`},p),oe={slots:_,slotProps:v},j={slots:_,slotProps:v};return{chartsWrapperProps:{sx:l,legendPosition:e.slotProps?.legend?.position,legendDirection:e.slotProps?.legend?.direction,hideLegend:e.hideLegend??!1},chartContainerProps:D,gridProps:O,clipPathProps:ee,clipPathGroupProps:k,areaPlotProps:te,linePlotProps:A,markPlotProps:ne,overlayProps:re,chartsAxisProps:ie,axisHighlightProps:ae,lineHighlightPlotProps:oe,legendProps:j,children:g}};var rr=6;function ir(){let e=Ie(),t=de(),n=Y(),{xAxis:r,xAxisIds:i}=N(),{yAxis:a,yAxisIds:o}=g();if(t===null||t.type!==`line`||!n)return null;let s=n.series[t.seriesId];if(s.data[t.dataIndex]==null)return null;let c=s.xAxisId??i[0],l=s.yAxisId??o[0];return(0,Z.jsx)(`rect`,{fill:`none`,stroke:(e.vars??e).palette.text.primary,strokeWidth:2,x:r[c].scale(r[c].data[t.dataIndex])-rr,y:a[l].scale(s.visibleStackedData[t.dataIndex][1])-rr,width:2*rr,height:2*rr,rx:3,ry:3})}var ar=X.forwardRef(function(e,t){let n=o({props:e,name:`MuiLineChart`}),{chartsWrapperProps:r,chartContainerProps:i,gridProps:a,clipPathProps:s,clipPathGroupProps:c,areaPlotProps:l,linePlotProps:u,markPlotProps:d,overlayProps:f,chartsAxisProps:p,axisHighlightProps:m,lineHighlightPlotProps:h,legendProps:g,children:_}=nr(n),{chartDataProviderProps:v,chartsSurfaceProps:y}=ie(i,t),b=n.slots?.tooltip??ce,S=n.slots?.toolbar;return(0,Z.jsx)(k,H({},v,{children:(0,Z.jsxs)(le,H({},r,{children:[n.showToolbar&&S?(0,Z.jsx)(S,H({},n.slotProps?.toolbar)):null,!n.hideLegend&&(0,Z.jsx)(oe,H({},g)),(0,Z.jsxs)(se,H({},y,{children:[(0,Z.jsx)(qe,H({},a)),(0,Z.jsxs)(`g`,H({},c,{children:[(0,Z.jsx)(Sn,H({},l)),(0,Z.jsx)(Pn,H({},u)),(0,Z.jsx)(x,H({},f)),(0,Z.jsx)(Ke,H({},m))]})),(0,Z.jsx)(ir,{}),(0,Z.jsx)(We,H({},p)),(0,Z.jsx)(`g`,{"data-drawing-container":!0,children:(0,Z.jsx)(qn,H({},d))}),(0,Z.jsx)($n,H({},h)),(0,Z.jsx)(Ye,H({},s)),_]})),!n.loading&&(0,Z.jsx)(b,H({},n.slotProps?.tooltip))]}))}))});function or({distribution:e,parentId:t}){let n=e.filter(e=>String(e.year)!==`1`).sort((e,t)=>Number(e.year)-Number(t.year));if(n.length===0)return(0,Z.jsx)($,{subsectionId:`years`,parentId:t,title:`Years`,children:(0,Z.jsx)(V,{color:`text.secondary`,children:`No year data available`})});let r=n.map(e=>String(e.year)),i=n.map(e=>e.count);return(0,Z.jsx)($,{subsectionId:`years`,parentId:t,title:`Years`,secondary:(0,Z.jsxs)(V,{variant:`body2`,color:`text.secondary`,children:[n.length,` years`]}),children:(0,Z.jsx)(ar,{height:250,xAxis:[{scaleType:`point`,data:r}],series:[{data:i,curve:`catmullRom`,showMark:!1}],margin:{left:50,right:20,top:20,bottom:30}})})}function sr({libraryId:e}){let[t,n]=(0,X.useState)(null),[r,i]=(0,X.useState)(!0),[a,o]=(0,X.useState)(null);return(0,X.useEffect)(()=>{(async()=>{try{i(!0),o(null),n(await je(e))}catch(e){o(e instanceof Error?e.message:`Failed to load collection overview`),console.error(`[CollectionOverview] Load error:`,e)}finally{i(!1)}})()},[e]),r?(0,Z.jsx)(Q,{sectionId:`collection-overview`,title:`Collection Overview`,children:(0,Z.jsx)(Ee,{size:24})}):a||!t?(0,Z.jsx)(Q,{sectionId:`collection-overview`,title:`Collection Overview`,children:(0,Z.jsx)(Pe,{severity:`error`,children:a||`Failed to load collection overview`})}):(0,Z.jsxs)(Q,{sectionId:`collection-overview`,title:`Collection Overview`,secondary:(0,Z.jsxs)(V,{variant:`body2`,color:`text.secondary`,children:[t.stats.file_count.toLocaleString(),` tracks`]}),children:[(0,Z.jsx)(an,{stats:t.stats,parentId:`collection-overview`}),(0,Z.jsx)(or,{distribution:t.year_distribution,parentId:`collection-overview`}),(0,Z.jsx)(en,{distribution:t.genre_distribution,parentId:`collection-overview`}),(0,Z.jsx)(Qt,{distribution:t.artist_distribution,parentId:`collection-overview`})]})}function cr({value:e,onChange:t}){let[n,r]=(0,X.useState)([]),[i,a]=(0,X.useState)(!0);return(0,X.useEffect)(()=>{(async()=>{try{r(await He(!0))}catch(e){console.error(`[LibraryFilter] Failed to load libraries:`,e)}finally{a(!1)}})()},[]),(0,Z.jsxs)(he,{size:`small`,sx:{minWidth:200},children:[(0,Z.jsx)(fe,{id:`library-filter-label`,children:`Library`}),(0,Z.jsxs)(me,{labelId:`library-filter-label`,id:`library-filter`,value:e??``,label:`Library`,onChange:e=>{let n=e.target.value;t(n===``?void 0:n)},disabled:i,children:[(0,Z.jsx)(pe,{value:``,children:`All Libraries`}),n.map(e=>(0,Z.jsx)(pe,{value:e.library_id,children:e.name},e.library_id))]})]})}function lr({vibes:e,parentId:t}){return e.length===0?(0,Z.jsx)($,{subsectionId:`vibes`,parentId:t,title:`Dominant Vibes`,children:(0,Z.jsx)(V,{color:`text.secondary`,children:`No mood data available`})}):(0,Z.jsx)($,{subsectionId:`vibes`,parentId:t,title:`Dominant Vibes`,children:(0,Z.jsx)(R,{sx:{display:`flex`,flexWrap:`wrap`,gap:2},children:e.map((e,t)=>(0,Z.jsxs)(R,{sx:{textAlign:`center`,flex:`1 1 100px`,p:1,borderRadius:1,bgcolor:t===0?`primary.main`:`action.hover`,color:t===0?`primary.contrastText`:`text.primary`},children:[(0,Z.jsxs)(V,{variant:`h6`,children:[e.percentage.toFixed(0),`%`]}),(0,Z.jsx)(V,{variant:`body2`,sx:{textTransform:`capitalize`},children:e.mood})]},e.mood))})})}function ur({pairs:e,parentId:t,tierSelector:n}){return e.length===0?(0,Z.jsx)($,{subsectionId:`combos`,parentId:t,title:`Mood Combos`,secondary:(0,Z.jsx)(R,{sx:{display:`flex`,alignItems:`center`,gap:1},children:n}),children:(0,Z.jsx)(V,{color:`text.secondary`,children:`No mood combinations found`})}):(0,Z.jsx)($,{subsectionId:`combos`,parentId:t,title:`Mood Combos`,defaultExpanded:!1,secondary:(0,Z.jsxs)(R,{sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,Z.jsx)(V,{variant:`body2`,color:`text.secondary`,children:`Top pairs`}),n]}),children:(0,Z.jsx)(R,{sx:{display:`flex`,flexWrap:`wrap`,gap:1},children:e.map((e,t)=>(0,Z.jsx)(P,{label:(0,Z.jsxs)(R,{sx:{display:`flex`,alignItems:`center`,gap:.5},children:[(0,Z.jsx)(V,{variant:`body2`,component:`span`,sx:{textTransform:`capitalize`},children:e.mood1}),(0,Z.jsx)(V,{variant:`body2`,component:`span`,color:`text.secondary`,children:`+`}),(0,Z.jsx)(V,{variant:`body2`,component:`span`,sx:{textTransform:`capitalize`},children:e.mood2}),(0,Z.jsxs)(V,{variant:`body2`,component:`span`,color:`text.secondary`,sx:{ml:.5},children:[`(`,e.count,`)`]})]}),variant:t<3?`filled`:`outlined`,color:t<3?`primary`:`default`,size:`small`},`${e.mood1}-${e.mood2}`))})})}var dr={strict:`Strict`,regular:`Regular`,loose:`Loose`},fr=[`strict`,`regular`,`loose`];function pr({coverage:e,balance:t,parentId:n}){let r=fr.filter(n=>n in e.tiers||n in t);return(0,Z.jsx)($,{subsectionId:`coverage`,parentId:n,title:`Mood Coverage`,secondary:(0,Z.jsxs)(V,{variant:`body2`,color:`text.secondary`,children:[e.total_files.toLocaleString(),` tracks`]}),children:(0,Z.jsx)(R,{sx:{display:`flex`,gap:2,flexWrap:`wrap`,justifyContent:`center`},children:r.map(n=>{let r=e.tiers[n],i=(t[n]||[]).map((e,t)=>({id:t,value:e.count,label:e.mood}));return(0,Z.jsxs)(R,{sx:{textAlign:`center`,minWidth:200},children:[(0,Z.jsx)(V,{variant:`subtitle2`,children:dr[n]||n}),r&&(0,Z.jsxs)(V,{variant:`caption`,color:`text.secondary`,children:[r.tagged.toLocaleString(),` tagged (`,r.percentage.toFixed(1),`%)`]}),i.length>0?(0,Z.jsx)($e,{series:[{data:i,innerRadius:25,outerRadius:80,paddingAngle:1,cornerRadius:3}],height:200,width:250,hideLegend:!0}):(0,Z.jsx)(V,{variant:`body2`,color:`text.secondary`,sx:{mt:2},children:`No data`})]},n)})})})}var mr=[{value:`strict`,label:`Strict`},{value:`regular`,label:`Regular`},{value:`loose`,label:`Loose`}];function hr({libraryId:e}){let[t,n]=(0,X.useState)(null),[r,i]=(0,X.useState)(!0),[a,o]=(0,X.useState)(null),[s,c]=(0,X.useState)(`strict`);return(0,X.useEffect)(()=>{(async()=>{try{i(!0),o(null),n(await Me(e,s))}catch(e){o(e instanceof Error?e.message:`Failed to load mood analysis`),console.error(`[MoodAnalysis] Load error:`,e)}finally{i(!1)}})()},[e,s]),r?(0,Z.jsx)(Q,{sectionId:`mood-analysis`,title:`Mood Analysis`,children:(0,Z.jsx)(Ee,{size:24})}):a||!t?(0,Z.jsx)(Q,{sectionId:`mood-analysis`,title:`Mood Analysis`,children:(0,Z.jsx)(Pe,{severity:`error`,children:a||`Failed to load mood analysis`})}):(0,Z.jsxs)(Q,{sectionId:`mood-analysis`,title:`Mood Analysis`,secondary:(0,Z.jsxs)(V,{variant:`body2`,color:`text.secondary`,children:[(t.coverage.tiers.strict?.percentage??0).toFixed(0),`% strict coverage`]}),children:[(0,Z.jsx)(pr,{coverage:t.coverage,balance:t.balance,parentId:`mood-analysis`}),(0,Z.jsx)(lr,{vibes:t.dominant_vibes,parentId:`mood-analysis`}),(0,Z.jsx)(ur,{pairs:t.top_pairs,parentId:`mood-analysis`,tierSelector:(0,Z.jsxs)(he,{size:`small`,sx:{minWidth:120},onClick:e=>e.stopPropagation(),children:[(0,Z.jsx)(fe,{id:`mood-tier-label`,children:`Tier`}),(0,Z.jsx)(me,{labelId:`mood-tier-label`,id:`mood-tier-select`,value:s,label:`Tier`,onChange:e=>{c(e.target.value)},children:mr.map(e=>(0,Z.jsx)(pe,{value:e.value,children:e.label},e.value))})]})})]})}function gr(){let[e,n]=(0,X.useState)(void 0);return(0,Z.jsxs)(t,{spacing:0,sx:{mt:2},children:[(0,Z.jsx)(R,{sx:{mb:2},children:(0,Z.jsx)(cr,{value:e,onChange:n})}),(0,Z.jsx)(sr,{libraryId:e}),(0,Z.jsx)(hr,{libraryId:e}),(0,Z.jsx)(Zt,{libraryId:e})]})}function _r(){return(0,Z.jsx)(Ne,{title:`Insights`,children:(0,Z.jsx)(gr,{})})}export{_r as InsightsPage};