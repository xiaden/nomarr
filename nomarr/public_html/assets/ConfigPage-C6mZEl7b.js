import{t as e}from"./Stack-3GazAHpv.js";import{n as t,t as n}from"./TextField-69jg-W4Q.js";import"./useSlotProps-Bj3y4dRD.js";import{t as r}from"./MenuItem-CpDopmxk.js";import{St as i,b as a,ft as o,m as s,n as c,p as l,w as u,x as d,xt as f}from"./index-Cc_P-jdR.js";import{t as p}from"./useNotification-CpEcaj7V.js";var m=i(o(),1);function h({configKey:e,value:i,onChange:a,disabled:o}){let s=i==null?``:String(i);return(0,m.jsxs)(d,{sx:{display:`grid`,gap:1},children:[(0,m.jsx)(u,{variant:`body2`,color:`text.secondary`,sx:{fontWeight:`bold`},children:e}),(0,m.jsx)(d,{sx:{display:`flex`,gap:1.25,alignItems:`center`},children:typeof i==`boolean`?(0,m.jsxs)(t,{value:s,onChange:t=>a(e,t.target.value),disabled:o,size:`small`,fullWidth:!0,children:[(0,m.jsx)(r,{value:`true`,children:`true`}),(0,m.jsx)(r,{value:`false`,children:`false`})]}):(0,m.jsx)(n,{type:`text`,value:s,onChange:t=>a(e,t.target.value),disabled:o,size:`small`,fullWidth:!0})})]})}function g({config:t,hasChanges:n,saveLoading:r,onChange:i,onSaveAll:o}){return(0,m.jsxs)(s,{children:[(0,m.jsx)(l,{title:`Settings`}),(0,m.jsx)(u,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Changes are saved to the database and will take effect on server restart. Use "Restart Server" in Admin page to apply changes.`}),(0,m.jsx)(e,{spacing:1.875,children:Object.entries(t).map(([e,t])=>(0,m.jsx)(h,{configKey:e,value:t,onChange:i,disabled:r},e))}),(0,m.jsxs)(d,{sx:{mt:3.75,display:`flex`,gap:1.25,alignItems:`center`},children:[(0,m.jsx)(a,{onClick:o,variant:`contained`,disabled:!n||r,sx:{whiteSpace:`nowrap`},children:r?`Saving...`:`Save All Changes`}),n&&(0,m.jsx)(u,{variant:`body2`,color:`warning.main`,children:`Unsaved changes`})]})]})}var _=i(f(),1);function v(){let{showSuccess:e,showError:t,showInfo:n}=p(),[r,i]=(0,_.useState)({}),[a,o]=(0,_.useState)({}),[s,l]=(0,_.useState)(!0),[u,d]=(0,_.useState)(null),[f,m]=(0,_.useState)(!1),[h,g]=(0,_.useState)(!1),v=async()=>{try{l(!0),d(null);let e=await c.config.get();i(e),o(e),g(!1)}catch(e){d(e instanceof Error?e.message:`Failed to load config`),console.error(`[Config] Load error:`,e)}finally{l(!1)}};return(0,_.useEffect)(()=>{v()},[]),(0,_.useEffect)(()=>{g(Object.keys(r).some(e=>r[e]!==a[e]))},[r,a]),{config:r,loading:s,error:u,saveLoading:f,hasChanges:h,handleSaveAll:async()=>{try{m(!0);let t=[];for(let e of Object.keys(r))if(r[e]!==a[e]){let n=r[e];if(n==null||n===``)continue;await c.config.update(e,String(n)),t.push(e)}if(t.length===0){n(`No changes to save`);return}e(`Saved ${t.length} config change(s). Use "Restart Server" in Admin page to apply.`),await v()}catch(e){t(e instanceof Error?e.message:`Failed to save config`)}finally{m(!1)}},handleChange:(e,t)=>{i(n=>({...n,[e]:t}))}}}function y(){let{config:e,loading:t,error:n,saveLoading:r,hasChanges:i,handleSaveAll:a,handleChange:o}=v();return(0,m.jsxs)(`div`,{style:{padding:`20px`},children:[(0,m.jsx)(`h1`,{style:{marginBottom:`20px`},children:`Configuration`}),t&&(0,m.jsx)(`p`,{children:`Loading configuration...`}),n&&(0,m.jsxs)(`p`,{style:{color:`var(--accent-red)`},children:[`Error: `,n]}),!t&&!n&&(0,m.jsx)(`div`,{style:{display:`grid`,gap:`20px`},children:(0,m.jsx)(g,{config:e,hasChanges:i,saveLoading:r,onChange:o,onSaveAll:a})})]})}export{y as ConfigPage};