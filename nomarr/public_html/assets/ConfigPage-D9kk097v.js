import{t as e}from"./Stack-ClVIuG4B.js";import"./List-C6hBqZwZ.js";import{a as t,c as n,i as r,n as i,o as a,r as o,s,t as c}from"./TextField-CUecFaSB.js";import{t as l}from"./Popper-W_WsQ9TP.js";import{n as u,t as d}from"./MenuItem-BU7fxczh.js";import"./listItemTextClasses-Dl-EhdJ0.js";import{Bt as f,Cn as p,Ct as m,D as ee,G as h,Gt as g,H as _,Ht as v,It as y,Lt as b,Nt as x,Q as S,Rt as C,Ut as w,W as te,Yt as T,Z as E,Zt as D,_ as O,_t as k,a as A,an as j,at as M,b as N,ct as P,et as ne,f as re,ft as ie,h as F,ht as I,in as L,it as R,jt as ae,kt as oe,mt as z,o as se,on as B,p as ce,pt as le,st as ue,un as V,ut as de,v as fe,wt as pe,x as me,xn as he,y as ge}from"./index-DF7hOdML.js";import{t as _e}from"./useConfirmDialog-BuS7lC4s.js";import{t as ve}from"./ServerFilePicker-ByTkXHbs.js";import{t as H}from"./useNotification-xDGVdim3.js";function ye(e){return j(`PrivateSwitchBase`,e)}L(`PrivateSwitchBase`,[`root`,`checked`,`disabled`,`input`,`edgeStart`,`edgeEnd`]);var U=p(he()),W=p(V()),G=e=>{let{classes:t,checked:n,disabled:r,edge:i}=e;return T({root:[`root`,n&&`checked`,r&&`disabled`,i&&`edge${C(i)}`],input:[`input`]},ye,t)},be=v(z,{name:`MuiSwitchBase`})({padding:9,borderRadius:`50%`,variants:[{props:{edge:`start`,size:`small`},style:{marginLeft:-3}},{props:({edge:e,ownerState:t})=>e===`start`&&t.size!==`small`,style:{marginLeft:-12}},{props:{edge:`end`,size:`small`},style:{marginRight:-3}},{props:({edge:e,ownerState:t})=>e===`end`&&t.size!==`small`,style:{marginRight:-12}}]}),K=v(`input`,{name:`MuiSwitchBase`,shouldForwardProp:w})({cursor:`inherit`,position:`absolute`,opacity:0,width:`100%`,height:`100%`,top:0,left:0,margin:0,padding:0,zIndex:1}),q=U.forwardRef(function(e,r){let{autoFocus:i,checked:a,checkedIcon:o,defaultChecked:s,disabled:c,disableFocusRipple:l=!1,edge:u=!1,icon:d,id:f,inputProps:p,inputRef:m,name:ee,onBlur:h,onChange:g,onFocus:_,readOnly:v,required:y=!1,tabIndex:b,type:x,value:S,slots:C={},slotProps:w={},...te}=e,[T,E]=n({controlled:a,default:!!s,name:`SwitchBase`,state:`checked`}),D=t(),O=e=>{_&&_(e),D&&D.onFocus&&D.onFocus(e)},A=e=>{h&&h(e),D&&D.onBlur&&D.onBlur(e)},j=e=>{if(e.nativeEvent.defaultPrevented)return;let t=e.target.checked;E(t),g&&g(e,t)},M=c;D&&M===void 0&&(M=D.disabled);let N=x===`checkbox`||x===`radio`,P={...e,checked:T,disabled:M,disableFocusRipple:l,edge:u},ne=G(P),re={slots:C,slotProps:{input:p,...w}},[ie,F]=k(`root`,{ref:r,elementType:be,className:ne.root,shouldForwardComponentProp:!0,externalForwardedProps:{...re,component:`span`,...te},getSlotProps:e=>({...e,onFocus:t=>{e.onFocus?.(t),O(t)},onBlur:t=>{e.onBlur?.(t),A(t)}}),ownerState:P,additionalProps:{centerRipple:!0,focusRipple:!l,disabled:M,role:void 0,tabIndex:null}}),[I,L]=k(`input`,{ref:m,elementType:K,className:ne.input,externalForwardedProps:re,getSlotProps:e=>({...e,onChange:t=>{e.onChange?.(t),j(t)}}),ownerState:P,additionalProps:{autoFocus:i,checked:a,defaultChecked:s,disabled:M,id:N?f:void 0,name:ee,readOnly:v,required:y,tabIndex:b,type:x,...x===`checkbox`&&S===void 0?{}:{value:S}}});return(0,W.jsxs)(ie,{...F,children:[(0,W.jsx)(I,{...L}),T?o:d]})}),xe=y((0,W.jsx)(`path`,{d:`M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z`}),`CheckBoxOutlineBlank`),J=y((0,W.jsx)(`path`,{d:`M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z`}),`CheckBox`),Se=y((0,W.jsx)(`path`,{d:`M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z`}),`IndeterminateCheckBox`);function Ce(e){return j(`MuiCheckbox`,e)}var we=L(`MuiCheckbox`,[`root`,`checked`,`disabled`,`indeterminate`,`colorPrimary`,`colorSecondary`,`sizeSmall`,`sizeMedium`]),Te=e=>{let{classes:t,indeterminate:n,color:r,size:i}=e,a=T({root:[`root`,n&&`indeterminate`,`color${C(r)}`,`size${C(i)}`]},Ce,t);return{...t,...a}},Ee=v(q,{shouldForwardProp:e=>w(e)||e===`classes`,name:`MuiCheckbox`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${C(n.size)}`],n.color!==`default`&&t[`color${C(n.color)}`]]}})(b(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:`default`,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(le()).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(le()).map(([t])=>({props:{color:t},style:{[`&.${we.checked}, &.${we.indeterminate}`]:{color:(e.vars||e).palette[t].main},[`&.${we.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:`transparent`}}}}]}))),De=(0,W.jsx)(J,{}),Oe=(0,W.jsx)(xe,{}),ke=(0,W.jsx)(Se,{}),Ae=U.forwardRef(function(e,t){let n=f({props:e,name:`MuiCheckbox`}),{checkedIcon:r=De,color:i=`primary`,icon:a=Oe,indeterminate:o=!1,indeterminateIcon:c=ke,inputProps:l,size:u=`medium`,disableRipple:d=!1,className:p,slots:m={},slotProps:ee={},...h}=n,g=o?c:a,_=o?c:r,v={...n,disableRipple:d,color:i,indeterminate:o,size:u},y=Te(v),b=ee.input??l,[x,S]=k(`root`,{ref:t,elementType:Ee,className:B(y.root,p),shouldForwardComponentProp:!0,externalForwardedProps:{slots:m,slotProps:ee,...h},ownerState:v,additionalProps:{type:`checkbox`,icon:U.cloneElement(g,{fontSize:g.props.fontSize??u}),checkedIcon:U.cloneElement(_,{fontSize:_.props.fontSize??u}),disableRipple:d,slots:m,slotProps:{input:s(typeof b==`function`?b(v):b,{"data-indeterminate":o})}}});return(0,W.jsx)(x,{...S,classes:y})});function je(e){return j(`MuiFormControlLabel`,e)}var Y=L(`MuiFormControlLabel`,[`root`,`labelPlacementStart`,`labelPlacementTop`,`labelPlacementBottom`,`disabled`,`label`,`error`,`required`,`asterisk`]),X=e=>{let{classes:t,disabled:n,labelPlacement:r,error:i,required:a}=e;return T({root:[`root`,n&&`disabled`,`labelPlacement${C(r)}`,i&&`error`,a&&`required`],label:[`label`,n&&`disabled`],asterisk:[`asterisk`,i&&`error`]},je,t)};const Z=v(`label`,{name:`MuiFormControlLabel`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${Y.label}`]:t.label},t.root,t[`labelPlacement${C(n.labelPlacement)}`]]}})(b(({theme:e})=>({display:`inline-flex`,alignItems:`center`,cursor:`pointer`,verticalAlign:`middle`,WebkitTapHighlightColor:`transparent`,marginLeft:-11,marginRight:16,[`&.${Y.disabled}`]:{cursor:`default`},[`& .${Y.label}`]:{[`&.${Y.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:`start`},style:{flexDirection:`row-reverse`,marginRight:-11}},{props:{labelPlacement:`top`},style:{flexDirection:`column-reverse`}},{props:{labelPlacement:`bottom`},style:{flexDirection:`column`}},{props:({labelPlacement:e})=>e===`start`||e===`top`||e===`bottom`,style:{marginLeft:16}}]})));var Q=v(`span`,{name:`MuiFormControlLabel`,slot:`Asterisk`})(b(({theme:e})=>({[`&.${Y.error}`]:{color:(e.vars||e).palette.error.main}}))),Me=U.forwardRef(function(e,n){let r=f({props:e,name:`MuiFormControlLabel`}),{checked:i,className:o,componentsProps:s={},control:c,disabled:l,disableTypography:u,inputRef:d,label:p,labelPlacement:m=`end`,name:ee,onChange:h,required:g,slots:_={},slotProps:v={},value:y,...b}=r,x=t(),S=l??c.props.disabled??x?.disabled,C=g??c.props.required,w={disabled:S,required:C};[`checked`,`name`,`onChange`,`value`,`inputRef`].forEach(e=>{c.props[e]===void 0&&r[e]!==void 0&&(w[e]=r[e])});let te=a({props:r,muiFormControl:x,states:[`error`]}),T={...r,disabled:S,labelPlacement:m,required:C,error:te.error},E=X(T),[D,O]=k(`typography`,{elementType:P,externalForwardedProps:{slots:_,slotProps:{...s,...v}},ownerState:T}),A=p;return A!=null&&A.type!==P&&!u&&(A=(0,W.jsx)(D,{component:`span`,...O,className:B(E.label,O?.className),children:A})),(0,W.jsxs)(Z,{className:B(E.root,o),ownerState:T,ref:n,...b,children:[U.cloneElement(c,w),C?(0,W.jsxs)(`div`,{children:[A,(0,W.jsxs)(Q,{ownerState:T,"aria-hidden":!0,className:E.asterisk,children:[` `,`*`]})]}):A]})});function Ne(e){return j(`MuiTooltip`,e)}var $=L(`MuiTooltip`,[`popper`,`popperInteractive`,`popperArrow`,`popperClose`,`tooltip`,`tooltipArrow`,`touch`,`tooltipPlacementLeft`,`tooltipPlacementRight`,`tooltipPlacementTop`,`tooltipPlacementBottom`,`arrow`]);function Pe(e){return Math.round(e*1e5)/1e5}var Fe=e=>{let{classes:t,disableInteractive:n,arrow:r,touch:i,placement:a}=e;return T({popper:[`popper`,!n&&`popperInteractive`,r&&`popperArrow`],tooltip:[`tooltip`,r&&`tooltipArrow`,i&&`touch`,`tooltipPlacement${C(a.split(`-`)[0])}`],arrow:[`arrow`]},Ne,t)},Ie=v(l,{name:`MuiTooltip`,slot:`Popper`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.popper,!n.disableInteractive&&t.popperInteractive,n.arrow&&t.popperArrow,!n.open&&t.popperClose]}})(b(({theme:e})=>({zIndex:(e.vars||e).zIndex.tooltip,pointerEvents:`none`,variants:[{props:({ownerState:e})=>!e.disableInteractive,style:{pointerEvents:`auto`}},{props:({open:e})=>!e,style:{pointerEvents:`none`}},{props:({ownerState:e})=>e.arrow,style:{[`&[data-popper-placement*="bottom"] .${$.arrow}`]:{top:0,marginTop:`-0.71em`,"&::before":{transformOrigin:`0 100%`}},[`&[data-popper-placement*="top"] .${$.arrow}`]:{bottom:0,marginBottom:`-0.71em`,"&::before":{transformOrigin:`100% 0`}},[`&[data-popper-placement*="right"] .${$.arrow}`]:{height:`1em`,width:`0.71em`,"&::before":{transformOrigin:`100% 100%`}},[`&[data-popper-placement*="left"] .${$.arrow}`]:{height:`1em`,width:`0.71em`,"&::before":{transformOrigin:`0 0`}}}},{props:({ownerState:e})=>e.arrow&&!e.isRtl,style:{[`&[data-popper-placement*="right"] .${$.arrow}`]:{left:0,marginLeft:`-0.71em`}}},{props:({ownerState:e})=>e.arrow&&!!e.isRtl,style:{[`&[data-popper-placement*="right"] .${$.arrow}`]:{right:0,marginRight:`-0.71em`}}},{props:({ownerState:e})=>e.arrow&&!e.isRtl,style:{[`&[data-popper-placement*="left"] .${$.arrow}`]:{right:0,marginRight:`-0.71em`}}},{props:({ownerState:e})=>e.arrow&&!!e.isRtl,style:{[`&[data-popper-placement*="left"] .${$.arrow}`]:{left:0,marginLeft:`-0.71em`}}}]}))),Le=v(`div`,{name:`MuiTooltip`,slot:`Tooltip`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.tooltip,n.touch&&t.touch,n.arrow&&t.tooltipArrow,t[`tooltipPlacement${C(n.placement.split(`-`)[0])}`]]}})(b(({theme:e})=>({backgroundColor:e.vars?e.vars.palette.Tooltip.bg:e.alpha(e.palette.grey[700],.92),borderRadius:(e.vars||e).shape.borderRadius,color:(e.vars||e).palette.common.white,fontFamily:e.typography.fontFamily,padding:`4px 8px`,fontSize:e.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:`break-word`,fontWeight:e.typography.fontWeightMedium,[`.${$.popper}[data-popper-placement*="left"] &`]:{transformOrigin:`right center`},[`.${$.popper}[data-popper-placement*="right"] &`]:{transformOrigin:`left center`},[`.${$.popper}[data-popper-placement*="top"] &`]:{transformOrigin:`center bottom`,marginBottom:`14px`},[`.${$.popper}[data-popper-placement*="bottom"] &`]:{transformOrigin:`center top`,marginTop:`14px`},variants:[{props:({ownerState:e})=>e.arrow,style:{position:`relative`,margin:0}},{props:({ownerState:e})=>e.touch,style:{padding:`8px 16px`,fontSize:e.typography.pxToRem(14),lineHeight:`${Pe(16/14)}em`,fontWeight:e.typography.fontWeightRegular}},{props:({ownerState:e})=>!e.isRtl,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginRight:`14px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginLeft:`14px`}}},{props:({ownerState:e})=>!e.isRtl&&e.touch,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginRight:`24px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginLeft:`24px`}}},{props:({ownerState:e})=>!!e.isRtl,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginLeft:`14px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginRight:`14px`}}},{props:({ownerState:e})=>!!e.isRtl&&e.touch,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginLeft:`24px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginRight:`24px`}}},{props:({ownerState:e})=>e.touch,style:{[`.${$.popper}[data-popper-placement*="top"] &`]:{marginBottom:`24px`}}},{props:({ownerState:e})=>e.touch,style:{[`.${$.popper}[data-popper-placement*="bottom"] &`]:{marginTop:`24px`}}}]}))),Re=v(`span`,{name:`MuiTooltip`,slot:`Arrow`})(b(({theme:e})=>({overflow:`hidden`,position:`absolute`,width:`1em`,height:`0.71em`,boxSizing:`border-box`,color:e.vars?e.vars.palette.Tooltip.bg:e.alpha(e.palette.grey[700],.9),"&::before":{content:`""`,margin:`auto`,display:`block`,width:`100%`,height:`100%`,backgroundColor:`currentColor`,transform:`rotate(45deg)`}}))),ze=!1,Be=new m,Ve={x:0,y:0};function He(e,t){return(n,...r)=>{t&&t(n,...r),e(n,...r)}}var Ue=U.forwardRef(function(e,t){let r=f({props:e,name:`MuiTooltip`}),{arrow:i=!1,children:a,classes:o,components:s={},componentsProps:c={},describeChild:u=!1,disableFocusListener:d=!1,disableHoverListener:p=!1,disableInteractive:m=!1,disableTouchListener:ee=!1,enterDelay:h=100,enterNextDelay:_=0,enterTouchDelay:v=700,followCursor:y=!1,id:b,leaveDelay:S=0,leaveTouchDelay:C=1500,onClose:w,onOpen:te,open:T,placement:E=`bottom`,PopperComponent:O,PopperProps:A={},slotProps:j={},slots:M={},title:N,TransitionComponent:P,TransitionProps:re,...ie}=r,F=U.isValidElement(a)?a:(0,W.jsx)(`span`,{children:a}),L=g(),R=D(),[z,se]=U.useState(),[ce,le]=U.useState(null),V=U.useRef(!1),de=m||y,fe=pe(),me=pe(),he=pe(),ge=pe(),[_e,ve]=n({controlled:T,default:!1,name:`Tooltip`,state:`open`}),H=_e,ye=x(b),G=U.useRef(),be=ae(()=>{G.current!==void 0&&(document.body.style.WebkitUserSelect=G.current,G.current=void 0),ge.clear()});U.useEffect(()=>be,[be]);let K=e=>{Be.clear(),ze=!0,ve(!0),te&&!H&&te(e)},q=ae(e=>{Be.start(800+S,()=>{ze=!1}),ve(!1),w&&H&&w(e),fe.start(L.transitions.duration.shortest,()=>{V.current=!1})}),xe=e=>{V.current&&e.type!==`touchstart`||(z&&z.removeAttribute(`title`),me.clear(),he.clear(),h||ze&&_?me.start(ze?_:h,()=>{K(e)}):K(e))},J=e=>{me.clear(),he.start(S,()=>{q(e)})},[,Se]=U.useState(!1),Ce=e=>{I(e.target)||(Se(!1),J(e))},we=e=>{z||se(e.currentTarget),I(e.target)&&(Se(!0),xe(e))},Te=e=>{V.current=!0;let t=F.props;t.onTouchStart&&t.onTouchStart(e)},Ee=e=>{Te(e),he.clear(),fe.clear(),be(),G.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect=`none`,ge.start(v,()=>{document.body.style.WebkitUserSelect=G.current,xe(e)})},De=e=>{F.props.onTouchEnd&&F.props.onTouchEnd(e),be(),he.start(C,()=>{q(e)})};U.useEffect(()=>{if(!H)return;function e(e){e.key===`Escape`&&q(e)}return document.addEventListener(`keydown`,e),()=>{document.removeEventListener(`keydown`,e)}},[q,H]);let Oe=oe(ue(F),se,t);!N&&N!==0&&(H=!1);let ke=U.useRef(),Ae=e=>{let t=F.props;t.onMouseMove&&t.onMouseMove(e),Ve={x:e.clientX,y:e.clientY},ke.current&&ke.current.update()},je={},Y=typeof N==`string`;u?(je.title=!H&&Y&&!p?N:null,je[`aria-describedby`]=H?ye:null):(je[`aria-label`]=Y?N:null,je[`aria-labelledby`]=H&&!Y?ye:null);let X={...je,...ie,...F.props,className:B(ie.className,F.props.className),onTouchStart:Te,ref:Oe,...y?{onMouseMove:Ae}:{}},Z={};ee||(X.onTouchStart=Ee,X.onTouchEnd=De),p||(X.onMouseOver=He(xe,X.onMouseOver),X.onMouseLeave=He(J,X.onMouseLeave),de||(Z.onMouseOver=xe,Z.onMouseLeave=J)),d||(X.onFocus=He(we,X.onFocus),X.onBlur=He(Ce,X.onBlur),de||(Z.onFocus=we,Z.onBlur=Ce));let Q={...r,isRtl:R,arrow:i,disableInteractive:de,placement:E,PopperComponentProp:O,touch:V.current},Me=typeof j.popper==`function`?j.popper(Q):j.popper,Ne=U.useMemo(()=>{let e=[{name:`arrow`,enabled:!!ce,options:{element:ce,padding:4}}];return A.popperOptions?.modifiers&&(e=e.concat(A.popperOptions.modifiers)),Me?.popperOptions?.modifiers&&(e=e.concat(Me.popperOptions.modifiers)),{...A.popperOptions,...Me?.popperOptions,modifiers:e}},[ce,A.popperOptions,Me?.popperOptions]),$=Fe(Q),Pe=typeof j.transition==`function`?j.transition(Q):j.transition,Ue={slots:{popper:s.Popper,transition:s.Transition??P,tooltip:s.Tooltip,arrow:s.Arrow,...M},slotProps:{arrow:j.arrow??c.arrow,popper:{...A,...Me??c.popper},tooltip:j.tooltip??c.tooltip,transition:{...re,...Pe??c.transition}}},[We,Ge]=k(`popper`,{elementType:Ie,externalForwardedProps:Ue,ownerState:Q,className:B($.popper,A?.className)}),[Ke,qe]=k(`transition`,{elementType:ne,externalForwardedProps:Ue,ownerState:Q}),[Je,Ye]=k(`tooltip`,{elementType:Le,className:$.tooltip,externalForwardedProps:Ue,ownerState:Q}),[Xe,Ze]=k(`arrow`,{elementType:Re,className:$.arrow,externalForwardedProps:Ue,ownerState:Q,ref:le});return(0,W.jsxs)(U.Fragment,{children:[U.cloneElement(F,X),(0,W.jsx)(We,{as:O??l,placement:E,anchorEl:y?{getBoundingClientRect:()=>({top:Ve.y,left:Ve.x,right:Ve.x,bottom:Ve.y,width:0,height:0})}:z,popperRef:ke,open:z?H:!1,id:ye,transition:!0,...Z,...Ge,popperOptions:Ne,children:({TransitionProps:e})=>(0,W.jsx)(Ke,{timeout:L.transitions.duration.shorter,...e,...qe,children:(0,W.jsxs)(Je,{...Ye,children:[N,i?(0,W.jsx)(Xe,{...Ze}):null]})})})]})});function We(){let{showSuccess:t}=H(),{confirm:n,isOpen:a,options:s,handleConfirm:l,handleCancel:f}=_e(),[p,m]=(0,U.useState)([]),[h,g]=(0,U.useState)(!0),[v,y]=(0,U.useState)(null),[b,x]=(0,U.useState)(!1),[C,w]=(0,U.useState)(null),[T,D]=(0,U.useState)(null),[k,j]=(0,U.useState)(null),[ne,ie]=(0,U.useState)(``),[I,L]=(0,U.useState)(``),[ae,oe]=(0,U.useState)(!0),[z,se]=(0,U.useState)(`off`),[B,le]=(0,U.useState)(`full`),[ue,V]=(0,U.useState)(!1),[de,pe]=(0,U.useState)(null),[he,ye]=(0,U.useState)({}),[G,be]=(0,U.useState)(`full`),K=(0,U.useCallback)(async()=>{try{g(!0),y(null),m(await O())}catch(e){y(e instanceof Error?e.message:`Failed to load libraries`),console.error(`[LibraryManagement] Load error:`,e)}finally{g(!1)}},[]),q=(0,U.useCallback)(async()=>{try{let e=await O();m(t=>{if(t.length!==e.length)return e;let n=new Map(e.map(e=>[e.library_id,e])),r=!1;for(let e of t){let t=n.get(e.library_id);if(!t){r=!0;break}if(e.scanStatus!==t.scanStatus||e.scanProgress!==t.scanProgress||e.scanTotal!==t.scanTotal||e.scanError!==t.scanError||e.scannedAt!==t.scannedAt||e.fileCount!==t.fileCount||e.folderCount!==t.folderCount){r=!0;break}}return r?t.map(e=>{let t=n.get(e.library_id);return!t||e.scanStatus===t.scanStatus&&e.scanProgress===t.scanProgress&&e.scanTotal===t.scanTotal&&e.scanError===t.scanError&&e.scannedAt===t.scannedAt&&e.fileCount===t.fileCount&&e.folderCount===t.folderCount?e:t}):t})}catch(e){console.error(`[LibraryManagement] Refresh error:`,e)}},[]),xe=async()=>{try{j((await A()).library_root||null)}catch(e){console.error(`[LibraryManagement] Failed to load config:`,e)}};(0,U.useEffect)(()=>{K(),xe()},[K]),(0,U.useEffect)(()=>{let e=!0,t=null,n=async()=>{try{let n=await ee();if(!e)return;n.is_busy?t||=setInterval(()=>{q()},500):t&&(clearInterval(t),t=null,q())}catch(e){console.error(`[LibraryManagement] Failed to check work status:`,e)}};n();let r=setInterval(n,5e3);return()=>{e=!1,t&&clearInterval(t),clearInterval(r)}},[q]);let J=e=>{if(!k)return!1;let t=k.replace(/\/+$/,``);return!e.replace(/\/+$/,``).startsWith(t)},Se=()=>{ie(``),L(``),oe(!0),se(`off`),le(`full`),be(`full`),V(!1),x(!1),w(null)},Ce=()=>{Se(),x(!0)},we=e=>{ie(e.name),L(e.rootPath),oe(e.isEnabled),se(e.watchMode),le(e.fileWriteMode),be(e.fileWriteMode),w(e.library_id),x(!1)},Te=async()=>{if(!I.trim()){y(`Path is required`);return}try{y(null),await re({name:ne.trim()||null,rootPath:I,isEnabled:ae,watchMode:z,fileWriteMode:B}),await K(),Se()}catch(e){y(e instanceof Error?e.message:`Failed to create library`)}},Ee=async()=>{if(C===null)return;if(!I.trim()){y(`Path is required`);return}let e=B!==G;try{if(y(null),await N(C,{name:ne.trim()||void 0,rootPath:I,isEnabled:ae,watchMode:z,...e?{}:{fileWriteMode:B}}),e){let e=await me(C,B);e.requires_reconciliation&&e.affected_file_count>0&&await n({title:`Reconcile Tags?`,message:`${e.affected_file_count} files need to be rewritten with the new tag format. Reconcile now?`,severity:`info`})&&await Q(C)}await K(),Se()}catch(e){y(e instanceof Error?e.message:`Failed to update library`)}},De=async(e,n)=>{try{y(null),D(e);let r=await ge(e,n);t(r.message||`Library scan started (${r.stats?.files_queued??0} files)`),await K()}catch(e){y(e instanceof Error?e.message:`Failed to scan library`)}finally{D(null)}},Oe=async(e,t)=>{if(await n({title:`Delete Library?`,message:`Delete library "${t}"?\n\nThis will remove the library entry but will NOT delete files on disk.`,severity:`warning`}))try{y(null),await ce(e),await K()}catch(e){y(e instanceof Error?e.message:`Failed to delete library`)}},ke=async(e,n)=>{try{y(null),await N(e,{watchMode:n}),await K(),t(`File watching mode changed to ${n}`)}catch(e){y(e instanceof Error?e.message:`Failed to change watch mode`)}},je=e=>{switch(e){case`event`:return`Event`;case`poll`:return`Poll`;default:return`Off`}},Y=e=>{switch(e){case`event`:return`success`;case`poll`:return`warning`;default:return`default`}},X=e=>{switch(e){case`none`:return`None`;case`minimal`:return`Minimal`;case`full`:return`Full`}},Z=e=>{switch(e){case`none`:return`default`;case`minimal`:return`secondary`;case`full`:return`primary`}},Q=async e=>{try{y(null),pe(e);let n=await fe(e);t(`Reconciled ${n.processed} files (${n.remaining} remaining, ${n.failed} failed)`);let r=await F(e);ye(t=>({...t,[e]:{pending:r.pending_count,inProgress:r.in_progress}}))}catch(e){y(e instanceof Error?e.message:`Failed to reconcile tags`)}finally{pe(null)}},Ne=async e=>{try{let t=await F(e);ye(n=>({...n,[e]:{pending:t.pending_count,inProgress:t.in_progress}}))}catch{}},$=b||C!==null;return(0,W.jsxs)(e,{spacing:2.5,children:[(0,W.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`center`,children:[(0,W.jsx)(P,{variant:`h5`,children:`Libraries`}),!$&&(0,W.jsx)(R,{variant:`contained`,onClick:Ce,children:`+ Add Library`})]}),v&&(0,W.jsx)(te,{children:v}),$&&(0,W.jsxs)(S,{children:[(0,W.jsx)(E,{title:b?`Create Library`:`Edit Library`}),(0,W.jsxs)(e,{spacing:2,children:[(0,W.jsxs)(M,{children:[(0,W.jsx)(P,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Name (optional)`}),(0,W.jsx)(c,{value:ne,onChange:e=>ie(e.target.value),placeholder:`Auto-generated from path if left empty`,fullWidth:!0})]}),(0,W.jsxs)(M,{children:[(0,W.jsx)(P,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Root Path`}),(0,W.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,W.jsx)(c,{value:I,onChange:e=>L(e.target.value),placeholder:`/music`,fullWidth:!0}),(0,W.jsx)(R,{variant:`outlined`,onClick:()=>V(!ue),sx:{minWidth:120},children:ue?`Hide Picker`:`Browse...`})]}),ue&&(0,W.jsx)(M,{sx:{mt:1.25,p:2,bgcolor:`background.default`,borderRadius:1,border:1,borderColor:`divider`},children:(0,W.jsx)(ve,{value:I,onChange:e=>{L(e),V(!1)},mode:`directory`,label:`Select Library Root Directory`})})]}),(0,W.jsx)(Me,{control:(0,W.jsx)(Ae,{checked:ae,onChange:e=>oe(e.target.checked)}),label:`Enabled`}),(0,W.jsx)(M,{children:(0,W.jsxs)(r,{fullWidth:!0,children:[(0,W.jsx)(o,{id:`watch-mode-label`,children:`File Watching`}),(0,W.jsxs)(i,{labelId:`watch-mode-label`,value:z,label:`File Watching`,onChange:e=>se(e.target.value),children:[(0,W.jsx)(d,{value:`off`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(P,{children:[(0,W.jsx)(`strong`,{children:`Off`}),` - No automatic scanning`]}),(0,W.jsx)(P,{variant:`caption`,color:`text.secondary`,children:`Manual scans only`})]})}),(0,W.jsx)(d,{value:`event`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(P,{children:[(0,W.jsx)(`strong`,{children:`Event`}),` - Real-time file watching`]}),(0,W.jsx)(P,{variant:`caption`,color:`text.secondary`,children:`Fast (2-5s response), local filesystems only`})]})}),(0,W.jsx)(d,{value:`poll`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(P,{children:[(0,W.jsx)(`strong`,{children:`Poll`}),` - Periodic scanning`]}),(0,W.jsx)(P,{variant:`caption`,color:`text.secondary`,children:`Slower (60s interval), network-mount-safe`})]})})]})]})}),(0,W.jsx)(M,{children:(0,W.jsxs)(r,{fullWidth:!0,children:[(0,W.jsx)(o,{id:`write-mode-label`,children:`Tag Writing Mode`}),(0,W.jsxs)(i,{labelId:`write-mode-label`,value:B,label:`Tag Writing Mode`,onChange:e=>le(e.target.value),children:[(0,W.jsx)(d,{value:`none`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(P,{children:[(0,W.jsx)(`strong`,{children:`None`}),` - Don't write tags to files`]}),(0,W.jsx)(P,{variant:`caption`,color:`text.secondary`,children:`DB is source of truth; clears existing nomarr tags`})]})}),(0,W.jsx)(d,{value:`minimal`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(P,{children:[(0,W.jsx)(`strong`,{children:`Minimal`}),` - Mood tags only`]}),(0,W.jsx)(P,{variant:`caption`,color:`text.secondary`,children:`Write mood-strict, mood-regular, mood-loose`})]})}),(0,W.jsx)(d,{value:`full`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(P,{children:[(0,W.jsx)(`strong`,{children:`Full`}),` - All tags`]}),(0,W.jsx)(P,{variant:`caption`,color:`text.secondary`,children:`Write all ML-derived tags to audio files`})]})})]})]})}),(0,W.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,W.jsx)(R,{variant:`contained`,onClick:b?Te:Ee,children:b?`Create`:`Update`}),(0,W.jsx)(R,{variant:`outlined`,onClick:Se,children:`Cancel`})]})]})]}),h&&(0,W.jsx)(P,{children:`Loading libraries...`}),!h&&!$&&p.length===0&&(0,W.jsx)(S,{children:(0,W.jsx)(P,{color:`text.secondary`,textAlign:`center`,fontStyle:`italic`,children:`No libraries configured. Click "Add Library" to get started.`})}),!h&&!$&&p.length>0&&(0,W.jsx)(e,{spacing:2,children:p.map(t=>(0,W.jsxs)(S,{children:[(0,W.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`flex-start`,sx:{mb:2},children:[(0,W.jsxs)(M,{children:[(0,W.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1.25,sx:{mb:.5},children:[(0,W.jsx)(P,{variant:`h6`,children:t.name}),J(t.rootPath)&&(0,W.jsx)(u,{label:`Outside library_root`,color:`warning`,size:`small`})]}),(0,W.jsx)(P,{variant:`body2`,color:`text.secondary`,sx:{fontFamily:`monospace`},children:t.rootPath}),(0,W.jsxs)(e,{direction:`row`,spacing:2,sx:{mt:.5},children:[(0,W.jsxs)(P,{variant:`body2`,color:`text.secondary`,children:[(0,W.jsx)(`strong`,{children:t.fileCount.toLocaleString()}),` files`]}),(0,W.jsxs)(P,{variant:`body2`,color:`text.secondary`,children:[(0,W.jsx)(`strong`,{children:t.folderCount.toLocaleString()}),` folders`]})]}),t.scanStatus===`scanning`&&(0,W.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:.5},children:[(0,W.jsx)(u,{label:`Scanning...`,color:`info`,size:`small`,sx:{animation:`pulse 1.5s infinite`}}),t.scanProgress!=null&&t.scanTotal!=null&&t.scanTotal>0&&(0,W.jsxs)(P,{variant:`body2`,color:`info.main`,children:[t.scanProgress.toLocaleString(),` / `,t.scanTotal.toLocaleString(),` files`,` `,`(`,Math.round(t.scanProgress/t.scanTotal*100),`%)`]})]}),t.scanStatus===`error`&&t.scanError&&(0,W.jsxs)(P,{variant:`caption`,color:`error.main`,sx:{mt:.5},children:[`⚠ Scan error: `,t.scanError]}),J(t.rootPath)&&(0,W.jsxs)(P,{variant:`caption`,color:`warning.main`,sx:{mt:.5},children:[`⚠ This library is outside the configured library_root (`,k,`)`]}),(0,W.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:1},children:[(0,W.jsx)(P,{variant:`caption`,color:`text.secondary`,children:`File Watching:`}),(0,W.jsx)(r,{size:`small`,sx:{minWidth:120},children:(0,W.jsxs)(i,{value:t.watchMode,onChange:e=>ke(t.library_id,e.target.value),size:`small`,sx:{fontSize:`0.75rem`},disabled:T===t.library_id,children:[(0,W.jsx)(d,{value:`off`,children:`Off`}),(0,W.jsx)(d,{value:`event`,children:`Event`}),(0,W.jsx)(d,{value:`poll`,children:`Poll`})]})}),(0,W.jsx)(Ue,{title:t.watchMode===`event`?`Real-time file watching (local filesystems)`:t.watchMode===`poll`?`Periodic scanning (network-mount-safe)`:`No automatic file watching`,children:(0,W.jsx)(u,{label:je(t.watchMode),color:Y(t.watchMode),size:`small`})})]}),(0,W.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:.5},children:[(0,W.jsx)(P,{variant:`caption`,color:`text.secondary`,children:`Tag Writing:`}),(0,W.jsx)(Ue,{title:t.fileWriteMode===`full`?`All ML-derived tags written to audio files`:t.fileWriteMode===`minimal`?`Only mood tags written to audio files`:`No tags written to audio files (DB only)`,children:(0,W.jsx)(u,{label:X(t.fileWriteMode),color:Z(t.fileWriteMode),size:`small`})}),he[t.library_id]?.pending>0&&(0,W.jsx)(u,{label:`${he[t.library_id].pending} pending`,color:`warning`,size:`small`})]})]}),(0,W.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,children:[(0,W.jsx)(M,{sx:{width:8,height:8,borderRadius:`50%`,bgcolor:t.isEnabled?`success.main`:`text.disabled`}}),(0,W.jsx)(P,{variant:`body2`,color:`text.secondary`,children:t.isEnabled?`Enabled`:`Disabled`})]})]}),(0,W.jsxs)(e,{direction:`row`,spacing:1.25,flexWrap:`wrap`,children:[(0,W.jsx)(R,{variant:`outlined`,size:`small`,onClick:()=>we(t),disabled:T===t.library_id,children:`Edit`}),(0,W.jsx)(R,{variant:`outlined`,color:`success`,size:`small`,onClick:()=>De(t.library_id,`quick`),disabled:!t.isEnabled||T===t.library_id||t.scanStatus===`scanning`||J(t.rootPath)||!t.scannedAt,title:t.scannedAt?t.scanStatus===`scanning`?`Scan already in progress`:J(t.rootPath)?`Cannot scan: library is outside library_root`:`Scan only new and modified files`:`Run a Full Scan first before using Quick Scan`,children:T===t.library_id||t.scanStatus===`scanning`?`Scanning...`:`Quick Scan`}),(0,W.jsx)(R,{variant:`contained`,color:`success`,size:`small`,onClick:()=>De(t.library_id,`full`),disabled:!t.isEnabled||T===t.library_id||t.scanStatus===`scanning`||J(t.rootPath),title:t.scanStatus===`scanning`?`Scan already in progress`:J(t.rootPath)?`Cannot scan: library is outside library_root`:`Rescan all files in the library`,children:T===t.library_id||t.scanStatus===`scanning`?`Scanning...`:`Full Scan`}),(0,W.jsx)(R,{variant:`outlined`,color:`secondary`,size:`small`,onClick:()=>Q(t.library_id),disabled:!t.isEnabled||de===t.library_id||t.scanStatus===`scanning`,title:de===t.library_id?`Reconciling tags...`:`Write tags from database to audio files`,onMouseEnter:()=>Ne(t.library_id),children:de===t.library_id?`Reconciling...`:`Reconcile Tags`}),(0,W.jsx)(R,{variant:`contained`,color:`error`,size:`small`,onClick:()=>Oe(t.library_id,t.name),disabled:T===t.library_id,children:`Delete`})]})]},t.library_id))}),(0,W.jsx)(_,{open:a,title:s.title,message:s.message,confirmLabel:s.confirmLabel,cancelLabel:s.cancelLabel,severity:s.severity,onConfirm:l,onCancel:f})]})}var Ge={file_write_mode:{label:`Tag Writing Mode`,description:`Controls which tags are written to audio files`,type:`select`,options:[{value:`none`,label:`None - Tags stored in database only`},{value:`minimal`,label:`Minimal - Essential tags only (artist, album, title, genre)`},{value:`full`,label:`Full - All generated tags written to files`}]},overwrite_tags:{label:`Overwrite Existing Tags`,description:`Whether to overwrite existing tags in audio files`,type:`boolean`},library_auto_tag:{label:`Auto-Tag New Files`,description:`Automatically process new files found during library scans`,type:`boolean`},library_ignore_patterns:{label:`Ignore Patterns`,description:`Comma-separated patterns to ignore during scanning (e.g., */Audiobooks/*,*.tmp)`,type:`text`},tagger_worker_count:{label:`Worker Threads`,description:`Number of parallel worker processes for tagging (0 = auto-detect)`,type:`text`},cache_idle_timeout:{label:`Cache Timeout (seconds)`,description:`How long to keep ML models in memory when idle`,type:`text`},calibrate_heads:{label:`Auto-Calibrate Heads`,description:`Automatically calibrate tag thresholds for optimal results`,type:`boolean`},calibration_repo:{label:`Calibration Repository`,description:`Git repository URL for calibration data downloads`,type:`text`}};function Ke({configKey:e,value:t,onChange:n,disabled:r}){let a=t==null?``:String(t),o=Ge[e],s=o?.label||e,l=o?.description,u=o?.type||(typeof t==`boolean`?`boolean`:`text`),f=o?.options||[];return(0,W.jsxs)(M,{sx:{display:`flex`,gap:2,alignItems:`flex-start`,py:1},children:[(0,W.jsxs)(M,{sx:{minWidth:`280px`,flexShrink:0},children:[(0,W.jsx)(P,{variant:`body2`,color:`text.primary`,sx:{fontWeight:500,mb:l?.5:0},children:s}),l&&(0,W.jsx)(P,{variant:`caption`,color:`text.secondary`,sx:{display:`block`},children:l})]}),(0,W.jsx)(M,{sx:{flex:1,maxWidth:`400px`},children:(()=>u===`select`&&f.length>0?(0,W.jsx)(i,{value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0,children:f.map(({value:e,label:t})=>(0,W.jsx)(d,{value:e,children:t},e))}):u===`boolean`?(0,W.jsxs)(i,{value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0,children:[(0,W.jsx)(d,{value:`true`,children:`true`}),(0,W.jsx)(d,{value:`false`,children:`false`})]}):(0,W.jsx)(c,{type:`text`,value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0,placeholder:l}))()})]})}function qe({config:t,hasChanges:n,saveLoading:r,onChange:i,onSaveAll:a}){return(0,W.jsxs)(S,{children:[(0,W.jsx)(E,{title:`Settings`}),(0,W.jsx)(P,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Changes are saved to the database and will take effect on server restart. Use "Restart Server" in Admin page to apply changes.`}),(0,W.jsx)(e,{spacing:1.875,children:Object.entries(t).map(([e,t])=>(0,W.jsx)(Ke,{configKey:e,value:t,onChange:i,disabled:r},e))}),(0,W.jsxs)(M,{sx:{mt:3.75,display:`flex`,gap:1.25,alignItems:`center`},children:[(0,W.jsx)(R,{onClick:a,variant:`contained`,disabled:!n||r,sx:{whiteSpace:`nowrap`},children:r?`Saving...`:`Save All Changes`}),n&&(0,W.jsx)(P,{variant:`body2`,color:`warning.main`,children:`Unsaved changes`})]})]})}function Je(){let{showSuccess:e,showError:t,showInfo:n}=H(),[r,i]=(0,U.useState)({}),[a,o]=(0,U.useState)({}),[s,c]=(0,U.useState)(!0),[l,u]=(0,U.useState)(null),[d,f]=(0,U.useState)(!1),[p,m]=(0,U.useState)(!1),ee=async()=>{try{c(!0),u(null);let e=await A();i(e),o(e),m(!1)}catch(e){u(e instanceof Error?e.message:`Failed to load config`),console.error(`[Config] Load error:`,e)}finally{c(!1)}};return(0,U.useEffect)(()=>{ee()},[]),(0,U.useEffect)(()=>{m(Object.keys(r).some(e=>r[e]!==a[e]))},[r,a]),{config:r,loading:s,error:l,saveLoading:d,hasChanges:p,handleSaveAll:async()=>{try{f(!0);let t=[];for(let e of Object.keys(r))if(r[e]!==a[e]){let n=r[e];if(n==null||n===``)continue;await se(e,String(n)),t.push(e)}if(t.length===0){n(`No changes to save`);return}e(`Saved ${t.length} config change(s). Use "Restart Server" in Admin page to apply.`),await ee()}catch(e){t(e instanceof Error?e.message:`Failed to save config`)}finally{f(!1)}},handleChange:(e,t)=>{i(n=>({...n,[e]:t}))}}}function Ye(){let{config:t,loading:n,error:r,saveLoading:i,hasChanges:a,handleSaveAll:o,handleChange:s}=Je();return(0,W.jsxs)(h,{title:`Configuration`,children:[n&&(0,W.jsx)(ie,{}),r&&(0,W.jsxs)(de,{severity:`error`,children:[`Error: `,r]}),!n&&!r&&(0,W.jsxs)(e,{spacing:2.5,children:[(0,W.jsx)(We,{}),(0,W.jsx)(qe,{config:t,hasChanges:a,saveLoading:i,onChange:s,onSaveAll:o})]})]})}export{Ye as ConfigPage};