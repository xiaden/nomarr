import{t as e}from"./Stack-CDy2Wfdf.js";import{i as t}from"./queue-Bwy5jqyj.js";import{r as n}from"./library-CA9bBme1.js";import{D as r,Dt as i,Et as a,_t as o,c as s,f as c,g as l,h as u,l as d,m as f,p,t as m,w as h}from"./index-DYVoQaaX.js";var g=i(a(),1),_=i(o(),1);function v(){let[i,a]=(0,g.useState)(null),[o,v]=(0,g.useState)(null),[y,b]=(0,g.useState)(!0),[x,S]=(0,g.useState)(null),[C,w]=(0,g.useState)(null),T=(0,g.useRef)([]),E=async()=>{try{b(!0),S(null);let[e,r]=await Promise.all([t(),n()]);a(e),v(r),D(e)}catch(e){S(e instanceof Error?e.message:`Failed to load dashboard data`),console.error(`[Dashboard] Load error:`,e)}finally{b(!1)}},D=e=>{let t=Date.now(),n=e.pending+e.running+e.completed+e.errors,r=e.completed,i=T.current;i.push({count:r,time:t});let a=t-300*1e3;T.current=i.filter(e=>e.time>a);let o=0,s=null;if(T.current.length>=2){let t=T.current[0],n=T.current[T.current.length-1],r=(n.time-t.time)/(1e3*60),i=n.count-t.count;if(r>0&&i>0){o=i/r;let t=e.pending+e.running;t>0&&o>0&&(s=t/o)}}w({totalJobs:n,completedCount:r,filesPerMinute:Math.round(o*10)/10,estimatedMinutesRemaining:s,lastUpdateTime:t})};(0,g.useEffect)(()=>{E()},[]);let{connected:O}=m({onMessage:e=>{try{let t=JSON.parse(e.data);console.log(`[Dashboard] SSE update:`,t),t.queue&&(a({pending:t.queue.pending||0,running:t.queue.running||0,completed:t.queue.completed||0,errors:t.queue.errors||0}),D({pending:t.queue.pending||0,running:t.queue.running||0,completed:t.queue.completed||0,errors:t.queue.errors||0}))}catch(e){console.error(`[Dashboard] Failed to parse SSE message:`,e)}},onError:e=>{console.error(`[Dashboard] SSE error:`,e)}}),k=e=>`${Math.floor(e/3600)}h ${Math.floor(e%3600/60)}m`,A=e=>e===null||e<=0?`—`:e<1?`< 1 min`:e<60?`${Math.round(e)} min`:`${Math.floor(e/60)}h ${Math.round(e%60)}m`,j=i&&(i.pending>0||i.running>0),M=C&&C.totalJobs>0?Math.round(C.completedCount/C.totalJobs*100):0;return(0,_.jsxs)(d,{title:`Dashboard`,children:[(0,_.jsx)(r,{variant:`body2`,sx:{color:O?`success.main`:`error.main`,mb:2},children:O?`● Live`:`● Disconnected`}),y&&(0,_.jsx)(r,{sx:{mt:2},children:`Loading dashboard...`}),x&&(0,_.jsxs)(s,{children:[`Error: `,x]}),!y&&!x&&(0,_.jsxs)(e,{spacing:2.5,children:[j&&C&&(0,_.jsxs)(l,{children:[(0,_.jsx)(u,{title:`Processing Status`}),(0,_.jsx)(h,{sx:{mb:2},children:(0,_.jsx)(p,{label:`Files processed`,value:C.completedCount,total:C.totalJobs,percentage:M})}),(0,_.jsxs)(c,{minWidth:150,children:[(0,_.jsx)(f,{label:`Velocity`,value:C.filesPerMinute>0?`${C.filesPerMinute}/min`:`—`}),(0,_.jsx)(f,{label:`ETA`,value:A(C.estimatedMinutesRemaining)}),(0,_.jsx)(f,{label:`Active`,value:i?.running||0}),(0,_.jsx)(f,{label:`Remaining`,value:i?.pending||0})]})]}),(0,_.jsxs)(l,{children:[(0,_.jsx)(u,{title:`Queue Summary`}),i&&(0,_.jsxs)(c,{minWidth:150,children:[(0,_.jsx)(f,{label:`Pending`,value:i.pending}),(0,_.jsx)(f,{label:`Running`,value:i.running}),(0,_.jsx)(f,{label:`Completed`,value:i.completed}),(0,_.jsx)(f,{label:`Errors`,value:i.errors})]})]}),(0,_.jsxs)(l,{children:[(0,_.jsx)(u,{title:`Library Stats`}),o&&(0,_.jsxs)(c,{minWidth:200,children:[(0,_.jsx)(f,{label:`Total Files`,value:o.total_files}),(0,_.jsx)(f,{label:`Artists`,value:o.unique_artists}),(0,_.jsx)(f,{label:`Albums`,value:o.unique_albums}),(0,_.jsx)(f,{label:`Total Duration`,value:k(o.total_duration_seconds)})]})]}),(0,_.jsxs)(l,{children:[(0,_.jsx)(u,{title:`Recent Activity`}),(0,_.jsx)(r,{color:`text.secondary`,fontStyle:`italic`,children:`Recently processed tracks and system events will appear here.`})]})]})]})}export{v as DashboardPage};