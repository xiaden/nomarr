import{n as e,t}from"./Stack-Yia4z9hu.js";import{At as n,C as r,Ct as i,D as a,Dt as o,E as s,Et as c,Ft as l,M as u,N as d,Nt as f,O as p,Q as m,S as h,T as g,Z as _,_ as v,_t as y,a as b,b as x,c as S,ct as C,et as w,f as T,gt as E,h as D,ht as O,i as k,it as A,j as ee,jt as te,k as j,kt as ne,l as re,m as M,mt as ie,n as ae,nt as oe,o as se,p as N,r as ce,s as le,t as ue,tt as de,v as fe,w as pe,x as me,y as he,yt as ge}from"./ChartsWrapper-G3KvqESP.js";import"./List-ClDpiA8c.js";import{i as _e,n as ve,r as ye,t as be}from"./TextField-7eBCAcnM.js";import{i as xe,n as Se,r as Ce,t as we}from"./ExpandMore-C5i0TLrw.js";import"./Popper-D5GwGClX.js";import{t as P}from"./Chip-Cyw0-KQc.js";import{t as F}from"./MenuItem-Cl2OpX3w.js";import"./listItemTextClasses-DX5voEPr.js";import{a as Te,i as Ee,n as De,r as I,t as Oe}from"./TableRow-xLyxtrfu.js";import{$ as ke,$t as Ae,At as L,En as je,Gt as R,H as Me,J as Ne,Jt as Pe,Pt as Fe,Qt as Ie,Rt as Le,U as Re,W as ze,_ as Be,c as Ve,cn as z,et as He,ft as Ue,l as We,mn as B,mt as Ge,ot as V,pn as Ke,sn as H,st as U,ut as W,vt as qe,wn as Je}from"./index-BcSftaEo.js";import{a as Ye,i as Xe,n as Ze,o as Qe,r as $e,t as et}from"./LineChart-DpCxlz4x.js";import{t as tt}from"./PieChart-C1v3kVcc.js";var G=je(Je(),1),K=je(Ke()),nt=Le((0,K.jsx)(`path`,{d:`M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z`}),`Close`);function rt(){return T(`bar`)}function it(e,t){let n=i(e.x,t.x),r=i(e.y,t.y),a=i(e.width,t.width),o=i(e.height,t.height);return e=>({x:n(e),y:r(e),width:a(e),height:o(e)})}function at(e){let t={x:e.layout===`vertical`?e.x:e.xOrigin,y:e.layout===`vertical`?e.yOrigin:e.y,width:e.layout===`vertical`?e.width:0,height:e.layout===`vertical`?0:e.height};return he({x:e.x,y:e.y,width:e.width,height:e.height},{createInterpolator:it,applyProps(e,t){e.setAttribute(`x`,t.x.toString()),e.setAttribute(`y`,t.y.toString()),e.setAttribute(`width`,t.width.toString()),e.setAttribute(`height`,t.height.toString())},transformProps:e=>e,initialProps:t,skip:e.skipAnimation,ref:e.ref})}function ot(e,t){let n=i(e.x,t.x),r=i(e.y,t.y),a=i(e.width,t.width),o=i(e.height,t.height);return e=>({x:n(e),y:r(e),width:a(e),height:o(e)})}function st(e){let{initialX:t,currentX:n,initialY:r,currentY:i}=e.placement===`outside`?lt(e):ct(e),a={x:t,y:r,width:e.width,height:e.height};return he({x:n,y:i,width:e.width,height:e.height},{createInterpolator:ot,transformProps:e=>e,applyProps(e,t){e.setAttribute(`x`,t.x.toString()),e.setAttribute(`y`,t.y.toString()),e.setAttribute(`width`,t.width.toString()),e.setAttribute(`height`,t.height.toString())},initialProps:a,skip:e.skipAnimation,ref:e.ref})}var q=4;function ct(e){return{initialX:e.layout===`vertical`?e.x+e.width/2:e.xOrigin,initialY:e.layout===`vertical`?e.yOrigin:e.y+e.height/2,currentX:e.x+e.width/2,currentY:e.y+e.height/2}}function lt(e){let t=0,n=0,r=0,i=0;return e.layout===`vertical`?(e.y<e.yOrigin?(t=e.yOrigin-q,n=e.y-q):(t=e.yOrigin+q,n=e.y+e.height+q),{initialX:e.x+e.width/2,currentX:e.x+e.width/2,initialY:t,currentY:n}):(e.x<e.xOrigin?(r=e.xOrigin,i=e.x-q):(r=e.xOrigin,i=e.x+e.width+q),{initialX:r,currentX:i,initialY:e.y+e.height/2,currentY:e.y+e.height/2})}function ut({value:e,onChange:t,options:n,placeholder:r=`Type or select...`,disabled:i=!1,...a}){let[o,s]=(0,G.useState)(!1),[c,l]=(0,G.useState)(n),u=(0,G.useRef)(null);(0,G.useEffect)(()=>{l(e?n.filter(t=>t.toLowerCase().includes(e.toLowerCase())):n)},[e,n]),(0,G.useEffect)(()=>{let e=e=>{u.current&&!u.current.contains(e.target)&&s(!1)};return document.addEventListener(`mousedown`,e),()=>document.removeEventListener(`mousedown`,e)},[]);let d=e=>{t(e.target.value),s(!0)},f=e=>{t(e),s(!1)};return(0,K.jsxs)(U,{...a,ref:u,sx:{position:`relative`,...a.sx},children:[(0,K.jsx)(be,{type:`text`,value:e,onChange:d,onFocus:()=>s(!0),placeholder:r,disabled:i,fullWidth:!0,size:`small`,sx:{"& .MuiOutlinedInput-root":{bgcolor:i?`background.paper`:`background.default`}}}),o&&!i&&c.length>0&&(0,K.jsx)(U,{sx:{position:`absolute`,top:`100%`,left:0,right:0,maxHeight:`200px`,overflowY:`auto`,bgcolor:`background.default`,border:1,borderColor:`divider`,borderTop:`none`,borderRadius:`0 0 4px 4px`,boxShadow:2,zIndex:1e3},children:c.map((e,t)=>(0,K.jsx)(U,{onClick:()=>f(e),sx:{p:1.5,cursor:`pointer`,fontSize:`0.875rem`,borderBottom:t<c.length-1?1:`none`,borderColor:`divider`,"&:hover":{bgcolor:`action.hover`}},children:e},t))})]})}function dt({libraryId:e}){let[n,r]=(0,G.useState)([]),[i,a]=(0,G.useState)([]),[o,s]=(0,G.useState)(``),[c,l]=(0,G.useState)(``),[u,d]=(0,G.useState)([]),[f,p]=(0,G.useState)([]),[m,h]=(0,G.useState)(null),[g,_]=(0,G.useState)(!1),[v,y]=(0,G.useState)(null);(0,G.useEffect)(()=>{b()},[]),(0,G.useEffect)(()=>{o?x(o):(a([]),l(``))},[o]);let b=async()=>{try{r((await Ve(!0)).tag_keys)}catch(e){console.error(`[TagCoOccurrence] Failed to load tag keys:`,e)}},x=async e=>{try{let t=await We(e,!0),n=new Set;for(let e of t.tag_keys)if(e.startsWith(`[`)&&e.endsWith(`]`))try{let t=JSON.parse(e);Array.isArray(t)?t.forEach(e=>n.add(String(e))):n.add(e)}catch{n.add(e)}else n.add(e);a(Array.from(n).sort())}catch(e){console.error(`[TagCoOccurrence] Failed to load tag values:`,e),a([])}},S=(e,t)=>u.some(n=>n.key===e&&n.value===t)||f.some(n=>n.key===e&&n.value===t),C=()=>{o&&c&&!u.some(e=>e.key===o&&e.value===c)&&u.length<16&&d([...u,{key:o,value:c}])},w=()=>{o&&c&&!f.some(e=>e.key===o&&e.value===c)&&f.length<16&&p([...f,{key:o,value:c}])},T=e=>{d(u.filter((t,n)=>n!==e))},E=e=>{p(f.filter((t,n)=>n!==e))},D=async()=>{if(u.length===0||f.length===0){y(`Both X and Y axes must have at least one tag`);return}try{_(!0),y(null),h(await ze({x:u,y:f},e))}catch(e){y(e instanceof Error?e.message:`Failed to build matrix`),console.error(`[TagCoOccurrence] Matrix build error:`,e)}finally{_(!1)}},O=(e,t)=>{if(e===0)return`#1a1a1a`;let n=Math.min(e/t,1);return`rgb(${Math.floor(30+n*44)}, ${Math.floor(30+n*128)}, ${Math.floor(30+n*225)})`},k=m?.matrix?Math.max(...m.matrix.flat(),1):1;return(0,K.jsxs)(He,{children:[(0,K.jsx)(ke,{title:`Tag Co-Occurrence Matrix`}),(0,K.jsxs)(t,{spacing:2,sx:{mb:2.5},children:[(0,K.jsxs)(U,{sx:{display:`flex`,gap:1.5,alignItems:`flex-end`},children:[(0,K.jsxs)(U,{sx:{flex:1},children:[(0,K.jsx)(W,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:`Tag Key`}),(0,K.jsx)(ut,{value:o,onChange:s,options:n,placeholder:`Select tag key...`})]}),(0,K.jsxs)(U,{sx:{flex:1},children:[(0,K.jsx)(W,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:`Tag Value`}),(0,K.jsx)(ut,{value:c,onChange:l,options:i,placeholder:`Select tag value...`,disabled:!o})]}),(0,K.jsx)(V,{onClick:C,disabled:!o||!c||u.length>=16||S(o,c),variant:`contained`,size:`small`,children:`Add to X`}),(0,K.jsx)(V,{onClick:w,disabled:!o||!c||f.length>=16||S(o,c),variant:`contained`,color:`secondary`,size:`small`,children:`Add to Y`})]}),(0,K.jsxs)(U,{children:[(0,K.jsxs)(W,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:[`X Axis (`,u.length,`/16)`]}),(0,K.jsxs)(U,{sx:{display:`flex`,flexWrap:`wrap`,gap:1,p:1.5,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minHeight:80},children:[u.length===0&&(0,K.jsx)(W,{variant:`body2`,color:`text.secondary`,children:`No tags added to X axis yet`}),u.map((e,t)=>(0,K.jsx)(P,{label:`${e.key}: ${e.value}`,onDelete:()=>T(t),deleteIcon:(0,K.jsx)(nt,{}),size:`small`},t))]})]}),(0,K.jsxs)(U,{children:[(0,K.jsxs)(W,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:[`Y Axis (`,f.length,`/16)`]}),(0,K.jsxs)(U,{sx:{display:`flex`,flexWrap:`wrap`,gap:1,p:1.5,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minHeight:80},children:[f.length===0&&(0,K.jsx)(W,{variant:`body2`,color:`text.secondary`,children:`No tags added to Y axis yet`}),f.map((e,t)=>(0,K.jsx)(P,{label:`${e.key}: ${e.value}`,onDelete:()=>E(t),deleteIcon:(0,K.jsx)(nt,{}),size:`small`},t))]})]}),(0,K.jsx)(V,{onClick:D,disabled:g||u.length===0||f.length===0,variant:`contained`,fullWidth:!0,children:g?`Building Matrix...`:`Build Matrix`})]}),v&&(0,K.jsx)(W,{color:`error`,sx:{mb:2},children:v}),m&&(0,K.jsx)(U,{sx:{overflowX:`auto`,mt:2.5},children:(0,K.jsxs)(Te,{size:`small`,sx:{minWidth:300},children:[(0,K.jsx)(De,{children:(0,K.jsxs)(Oe,{children:[(0,K.jsx)(I,{sx:{bgcolor:`background.default`,borderBottom:2,borderColor:`divider`,fontWeight:600},children:`Y \\ X`}),m.x.map((e,t)=>(0,K.jsxs)(I,{sx:{bgcolor:`background.default`,borderBottom:2,borderColor:`divider`,fontWeight:600},children:[e.key,`:`,(0,K.jsx)(`br`,{}),e.value]},t))]})}),(0,K.jsx)(Ee,{children:m.y.map((e,t)=>(0,K.jsxs)(Oe,{children:[(0,K.jsxs)(I,{sx:{borderColor:`divider`,fontWeight:600},children:[e.key,`: `,e.value]}),m.x.map((e,n)=>(0,K.jsx)(I,{align:`center`,sx:{borderColor:`divider`,bgcolor:O(m.matrix[t][n],k),fontWeight:m.matrix[t][n]>0?600:`normal`},children:m.matrix[t][n]},n))]},t))})]})})]})}var ft=`nomarr:insights:accordion:`;function pt({storageKey:e,title:t,defaultExpanded:n=!0,children:r,secondary:i}){let a=`${ft}${e}`,[o,s]=(0,G.useState)(()=>{try{let e=localStorage.getItem(a);if(e!==null)return e===`true`}catch{}return n}),c=(0,G.useCallback)((e,t)=>{s(t);try{localStorage.setItem(a,String(t))}catch{}},[a]);return(0,G.useEffect)(()=>{let e=e=>{e.key===a&&e.newValue!==null&&s(e.newValue===`true`)};return window.addEventListener(`storage`,e),()=>window.removeEventListener(`storage`,e)},[a]),(0,K.jsxs)(xe,{expanded:o,onChange:c,children:[(0,K.jsxs)(Se,{expandIcon:(0,K.jsx)(we,{}),children:[(0,K.jsx)(W,{variant:`h6`,sx:{flexGrow:1},children:t}),i]}),(0,K.jsx)(Ce,{children:r})]})}function J({sectionId:e,title:t,defaultExpanded:n=!0,children:r,secondary:i}){return(0,K.jsx)(qe,{elevation:1,sx:{mb:2},children:(0,K.jsx)(pt,{storageKey:e,title:t,defaultExpanded:n,secondary:i,children:(0,K.jsx)(U,{sx:{px:1},children:r})})})}function mt({libraryId:e}){return(0,K.jsx)(J,{sectionId:`advanced`,title:`Advanced Analytics`,defaultExpanded:!1,children:(0,K.jsx)(dt,{libraryId:e})})}function ht(e){return z(`MuiBarElement`,e)}const gt=H(`MuiBarElement`,[`root`,`highlighted`,`faded`,`series`]),_t=e=>{let{classes:t,id:n,isHighlighted:r,isFaded:i}=e;return Ie({root:[`root`,`series-${n}`,r&&`highlighted`,i&&`faded`]},ht,t)};function vt(e){return z(`MuiBarLabel`,e)}const yt=H(`MuiBarLabel`,[`root`,`highlighted`,`faded`,`animate`]),bt=e=>{let{classes:t,seriesId:n,isFaded:r,isHighlighted:i,skipAnimation:a}=e;return Ie({root:[`root`,`series-${n}`,i&&`highlighted`,r&&`faded`,!a&&`animate`]},vt,t)};function xt(e){let{barLabel:t,value:n,dataIndex:r,seriesId:i,height:a,width:o}=e;return t===`value`?n?n?.toString():null:t({seriesId:i,dataIndex:r,value:n},{bar:{height:a,width:o}})}var St=[`seriesId`,`dataIndex`,`color`,`isFaded`,`isHighlighted`,`classes`,`skipAnimation`,`layout`,`xOrigin`,`yOrigin`,`placement`,`hidden`];const Ct=R(`text`,{name:`MuiBarLabel`,slot:`Root`,overridesResolver:(e,t)=>[{[`&.${yt.faded}`]:t.faded},{[`&.${yt.highlighted}`]:t.highlighted},t.root]})(({theme:e})=>B({},e?.typography?.body2,{stroke:`none`,fill:(e.vars||e)?.palette?.text?.primary,transitionProperty:`opacity, fill`,transitionDuration:`300ms`,transitionTimingFunction:me,pointerEvents:`none`}));function wt(e){let t=l({props:e,name:`MuiBarLabel`}),{isFaded:n,hidden:r}=t,i=L(t,St),a=st(t);return(0,K.jsx)(Ct,B({textAnchor:Tt(t),dominantBaseline:Et(t),opacity:r?0:n?.3:1},i,a))}function Tt({placement:e,layout:t,xOrigin:n,x:r}){return e===`outside`&&t===`horizontal`?r<n?`end`:`start`:`middle`}function Et({placement:e,layout:t,yOrigin:n,y:r}){return e===`outside`?t===`horizontal`?`central`:r<n?`auto`:`hanging`:`central`}var Dt=[`seriesId`,`classes`,`color`,`dataIndex`,`barLabel`,`slots`,`slotProps`,`xOrigin`,`yOrigin`,`x`,`y`,`width`,`height`,`value`,`skipAnimation`,`layout`,`barLabelPlacement`,`hidden`],Ot=[`ownerState`];function kt(t){let{seriesId:n,classes:r,color:i,dataIndex:a,barLabel:o,slots:s,slotProps:c,xOrigin:l,yOrigin:u,x:d,y:f,width:p,height:m,value:g,skipAnimation:_,layout:v,barLabelPlacement:y,hidden:b}=t,x=L(t,Dt),{isFaded:S,isHighlighted:C}=h({seriesId:n,dataIndex:a}),w={seriesId:n,classes:r,color:i,isFaded:S,isHighlighted:C,dataIndex:a,skipAnimation:_,layout:v},T=bt(w),E=s?.barLabel??wt,D=e({elementType:E,externalSlotProps:c?.barLabel,additionalProps:B({},x,{xOrigin:l,yOrigin:u,x:d,y:f,width:p,height:m,placement:y,className:T.root}),ownerState:w}),{ownerState:O}=D,k=L(D,Ot);if(!o)return null;let A=xt({barLabel:o,value:g,dataIndex:a,seriesId:n,height:m,width:p});return A?(0,K.jsx)(E,B({},k,O,{hidden:b,children:A})):null}var At=[`processedSeries`,`className`,`skipAnimation`];function jt(e){let{processedSeries:t,className:n,skipAnimation:r}=e,i=L(e,At),{seriesId:a,data:o,layout:s,xOrigin:c,yOrigin:l}=t,u=t.barLabel??e.barLabel;return u?(0,K.jsx)(`g`,{className:n,"data-series":a,children:o.map(({x:e,y:n,dataIndex:o,color:d,value:f,width:p,height:m,hidden:h})=>(0,K.jsx)(kt,B({seriesId:a,dataIndex:o,value:f,color:d,xOrigin:c,yOrigin:l,x:e,y:n,width:p,height:m,skipAnimation:r??!1,layout:s??`vertical`,hidden:h},i,{barLabel:u,barLabelPlacement:t.barLabelPlacement||`center`}),o))},a):null}var Y=(e,t)=>{let n=`${e}-axis`,r=`${e}Axis`;return t===(e===`x`?`DEFAULT_X_AXIS_KEY`:`DEFAULT_Y_AXIS_KEY`)?`The first \`${r}\``:`The ${n} with id "${t}"`};function Mt(e,t,n,r,i,a,o){let s=i[r],c=o[a],l=e?s:c,u=e?c:s,d=e?r:a,f=e?a:r,p=e?`x`:`y`,m=e?`y`:`x`;if(l.scaleType!==`band`)throw Error(`MUI X Charts: ${Y(p,d)} should be of type "band" to display the bar series of id "${t}".`);if(l.data===void 0)throw Error(`MUI X Charts: ${Y(p,d)} should have data property.`);if(u.scaleType===`band`||u.scaleType===`point`)throw Error(`MUI X Charts: ${Y(m,f)} should be a continuous type to display the bar series of id "${t}".`)}function Nt(e,t,n){let r=rt()??{series:{},stackingGroups:[],seriesOrder:[]},i=M().xAxisIds[0],a=D().yAxisIds[0];return Pt(e,v(),r.stackingGroups,r.series,t,n,i,a)}function Pt(e,t,n,r,i,a,o,s){let c={};return{completedData:n.flatMap(({ids:l},u)=>{let f=e.left,p=e.left+e.width,m=e.top,h=e.top+e.height,g=new Map,_=new Map;return l.map(e=>{let l=r[e].xAxisId??o,v=r[e].yAxisId??s,y=r[e].layout,b=i[l],x=a[v],S=r[e].layout===`vertical`,C=(S?x.reverse:b.reverse)??!1;Mt(S,e,r[e].stackedData.length,l,i,v,a);let w=S?b:x,T=b.scale,E=x.scale,D=Math.round(T(0)??0),O=Math.round(E(0)??0),k=d(r[e],i[l],a[v]),A=[];for(let i=0;i<w.data.length;i+=1){let a=ee({verticalLayout:S,xAxisConfig:b,yAxisConfig:x,series:r[e],dataIndex:i,numberOfGroups:n.length,groupIndex:u});if(a==null)continue;let o=r[e].stack,s=B({seriesId:e,dataIndex:i,hidden:r[e].hidden},a,{color:k(i),value:r[e].data[i],maskId:`${t}_${o||e}_${u}_${i}`});if(s.x>p||s.x+s.width<f||s.y>h||s.y+s.height<m)continue;let l=g.get(i),d=_.get(i),v=(C?-1:1)*Math.sign(s.value??0);v>0?(d&&delete d.borderRadiusSide,s.borderRadiusSide=S?`top`:`right`,_.set(i,s)):v<0&&(l&&delete l.borderRadiusSide,s.borderRadiusSide=S?`bottom`:`left`,g.set(i,s)),c[s.maskId]||(c[s.maskId]={id:s.maskId,width:0,height:0,hasNegative:!1,hasPositive:!1,layout:y,xOrigin:D,yOrigin:O,x:0,y:0});let w=c[s.maskId];w.width=y===`vertical`?s.width:w.width+s.width,w.height=y===`vertical`?w.height+s.height:s.height,w.x=Math.min(w.x===0?1/0:w.x,s.x),w.y=Math.min(w.y===0?1/0:w.y,s.y);let T=s.value??0;w.hasNegative=w.hasNegative||(C?T>0:T<0),w.hasPositive=w.hasPositive||(C?T<0:T>0),A.push(s)}return{seriesId:e,barLabel:r[e].barLabel,barLabelPlacement:r[e].barLabelPlacement,data:A,layout:y,xOrigin:D,yOrigin:O}})}),masksData:Object.values(c)}}function Ft(e){return z(`MuiBar`,e)}H(`MuiBar`,[`root`,`series`,`seriesLabels`]);const It=e=>Ie({root:[`root`],series:[`series`],seriesLabels:[`seriesLabels`]},Ft,e);var Lt=[`ownerState`,`skipAnimation`,`id`,`dataIndex`,`xOrigin`,`yOrigin`];function Rt(e){let{ownerState:t}=e,n=L(e,Lt),r=at(e);return(0,K.jsx)(`rect`,B({},n,{filter:t.isHighlighted?`brightness(120%)`:void 0,opacity:t.isFaded?.3:1,"data-highlighted":t.isHighlighted||void 0,"data-faded":t.isFaded||void 0},r))}function zt(e){return a().use(A,e)}var Bt=[`id`,`dataIndex`,`classes`,`color`,`slots`,`slotProps`,`style`,`onClick`,`skipAnimation`,`layout`,`x`,`xOrigin`,`y`,`yOrigin`,`width`,`height`,`hidden`];function Vt(t){let{id:n,dataIndex:r,classes:i,color:a,slots:o,slotProps:s,style:c,onClick:l,skipAnimation:u,layout:d,x:f,xOrigin:m,y:g,yOrigin:_,width:v,height:y,hidden:b}=t,x=L(t,Bt),S=G.useMemo(()=>({type:`bar`,seriesId:n,dataIndex:r}),[n,r]),C=p(S),{isFaded:w,isHighlighted:T}=h(S),E={id:n,dataIndex:r,classes:i,color:a,isFaded:w,isHighlighted:T,isFocused:zt(G.useMemo(()=>({type:`bar`,seriesId:n,dataIndex:r}),[n,r]))},D=_t(E),O=o?.bar??Rt;return(0,K.jsx)(O,B({},e({elementType:O,externalSlotProps:s?.bar,externalForwardedProps:x,additionalProps:B({},C,{id:n,dataIndex:r,color:a,x:f,xOrigin:m,y:g,yOrigin:_,width:v,height:y,style:c,onClick:l,cursor:l?`pointer`:`unset`,stroke:`none`,fill:a,skipAnimation:u,layout:d,hidden:b}),className:D.root,ownerState:E})))}function Ht(e,t){let n=i(e.x,t.x),r=i(e.y,t.y),a=i(e.width,t.width),o=i(e.height,t.height),s=i(e.borderRadius,t.borderRadius);return e=>({x:n(e),y:r(e),width:a(e),height:o(e),borderRadius:s(e)})}function Ut(e){let t={x:e.layout===`vertical`?e.x:e.xOrigin,y:e.layout===`vertical`?e.yOrigin:e.y,width:e.layout===`vertical`?e.width:0,height:e.layout===`vertical`?0:e.height,borderRadius:e.borderRadius};return he({x:e.x,y:e.y,width:e.width,height:e.height,borderRadius:e.borderRadius},{createInterpolator:Ht,transformProps:t=>({d:Gt(e.hasNegative,e.hasPositive,e.layout,t.x,t.y,t.width,t.height,e.xOrigin,e.yOrigin,t.borderRadius)}),applyProps(e,{d:t}){t&&e.setAttribute(`d`,t)},initialProps:t,skip:e.skipAnimation,ref:e.ref})}function Wt(e){let{maskId:t,x:n,y:r,width:i,height:a,skipAnimation:o}=e,{ref:s,d:c}=Ut({layout:e.layout??`vertical`,hasNegative:e.hasNegative,hasPositive:e.hasPositive,xOrigin:e.xOrigin,yOrigin:e.yOrigin,x:n,y:r,width:i,height:a,borderRadius:e.borderRadius??0,skipAnimation:o});return!e.borderRadius||e.borderRadius<=0?null:(0,K.jsx)(`clipPath`,{id:t,children:(0,K.jsx)(`path`,{ref:s,d:c})})}function Gt(e,t,n,r,i,a,o,s,c,l){if(n===`vertical`){if(t&&e){let e=Math.min(l,a/2,o/2);return`M${r},${i+o/2} v${-(o/2-e)} a${e},${e} 0 0 1 ${e},${-e} h${a-e*2} a${e},${e} 0 0 1 ${e},${e} v${o-2*e} a${e},${e} 0 0 1 ${-e},${e} h${-(a-e*2)} a${e},${e} 0 0 1 ${-e},${-e} v${-(o/2-e)}`}let n=Math.min(l,a/2);if(t)return`M${r},${Math.max(c,i+n)} v${Math.min(0,-(c-i-n))} a${n},${n} 0 0 1 ${n},${-n} h${a-n*2} a${n},${n} 0 0 1 ${n},${n} v${Math.max(0,c-i-n)} Z`;if(e)return`M${r},${Math.min(c,i+o-n)} v${Math.max(0,o-n)} a${n},${n} 0 0 0 ${n},${n} h${a-n*2} a${n},${n} 0 0 0 ${n},${-n} v${-Math.max(0,o-n)} Z`}if(n===`horizontal`){if(t&&e){let e=Math.min(l,a/2,o/2);return`M${r+a/2},${i} h${a/2-e} a${e},${e} 0 0 1 ${e},${e} v${o-e*2} a${e},${e} 0 0 1 ${-e},${e} h${-(a-2*e)} a${e},${e} 0 0 1 ${-e},${-e} v${-(o-e*2)} a${e},${e} 0 0 1 ${e},${-e} h${a/2-e}`}let n=Math.min(l,o/2);if(t)return`M${Math.min(s,r-n)},${i} h${a} a${n},${n} 0 0 1 ${n},${n} v${o-n*2} a${n},${n} 0 0 1 ${-n},${n} h${-a} Z`;if(e)return`M${Math.max(s,r+a+n)},${i} h${-a} a${n},${n} 0 0 0 ${-n},${n} v${o-n*2} a${n},${n} 0 0 0 ${n},${n} h${a} Z`}}var Kt=[`completedData`,`masksData`,`borderRadius`,`onItemClick`,`skipAnimation`];function qt(e){let{completedData:t,masksData:n,borderRadius:r,onItemClick:i,skipAnimation:a}=e,o=L(e,Kt),s=It(),c=!r||r<=0;return(0,K.jsxs)(G.Fragment,{children:[!c&&n.map(({id:e,x:t,y:n,xOrigin:i,yOrigin:o,width:s,height:c,hasPositive:l,hasNegative:u,layout:d})=>(0,K.jsx)(Wt,{maskId:e,borderRadius:r,hasNegative:u,hasPositive:l,layout:d,x:t,y:n,xOrigin:i,yOrigin:o,width:s,height:c,skipAnimation:a??!1},e)),t.map(({seriesId:e,layout:t,xOrigin:n,yOrigin:r,data:l})=>(0,K.jsx)(`g`,{"data-series":e,className:s.series,children:l.map(({dataIndex:s,color:l,maskId:u,x:d,y:f,width:p,height:m})=>{let h=(0,K.jsx)(Vt,B({id:e,dataIndex:s,color:l,skipAnimation:a??!1,layout:t??`vertical`,x:d,xOrigin:n,y:f,yOrigin:r,width:p,height:m},o,{onClick:i&&(t=>{i(t,{type:`bar`,seriesId:e,dataIndex:s})})}),s);return c?h:(0,K.jsx)(`g`,{clipPath:`url(#${u})`,children:h},s)})},e))]})}function Jt(e,t){return e.bandwidth()===0?Math.floor((t-Math.min(...e.range())+e.step()/2)/e.step()):Math.floor((t-Math.min(...e.range()))/e.step())}const Yt=f(E,y,c,function({axis:e,axisIds:t},{axis:n,axisIds:r},i,a){let{series:o,stackingGroups:s=[]}=i?.bar??{},c=t[0],l=r[0],d;for(let t=0;t<s.length;t+=1){let r=s[t].ids;for(let i of r){let r=(o??{})[i],f=r.xAxisId??c,p=r.yAxisId??l,m=e[f],h=n[p],g=r.layout===`horizontal`?h:m,_=r.layout===`horizontal`?m:h,v=g.scale,y=r.layout===`horizontal`?a.y:a.x;if(!ge(v))continue;let b=Jt(v,y),{barWidth:x,offset:S}=u(v.bandwidth(),s.length,g.barGapRatio),C=t*(x+S),w=g.data?.[b];if(w==null)continue;let T=v(w);if(T==null)continue;let E=T+C,D=E+x;if(y>=Math.min(E,D)&&y<=Math.max(E,D)){let e=r.layout===`horizontal`?a.x:a.y,t=r.visibleStackedData[b],n=_.scale(t[0]),o=_.scale(t[1]);if(n==null||o==null)continue;e>=Math.min(n,o)&&e<=Math.max(n,o)&&(d={seriesId:i,dataIndex:b})}}}if(d)return{type:`bar`,seriesId:d.seriesId,dataIndex:d.dataIndex}});function Xt(e){let{instance:t}=j(),n=N(),r=a();G.useEffect(()=>{let i=n.current;if(!i||!e)return;let a=null,o=function(n){let o=n;a&&Math.abs(n.clientX-a.clientX)<=1&&Math.abs(n.clientY-a.clientY)<=1&&(o={clientX:a.clientX,clientY:a.clientY}),a=null;let s=O(i,o);if(!t.isPointInside(s.x,s.y))return;let c=Yt(r.state,s);c&&e(n,{type:`bar`,seriesId:c.seriesId,dataIndex:c.dataIndex})},s=function(e){a=e};return i.addEventListener(`click`,o),i.addEventListener(`pointerup`,s),()=>{i.removeEventListener(`click`,o),i.removeEventListener(`pointerup`,s)}},[t,e,r,n])}function Zt(e,t,n){let r=e.get(t);return r?r.push(n):(r=[n],e.set(t,r)),r}var Qt=1e3;function $t(e,t,n,r,i,a,o,s){let c=Math.min(i,n/2,r/2),l=Math.min(a,n/2,r/2),u=Math.min(o,n/2,r/2),d=Math.min(s,n/2,r/2);return`M${e+c},${t}
   h${n-c-l}
   a${l},${l} 0 0 1 ${l},${l}
   v${r-l-u}
   a${u},${u} 0 0 1 -${u},${u}
   h-${n-u-d}
   a${d},${d} 0 0 1 -${d},-${d}
   v-${r-d-c}
   a${c},${c} 0 0 1 ${c},-${c}
   Z`}function en(e,t){return $t(e.x,e.y,e.width,e.height,e.borderRadiusSide===`left`||e.borderRadiusSide===`top`?t:0,e.borderRadiusSide===`right`||e.borderRadiusSide===`top`?t:0,e.borderRadiusSide===`right`||e.borderRadiusSide===`bottom`?t:0,e.borderRadiusSide===`left`||e.borderRadiusSide===`bottom`?t:0)}function tn(e,t){let n=new Map,r=new Map;for(let i=0;i<e.data.length;i+=1){let a=e.data[i],o=en(a,t),s=Zt(r,a.color,o);s.length>=Qt&&(Zt(n,a.color,s.join(``)),r.delete(a.color))}for(let[e,t]of r.entries())t.length>0&&Zt(n,e,t.join(``));return n}var nn=[`skipAnimation`,`layout`,`xOrigin`,`yOrigin`],rn=[`children`,`layout`,`xOrigin`,`yOrigin`],an=R(`g`)({'&[data-faded="true"]':{opacity:.3},"& path":{pointerEvents:`none`}});function on(e){let{skipAnimation:t,layout:n,xOrigin:r,yOrigin:i}=e,a=L(e,nn);return t?(0,K.jsx)(an,B({},a)):(0,K.jsx)(sn,B({},a,{layout:n,xOrigin:r,yOrigin:i}))}var X=R(`rect`)({"@keyframes scaleInX":{from:{transform:`scaleX(0)`},to:{transform:`scaleX(1)`}},"@keyframes scaleInY":{from:{transform:`scaleY(0)`},to:{transform:`scaleY(1)`}},animationDuration:`300ms`,animationFillMode:`forwards`,'&[data-orientation="horizontal"]':{animationName:`scaleInX`},'&[data-orientation="vertical"]':{animationName:`scaleInY`}});function sn(e){let{children:t,layout:n,xOrigin:r,yOrigin:i}=e,o=L(e,rn),s=a().use(ne),c=Ae(),l=[];return n===`horizontal`?(l.push((0,K.jsx)(X,{"data-orientation":`horizontal`,x:s.left,width:r-s.left,y:s.top,height:s.height,style:{transformOrigin:`${r}px ${s.top+s.height/2}px`}},`left`)),l.push((0,K.jsx)(X,{"data-orientation":`horizontal`,x:r,width:s.left+s.width-r,y:s.top,height:s.height,style:{transformOrigin:`${r}px ${s.top+s.height/2}px`}},`right`))):(l.push((0,K.jsx)(X,{"data-orientation":`vertical`,x:s.left,width:s.width,y:s.top,height:i-s.top,style:{transformOrigin:`${s.left+s.width/2}px ${i}px`}},`top`)),l.push((0,K.jsx)(X,{"data-orientation":`vertical`,x:s.left,width:s.width,y:i,height:s.top+s.height-i,style:{transformOrigin:`${s.left+s.width/2}px ${i}px`}},`bottom`))),(0,K.jsxs)(G.Fragment,{children:[(0,K.jsx)(`clipPath`,{id:c,children:l}),(0,K.jsx)(an,B({clipPath:`url(#${c})`},o,{children:t}))]})}function cn(e,t,n){let{instance:r}=j(),i=N(),o=a(),s=G.useRef(!1),c=G.useRef(void 0),l=Fe(()=>t?.()),u=Fe(()=>n?.());G.useEffect(()=>{let t=i.current;if(!t)return;function n(){s.current=!0}function a(){let e=c.current;e&&(c.current=void 0,r.removeTooltipItem(e),r.clearHighlight(),u())}function d(){s.current=!1,a()}let f=function(n){let i=O(t,n);if(!r.isPointInside(i.x,i.y)){a();return}let s=e(o.state,i);s?(r.setLastUpdateSource(`pointer`),r.setTooltipItem(s),r.setHighlight(s),l(),c.current=s):a()};return t.addEventListener(`pointerleave`,d),t.addEventListener(`pointermove`,f),t.addEventListener(`pointerenter`,n),()=>{t.removeEventListener(`pointerenter`,n),t.removeEventListener(`pointermove`,f),t.removeEventListener(`pointerleave`,d),s.current&&d()}},[e,r,l,u,o,i])}function ln({completedData:e,borderRadius:t=0,onItemClick:n,skipAnimation:r=!1}){let i=G.useRef(null),a=N();return cn(Yt,n?()=>{let e=a.current;e&&(i.current??(i.current=e.style.cursor,e.style.cursor=`pointer`))}:void 0,n?()=>{let e=a.current;e&&i.current!=null&&(e.style.cursor=i.current,i.current=null)}:void 0),Xt(n),(0,K.jsx)(G.Fragment,{children:e.map(e=>(0,K.jsx)(dn,{series:e,borderRadius:t,skipAnimation:r},e.seriesId))})}var un=G.memo(pn);function dn({series:e,borderRadius:t,skipAnimation:n}){let i=It(),{store:a}=j(),o=a.use(pe,e.seriesId),s=a.use(r,e.seriesId);return(0,K.jsxs)(G.Fragment,{children:[(0,K.jsx)(on,{className:i.series,"data-series":e.seriesId,layout:e.layout,xOrigin:e.xOrigin,yOrigin:e.yOrigin,skipAnimation:n,"data-faded":s||void 0,"data-highlighted":o||void 0,children:(0,K.jsx)(fn,{processedSeries:e,borderRadius:t})}),(0,K.jsx)(un,{processedSeries:e,borderRadius:t})]})}function fn({processedSeries:e,borderRadius:t}){let n=tn(e,t),r=[],i=0;for(let[e,t]of n.entries())for(let n of t)r.push((0,K.jsx)(`path`,{fill:e,d:n},i)),i+=1;return(0,K.jsx)(G.Fragment,{children:r})}function pn({processedSeries:e,borderRadius:t}){let{store:n}=j(),r=n.use(g,e.seriesId),i=n.use(s,e.seriesId),a=r==null?null:e.data.find(e=>e.dataIndex===r)||null,o=i==null?null:e.data.find(e=>e.dataIndex===i)||null,c=[];return a!=null&&c.push((0,K.jsx)(`path`,{fill:a.color,filter:`brightness(120%)`,"data-highlighted":!0,d:en(a,t)},`highlighted-${e.seriesId}`)),o!=null&&c.push((0,K.jsx)(`path`,{fill:o.color,d:en(o,t)},`unfaded-${o.seriesId}`)),(0,K.jsx)(G.Fragment,{children:c})}var mn=[`skipAnimation`,`onItemClick`,`borderRadius`,`barLabel`,`renderer`],hn=R(`g`,{name:`MuiBarPlot`,slot:`Root`})({[`& .${gt.root}`]:{transitionProperty:`opacity, fill`,transitionDuration:`300ms`,transitionTimingFunction:me}});function gn(e){let{skipAnimation:t,onItemClick:n,borderRadius:r,barLabel:i,renderer:a}=e,o=L(e,mn),s=S(Qe()||t),c=S(t),{xAxis:l}=M(),{yAxis:u}=D(),{completedData:d,masksData:f}=Nt(fe(),l,u),p=It(),m=a===`svg-batch`?ln:qt;return(0,K.jsxs)(hn,{className:p.root,children:[(0,K.jsx)(m,B({completedData:d,masksData:f,skipAnimation:a===`svg-batch`?c:s,onItemClick:n,borderRadius:r},o)),d.map(e=>(0,K.jsx)(jt,B({className:p.seriesLabels,processedSeries:e,skipAnimation:s,barLabel:i},o),e.seriesId))]})}const _n=[m,oe,de,ie,C,_,o,w];var vn=`xAxis.yAxis.series.width.height.margin.colors.dataset.sx.axisHighlight.grid.children.slots.slotProps.skipAnimation.loading.layout.onItemClick.highlightedItem.onHighlightChange.borderRadius.barLabel.className.hideLegend.showToolbar.brushConfig.renderer`.split(`.`);const yn=e=>{let{xAxis:t,yAxis:r,series:i,width:a,height:o,margin:s,colors:c,dataset:l,sx:u,axisHighlight:d,grid:f,children:p,slots:m,slotProps:h,skipAnimation:g,loading:_,layout:v,onItemClick:y,highlightedItem:b,onHighlightChange:x,borderRadius:S,barLabel:C,className:w,brushConfig:T,renderer:E}=e,D=L(e,vn),O=`${Ae()}-clip-path`,k=v===`horizontal`||v===void 0&&i.some(e=>e.layout===`horizontal`),A=G.useMemo(()=>[{id:n,scaleType:`band`,data:Array.from({length:Math.max(...i.map(e=>(e.data??l??[]).length))},(e,t)=>t)}],[l,i]),ee=G.useMemo(()=>[{id:te,scaleType:`band`,data:Array.from({length:Math.max(...i.map(e=>(e.data??l??[]).length))},(e,t)=>t)}],[l,i]),j=G.useMemo(()=>i.map(e=>B({type:`bar`},e,{layout:k?`horizontal`:`vertical`})),[k,i]),ne=k?void 0:A,re=G.useMemo(()=>t?k?t:t.map(e=>B({scaleType:`band`},e)):ne,[ne,k,t]),M=k?ee:void 0,ie=B({},D,{series:j,width:a,height:o,margin:s,colors:c,dataset:l,xAxis:re,yAxis:G.useMemo(()=>r?k?r.map(e=>B({scaleType:`band`},e)):r:M,[M,k,r]),highlightedItem:b,onHighlightChange:x,disableAxisListener:h?.tooltip?.trigger!==`axis`&&d?.x===`none`&&d?.y===`none`,className:w,skipAnimation:g,brushConfig:T,plugins:_n}),ae={onItemClick:y,slots:m,slotProps:h,borderRadius:S,renderer:E,barLabel:C},oe={vertical:f?.vertical,horizontal:f?.horizontal},se={clipPath:`url(#${O})`},N={id:O},ce={slots:m,slotProps:h,loading:_},le={slots:m,slotProps:h},ue=B({},k?{y:`band`}:{x:`band`},d),de={slots:m,slotProps:h};return{chartsWrapperProps:{sx:u,legendPosition:e.slotProps?.legend?.position,legendDirection:e.slotProps?.legend?.direction,hideLegend:e.hideLegend??!1},chartContainerProps:ie,barPlotProps:ae,gridProps:oe,clipPathProps:N,clipPathGroupProps:se,overlayProps:ce,chartsAxisProps:le,axisHighlightProps:ue,legendProps:de,children:p}};function bn(e){let t=Pe(),n=re(),r=rt(),{xAxis:i,xAxisIds:a}=M(),{yAxis:o,yAxisIds:s}=D();if(n===null||n.type!==`bar`||!r)return null;let c=r.series[n.seriesId];if(c.data[n.dataIndex]==null)return null;let l=c.xAxisId??a[0],u=c.yAxisId??s[0],d=i[l],f=o[u],p=r.series[n.seriesId].layout===`vertical`,m=r.stackingGroups.findIndex(e=>e.ids.includes(n.seriesId)),h=ee({verticalLayout:p,xAxisConfig:d,yAxisConfig:f,series:c,dataIndex:n.dataIndex,numberOfGroups:r.stackingGroups.length,groupIndex:m});if(h===null)return null;let{x:g,y:_,height:v,width:y}=h;return(0,K.jsx)(`rect`,B({fill:`none`,stroke:(t.vars??t).palette.text.primary,strokeWidth:2,x:g-3,y:_-3,width:y+6,height:v+6,rx:3,ry:3},e))}var xn=G.forwardRef(function(e,t){let n=l({props:e,name:`MuiBarChart`}),{chartsWrapperProps:r,chartContainerProps:i,barPlotProps:a,gridProps:o,clipPathProps:s,clipPathGroupProps:c,overlayProps:u,chartsAxisProps:d,axisHighlightProps:f,legendProps:p,children:m}=yn(n),{chartDataProviderProps:h,chartsSurfaceProps:g}=k(i,t),_=n.slots?.tooltip??le,v=n.slots?.toolbar;return(0,K.jsx)(ce,B({},h,{children:(0,K.jsxs)(ue,B({},r,{children:[n.showToolbar&&v?(0,K.jsx)(v,B({},n.slotProps?.toolbar)):null,!n.hideLegend&&(0,K.jsx)(se,B({},p)),(0,K.jsxs)(ae,B({},g,{children:[(0,K.jsx)(Ze,B({},o)),(0,K.jsxs)(`g`,B({},c,{children:[(0,K.jsx)(gn,B({},a)),(0,K.jsx)(b,B({},u)),(0,K.jsx)(Xe,B({},f)),(0,K.jsx)(bn,{})]})),(0,K.jsx)(Ye,B({},d)),(0,K.jsx)($e,B({},s)),m]})),!n.loading&&(0,K.jsx)(_,B({},n.slotProps?.tooltip))]}))}))});function Z({subsectionId:e,parentId:t,title:n,defaultExpanded:r=!0,children:i,secondary:a}){return(0,K.jsx)(U,{sx:{mb:1},children:(0,K.jsx)(pt,{storageKey:`${t}:${e}`,title:n,defaultExpanded:r,secondary:a,children:i})})}function Sn({distribution:e,parentId:t}){let{top_artists:n,others_count:r,total_artists:i}=e;if(n.length===0)return(0,K.jsx)(Z,{subsectionId:`artists`,parentId:t,title:`Artists`,children:(0,K.jsx)(W,{color:`text.secondary`,children:`No artist data available`})});let a=n.map(e=>e.artist),o=n.map(e=>e.count);return(0,K.jsxs)(Z,{subsectionId:`artists`,parentId:t,title:`Artists`,secondary:(0,K.jsxs)(W,{variant:`body2`,color:`text.secondary`,children:[i,` artists`]}),children:[(0,K.jsx)(xn,{height:300,xAxis:[{scaleType:`band`,data:a,tickLabelStyle:{angle:-45,textAnchor:`end`,fontSize:11}}],series:[{data:o}],margin:{left:50,right:20,top:20,bottom:80}}),r>0&&(0,K.jsxs)(W,{variant:`body2`,color:`text.secondary`,sx:{fontStyle:`italic`,mt:1},children:[`+ `,r,` tracks from `,i-n.length,` `,`other artists`]})]})}var Q=[`#2196f3`,`#4caf50`,`#ff9800`,`#e91e63`,`#9c27b0`,`#00bcd4`,`#ff5722`,`#795548`,`#607d8b`,`#3f51b5`,`#8bc34a`,`#ffc107`,`#673ab7`,`#009688`,`#f44336`,`#03a9f4`,`#cddc39`,`#ffeb3b`,`#9e9e9e`,`#ff4081`];function Cn({distribution:e,parentId:n}){let[r,i]=(0,G.useState)(new Set),{pieData:a,visibleCount:o,totalCount:s}=(0,G.useMemo)(()=>{let t=e.filter(e=>!r.has(e.genre));return{pieData:t.map((e,t)=>({id:e.genre,value:e.count,label:e.genre,color:Q[t%Q.length]})),visibleCount:t.length,totalCount:e.length}},[e,r]),c=e=>{i(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})};return e.length===0?(0,K.jsx)(Z,{subsectionId:`genres`,parentId:n,title:`Genres`,children:(0,K.jsx)(W,{color:`text.secondary`,children:`No genre data available`})}):(0,K.jsxs)(Z,{subsectionId:`genres`,parentId:n,title:`Genres`,secondary:(0,K.jsxs)(W,{variant:`body2`,color:`text.secondary`,children:[o,` of `,s,` genres shown`]}),children:[a.length>0?(0,K.jsx)(U,{sx:{height:350,mb:2},children:(0,K.jsx)(tt,{series:[{data:a,innerRadius:40,outerRadius:120,paddingAngle:1,cornerRadius:4,highlightScope:{highlight:`item`,fade:`global`}}],height:350,hideLegend:!0})}):(0,K.jsx)(W,{color:`text.secondary`,sx:{mb:2},children:`All genres hidden. Click chips below to show.`}),(0,K.jsx)(U,{sx:{mb:1},children:(0,K.jsxs)(t,{direction:`row`,spacing:1,sx:{mb:1},children:[(0,K.jsx)(P,{label:`Show All`,size:`small`,variant:`outlined`,onClick:()=>i(new Set),disabled:r.size===0}),(0,K.jsx)(P,{label:`Hide All`,size:`small`,variant:`outlined`,onClick:()=>i(new Set(e.map(e=>e.genre))),disabled:r.size===e.length})]})}),(0,K.jsx)(t,{direction:`row`,flexWrap:`wrap`,gap:.5,children:e.map((e,t)=>{let n=r.has(e.genre),i=Q[t%Q.length];return(0,K.jsx)(P,{label:`${e.genre} (${e.count})`,size:`small`,onClick:()=>c(e.genre),sx:{bgcolor:n?`transparent`:i,color:n?`text.secondary`:`#fff`,border:n?1:0,borderColor:`divider`,textDecoration:n?`line-through`:`none`,opacity:n?.6:1,"&:hover":{bgcolor:n?`action.hover`:i,opacity:1}}},e.genre)})})]})}function wn(e){let t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4);return t>0?`${t}h ${n}m`:`${n}m`}function Tn(e){return e>=0xe8d4a51000?`${(e/0xe8d4a51000).toFixed(1)} TB`:e>=1e9?`${(e/1e9).toFixed(1)} GB`:e>=1e6?`${(e/1e6).toFixed(1)} MB`:`${(e/1e3).toFixed(1)} KB`}function $({label:e,value:t}){return(0,K.jsxs)(U,{sx:{textAlign:`center`,py:1,flex:`1 1 25%`,minWidth:100},children:[(0,K.jsx)(W,{variant:`h5`,color:`primary`,children:t}),(0,K.jsx)(W,{variant:`body2`,color:`text.secondary`,children:e})]})}function En({stats:e,parentId:t}){return(0,K.jsx)(Z,{subsectionId:`stats`,parentId:t,title:`Library Statistics`,children:(0,K.jsxs)(U,{sx:{display:`flex`,flexWrap:`wrap`,gap:2},children:[(0,K.jsx)($,{label:`Tracks`,value:e.file_count.toLocaleString()}),(0,K.jsx)($,{label:`Total Duration`,value:wn(e.total_duration_ms)}),(0,K.jsx)($,{label:`Total Size`,value:Tn(e.total_file_size_bytes)}),(0,K.jsx)($,{label:`Avg Track`,value:wn(e.avg_track_length_ms)})]})})}function Dn({distribution:e,parentId:t}){let n=e.filter(e=>String(e.year)!==`1`).sort((e,t)=>Number(e.year)-Number(t.year));if(n.length===0)return(0,K.jsx)(Z,{subsectionId:`years`,parentId:t,title:`Years`,children:(0,K.jsx)(W,{color:`text.secondary`,children:`No year data available`})});let r=n.map(e=>String(e.year)),i=n.map(e=>e.count);return(0,K.jsx)(Z,{subsectionId:`years`,parentId:t,title:`Years`,secondary:(0,K.jsxs)(W,{variant:`body2`,color:`text.secondary`,children:[n.length,` years`]}),children:(0,K.jsx)(et,{height:250,xAxis:[{scaleType:`point`,data:r}],series:[{data:i,curve:`catmullRom`,showMark:!1}],margin:{left:50,right:20,top:20,bottom:30}})})}function On({libraryId:e}){let[t,n]=(0,G.useState)(null),[r,i]=(0,G.useState)(!0),[a,o]=(0,G.useState)(null);return(0,G.useEffect)(()=>{(async()=>{try{i(!0),o(null),n(await Me(e))}catch(e){o(e instanceof Error?e.message:`Failed to load collection overview`),console.error(`[CollectionOverview] Load error:`,e)}finally{i(!1)}})()},[e]),r?(0,K.jsx)(J,{sectionId:`collection-overview`,title:`Collection Overview`,children:(0,K.jsx)(Ge,{size:24})}):a||!t?(0,K.jsx)(J,{sectionId:`collection-overview`,title:`Collection Overview`,children:(0,K.jsx)(Ue,{severity:`error`,children:a||`Failed to load collection overview`})}):(0,K.jsxs)(J,{sectionId:`collection-overview`,title:`Collection Overview`,secondary:(0,K.jsxs)(W,{variant:`body2`,color:`text.secondary`,children:[t.stats.file_count.toLocaleString(),` tracks`]}),children:[(0,K.jsx)(En,{stats:t.stats,parentId:`collection-overview`}),(0,K.jsx)(Dn,{distribution:t.year_distribution,parentId:`collection-overview`}),(0,K.jsx)(Cn,{distribution:t.genre_distribution,parentId:`collection-overview`}),(0,K.jsx)(Sn,{distribution:t.artist_distribution,parentId:`collection-overview`})]})}function kn({value:e,onChange:t}){let[n,r]=(0,G.useState)([]),[i,a]=(0,G.useState)(!0);return(0,G.useEffect)(()=>{(async()=>{try{r(await Be(!0))}catch(e){console.error(`[LibraryFilter] Failed to load libraries:`,e)}finally{a(!1)}})()},[]),(0,K.jsxs)(_e,{size:`small`,sx:{minWidth:200},children:[(0,K.jsx)(ye,{id:`library-filter-label`,children:`Library`}),(0,K.jsxs)(ve,{labelId:`library-filter-label`,id:`library-filter`,value:e??``,label:`Library`,onChange:e=>{let n=e.target.value;t(n===``?void 0:n)},disabled:i,children:[(0,K.jsx)(F,{value:``,children:`All Libraries`}),n.map(e=>(0,K.jsx)(F,{value:e.library_id,children:e.name},e.library_id))]})]})}function An({vibes:e,parentId:t}){return e.length===0?(0,K.jsx)(Z,{subsectionId:`vibes`,parentId:t,title:`Dominant Vibes`,children:(0,K.jsx)(W,{color:`text.secondary`,children:`No mood data available`})}):(0,K.jsx)(Z,{subsectionId:`vibes`,parentId:t,title:`Dominant Vibes`,children:(0,K.jsx)(U,{sx:{display:`flex`,flexWrap:`wrap`,gap:2},children:e.map((e,t)=>(0,K.jsxs)(U,{sx:{textAlign:`center`,flex:`1 1 100px`,p:1,borderRadius:1,bgcolor:t===0?`primary.main`:`action.hover`,color:t===0?`primary.contrastText`:`text.primary`},children:[(0,K.jsxs)(W,{variant:`h6`,children:[e.percentage.toFixed(0),`%`]}),(0,K.jsx)(W,{variant:`body2`,sx:{textTransform:`capitalize`},children:e.mood})]},e.mood))})})}function jn({pairs:e,parentId:t,tierSelector:n}){return e.length===0?(0,K.jsx)(Z,{subsectionId:`combos`,parentId:t,title:`Mood Combos`,secondary:(0,K.jsx)(U,{sx:{display:`flex`,alignItems:`center`,gap:1},children:n}),children:(0,K.jsx)(W,{color:`text.secondary`,children:`No mood combinations found`})}):(0,K.jsx)(Z,{subsectionId:`combos`,parentId:t,title:`Mood Combos`,defaultExpanded:!1,secondary:(0,K.jsxs)(U,{sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,K.jsx)(W,{variant:`body2`,color:`text.secondary`,children:`Top pairs`}),n]}),children:(0,K.jsx)(U,{sx:{display:`flex`,flexWrap:`wrap`,gap:1},children:e.map((e,t)=>(0,K.jsx)(P,{label:(0,K.jsxs)(U,{sx:{display:`flex`,alignItems:`center`,gap:.5},children:[(0,K.jsx)(W,{variant:`body2`,component:`span`,sx:{textTransform:`capitalize`},children:e.mood1}),(0,K.jsx)(W,{variant:`body2`,component:`span`,color:`text.secondary`,children:`+`}),(0,K.jsx)(W,{variant:`body2`,component:`span`,sx:{textTransform:`capitalize`},children:e.mood2}),(0,K.jsxs)(W,{variant:`body2`,component:`span`,color:`text.secondary`,sx:{ml:.5},children:[`(`,e.count,`)`]})]}),variant:t<3?`filled`:`outlined`,color:t<3?`primary`:`default`,size:`small`},`${e.mood1}-${e.mood2}`))})})}var Mn={strict:`Strict`,regular:`Regular`,loose:`Loose`},Nn=[`strict`,`regular`,`loose`];function Pn({coverage:e,balance:t,parentId:n}){let r=Nn.filter(n=>n in e.tiers||n in t);return(0,K.jsx)(Z,{subsectionId:`coverage`,parentId:n,title:`Mood Coverage`,secondary:(0,K.jsxs)(W,{variant:`body2`,color:`text.secondary`,children:[e.total_files.toLocaleString(),` tracks`]}),children:(0,K.jsx)(U,{sx:{display:`flex`,gap:2,flexWrap:`wrap`,justifyContent:`center`},children:r.map(n=>{let r=e.tiers[n],i=(t[n]||[]).map((e,t)=>({id:t,value:e.count,label:e.mood}));return(0,K.jsxs)(U,{sx:{textAlign:`center`,minWidth:200},children:[(0,K.jsx)(W,{variant:`subtitle2`,children:Mn[n]||n}),r&&(0,K.jsxs)(W,{variant:`caption`,color:`text.secondary`,children:[r.tagged.toLocaleString(),` tagged (`,r.percentage.toFixed(1),`%)`]}),i.length>0?(0,K.jsx)(tt,{series:[{data:i,innerRadius:25,outerRadius:80,paddingAngle:1,cornerRadius:3}],height:200,width:250,hideLegend:!0}):(0,K.jsx)(W,{variant:`body2`,color:`text.secondary`,sx:{mt:2},children:`No data`})]},n)})})})}var Fn=[{value:`strict`,label:`Strict`},{value:`regular`,label:`Regular`},{value:`loose`,label:`Loose`}];function In({libraryId:e}){let[t,n]=(0,G.useState)(null),[r,i]=(0,G.useState)(!0),[a,o]=(0,G.useState)(null),[s,c]=(0,G.useState)(`strict`);return(0,G.useEffect)(()=>{(async()=>{try{i(!0),o(null),n(await Re(e,s))}catch(e){o(e instanceof Error?e.message:`Failed to load mood analysis`),console.error(`[MoodAnalysis] Load error:`,e)}finally{i(!1)}})()},[e,s]),r?(0,K.jsx)(J,{sectionId:`mood-analysis`,title:`Mood Analysis`,children:(0,K.jsx)(Ge,{size:24})}):a||!t?(0,K.jsx)(J,{sectionId:`mood-analysis`,title:`Mood Analysis`,children:(0,K.jsx)(Ue,{severity:`error`,children:a||`Failed to load mood analysis`})}):(0,K.jsxs)(J,{sectionId:`mood-analysis`,title:`Mood Analysis`,secondary:(0,K.jsxs)(W,{variant:`body2`,color:`text.secondary`,children:[(t.coverage.tiers.strict?.percentage??0).toFixed(0),`% strict coverage`]}),children:[(0,K.jsx)(Pn,{coverage:t.coverage,balance:t.balance,parentId:`mood-analysis`}),(0,K.jsx)(An,{vibes:t.dominant_vibes,parentId:`mood-analysis`}),(0,K.jsx)(jn,{pairs:t.top_pairs,parentId:`mood-analysis`,tierSelector:(0,K.jsxs)(_e,{size:`small`,sx:{minWidth:120},onClick:e=>e.stopPropagation(),children:[(0,K.jsx)(ye,{id:`mood-tier-label`,children:`Tier`}),(0,K.jsx)(ve,{labelId:`mood-tier-label`,id:`mood-tier-select`,value:s,label:`Tier`,onChange:e=>{c(e.target.value)},children:Fn.map(e=>(0,K.jsx)(F,{value:e.value,children:e.label},e.value))})]})})]})}function Ln(){let[e,n]=(0,G.useState)(void 0);return(0,K.jsxs)(t,{spacing:0,sx:{mt:2},children:[(0,K.jsx)(U,{sx:{mb:2},children:(0,K.jsx)(kn,{value:e,onChange:n})}),(0,K.jsx)(On,{libraryId:e}),(0,K.jsx)(In,{libraryId:e}),(0,K.jsx)(mt,{libraryId:e})]})}function Rn(){return(0,K.jsx)(Ne,{title:`Insights`,children:(0,K.jsx)(Ln,{})})}export{Rn as InsightsPage};