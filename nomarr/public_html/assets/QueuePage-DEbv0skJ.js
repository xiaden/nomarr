import{l as e,n as t,t as n,u as r}from"./ui-DMTNeb6j.js";import{h as i}from"./Grow-K3BNb4Vk.js";import{a,i as o,n as s,r as c,s as l,t as u}from"./ToggleButton-CAzIMUXN.js";import{t as d}from"./Chip-DH85oD94.js";import{E as f,I as p,J as m,K as h,T as g,Z as _,a as v,dt as y,j as b,k as x,n as S,o as C,pt as w,q as T,s as E,t as D}from"./index-Ck38l4oW.js";var O=w(y());function k(e){return O.Children.toArray(e).filter(e=>O.isValidElement(e))}function A(e){return T(`MuiToggleButtonGroup`,e)}var j=h(`MuiToggleButtonGroup`,[`root`,`selected`,`horizontal`,`vertical`,`disabled`,`grouped`,`groupedHorizontal`,`groupedVertical`,`fullWidth`,`firstButton`,`lastButton`,`middleButton`]),M=w(_()),N=e=>{let{classes:t,orientation:n,fullWidth:r,disabled:i}=e;return p({root:[`root`,n,r&&`fullWidth`],grouped:[`grouped`,`grouped${f(n)}`,i&&`disabled`],firstButton:[`firstButton`],lastButton:[`lastButton`],middleButton:[`middleButton`]},A,t)},P=b(`div`,{name:`MuiToggleButtonGroup`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${j.grouped}`]:t.grouped},{[`& .${j.grouped}`]:t[`grouped${f(n.orientation)}`]},{[`& .${j.firstButton}`]:t.firstButton},{[`& .${j.lastButton}`]:t.lastButton},{[`& .${j.middleButton}`]:t.middleButton},t.root,n.orientation===`vertical`&&t.vertical,n.fullWidth&&t.fullWidth]}})(g(({theme:e})=>({display:`inline-flex`,borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{orientation:`vertical`},style:{flexDirection:`column`,[`& .${j.grouped}`]:{[`&.${j.selected} + .${j.grouped}.${j.selected}`]:{borderTop:0,marginTop:0}},[`& .${j.firstButton},& .${j.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${j.lastButton},& .${j.middleButton}`]:{marginTop:-1,borderTop:`1px solid transparent`,borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${j.lastButton}.${o.disabled},& .${j.middleButton}.${o.disabled}`]:{borderTop:`1px solid transparent`}}},{props:{fullWidth:!0},style:{width:`100%`}},{props:{orientation:`horizontal`},style:{[`& .${j.grouped}`]:{[`&.${j.selected} + .${j.grouped}.${j.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${j.firstButton},& .${j.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${j.lastButton},& .${j.middleButton}`]:{marginLeft:-1,borderLeft:`1px solid transparent`,borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${j.lastButton}.${o.disabled},& .${j.middleButton}.${o.disabled}`]:{borderLeft:`1px solid transparent`}}}]}))),F=O.forwardRef(function(e,t){let n=x({props:e,name:`MuiToggleButtonGroup`}),{children:r,className:i,color:a=`standard`,disabled:o=!1,exclusive:l=!1,fullWidth:u=!1,onChange:d,orientation:f=`horizontal`,size:p=`medium`,value:h,...g}=n,_={...n,disabled:o,fullWidth:u,orientation:f,size:p},v=N(_),y=O.useCallback((e,t)=>{if(!d)return;let n=h&&h.indexOf(t),r;h&&n>=0?(r=h.slice(),r.splice(n,1)):r=h?h.concat(t):[t],d(e,r)},[d,h]),b=O.useCallback((e,t)=>{d&&d(e,h===t?null:t)},[d,h]),S=O.useMemo(()=>({className:v.grouped,onChange:l?b:y,value:h,size:p,fullWidth:u,color:a,disabled:o}),[v.grouped,l,b,y,h,p,u,a,o]),C=k(r),w=C.length,T=e=>{let t=e===0,n=e===w-1;return t&&n?``:t?v.firstButton:n?v.lastButton:v.middleButton};return(0,M.jsx)(P,{role:`group`,className:m(v.root,i),ref:t,ownerState:_,...g,children:(0,M.jsx)(c.Provider,{value:S,children:C.map((e,t)=>(0,M.jsx)(s.Provider,{value:T(t),children:e},t))})})}),I=i((0,M.jsx)(`path`,{d:`M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z`}),`Delete`),L=i((0,M.jsx)(`path`,{d:`M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z`}),`Refresh`);function R({statusFilter:t,onFilterChange:n,loading:i,actionLoading:a,summary:o,onRefresh:s,onClearCompleted:c,onClearErrors:l,onClearAll:d}){return(0,M.jsx)(e,{children:(0,M.jsxs)(r,{direction:`row`,spacing:2,alignItems:`center`,justifyContent:`space-between`,flexWrap:`wrap`,gap:2,children:[(0,M.jsx)(F,{value:t,exclusive:!0,onChange:(e,t)=>t&&n(t),size:`small`,disabled:i,children:[`all`,`pending`,`running`,`done`,`error`].map(e=>(0,M.jsx)(u,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),(0,M.jsxs)(r,{direction:`row`,spacing:1,children:[(0,M.jsx)(v,{onClick:s,disabled:i||a,variant:`outlined`,size:`small`,startIcon:(0,M.jsx)(L,{}),children:`Refresh`}),(0,M.jsx)(v,{onClick:c,disabled:i||a||o.completed===0,variant:`outlined`,size:`small`,children:`Clear Completed`}),(0,M.jsx)(v,{onClick:l,disabled:i||a||o.errors===0,variant:`outlined`,size:`small`,children:`Clear Errors`}),(0,M.jsx)(v,{onClick:d,disabled:i||a,variant:`outlined`,color:`error`,size:`small`,children:`Clear All`})]})]})})}function z({jobs:t,total:n,currentPage:i,totalPages:o,onRemoveJob:s,onNextPage:c,onPrevPage:u,statusFilter:f}){let p=e=>e?new Date(e*1e3).toLocaleString():`-`,m=(e,t=80)=>{if(e.length<=t)return e;let n=e.substring(0,40),r=e.substring(e.length-37);return n+`...`+r},h=e=>e===`running`?`warning`:e===`done`?`success`:e===`error`?`error`:`default`;return t.length===0&&n===0?(0,M.jsx)(e,{children:(0,M.jsx)(E,{color:`text.secondary`,textAlign:`center`,py:8,children:f===`all`?`Queue is empty`:`No ${f} jobs found`})}):(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(r,{spacing:1,children:t.map(e=>(0,M.jsxs)(C,{sx:{bgcolor:`background.paper`,border:1,borderColor:`divider`,borderRadius:1,p:2,display:`flex`,justifyContent:`space-between`,alignItems:`flex-start`},children:[(0,M.jsxs)(C,{sx:{flex:1,minWidth:0},children:[(0,M.jsxs)(r,{direction:`row`,spacing:1,alignItems:`center`,sx:{mb:1},children:[(0,M.jsxs)(E,{variant:`caption`,color:`text.disabled`,sx:{fontFamily:`monospace`},children:[`#`,e.id]}),(0,M.jsx)(d,{label:e.status,size:`small`,color:h(e.status),sx:{height:20,fontSize:`0.7rem`}})]}),(0,M.jsx)(a,{title:e.path,placement:`top`,children:(0,M.jsx)(E,{variant:`body2`,sx:{fontFamily:`monospace`,fontSize:`0.85rem`,mb:.5,wordBreak:`break-all`},children:m(e.path)})}),(0,M.jsxs)(r,{direction:`row`,spacing:2,sx:{mt:1},children:[(0,M.jsxs)(E,{variant:`caption`,color:`text.secondary`,children:[`Created: `,p(e.created_at)]}),e.started_at&&(0,M.jsxs)(E,{variant:`caption`,color:`text.secondary`,children:[`Started: `,p(e.started_at)]})]}),e.error_message&&(0,M.jsx)(E,{variant:`caption`,color:`error`,sx:{display:`block`,mt:1,p:1,bgcolor:`error.dark`,borderRadius:.5},children:e.error_message})]}),(0,M.jsx)(l,{onClick:()=>s(e.id),disabled:e.status===`running`,color:`error`,size:`small`,sx:{ml:2},children:(0,M.jsx)(I,{fontSize:`small`})})]},e.id))}),o>1&&(0,M.jsx)(C,{sx:{mt:3},children:(0,M.jsxs)(r,{direction:`row`,spacing:2,alignItems:`center`,justifyContent:`center`,children:[(0,M.jsx)(v,{variant:`outlined`,onClick:u,disabled:i===1,children:`Previous`}),(0,M.jsxs)(E,{color:`text.secondary`,children:[`Page `,i,` of `,o,` (`,n.toLocaleString(),` total)`]}),(0,M.jsx)(v,{variant:`outlined`,onClick:c,disabled:i===o,children:`Next`})]})})]})}function B({summary:t,connected:n}){return(0,M.jsxs)(e,{children:[(0,M.jsxs)(r,{direction:`row`,spacing:1,alignItems:`center`,sx:{mb:2},children:[(0,M.jsx)(E,{variant:`body2`,color:`text.secondary`,children:`SSE Status:`}),(0,M.jsx)(d,{label:n?`Connected`:`Disconnected`,size:`small`,color:n?`success`:`error`,sx:{height:20,fontSize:`0.7rem`}})]}),(0,M.jsxs)(r,{direction:`row`,spacing:2,flexWrap:`wrap`,children:[(0,M.jsxs)(C,{sx:{display:`flex`,flexDirection:`column`,alignItems:`center`,p:2,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minWidth:100},children:[(0,M.jsx)(E,{variant:`h4`,fontWeight:`bold`,children:t.pending}),(0,M.jsx)(E,{variant:`caption`,color:`text.secondary`,children:`Pending`})]}),(0,M.jsxs)(C,{sx:{display:`flex`,flexDirection:`column`,alignItems:`center`,p:2,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minWidth:100},children:[(0,M.jsx)(E,{variant:`h4`,fontWeight:`bold`,children:t.running}),(0,M.jsx)(E,{variant:`caption`,color:`text.secondary`,children:`Running`})]}),(0,M.jsxs)(C,{sx:{display:`flex`,flexDirection:`column`,alignItems:`center`,p:2,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minWidth:100},children:[(0,M.jsx)(E,{variant:`h4`,fontWeight:`bold`,children:t.completed}),(0,M.jsx)(E,{variant:`caption`,color:`text.secondary`,children:`Completed`})]}),(0,M.jsxs)(C,{sx:{display:`flex`,flexDirection:`column`,alignItems:`center`,p:2,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minWidth:100},children:[(0,M.jsx)(E,{variant:`h4`,fontWeight:`bold`,children:t.errors}),(0,M.jsx)(E,{variant:`caption`,color:`text.secondary`,children:`Errors`})]})]})]})}function V(){let[e,t]=(0,O.useState)([]),[n,r]=(0,O.useState)({pending:0,running:0,completed:0,errors:0}),[i,a]=(0,O.useState)(0),[o,s]=(0,O.useState)(!0),[c,l]=(0,O.useState)(null),[u,d]=(0,O.useState)(!1),[f,p]=(0,O.useState)(`all`),[m]=(0,O.useState)(50),[h,g]=(0,O.useState)(0),_=Math.floor(h/m)+1,v=Math.ceil(i/m),y=async()=>{try{s(!0),l(null);let e={limit:m,offset:h};f!==`all`&&(e.status=f);let n=await S.queue.listJobs(e);t(n.jobs),a(n.total),r(await S.queue.getStatus())}catch(e){l(e instanceof Error?e.message:`Failed to load queue`),console.error(`[Queue] Load error:`,e)}finally{s(!1)}};(0,O.useEffect)(()=>{y()},[f,h]);let{connected:b}=D({onMessage:e=>{try{let t=JSON.parse(e.data);t.topic===`queue:status`&&t.state&&(r({pending:t.state.pending||0,running:t.state.running||0,completed:t.state.completed||0,errors:t.state.errors||0}),console.log(`[Queue] SSE: Updated summary from event`,t.state)),t.topic===`queue:jobs`&&!o&&(console.log(`[Queue] SSE: Job update, reloading job list`),y())}catch(e){console.warn(`[Queue] Failed to parse SSE message:`,e)}}});return{jobs:e,summary:n,total:i,loading:o,error:c,actionLoading:u,connected:b,statusFilter:f,currentPage:_,totalPages:v,loadQueue:y,removeJob:async e=>{if(confirm(`Remove job ${e}?`))try{d(!0),await S.queue.removeJobs({job_id:e}),await y()}catch(e){alert(e instanceof Error?e.message:`Failed to remove job`)}finally{d(!1)}},clearCompleted:async()=>{if(confirm(`Clear all completed jobs?`))try{d(!0);let e=await S.queue.clearCompleted();alert(`Removed ${e.removed} completed job(s)`),await y()}catch(e){alert(e instanceof Error?e.message:`Failed to clear completed`)}finally{d(!1)}},clearErrors:async()=>{if(confirm(`Clear all error jobs?`))try{d(!0);let e=await S.queue.clearErrors();alert(`Removed ${e.removed} error job(s)`),await y()}catch(e){alert(e instanceof Error?e.message:`Failed to clear errors`)}finally{d(!1)}},clearAll:async()=>{if(confirm(`Clear ALL jobs (except running)?`))try{d(!0);let e=await S.queue.clearAll();alert(`Removed ${e.removed} job(s)`),await y()}catch(e){alert(e instanceof Error?e.message:`Failed to clear all`)}finally{d(!1)}},handleFilterChange:e=>{p(e),g(0)},nextPage:()=>{_<v&&g(h+m)},prevPage:()=>{_>1&&g(Math.max(0,h-m))}}}function H(){let{jobs:e,summary:r,total:i,loading:a,error:o,actionLoading:s,connected:c,statusFilter:l,currentPage:u,totalPages:d,loadQueue:f,removeJob:p,clearCompleted:m,clearErrors:h,clearAll:g,handleFilterChange:_,nextPage:v,prevPage:y}=V();return(0,M.jsxs)(t,{title:`Queue Management`,children:[(0,M.jsx)(B,{summary:r,connected:c}),(0,M.jsx)(R,{statusFilter:l,onFilterChange:_,loading:a,actionLoading:s,summary:r,onRefresh:f,onClearCompleted:m,onClearErrors:h,onClearAll:g}),a&&(0,M.jsx)(E,{textAlign:`center`,py:5,color:`text.secondary`,children:`Loading queue...`}),o&&(0,M.jsx)(n,{children:o}),!a&&!o&&(0,M.jsx)(z,{jobs:e,total:i,currentPage:u,totalPages:d,onRemoveJob:p,onNextPage:v,onPrevPage:y,statusFilter:l})]})}export{H as QueuePage};