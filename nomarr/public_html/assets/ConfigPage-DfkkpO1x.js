import{t as e}from"./Stack-BtQgkU3W.js";import{n as t,t as n}from"./TextField-DY6xt5mA.js";import"./Portal-D6vP4qC-.js";import{t as r}from"./MenuItem-CNYjiSpW.js";import{Ft as i,Lt as a,_ as o,d as s,f as c,g as l,n as u,xt as d,y as f}from"./index-DjY4hVv8.js";var p=a(d(),1);function m({configKey:e,value:i,onChange:a,disabled:s}){let c=i==null?``:String(i);return(0,p.jsxs)(o,{sx:{display:`grid`,gap:1},children:[(0,p.jsx)(f,{variant:`body2`,color:`text.secondary`,sx:{fontWeight:`bold`},children:e}),(0,p.jsx)(o,{sx:{display:`flex`,gap:1.25,alignItems:`center`},children:typeof i==`boolean`?(0,p.jsxs)(t,{value:c,onChange:t=>a(e,t.target.value),disabled:s,size:`small`,fullWidth:!0,children:[(0,p.jsx)(r,{value:`true`,children:`true`}),(0,p.jsx)(r,{value:`false`,children:`false`})]}):(0,p.jsx)(n,{type:`text`,value:c,onChange:t=>a(e,t.target.value),disabled:s,size:`small`,fullWidth:!0})})]})}function h({config:t,hasChanges:n,saveLoading:r,onChange:i,onSaveAll:a}){return(0,p.jsxs)(c,{children:[(0,p.jsx)(s,{title:`Settings`}),(0,p.jsx)(f,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Changes are saved to the database and will take effect on server restart. Use "Restart Server" in Admin page to apply changes.`}),(0,p.jsx)(e,{spacing:1.875,children:Object.entries(t).map(([e,t])=>(0,p.jsx)(m,{configKey:e,value:t,onChange:i,disabled:r},e))}),(0,p.jsxs)(o,{sx:{mt:3.75,display:`flex`,gap:1.25,alignItems:`center`},children:[(0,p.jsx)(l,{onClick:a,variant:`contained`,disabled:!n||r,sx:{whiteSpace:`nowrap`},children:r?`Saving...`:`Save All Changes`}),n&&(0,p.jsx)(f,{variant:`body2`,color:`warning.main`,children:`Unsaved changes`})]})]})}var g=a(i(),1);function _(){let[e,t]=(0,g.useState)({}),[n,r]=(0,g.useState)({}),[i,a]=(0,g.useState)(!0),[o,s]=(0,g.useState)(null),[c,l]=(0,g.useState)(!1),[d,f]=(0,g.useState)(!1),p=async()=>{try{a(!0),s(null);let e=await u.config.get();t(e),r(e),f(!1)}catch(e){s(e instanceof Error?e.message:`Failed to load config`),console.error(`[Config] Load error:`,e)}finally{a(!1)}};return(0,g.useEffect)(()=>{p()},[]),(0,g.useEffect)(()=>{f(Object.keys(e).some(t=>e[t]!==n[t]))},[e,n]),{config:e,loading:i,error:o,saveLoading:c,hasChanges:d,handleSaveAll:async()=>{try{l(!0);let t=[];for(let r of Object.keys(e))if(e[r]!==n[r]){let n=e[r];if(n==null||n===``)continue;await u.config.update(r,String(n)),t.push(r)}if(t.length===0){alert(`No changes to save`);return}alert(`Saved ${t.length} config change(s). Use "Restart Server" in Admin page to apply.`),await p()}catch(e){alert(e instanceof Error?e.message:`Failed to save config`)}finally{l(!1)}},handleChange:(e,n)=>{t(t=>({...t,[e]:n}))}}}function v(){let{config:e,loading:t,error:n,saveLoading:r,hasChanges:i,handleSaveAll:a,handleChange:o}=_();return(0,p.jsxs)(`div`,{style:{padding:`20px`},children:[(0,p.jsx)(`h1`,{style:{marginBottom:`20px`},children:`Configuration`}),t&&(0,p.jsx)(`p`,{children:`Loading configuration...`}),n&&(0,p.jsxs)(`p`,{style:{color:`var(--accent-red)`},children:[`Error: `,n]}),!t&&!n&&(0,p.jsx)(`div`,{style:{display:`grid`,gap:`20px`},children:(0,p.jsx)(h,{config:e,hasChanges:i,saveLoading:r,onChange:o,onSaveAll:a})})]})}export{v as ConfigPage};