import{c as e,l as t,n,r,t as i,u as a}from"./ui-0x0XinP6.js";import{t as o}from"./TextField-RhsmfodV.js";import"./Grow-BleD-8bo.js";import{t as s}from"./TableCell-C1oxeEqY.js";import{i as c,n as l,r as u,t as d}from"./TableRow-8WmbevDu.js";import{Z as f,a as p,dt as m,n as h,o as g,pt as _,s as v}from"./index-ByHFyLQZ.js";var y=_(m(),1),b=_(f(),1);function x({preview:n,configText:r,loading:f,error:m,onLoadPreview:h,onGenerateConfig:_}){return(0,b.jsxs)(a,{spacing:2.5,children:[(0,b.jsxs)(t,{children:[(0,b.jsx)(e,{title:`Navidrome TOML Configuration`}),(0,b.jsxs)(a,{spacing:1.25,children:[(0,b.jsx)(p,{onClick:h,disabled:f,variant:`contained`,fullWidth:!0,children:f?`Loading...`:`Load Tag Preview`}),(0,b.jsx)(p,{onClick:_,disabled:f,variant:`contained`,fullWidth:!0,children:f?`Generating...`:`Generate Config`})]}),m&&(0,b.jsxs)(i,{children:[`Error: `,m]})]}),n&&(0,b.jsxs)(t,{children:[(0,b.jsx)(e,{title:`Tag Preview`}),(0,b.jsx)(g,{sx:{overflowX:`auto`},children:(0,b.jsxs)(c,{children:[(0,b.jsx)(l,{children:(0,b.jsxs)(d,{children:[(0,b.jsx)(s,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Tag`}),(0,b.jsx)(s,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Type`}),(0,b.jsx)(s,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Multivalue`}),(0,b.jsx)(s,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Count`}),(0,b.jsx)(s,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Summary`})]})}),(0,b.jsx)(u,{children:n.map(e=>(0,b.jsxs)(d,{children:[(0,b.jsx)(s,{sx:{borderColor:`divider`},children:e.tag_key}),(0,b.jsx)(s,{sx:{borderColor:`divider`},children:e.type}),(0,b.jsx)(s,{sx:{borderColor:`divider`},children:e.is_multivalue?`Yes`:`No`}),(0,b.jsx)(s,{sx:{borderColor:`divider`},children:e.total_count}),(0,b.jsx)(s,{sx:{borderColor:`divider`},children:e.summary})]},e.tag_key))})]})})]}),r&&(0,b.jsxs)(t,{children:[(0,b.jsx)(e,{title:`Generated Config`}),(0,b.jsx)(o,{multiline:!0,rows:20,value:r,fullWidth:!0,InputProps:{readOnly:!0,sx:{fontFamily:`monospace`,fontSize:`0.875rem`}}}),(0,b.jsx)(p,{onClick:()=>{r&&(navigator.clipboard.writeText(r),alert(`Copied to clipboard!`))},variant:`contained`,sx:{mt:1.25},children:`Copy to Clipboard`})]})]})}function S({query:n,name:r,comment:s,limit:c,sort:l,preview:u,content:d,loading:f,error:m,onQueryChange:h,onNameChange:_,onCommentChange:y,onLimitChange:x,onSortChange:S,onPreview:C,onGenerate:w}){return(0,b.jsxs)(a,{spacing:2.5,children:[(0,b.jsxs)(t,{children:[(0,b.jsx)(e,{title:`Smart Playlist Generator`}),(0,b.jsx)(g,{component:`form`,onSubmit:C,children:(0,b.jsxs)(a,{spacing:2,children:[(0,b.jsxs)(g,{children:[(0,b.jsx)(v,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Query *`}),(0,b.jsx)(o,{value:n,onChange:e=>h(e.target.value),placeholder:`e.g., tag:nom_happy > 0.8`,multiline:!0,rows:3,disabled:f,required:!0,fullWidth:!0,InputProps:{sx:{fontFamily:`monospace`,fontSize:`0.875rem`}}})]}),(0,b.jsxs)(g,{children:[(0,b.jsx)(v,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Playlist Name *`}),(0,b.jsx)(o,{value:r,onChange:e=>_(e.target.value),disabled:f,required:!0,fullWidth:!0})]}),(0,b.jsxs)(g,{children:[(0,b.jsx)(v,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Comment`}),(0,b.jsx)(o,{value:s,onChange:e=>y(e.target.value),disabled:f,fullWidth:!0})]}),(0,b.jsxs)(g,{sx:{display:`grid`,gridTemplateColumns:`1fr 1fr`,gap:1.25},children:[(0,b.jsxs)(g,{children:[(0,b.jsx)(v,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Limit`}),(0,b.jsx)(o,{type:`number`,value:c??``,onChange:e=>x(e.target.value?parseInt(e.target.value):void 0),disabled:f,placeholder:`Optional`,fullWidth:!0})]}),(0,b.jsxs)(g,{children:[(0,b.jsx)(v,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Sort`}),(0,b.jsx)(o,{value:l,onChange:e=>S(e.target.value),disabled:f,placeholder:`Optional`,fullWidth:!0})]})]}),(0,b.jsxs)(a,{direction:`row`,spacing:1.25,children:[(0,b.jsx)(p,{type:`submit`,variant:`contained`,disabled:f,fullWidth:!0,children:f?`Loading...`:`Preview Query`}),(0,b.jsx)(p,{type:`button`,onClick:w,variant:`contained`,disabled:f,fullWidth:!0,children:f?`Generating...`:`Generate .nsp`})]})]})}),m&&(0,b.jsxs)(i,{children:[`Error: `,m]})]}),u&&(0,b.jsxs)(t,{children:[(0,b.jsx)(e,{title:`Query Preview`}),(0,b.jsx)(g,{component:`pre`,sx:{p:2,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,overflow:`auto`,fontSize:`0.875rem`,fontFamily:`monospace`},children:JSON.stringify(u,null,2)})]}),d&&(0,b.jsxs)(t,{children:[(0,b.jsx)(e,{title:`Generated Playlist (.nsp)`}),(0,b.jsx)(o,{multiline:!0,rows:15,value:d,fullWidth:!0,InputProps:{readOnly:!0,sx:{fontFamily:`monospace`,fontSize:`0.875rem`}}}),(0,b.jsx)(p,{onClick:()=>{if(d){let e=new Blob([d],{type:`text/plain`}),t=URL.createObjectURL(e),n=document.createElement(`a`);n.href=t,n.download=`${r}.nsp`,n.click(),URL.revokeObjectURL(t)}},variant:`contained`,sx:{mt:1.25},children:`Download .nsp File`})]})]})}function C(){let[e,t]=(0,y.useState)(null),[n,r]=(0,y.useState)(null),[i,a]=(0,y.useState)(!1),[o,s]=(0,y.useState)(null),[c,l]=(0,y.useState)(``),[u,d]=(0,y.useState)(`My Playlist`),[f,p]=(0,y.useState)(``),[m,g]=(0,y.useState)(void 0),[_,v]=(0,y.useState)(``),[b,x]=(0,y.useState)(null),[S,C]=(0,y.useState)(null),[w,T]=(0,y.useState)(!1),[E,D]=(0,y.useState)(null);return{configPreview:e,configText:n,configLoading:i,configError:o,playlistQuery:c,playlistName:u,playlistComment:f,playlistLimit:m,playlistSort:_,playlistPreview:b,playlistContent:S,playlistLoading:w,playlistError:E,loadConfigPreview:async()=>{try{a(!0),s(null),t((await h.navidrome.getPreview()).tags)}catch(e){s(e instanceof Error?e.message:`Failed to load preview`)}finally{a(!1)}},generateConfig:async()=>{try{a(!0),s(null),r((await h.navidrome.getConfig()).config)}catch(e){s(e instanceof Error?e.message:`Failed to generate config`)}finally{a(!1)}},previewPlaylist:async e=>{if(e.preventDefault(),c.trim())try{T(!0),D(null),x(await h.navidrome.previewPlaylist(c,10))}catch(e){D(e instanceof Error?e.message:`Failed to preview playlist`)}finally{T(!1)}},generatePlaylist:async()=>{if(!c.trim()){alert(`Query is required`);return}if(!u.trim()){alert(`Playlist name is required`);return}try{T(!0),D(null),C((await h.navidrome.generatePlaylist({query:c,playlist_name:u,comment:f,limit:m,sort:_||void 0})).content)}catch(e){D(e instanceof Error?e.message:`Failed to generate playlist`)}finally{T(!1)}},setPlaylistQuery:l,setPlaylistName:d,setPlaylistComment:p,setPlaylistLimit:g,setPlaylistSort:v}}function w(){let[e,t]=(0,y.useState)(`config`),{configPreview:i,configText:a,configLoading:o,configError:s,playlistQuery:c,playlistName:l,playlistComment:u,playlistLimit:d,playlistSort:f,playlistPreview:p,playlistContent:m,playlistLoading:h,playlistError:g,loadConfigPreview:_,generateConfig:v,previewPlaylist:w,generatePlaylist:T,setPlaylistQuery:E,setPlaylistName:D,setPlaylistComment:O,setPlaylistLimit:k,setPlaylistSort:A}=C();return(0,b.jsxs)(n,{title:`Navidrome Integration`,children:[(0,b.jsx)(r,{tabs:[{id:`config`,label:`Config Generator`},{id:`playlist`,label:`Playlist Generator`}],activeTab:e,onTabChange:e=>t(e)}),e===`config`&&(0,b.jsx)(x,{preview:i,configText:a,loading:o,error:s,onLoadPreview:_,onGenerateConfig:v}),e===`playlist`&&(0,b.jsx)(S,{query:c,name:l,comment:u,limit:d,sort:f,preview:p,content:m,loading:h,error:g,onQueryChange:E,onNameChange:D,onCommentChange:O,onLimitChange:k,onSortChange:A,onPreview:w,onGenerate:T})]})}export{w as NavidromePage};