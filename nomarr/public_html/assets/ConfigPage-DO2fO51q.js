import{t as e}from"./Stack-cFD0omJI.js";import"./List-BM9fqlhn.js";import{a as t,c as n,i as r,n as i,o as a,r as o,s,t as c}from"./TextField-IkNHReuh.js";import{t as l}from"./Popper-uAzt09Bx.js";import{n as u,t as d}from"./MenuItem-Ds9NRi4o.js";import"./listItemTextClasses-BK8pU73n.js";import{Ct as f,D as p,G as m,H as h,It as g,Kt as _,Lt as v,Nt as ee,Q as y,Qt as b,Rt as x,Sn as S,Ut as C,Vt as te,W as ne,Wt as w,Xt as T,Z as E,_ as D,_t as O,a as k,an as A,at as j,b as M,ct as N,dn as re,et as ie,f as ae,ft as P,h as oe,ht as se,it as F,jt as ce,kt as le,mt as I,o as ue,on as L,p as de,pt as R,sn as z,st as fe,ut as B,v as pe,wn as V,wt as me,x as he,y as ge}from"./index-wZ24p6BA.js";import{t as _e}from"./useConfirmDialog-CWeYYVXl.js";import{t as ve}from"./ServerFilePicker-Cy-B0sNA.js";import{t as H}from"./useNotification-CHyOsPIB.js";function ye(e){return L(`PrivateSwitchBase`,e)}A(`PrivateSwitchBase`,[`root`,`checked`,`disabled`,`input`,`edgeStart`,`edgeEnd`]);var U=V(S()),W=V(re()),G=e=>{let{classes:t,checked:n,disabled:r,edge:i}=e;return T({root:[`root`,n&&`checked`,r&&`disabled`,i&&`edge${x(i)}`],input:[`input`]},ye,t)},K=C(I,{name:`MuiSwitchBase`})({padding:9,borderRadius:`50%`,variants:[{props:{edge:`start`,size:`small`},style:{marginLeft:-3}},{props:({edge:e,ownerState:t})=>e===`start`&&t.size!==`small`,style:{marginLeft:-12}},{props:{edge:`end`,size:`small`},style:{marginRight:-3}},{props:({edge:e,ownerState:t})=>e===`end`&&t.size!==`small`,style:{marginRight:-12}}]}),q=C(`input`,{name:`MuiSwitchBase`,shouldForwardProp:w})({cursor:`inherit`,position:`absolute`,opacity:0,width:`100%`,height:`100%`,top:0,left:0,margin:0,padding:0,zIndex:1}),J=U.forwardRef(function(e,r){let{autoFocus:i,checked:a,checkedIcon:o,defaultChecked:s,disabled:c,disableFocusRipple:l=!1,edge:u=!1,icon:d,id:f,inputProps:p,inputRef:m,name:h,onBlur:g,onChange:_,onFocus:v,readOnly:ee,required:y=!1,tabIndex:b,type:x,value:S,slots:C={},slotProps:te={},...ne}=e,[w,T]=n({controlled:a,default:!!s,name:`SwitchBase`,state:`checked`}),E=t(),D=e=>{v&&v(e),E&&E.onFocus&&E.onFocus(e)},k=e=>{g&&g(e),E&&E.onBlur&&E.onBlur(e)},A=e=>{if(e.nativeEvent.defaultPrevented||ee)return;let t=e.target.checked;T(t),_&&_(e,t)},j=c;E&&j===void 0&&(j=E.disabled);let M=x===`checkbox`||x===`radio`,N={...e,checked:w,disabled:j,disableFocusRipple:l,edge:u},re=G(N),ie={slots:C,slotProps:{input:p,...te}},[ae,P]=O(`root`,{ref:r,elementType:K,className:re.root,shouldForwardComponentProp:!0,externalForwardedProps:{...ie,component:`span`,...ne},getSlotProps:e=>({...e,onFocus:t=>{e.onFocus?.(t),D(t)},onBlur:t=>{e.onBlur?.(t),k(t)}}),ownerState:N,additionalProps:{centerRipple:!0,focusRipple:!l,disabled:j,role:void 0,tabIndex:null}}),[oe,se]=O(`input`,{ref:m,elementType:q,className:re.input,externalForwardedProps:ie,getSlotProps:e=>({...e,onChange:t=>{e.onChange?.(t),A(t)}}),ownerState:N,additionalProps:{autoFocus:i,checked:a,defaultChecked:s,disabled:j,id:M?f:void 0,name:h,readOnly:ee,required:y,tabIndex:b,type:x,...x===`checkbox`&&S===void 0?{}:{value:S}}});return(0,W.jsxs)(ae,{...P,children:[(0,W.jsx)(oe,{...se}),w?o:d]})}),be=g((0,W.jsx)(`path`,{d:`M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z`}),`CheckBoxOutlineBlank`),Y=g((0,W.jsx)(`path`,{d:`M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z`}),`CheckBox`),xe=g((0,W.jsx)(`path`,{d:`M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z`}),`IndeterminateCheckBox`);function Se(e){return L(`MuiCheckbox`,e)}var Ce=A(`MuiCheckbox`,[`root`,`checked`,`disabled`,`indeterminate`,`colorPrimary`,`colorSecondary`,`sizeSmall`,`sizeMedium`]),we=e=>{let{classes:t,indeterminate:n,color:r,size:i}=e,a=T({root:[`root`,n&&`indeterminate`,`color${x(r)}`,`size${x(i)}`]},Se,t);return{...t,...a}},Te=C(J,{shouldForwardProp:e=>w(e)||e===`classes`,name:`MuiCheckbox`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${x(n.size)}`],n.color!==`default`&&t[`color${x(n.color)}`]]}})(v(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:`default`,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(R()).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(R()).map(([t])=>({props:{color:t},style:{[`&.${Ce.checked}, &.${Ce.indeterminate}`]:{color:(e.vars||e).palette[t].main},[`&.${Ce.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:`transparent`}}}}]}))),Ee=(0,W.jsx)(Y,{}),De=(0,W.jsx)(be,{}),Oe=(0,W.jsx)(xe,{}),ke=U.forwardRef(function(e,t){let n=te({props:e,name:`MuiCheckbox`}),{checkedIcon:r=Ee,color:i=`primary`,icon:a=De,indeterminate:o=!1,indeterminateIcon:c=Oe,inputProps:l,size:u=`medium`,disableRipple:d=!1,className:f,slots:p={},slotProps:m={},...h}=n,g=o?c:a,_=o?c:r,v={...n,disableRipple:d,color:i,indeterminate:o,size:u},ee=we(v),y=m.input??l,[b,x]=O(`root`,{ref:t,elementType:Te,className:z(ee.root,f),shouldForwardComponentProp:!0,externalForwardedProps:{slots:p,slotProps:m,...h},ownerState:v,additionalProps:{type:`checkbox`,icon:U.cloneElement(g,{fontSize:g.props.fontSize??u}),checkedIcon:U.cloneElement(_,{fontSize:_.props.fontSize??u}),disableRipple:d,slots:p,slotProps:{input:s(typeof y==`function`?y(v):y,{"data-indeterminate":o})}}});return(0,W.jsx)(b,{...x,classes:ee})});function Ae(e){return L(`MuiFormControlLabel`,e)}var X=A(`MuiFormControlLabel`,[`root`,`labelPlacementStart`,`labelPlacementTop`,`labelPlacementBottom`,`disabled`,`label`,`error`,`required`,`asterisk`]),Z=e=>{let{classes:t,disabled:n,labelPlacement:r,error:i,required:a}=e;return T({root:[`root`,n&&`disabled`,`labelPlacement${x(r)}`,i&&`error`,a&&`required`],label:[`label`,n&&`disabled`],asterisk:[`asterisk`,i&&`error`]},Ae,t)};const je=C(`label`,{name:`MuiFormControlLabel`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${X.label}`]:t.label},t.root,t[`labelPlacement${x(n.labelPlacement)}`]]}})(v(({theme:e})=>({display:`inline-flex`,alignItems:`center`,cursor:`pointer`,verticalAlign:`middle`,WebkitTapHighlightColor:`transparent`,marginLeft:-11,marginRight:16,[`&.${X.disabled}`]:{cursor:`default`},[`& .${X.label}`]:{[`&.${X.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:`start`},style:{flexDirection:`row-reverse`,marginRight:-11}},{props:{labelPlacement:`top`},style:{flexDirection:`column-reverse`}},{props:{labelPlacement:`bottom`},style:{flexDirection:`column`}},{props:({labelPlacement:e})=>e===`start`||e===`top`||e===`bottom`,style:{marginLeft:16}}]})));var Q=C(`span`,{name:`MuiFormControlLabel`,slot:`Asterisk`})(v(({theme:e})=>({[`&.${X.error}`]:{color:(e.vars||e).palette.error.main}}))),Me=U.forwardRef(function(e,n){let r=te({props:e,name:`MuiFormControlLabel`}),{checked:i,className:o,componentsProps:s={},control:c,disabled:l,disableTypography:u,inputRef:d,label:f,labelPlacement:p=`end`,name:m,onChange:h,required:g,slots:_={},slotProps:v={},value:ee,...y}=r,b=t(),x=l??c.props.disabled??b?.disabled,S=g??c.props.required,C={disabled:x,required:S};[`checked`,`name`,`onChange`,`value`,`inputRef`].forEach(e=>{c.props[e]===void 0&&r[e]!==void 0&&(C[e]=r[e])});let ne=a({props:r,muiFormControl:b,states:[`error`]}),w={...r,disabled:x,labelPlacement:p,required:S,error:ne.error},T=Z(w),[E,D]=O(`typography`,{elementType:N,externalForwardedProps:{slots:_,slotProps:{...s,...v}},ownerState:w}),k=f;return k!=null&&k.type!==N&&!u&&(k=(0,W.jsx)(E,{component:`span`,...D,className:z(T.label,D?.className),children:k})),(0,W.jsxs)(je,{className:z(T.root,o),ownerState:w,ref:n,...y,children:[U.cloneElement(c,C),S?(0,W.jsxs)(`div`,{children:[k,(0,W.jsxs)(Q,{ownerState:w,"aria-hidden":!0,className:T.asterisk,children:[` `,`*`]})]}):k]})});function Ne(e){return L(`MuiTooltip`,e)}var $=A(`MuiTooltip`,[`popper`,`popperInteractive`,`popperArrow`,`popperClose`,`tooltip`,`tooltipArrow`,`touch`,`tooltipPlacementLeft`,`tooltipPlacementRight`,`tooltipPlacementTop`,`tooltipPlacementBottom`,`arrow`]);function Pe(e){return Math.round(e*1e5)/1e5}var Fe=e=>{let{classes:t,disableInteractive:n,arrow:r,touch:i,placement:a}=e;return T({popper:[`popper`,!n&&`popperInteractive`,r&&`popperArrow`],tooltip:[`tooltip`,r&&`tooltipArrow`,i&&`touch`,`tooltipPlacement${x(a.split(`-`)[0])}`],arrow:[`arrow`]},Ne,t)},Ie=C(l,{name:`MuiTooltip`,slot:`Popper`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.popper,!n.disableInteractive&&t.popperInteractive,n.arrow&&t.popperArrow,!n.open&&t.popperClose]}})(v(({theme:e})=>({zIndex:(e.vars||e).zIndex.tooltip,pointerEvents:`none`,variants:[{props:({ownerState:e})=>!e.disableInteractive,style:{pointerEvents:`auto`}},{props:({open:e})=>!e,style:{pointerEvents:`none`}},{props:({ownerState:e})=>e.arrow,style:{[`&[data-popper-placement*="bottom"] .${$.arrow}`]:{top:0,marginTop:`-0.71em`,"&::before":{transformOrigin:`0 100%`}},[`&[data-popper-placement*="top"] .${$.arrow}`]:{bottom:0,marginBottom:`-0.71em`,"&::before":{transformOrigin:`100% 0`}},[`&[data-popper-placement*="right"] .${$.arrow}`]:{height:`1em`,width:`0.71em`,"&::before":{transformOrigin:`100% 100%`}},[`&[data-popper-placement*="left"] .${$.arrow}`]:{height:`1em`,width:`0.71em`,"&::before":{transformOrigin:`0 0`}}}},{props:({ownerState:e})=>e.arrow&&!e.isRtl,style:{[`&[data-popper-placement*="right"] .${$.arrow}`]:{left:0,marginLeft:`-0.71em`}}},{props:({ownerState:e})=>e.arrow&&!!e.isRtl,style:{[`&[data-popper-placement*="right"] .${$.arrow}`]:{right:0,marginRight:`-0.71em`}}},{props:({ownerState:e})=>e.arrow&&!e.isRtl,style:{[`&[data-popper-placement*="left"] .${$.arrow}`]:{right:0,marginRight:`-0.71em`}}},{props:({ownerState:e})=>e.arrow&&!!e.isRtl,style:{[`&[data-popper-placement*="left"] .${$.arrow}`]:{left:0,marginLeft:`-0.71em`}}}]}))),Le=C(`div`,{name:`MuiTooltip`,slot:`Tooltip`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.tooltip,n.touch&&t.touch,n.arrow&&t.tooltipArrow,t[`tooltipPlacement${x(n.placement.split(`-`)[0])}`]]}})(v(({theme:e})=>({backgroundColor:e.vars?e.vars.palette.Tooltip.bg:e.alpha(e.palette.grey[700],.92),borderRadius:(e.vars||e).shape.borderRadius,color:(e.vars||e).palette.common.white,fontFamily:e.typography.fontFamily,padding:`4px 8px`,fontSize:e.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:`break-word`,fontWeight:e.typography.fontWeightMedium,[`.${$.popper}[data-popper-placement*="left"] &`]:{transformOrigin:`right center`},[`.${$.popper}[data-popper-placement*="right"] &`]:{transformOrigin:`left center`},[`.${$.popper}[data-popper-placement*="top"] &`]:{transformOrigin:`center bottom`,marginBottom:`14px`},[`.${$.popper}[data-popper-placement*="bottom"] &`]:{transformOrigin:`center top`,marginTop:`14px`},variants:[{props:({ownerState:e})=>e.arrow,style:{position:`relative`,margin:0}},{props:({ownerState:e})=>e.touch,style:{padding:`8px 16px`,fontSize:e.typography.pxToRem(14),lineHeight:`${Pe(16/14)}em`,fontWeight:e.typography.fontWeightRegular}},{props:({ownerState:e})=>!e.isRtl,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginRight:`14px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginLeft:`14px`}}},{props:({ownerState:e})=>!e.isRtl&&e.touch,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginRight:`24px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginLeft:`24px`}}},{props:({ownerState:e})=>!!e.isRtl,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginLeft:`14px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginRight:`14px`}}},{props:({ownerState:e})=>!!e.isRtl&&e.touch,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginLeft:`24px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginRight:`24px`}}},{props:({ownerState:e})=>e.touch,style:{[`.${$.popper}[data-popper-placement*="top"] &`]:{marginBottom:`24px`}}},{props:({ownerState:e})=>e.touch,style:{[`.${$.popper}[data-popper-placement*="bottom"] &`]:{marginTop:`24px`}}}]}))),Re=C(`span`,{name:`MuiTooltip`,slot:`Arrow`})(v(({theme:e})=>({overflow:`hidden`,position:`absolute`,width:`1em`,height:`0.71em`,boxSizing:`border-box`,color:e.vars?e.vars.palette.Tooltip.bg:e.alpha(e.palette.grey[700],.9),"&::before":{content:`""`,margin:`auto`,display:`block`,width:`100%`,height:`100%`,backgroundColor:`currentColor`,transform:`rotate(45deg)`}}))),ze=!1,Be=new f,Ve={x:0,y:0};function He(e,t){return(n,...r)=>{t&&t(n,...r),e(n,...r)}}var Ue=U.forwardRef(function(e,t){let r=te({props:e,name:`MuiTooltip`}),{arrow:i=!1,children:a,classes:o,components:s={},componentsProps:c={},describeChild:u=!1,disableFocusListener:d=!1,disableHoverListener:f=!1,disableInteractive:p=!1,disableTouchListener:m=!1,enterDelay:h=100,enterNextDelay:g=0,enterTouchDelay:v=700,followCursor:y=!1,id:x,leaveDelay:S=0,leaveTouchDelay:C=1500,onClose:ne,onOpen:w,open:T,placement:E=`bottom`,PopperComponent:D,PopperProps:k={},slotProps:A={},slots:j={},title:M,TransitionComponent:N,TransitionProps:re,...ae}=r,P=U.isValidElement(a)?a:(0,W.jsx)(`span`,{children:a}),oe=_(),F=b(),[I,ue]=U.useState(),[L,de]=U.useState(null),R=U.useRef(!1),B=p||y,pe=me(),V=me(),he=me(),ge=me(),[_e,ve]=n({controlled:T,default:!1,name:`Tooltip`,state:`open`}),H=_e,ye=ee(x),G=U.useRef(),K=ce(()=>{G.current!==void 0&&(document.body.style.WebkitUserSelect=G.current,G.current=void 0),ge.clear()});U.useEffect(()=>K,[K]);let q=e=>{Be.clear(),ze=!0,ve(!0),w&&!H&&w(e)},J=ce(e=>{Be.start(800+S,()=>{ze=!1}),ve(!1),ne&&H&&ne(e),pe.start(oe.transitions.duration.shortest,()=>{R.current=!1})}),be=e=>{R.current&&e.type!==`touchstart`||(I&&I.removeAttribute(`title`),V.clear(),he.clear(),h||ze&&g?V.start(ze?g:h,()=>{q(e)}):q(e))},Y=e=>{V.clear(),he.start(S,()=>{J(e)})},[,xe]=U.useState(!1),Se=e=>{se(e.target)||(xe(!1),Y(e))},Ce=e=>{I||ue(e.currentTarget),se(e.target)&&(xe(!0),be(e))},we=e=>{R.current=!0;let t=P.props;t.onTouchStart&&t.onTouchStart(e)},Te=e=>{we(e),he.clear(),pe.clear(),K(),G.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect=`none`,ge.start(v,()=>{document.body.style.WebkitUserSelect=G.current,be(e)})},Ee=e=>{P.props.onTouchEnd&&P.props.onTouchEnd(e),K(),he.start(C,()=>{J(e)})};U.useEffect(()=>{if(!H)return;function e(e){e.key===`Escape`&&J(e)}return document.addEventListener(`keydown`,e),()=>{document.removeEventListener(`keydown`,e)}},[J,H]);let De=le(fe(P),ue,t);!M&&M!==0&&(H=!1);let Oe=U.useRef(),ke=e=>{let t=P.props;t.onMouseMove&&t.onMouseMove(e),Ve={x:e.clientX,y:e.clientY},Oe.current&&Oe.current.update()},Ae={},X=typeof M==`string`;u?(Ae.title=!H&&X&&!f?M:null,Ae[`aria-describedby`]=H?ye:null):(Ae[`aria-label`]=X?M:null,Ae[`aria-labelledby`]=H&&!X?ye:null);let Z={...Ae,...ae,...P.props,className:z(ae.className,P.props.className),onTouchStart:we,ref:De,...y?{onMouseMove:ke}:{}},je={};m||(Z.onTouchStart=Te,Z.onTouchEnd=Ee),f||(Z.onMouseOver=He(be,Z.onMouseOver),Z.onMouseLeave=He(Y,Z.onMouseLeave),B||(je.onMouseOver=be,je.onMouseLeave=Y)),d||(Z.onFocus=He(Ce,Z.onFocus),Z.onBlur=He(Se,Z.onBlur),B||(je.onFocus=Ce,je.onBlur=Se));let Q={...r,isRtl:F,arrow:i,disableInteractive:B,placement:E,PopperComponentProp:D,touch:R.current},Me=typeof A.popper==`function`?A.popper(Q):A.popper,Ne=U.useMemo(()=>{let e=[{name:`arrow`,enabled:!!L,options:{element:L,padding:4}}];return k.popperOptions?.modifiers&&(e=e.concat(k.popperOptions.modifiers)),Me?.popperOptions?.modifiers&&(e=e.concat(Me.popperOptions.modifiers)),{...k.popperOptions,...Me?.popperOptions,modifiers:e}},[L,k.popperOptions,Me?.popperOptions]),$=Fe(Q),Pe=typeof A.transition==`function`?A.transition(Q):A.transition,Ue={slots:{popper:s.Popper,transition:s.Transition??N,tooltip:s.Tooltip,arrow:s.Arrow,...j},slotProps:{arrow:A.arrow??c.arrow,popper:{...k,...Me??c.popper},tooltip:A.tooltip??c.tooltip,transition:{...re,...Pe??c.transition}}},[We,Ge]=O(`popper`,{elementType:Ie,externalForwardedProps:Ue,ownerState:Q,className:z($.popper,k?.className)}),[Ke,qe]=O(`transition`,{elementType:ie,externalForwardedProps:Ue,ownerState:Q}),[Je,Ye]=O(`tooltip`,{elementType:Le,className:$.tooltip,externalForwardedProps:Ue,ownerState:Q}),[Xe,Ze]=O(`arrow`,{elementType:Re,className:$.arrow,externalForwardedProps:Ue,ownerState:Q,ref:de});return(0,W.jsxs)(U.Fragment,{children:[U.cloneElement(P,Z),(0,W.jsx)(We,{as:D??l,placement:E,anchorEl:y?{getBoundingClientRect:()=>({top:Ve.y,left:Ve.x,right:Ve.x,bottom:Ve.y,width:0,height:0})}:I,popperRef:Oe,open:I?H:!1,id:ye,transition:!0,...je,...Ge,popperOptions:Ne,children:({TransitionProps:e})=>(0,W.jsx)(Ke,{timeout:oe.transitions.duration.shorter,...e,...qe,children:(0,W.jsxs)(Je,{...Ye,children:[M,i?(0,W.jsx)(Xe,{...Ze}):null]})})})]})});function We(){let{showSuccess:t}=H(),{confirm:n,isOpen:a,options:s,handleConfirm:l,handleCancel:f}=_e(),[m,g]=(0,U.useState)([]),[_,v]=(0,U.useState)(!0),[ee,b]=(0,U.useState)(null),[x,S]=(0,U.useState)(!1),[C,te]=(0,U.useState)(null),[w,T]=(0,U.useState)(null),[O,A]=(0,U.useState)(null),[re,ie]=(0,U.useState)(``),[P,se]=(0,U.useState)(``),[ce,le]=(0,U.useState)(!0),[I,ue]=(0,U.useState)(`off`),[L,R]=(0,U.useState)(`full`),[z,fe]=(0,U.useState)(!1),[B,V]=(0,U.useState)(null),[me,ye]=(0,U.useState)({}),[G,K]=(0,U.useState)(`full`),q=(0,U.useCallback)(async()=>{try{v(!0),b(null),g(await D())}catch(e){b(e instanceof Error?e.message:`Failed to load libraries`),console.error(`[LibraryManagement] Load error:`,e)}finally{v(!1)}},[]),J=(0,U.useCallback)(async()=>{try{let e=await D();g(t=>{if(t.length!==e.length)return e;let n=new Map(e.map(e=>[e.library_id,e])),r=!1;for(let e of t){let t=n.get(e.library_id);if(!t){r=!0;break}if(e.scanStatus!==t.scanStatus||e.scanProgress!==t.scanProgress||e.scanTotal!==t.scanTotal||e.scanError!==t.scanError||e.scannedAt!==t.scannedAt||e.fileCount!==t.fileCount||e.folderCount!==t.folderCount){r=!0;break}}return r?t.map(e=>{let t=n.get(e.library_id);return!t||e.scanStatus===t.scanStatus&&e.scanProgress===t.scanProgress&&e.scanTotal===t.scanTotal&&e.scanError===t.scanError&&e.scannedAt===t.scannedAt&&e.fileCount===t.fileCount&&e.folderCount===t.folderCount?e:t}):t})}catch(e){console.error(`[LibraryManagement] Refresh error:`,e)}},[]),be=async()=>{try{A((await k()).library_root||null)}catch(e){console.error(`[LibraryManagement] Failed to load config:`,e)}};(0,U.useEffect)(()=>{q(),be()},[q]),(0,U.useEffect)(()=>{let e=!0,t=null,n=async()=>{try{let n=await p();if(!e)return;n.is_busy?t||=setInterval(()=>{J()},500):t&&(clearInterval(t),t=null,J())}catch(e){console.error(`[LibraryManagement] Failed to check work status:`,e)}};n();let r=setInterval(n,5e3);return()=>{e=!1,t&&clearInterval(t),clearInterval(r)}},[J]);let Y=e=>{if(!O)return!1;let t=O.replace(/\/+$/,``);return!e.replace(/\/+$/,``).startsWith(t)},xe=()=>{ie(``),se(``),le(!0),ue(`off`),R(`full`),K(`full`),fe(!1),S(!1),te(null)},Se=()=>{xe(),S(!0)},Ce=e=>{ie(e.name),se(e.rootPath),le(e.isEnabled),ue(e.watchMode),R(e.fileWriteMode),K(e.fileWriteMode),te(e.library_id),S(!1)},we=async()=>{if(!P.trim()){b(`Path is required`);return}try{b(null),await ae({name:re.trim()||null,rootPath:P,isEnabled:ce,watchMode:I,fileWriteMode:L}),await q(),xe()}catch(e){b(e instanceof Error?e.message:`Failed to create library`)}},Te=async()=>{if(C===null)return;if(!P.trim()){b(`Path is required`);return}let e=L!==G;try{if(b(null),await M(C,{name:re.trim()||void 0,rootPath:P,isEnabled:ce,watchMode:I,...e?{}:{fileWriteMode:L}}),e){let e=await he(C,L);e.requires_reconciliation&&e.affected_file_count>0&&await n({title:`Reconcile Tags?`,message:`${e.affected_file_count} files need to be rewritten with the new tag format. Reconcile now?`,severity:`info`})&&await Q(C)}await q(),xe()}catch(e){b(e instanceof Error?e.message:`Failed to update library`)}},Ee=async(e,n)=>{try{b(null),T(e);let r=await ge(e,n);t(r.message||`Library scan started (${r.stats?.files_queued??0} files)`),await q()}catch(e){b(e instanceof Error?e.message:`Failed to scan library`)}finally{T(null)}},De=async(e,t)=>{if(await n({title:`Delete Library?`,message:`Delete library "${t}"?\n\nThis will remove the library entry but will NOT delete files on disk.`,severity:`warning`}))try{b(null),await de(e),await q()}catch(e){b(e instanceof Error?e.message:`Failed to delete library`)}},Oe=async(e,n)=>{try{b(null),await M(e,{watchMode:n}),await q(),t(`File watching mode changed to ${n}`)}catch(e){b(e instanceof Error?e.message:`Failed to change watch mode`)}},Ae=e=>{switch(e){case`event`:return`Event`;case`poll`:return`Poll`;default:return`Off`}},X=e=>{switch(e){case`event`:return`success`;case`poll`:return`warning`;default:return`default`}},Z=e=>{switch(e){case`none`:return`None`;case`minimal`:return`Minimal`;case`full`:return`Full`}},je=e=>{switch(e){case`none`:return`default`;case`minimal`:return`secondary`;case`full`:return`primary`}},Q=async e=>{try{b(null),V(e);let n=await pe(e);t(`Reconciled ${n.processed} files (${n.remaining} remaining, ${n.failed} failed)`);let r=await oe(e);ye(t=>({...t,[e]:{pending:r.pending_count,inProgress:r.in_progress}}))}catch(e){b(e instanceof Error?e.message:`Failed to reconcile tags`)}finally{V(null)}},Ne=async e=>{try{let t=await oe(e);ye(n=>({...n,[e]:{pending:t.pending_count,inProgress:t.in_progress}}))}catch{}},$=x||C!==null;return(0,W.jsxs)(e,{spacing:2.5,children:[(0,W.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`center`,children:[(0,W.jsx)(N,{variant:`h5`,children:`Libraries`}),!$&&(0,W.jsx)(F,{variant:`contained`,onClick:Se,children:`+ Add Library`})]}),ee&&(0,W.jsx)(ne,{children:ee}),$&&(0,W.jsxs)(y,{children:[(0,W.jsx)(E,{title:x?`Create Library`:`Edit Library`}),(0,W.jsxs)(e,{spacing:2,children:[(0,W.jsxs)(j,{children:[(0,W.jsx)(N,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Name (optional)`}),(0,W.jsx)(c,{value:re,onChange:e=>ie(e.target.value),placeholder:`Auto-generated from path if left empty`,fullWidth:!0})]}),(0,W.jsxs)(j,{children:[(0,W.jsx)(N,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Root Path`}),(0,W.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,W.jsx)(c,{value:P,onChange:e=>se(e.target.value),placeholder:`/music`,fullWidth:!0}),(0,W.jsx)(F,{variant:`outlined`,onClick:()=>fe(!z),sx:{minWidth:120},children:z?`Hide Picker`:`Browse...`})]}),z&&(0,W.jsx)(j,{sx:{mt:1.25,p:2,bgcolor:`background.default`,borderRadius:1,border:1,borderColor:`divider`},children:(0,W.jsx)(ve,{value:P,onChange:e=>{se(e),fe(!1)},mode:`directory`,label:`Select Library Root Directory`})})]}),(0,W.jsx)(Me,{control:(0,W.jsx)(ke,{checked:ce,onChange:e=>le(e.target.checked)}),label:`Enabled`}),(0,W.jsx)(j,{children:(0,W.jsxs)(r,{fullWidth:!0,children:[(0,W.jsx)(o,{id:`watch-mode-label`,children:`File Watching`}),(0,W.jsxs)(i,{labelId:`watch-mode-label`,value:I,label:`File Watching`,onChange:e=>ue(e.target.value),children:[(0,W.jsx)(d,{value:`off`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(N,{children:[(0,W.jsx)(`strong`,{children:`Off`}),` - No automatic scanning`]}),(0,W.jsx)(N,{variant:`caption`,color:`text.secondary`,children:`Manual scans only`})]})}),(0,W.jsx)(d,{value:`event`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(N,{children:[(0,W.jsx)(`strong`,{children:`Event`}),` - Real-time file watching`]}),(0,W.jsx)(N,{variant:`caption`,color:`text.secondary`,children:`Fast (2-5s response), local filesystems only`})]})}),(0,W.jsx)(d,{value:`poll`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(N,{children:[(0,W.jsx)(`strong`,{children:`Poll`}),` - Periodic scanning`]}),(0,W.jsx)(N,{variant:`caption`,color:`text.secondary`,children:`Slower (60s interval), network-mount-safe`})]})})]})]})}),(0,W.jsx)(j,{children:(0,W.jsxs)(r,{fullWidth:!0,children:[(0,W.jsx)(o,{id:`write-mode-label`,children:`Tag Writing Mode`}),(0,W.jsxs)(i,{labelId:`write-mode-label`,value:L,label:`Tag Writing Mode`,onChange:e=>R(e.target.value),children:[(0,W.jsx)(d,{value:`none`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(N,{children:[(0,W.jsx)(`strong`,{children:`None`}),` - Don't write tags to files`]}),(0,W.jsx)(N,{variant:`caption`,color:`text.secondary`,children:`DB is source of truth; clears existing nomarr tags`})]})}),(0,W.jsx)(d,{value:`minimal`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(N,{children:[(0,W.jsx)(`strong`,{children:`Minimal`}),` - Mood tags only`]}),(0,W.jsx)(N,{variant:`caption`,color:`text.secondary`,children:`Write mood-strict, mood-regular, mood-loose`})]})}),(0,W.jsx)(d,{value:`full`,children:(0,W.jsxs)(e,{children:[(0,W.jsxs)(N,{children:[(0,W.jsx)(`strong`,{children:`Full`}),` - All tags`]}),(0,W.jsx)(N,{variant:`caption`,color:`text.secondary`,children:`Write all ML-derived tags to audio files`})]})})]})]})}),(0,W.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,W.jsx)(F,{variant:`contained`,onClick:x?we:Te,children:x?`Create`:`Update`}),(0,W.jsx)(F,{variant:`outlined`,onClick:xe,children:`Cancel`})]})]})]}),_&&(0,W.jsx)(N,{children:`Loading libraries...`}),!_&&!$&&m.length===0&&(0,W.jsx)(y,{children:(0,W.jsx)(N,{color:`text.secondary`,textAlign:`center`,fontStyle:`italic`,children:`No libraries configured. Click "Add Library" to get started.`})}),!_&&!$&&m.length>0&&(0,W.jsx)(e,{spacing:2,children:m.map(t=>(0,W.jsxs)(y,{children:[(0,W.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`flex-start`,sx:{mb:2},children:[(0,W.jsxs)(j,{children:[(0,W.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1.25,sx:{mb:.5},children:[(0,W.jsx)(N,{variant:`h6`,children:t.name}),Y(t.rootPath)&&(0,W.jsx)(u,{label:`Outside library_root`,color:`warning`,size:`small`})]}),(0,W.jsx)(N,{variant:`body2`,color:`text.secondary`,sx:{fontFamily:`monospace`},children:t.rootPath}),(0,W.jsxs)(e,{direction:`row`,spacing:2,sx:{mt:.5},children:[(0,W.jsxs)(N,{variant:`body2`,color:`text.secondary`,children:[(0,W.jsx)(`strong`,{children:t.fileCount.toLocaleString()}),` files`]}),(0,W.jsxs)(N,{variant:`body2`,color:`text.secondary`,children:[(0,W.jsx)(`strong`,{children:t.folderCount.toLocaleString()}),` folders`]})]}),t.scanStatus===`scanning`&&(0,W.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:.5},children:[(0,W.jsx)(u,{label:`Scanning...`,color:`info`,size:`small`,sx:{animation:`pulse 1.5s infinite`}}),t.scanProgress!=null&&t.scanTotal!=null&&t.scanTotal>0&&(0,W.jsxs)(N,{variant:`body2`,color:`info.main`,children:[t.scanProgress.toLocaleString(),` / `,t.scanTotal.toLocaleString(),` files`,` `,`(`,Math.round(t.scanProgress/t.scanTotal*100),`%)`]})]}),t.scanStatus===`error`&&t.scanError&&(0,W.jsxs)(N,{variant:`caption`,color:`error.main`,sx:{mt:.5},children:[`⚠ Scan error: `,t.scanError]}),Y(t.rootPath)&&(0,W.jsxs)(N,{variant:`caption`,color:`warning.main`,sx:{mt:.5},children:[`⚠ This library is outside the configured library_root (`,O,`)`]}),(0,W.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:1},children:[(0,W.jsx)(N,{variant:`caption`,color:`text.secondary`,children:`File Watching:`}),(0,W.jsx)(r,{size:`small`,sx:{minWidth:120},children:(0,W.jsxs)(i,{value:t.watchMode,onChange:e=>Oe(t.library_id,e.target.value),size:`small`,sx:{fontSize:`0.75rem`},disabled:w===t.library_id,children:[(0,W.jsx)(d,{value:`off`,children:`Off`}),(0,W.jsx)(d,{value:`event`,children:`Event`}),(0,W.jsx)(d,{value:`poll`,children:`Poll`})]})}),(0,W.jsx)(Ue,{title:t.watchMode===`event`?`Real-time file watching (local filesystems)`:t.watchMode===`poll`?`Periodic scanning (network-mount-safe)`:`No automatic file watching`,children:(0,W.jsx)(u,{label:Ae(t.watchMode),color:X(t.watchMode),size:`small`})})]}),(0,W.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:.5},children:[(0,W.jsx)(N,{variant:`caption`,color:`text.secondary`,children:`Tag Writing:`}),(0,W.jsx)(Ue,{title:t.fileWriteMode===`full`?`All ML-derived tags written to audio files`:t.fileWriteMode===`minimal`?`Only mood tags written to audio files`:`No tags written to audio files (DB only)`,children:(0,W.jsx)(u,{label:Z(t.fileWriteMode),color:je(t.fileWriteMode),size:`small`})}),me[t.library_id]?.pending>0&&(0,W.jsx)(u,{label:`${me[t.library_id].pending} pending`,color:`warning`,size:`small`})]})]}),(0,W.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,children:[(0,W.jsx)(j,{sx:{width:8,height:8,borderRadius:`50%`,bgcolor:t.isEnabled?`success.main`:`text.disabled`}}),(0,W.jsx)(N,{variant:`body2`,color:`text.secondary`,children:t.isEnabled?`Enabled`:`Disabled`})]})]}),(0,W.jsxs)(e,{direction:`row`,spacing:1.25,flexWrap:`wrap`,children:[(0,W.jsx)(F,{variant:`outlined`,size:`small`,onClick:()=>Ce(t),disabled:w===t.library_id,children:`Edit`}),(0,W.jsx)(F,{variant:`outlined`,color:`success`,size:`small`,onClick:()=>Ee(t.library_id,`quick`),disabled:!t.isEnabled||w===t.library_id||t.scanStatus===`scanning`||Y(t.rootPath)||!t.scannedAt,title:t.scannedAt?t.scanStatus===`scanning`?`Scan already in progress`:Y(t.rootPath)?`Cannot scan: library is outside library_root`:`Scan only new and modified files`:`Run a Full Scan first before using Quick Scan`,children:w===t.library_id||t.scanStatus===`scanning`?`Scanning...`:`Quick Scan`}),(0,W.jsx)(F,{variant:`contained`,color:`success`,size:`small`,onClick:()=>Ee(t.library_id,`full`),disabled:!t.isEnabled||w===t.library_id||t.scanStatus===`scanning`||Y(t.rootPath),title:t.scanStatus===`scanning`?`Scan already in progress`:Y(t.rootPath)?`Cannot scan: library is outside library_root`:`Rescan all files in the library`,children:w===t.library_id||t.scanStatus===`scanning`?`Scanning...`:`Full Scan`}),(0,W.jsx)(F,{variant:`outlined`,color:`secondary`,size:`small`,onClick:()=>Q(t.library_id),disabled:!t.isEnabled||B===t.library_id||t.scanStatus===`scanning`,title:B===t.library_id?`Reconciling tags...`:`Write tags from database to audio files`,onMouseEnter:()=>Ne(t.library_id),children:B===t.library_id?`Reconciling...`:`Reconcile Tags`}),(0,W.jsx)(F,{variant:`contained`,color:`error`,size:`small`,onClick:()=>De(t.library_id,t.name),disabled:w===t.library_id,children:`Delete`})]})]},t.library_id))}),(0,W.jsx)(h,{open:a,title:s.title,message:s.message,confirmLabel:s.confirmLabel,cancelLabel:s.cancelLabel,severity:s.severity,onConfirm:l,onCancel:f})]})}var Ge={file_write_mode:{label:`Tag Writing Mode`,description:`Controls which tags are written to audio files`,type:`select`,options:[{value:`none`,label:`None - Tags stored in database only`},{value:`minimal`,label:`Minimal - Essential tags only (artist, album, title, genre)`},{value:`full`,label:`Full - All generated tags written to files`}]},overwrite_tags:{label:`Overwrite Existing Tags`,description:`Whether to overwrite existing tags in audio files`,type:`boolean`},library_auto_tag:{label:`Auto-Tag New Files`,description:`Automatically process new files found during library scans`,type:`boolean`},library_ignore_patterns:{label:`Ignore Patterns`,description:`Comma-separated patterns to ignore during scanning (e.g., */Audiobooks/*,*.tmp)`,type:`text`},tagger_worker_count:{label:`Worker Threads`,description:`Number of parallel worker processes for tagging (0 = auto-detect)`,type:`text`},cache_idle_timeout:{label:`Cache Timeout (seconds)`,description:`How long to keep ML models in memory when idle`,type:`text`},calibrate_heads:{label:`Auto-Calibrate Heads`,description:`Automatically calibrate tag thresholds for optimal results`,type:`boolean`},calibration_repo:{label:`Calibration Repository`,description:`Git repository URL for calibration data downloads`,type:`text`}};function Ke({configKey:e,value:t,onChange:n,disabled:r}){let a=t==null?``:String(t),o=Ge[e],s=o?.label||e,l=o?.description,u=o?.type||(typeof t==`boolean`?`boolean`:`text`),f=o?.options||[];return(0,W.jsxs)(j,{sx:{display:`flex`,gap:2,alignItems:`flex-start`,py:1},children:[(0,W.jsxs)(j,{sx:{minWidth:`280px`,flexShrink:0},children:[(0,W.jsx)(N,{variant:`body2`,color:`text.primary`,sx:{fontWeight:500,mb:l?.5:0},children:s}),l&&(0,W.jsx)(N,{variant:`caption`,color:`text.secondary`,sx:{display:`block`},children:l})]}),(0,W.jsx)(j,{sx:{flex:1,maxWidth:`400px`},children:(()=>u===`select`&&f.length>0?(0,W.jsx)(i,{value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0,children:f.map(({value:e,label:t})=>(0,W.jsx)(d,{value:e,children:t},e))}):u===`boolean`?(0,W.jsxs)(i,{value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0,children:[(0,W.jsx)(d,{value:`true`,children:`true`}),(0,W.jsx)(d,{value:`false`,children:`false`})]}):(0,W.jsx)(c,{type:`text`,value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0,placeholder:l}))()})]})}function qe({config:t,hasChanges:n,saveLoading:r,onChange:i,onSaveAll:a}){return(0,W.jsxs)(y,{children:[(0,W.jsx)(E,{title:`Settings`}),(0,W.jsx)(N,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Changes are saved to the database and will take effect on server restart. Use "Restart Server" in Admin page to apply changes.`}),(0,W.jsx)(e,{spacing:1.875,children:Object.entries(t).map(([e,t])=>(0,W.jsx)(Ke,{configKey:e,value:t,onChange:i,disabled:r},e))}),(0,W.jsxs)(j,{sx:{mt:3.75,display:`flex`,gap:1.25,alignItems:`center`},children:[(0,W.jsx)(F,{onClick:a,variant:`contained`,disabled:!n||r,sx:{whiteSpace:`nowrap`},children:r?`Saving...`:`Save All Changes`}),n&&(0,W.jsx)(N,{variant:`body2`,color:`warning.main`,children:`Unsaved changes`})]})]})}function Je(){let{showSuccess:e,showError:t,showInfo:n}=H(),[r,i]=(0,U.useState)({}),[a,o]=(0,U.useState)({}),[s,c]=(0,U.useState)(!0),[l,u]=(0,U.useState)(null),[d,f]=(0,U.useState)(!1),[p,m]=(0,U.useState)(!1),h=async()=>{try{c(!0),u(null);let e=await k();i(e),o(e),m(!1)}catch(e){u(e instanceof Error?e.message:`Failed to load config`),console.error(`[Config] Load error:`,e)}finally{c(!1)}};return(0,U.useEffect)(()=>{h()},[]),(0,U.useEffect)(()=>{m(Object.keys(r).some(e=>r[e]!==a[e]))},[r,a]),{config:r,loading:s,error:l,saveLoading:d,hasChanges:p,handleSaveAll:async()=>{try{f(!0);let t=[];for(let e of Object.keys(r))if(r[e]!==a[e]){let n=r[e];if(n==null||n===``)continue;await ue(e,String(n)),t.push(e)}if(t.length===0){n(`No changes to save`);return}e(`Saved ${t.length} config change(s). Use "Restart Server" in Admin page to apply.`),await h()}catch(e){t(e instanceof Error?e.message:`Failed to save config`)}finally{f(!1)}},handleChange:(e,t)=>{i(n=>({...n,[e]:t}))}}}function Ye(){let{config:t,loading:n,error:r,saveLoading:i,hasChanges:a,handleSaveAll:o,handleChange:s}=Je();return(0,W.jsxs)(m,{title:`Configuration`,children:[n&&(0,W.jsx)(P,{}),r&&(0,W.jsxs)(B,{severity:`error`,children:[`Error: `,r]}),!n&&!r&&(0,W.jsxs)(e,{spacing:2.5,children:[(0,W.jsx)(We,{}),(0,W.jsx)(qe,{config:t,hasChanges:a,saveLoading:i,onChange:s,onSaveAll:o})]})]})}export{Ye as ConfigPage};