import{t as e}from"./Stack-CEc3FyMT.js";import{i as t,o as n,r,t as i}from"./Select-CkHGpnQQ.js";import{t as a}from"./ExpandMore-xw4NQNVo.js";import{n as o,r as s,t as c}from"./AccordionSummary-C0MjQrDK.js";import{n as l,t as u}from"./Autocomplete-DZUMk2Nm.js";import"./Popper-DNg_BLJ9.js";import{t as d}from"./Chip-CaGdlF6-.js";import{n as f,t as p}from"./ToggleButtonGroup-DJsB3Inz.js";import{t as m}from"./TextField-B4HCs_hP.js";import{t as h}from"./Tooltip-DoovrUDa.js";import{a as g,i as _,n as v,r as y,t as b}from"./TableRow-BQwF3WwQ.js";import{t as x}from"./TableContainer-D-RSi1UR.js";import{Gn as S,Mn as C,Ot as w,Un as T,a as E,bt as D,ct as O,ft as k,gt as A,ht as ee,i as j,kt as M,lt as N,mt as P,n as F,nt as I,o as te,pt as ne,r as re,rt as ie,t as ae,tn as L,wt as R,xt as z}from"./index-DnLmJuEf.js";import{t as B}from"./useNotification-BjHeKjQP.js";import{t as V}from"./Add-D6hRLL-f.js";import{t as H}from"./Close-Cvbnzu4X.js";var U=S(T(),1),W=S(C()),G=L((0,W.jsx)(`path`,{d:`m20 12-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8z`}),`ArrowDownward`),K=L((0,W.jsx)(`path`,{d:`m4 12 1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8z`}),`ArrowUpward`),q=L((0,W.jsx)(`path`,{d:`M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z`}),`Delete`);function oe({preview:t,configText:n,loading:r,error:i,onLoadPreview:a,onGenerateConfig:o}){let{showSuccess:s}=B();return(0,W.jsxs)(e,{spacing:2.5,children:[(0,W.jsxs)(N,{children:[(0,W.jsx)(O,{title:`Navidrome TOML Configuration`}),(0,W.jsxs)(e,{spacing:1.25,children:[(0,W.jsx)(D,{onClick:a,disabled:r,variant:`contained`,fullWidth:!0,children:r?`Loading...`:`Load Tag Preview`}),(0,W.jsx)(D,{onClick:o,disabled:r,variant:`contained`,fullWidth:!0,children:r?`Generating...`:`Generate Config`})]}),i&&(0,W.jsxs)(I,{children:[`Error: `,i]})]}),t&&(0,W.jsxs)(N,{children:[(0,W.jsx)(O,{title:`Tag Preview`}),(0,W.jsx)(z,{sx:{overflowX:`auto`},children:(0,W.jsxs)(g,{children:[(0,W.jsx)(v,{children:(0,W.jsxs)(b,{children:[(0,W.jsx)(y,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Tag`}),(0,W.jsx)(y,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Type`}),(0,W.jsx)(y,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Multivalue`}),(0,W.jsx)(y,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Count`}),(0,W.jsx)(y,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Summary`})]})}),(0,W.jsx)(_,{children:t.map(e=>(0,W.jsxs)(b,{children:[(0,W.jsx)(y,{sx:{borderColor:`divider`},title:e.tag_key,children:e.short_name}),(0,W.jsx)(y,{sx:{borderColor:`divider`},children:e.type}),(0,W.jsx)(y,{sx:{borderColor:`divider`},children:e.is_multivalue?`Yes`:`No`}),(0,W.jsx)(y,{sx:{borderColor:`divider`},children:e.total_count}),(0,W.jsx)(y,{sx:{borderColor:`divider`},children:e.summary})]},e.tag_key))})]})})]}),n&&(0,W.jsxs)(N,{children:[(0,W.jsx)(O,{title:`Generated Config`}),(0,W.jsx)(m,{multiline:!0,rows:20,value:n,fullWidth:!0,InputProps:{readOnly:!0,sx:{fontFamily:`monospace`,fontSize:`0.875rem`}}}),(0,W.jsx)(D,{onClick:()=>{n&&(navigator.clipboard.writeText(n),s(`Copied to clipboard!`))},variant:`contained`,sx:{mt:1.25},children:`Copy to Clipboard`})]})]})}var se=new Set([`artist`,`artists`,`album`,`album_artist`,`genre`,`year`,`date`,`bpm`,`composer`,`label`,`publisher`,`title`,`lyricist`]),ce=new Set([`year`,`bpm`]),le={artist:`Artist`,artists:`Artists`,album:`Album`,album_artist:`Album Artist`,genre:`Genre`,year:`Year`,date:`Date`,bpm:`BPM`,composer:`Composer`,label:`Label`,publisher:`Publisher`,title:`Title`,lyricist:`Lyricist`,"nom:mood-loose":`Mood (Loose)`,"nom:mood-regular":`Mood (Regular)`,"nom:mood-strict":`Mood (Strict)`};function ue(e){return se.has(e)||e.startsWith(`nom:`)}function de(){let[e,t]=(0,U.useState)([]),[n,r]=(0,U.useState)(!1),[i,a]=(0,U.useState)(null),o=(0,U.useCallback)(async()=>{try{r(!0),a(null),t(await j())}catch(e){a(e instanceof Error?e.message:`Failed to load tag metadata`)}finally{r(!1)}},[]);(0,U.useEffect)(()=>{o()},[o]);let s=(0,U.useMemo)(()=>e.filter(e=>ue(e.key)).map(e=>({...e,type:ce.has(e.key)?`integer`:e.type,label:le[e.key]??e.short_name??e.key})).sort((e,t)=>e.label.localeCompare(t.label)),[e]);return{tags:s,numericTags:(0,U.useMemo)(()=>s.filter(e=>e.type===`float`||e.type===`integer`),[s]),stringTags:(0,U.useMemo)(()=>s.filter(e=>e.type===`string`),[s]),loading:n,error:i,reload:o}}function fe({data:t}){let{total_count:n,sample_tracks:r}=t;return(0,W.jsxs)(e,{spacing:1.5,children:[(0,W.jsxs)(e,{direction:`row`,spacing:1,alignItems:`center`,children:[(0,W.jsx)(R,{variant:`body2`,color:`text.secondary`,children:`Matching tracks`}),(0,W.jsx)(d,{label:n,size:`small`,color:`primary`})]}),r.length>0?(0,W.jsx)(x,{children:(0,W.jsxs)(g,{size:`small`,children:[(0,W.jsx)(v,{children:(0,W.jsxs)(b,{children:[(0,W.jsx)(y,{children:`Title`}),(0,W.jsx)(y,{children:`Artist`}),(0,W.jsx)(y,{children:`Album`})]})}),(0,W.jsx)(_,{children:r.map((e,t)=>(0,W.jsxs)(b,{children:[(0,W.jsx)(y,{children:e.title??`—`}),(0,W.jsx)(y,{children:e.artist??`—`}),(0,W.jsx)(y,{children:e.album??`—`})]},t))})]})}):(0,W.jsx)(R,{variant:`body2`,color:`text.secondary`,children:`No tracks match the current rules.`}),r.length>0&&r.length<n&&(0,W.jsxs)(R,{variant:`caption`,color:`text.secondary`,children:[`Showing `,r.length,` of `,n,` matches`]})]})}var pe=[{value:`=`,label:`=`},{value:`!=`,label:`≠`},{value:`>`,label:`>`},{value:`<`,label:`<`}],me=[{value:`contains`,label:`contains`},{value:`notcontains`,label:`not contains`},{value:`=`,label:`=`},{value:`!=`,label:`≠`}];function he({rule:a,numericTags:o,stringTags:s,onChange:c,onRemove:d}){let f=[...o,...s],p=f.find(e=>e.key===a.tagKey),g=p?.type===`float`||p?.type===`integer`,_=g?pe:me,[v,y]=(0,U.useState)([]),[b,x]=(0,U.useState)(!1),S=(0,U.useCallback)(async e=>{if(!e){y([]);return}try{x(!0),y(await E(e))}catch{y([])}finally{x(!1)}},[]);return(0,U.useEffect)(()=>{S(a.tagKey)},[a.tagKey,S]),(0,W.jsxs)(e,{direction:`row`,spacing:1,alignItems:`center`,children:[(0,W.jsxs)(n,{size:`small`,sx:{minWidth:180,flex:2},children:[(0,W.jsx)(t,{children:`Tag`}),(0,W.jsxs)(i,{value:a.tagKey,label:`Tag`,onChange:e=>{let t=e.target.value,n=f.find(e=>e.key===t),r=g,i=n?.type===`float`||n?.type===`integer`,o=r===i&&_.some(e=>e.value===a.operator),s=i?`=`:`contains`;c({...a,tagKey:t,operator:o?a.operator:s,value:r===i?a.value:``})},children:[o.length>0&&(0,W.jsx)(l,{children:`Numeric`}),o.map(e=>(0,W.jsx)(r,{value:e.key,children:e.label},e.key)),s.length>0&&(0,W.jsx)(l,{children:`Text`}),s.map(e=>(0,W.jsx)(r,{value:e.key,children:e.label},e.key))]})]}),(0,W.jsxs)(n,{size:`small`,sx:{minWidth:90,flex:0},children:[(0,W.jsx)(t,{children:`Op`}),(0,W.jsx)(i,{value:a.operator,label:`Op`,onChange:e=>{c({...a,operator:e.target.value})},children:_.map(e=>(0,W.jsx)(r,{value:e.value,children:e.label},e.value))})]}),(0,W.jsx)(u,{size:`small`,freeSolo:!0,options:v,loading:b,value:a.value||null,inputValue:a.value,onInputChange:(e,t)=>{c({...a,value:t})},onChange:(e,t)=>{c({...a,value:t??``})},renderInput:e=>(0,W.jsx)(m,{...e,label:`Value`,type:g?`number`:`text`,inputProps:{...e.inputProps,...g?{step:`any`}:{}}}),sx:{flex:2,minWidth:160}}),(0,W.jsx)(h,{title:`Remove rule`,children:(0,W.jsx)(w,{size:`small`,onClick:d,color:`error`,children:(0,W.jsx)(H,{fontSize:`small`})})})]})}var J=1;function Y(){return{id:String(J++),tagKey:``,operator:`=`,value:``}}function X(e=`all`){return{id:String(J++),logic:e,rules:[],groups:[]}}function Z(e){let t=[],n=e.rules.filter(e=>e.tagKey&&e.value!==``).map(e=>`tag:${e.tagKey} ${e.operator} ${e.value}`);t.push(...n);for(let n of e.groups){let e=Z(n);e&&t.push(`(${e})`)}let r=e.logic===`all`?` AND `:` OR `;return t.join(r)}function Q({group:t,numericTags:n,stringTags:r,depth:i=0,onGroupChange:a,onRemove:o}){let s=i===0,[c,l]=(0,U.useState)(!1),u=t.rules.length>0||t.groups.length>0,d=()=>{a({...t,rules:[...t.rules,Y()]})},m=(e,n)=>{a({...t,rules:t.rules.map((t,r)=>r===e?n:t)})},g=e=>{a({...t,rules:t.rules.filter((t,n)=>n!==e)})},_=(e,n)=>{n&&a({...t,logic:n})},v=(e,n)=>{a({...t,groups:t.groups.map((t,r)=>r===e?n:t)})},y=e=>{a({...t,groups:t.groups.filter((t,n)=>n!==e)})},b=()=>{let e=X(t.logic);a({...t,groups:[...t.groups,e]})},x=()=>{u?l(!0):o&&o()},S=()=>{l(!1),o&&o()},C=()=>{l(!1)};return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(z,{sx:s?{}:{border:1,borderColor:`divider`,borderRadius:1,p:2,ml:2},children:(0,W.jsxs)(e,{spacing:1.5,children:[(0,W.jsxs)(e,{direction:`row`,spacing:2,alignItems:`center`,children:[(0,W.jsx)(R,{variant:`body2`,color:`text.secondary`,children:s?`Match`:`Group match`}),(0,W.jsxs)(p,{value:t.logic,exclusive:!0,onChange:_,size:`small`,children:[(0,W.jsx)(f,{value:`all`,children:`ALL`}),(0,W.jsx)(f,{value:`any`,children:`ANY`})]}),!s&&o&&(0,W.jsx)(h,{title:`Remove group`,children:(0,W.jsx)(w,{size:`small`,onClick:x,color:`error`,sx:{ml:`auto`},children:(0,W.jsx)(q,{fontSize:`small`})})})]}),t.rules.map((e,t)=>(0,W.jsx)(he,{rule:e,numericTags:n,stringTags:r,onChange:e=>m(t,e),onRemove:()=>g(t)},e.id)),t.groups.map((e,t)=>(0,W.jsx)(Q,{group:e,numericTags:n,stringTags:r,depth:i+1,onGroupChange:e=>v(t,e),onRemove:()=>y(t)},e.id)),(0,W.jsxs)(e,{direction:`row`,spacing:1,children:[(0,W.jsx)(D,{startIcon:(0,W.jsx)(V,{}),onClick:d,variant:`outlined`,size:`small`,children:`Add Rule`}),(0,W.jsx)(D,{startIcon:(0,W.jsx)(V,{}),onClick:b,variant:`outlined`,size:`small`,children:`Add Group`})]})]})}),(0,W.jsxs)(A,{open:c,onClose:C,children:[(0,W.jsx)(k,{children:`Remove Group?`}),(0,W.jsx)(P,{children:(0,W.jsxs)(ne,{children:[`This group contains `,t.rules.length,` rule(s) and`,` `,t.groups.length,` nested group(s). Are you sure you want to remove it?`]})}),(0,W.jsxs)(ee,{children:[(0,W.jsx)(D,{onClick:C,children:`Cancel`}),(0,W.jsx)(D,{onClick:S,color:`error`,autoFocus:!0,children:`Remove`})]})]})]})}function ge({rootGroup:t,numericTags:n,stringTags:r,onGroupChange:i}){return(0,W.jsx)(e,{spacing:1.5,children:(0,W.jsx)(Q,{group:t,numericTags:n,stringTags:r,depth:0,onGroupChange:i})})}var $=[{value:`title`,label:`Title`},{value:`artist`,label:`Artist`},{value:`album`,label:`Album`},{value:`path`,label:`Path`},{value:`random`,label:`Random`}];function _e(e){return e.startsWith(`-`)?{column:e.slice(1),descending:!0}:{column:e||`title`,descending:!1}}function ve({value:a,onChange:o}){let{column:s,descending:c}=_e(a);return(0,W.jsxs)(e,{direction:`row`,spacing:1,alignItems:`center`,children:[(0,W.jsxs)(n,{size:`small`,sx:{minWidth:140},children:[(0,W.jsx)(t,{children:`Sort by`}),(0,W.jsx)(i,{value:s,label:`Sort by`,onChange:e=>{let t=e.target.value;o(c?`-${t}`:t)},children:$.map(e=>(0,W.jsx)(r,{value:e.value,children:e.label},e.value))})]}),s!==`random`&&(0,W.jsx)(h,{title:c?`Descending`:`Ascending`,children:(0,W.jsx)(w,{size:`small`,onClick:()=>{o(c?s:`-${s}`)},children:c?(0,W.jsx)(G,{}):(0,W.jsx)(K,{})})})]})}function ye({rootGroup:t,name:n,comment:r,limit:i,sort:a,preview:o,content:s,loading:c,error:l,onGroupChange:u,onNameChange:d,onCommentChange:f,onLimitChange:p,onSortChange:h,onPreview:g,onGenerate:_}){let{numericTags:v,stringTags:y,loading:b}=de(),x=Z(t),S=x.length>0;return(0,W.jsxs)(e,{spacing:2.5,children:[(0,W.jsxs)(N,{children:[(0,W.jsx)(O,{title:`Smart Playlist Generator`}),(0,W.jsxs)(e,{spacing:2,children:[b?(0,W.jsxs)(z,{sx:{display:`flex`,flexDirection:`column`,alignItems:`center`,justifyContent:`center`,py:4,gap:2},children:[(0,W.jsx)(M,{size:40}),(0,W.jsx)(R,{variant:`body2`,color:`text.secondary`,children:`Loading tag metadata…`})]}):(0,W.jsx)(ge,{rootGroup:t,numericTags:v,stringTags:y,onGroupChange:u}),x&&(0,W.jsx)(m,{value:x,label:`Generated query`,size:`small`,fullWidth:!0,slotProps:{input:{readOnly:!0,sx:{fontFamily:`monospace`,fontSize:`0.8rem`}}}}),(0,W.jsxs)(z,{children:[(0,W.jsx)(R,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Playlist Name *`}),(0,W.jsx)(m,{value:n,onChange:e=>d(e.target.value),disabled:c,required:!0,fullWidth:!0,size:`small`})]}),(0,W.jsxs)(z,{children:[(0,W.jsx)(R,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Comment`}),(0,W.jsx)(m,{value:r,onChange:e=>f(e.target.value),disabled:c,fullWidth:!0,size:`small`})]}),(0,W.jsxs)(e,{direction:`row`,spacing:2,alignItems:`flex-end`,children:[(0,W.jsxs)(z,{children:[(0,W.jsx)(R,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Sort`}),(0,W.jsx)(ve,{value:a,onChange:h})]}),(0,W.jsxs)(z,{children:[(0,W.jsx)(R,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Limit`}),(0,W.jsx)(m,{type:`number`,value:i??``,onChange:e=>p(e.target.value?parseInt(e.target.value):void 0),disabled:c,placeholder:`Optional`,size:`small`,sx:{width:120}})]})]}),(0,W.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,W.jsx)(D,{variant:`contained`,disabled:c||!S,onClick:g,fullWidth:!0,children:c?`Loading…`:`Preview Query`}),(0,W.jsx)(D,{variant:`contained`,disabled:c||!S,onClick:_,fullWidth:!0,children:c?`Generating…`:`Generate .nsp`})]})]}),l&&(0,W.jsxs)(I,{children:[`Error: `,l]})]}),o&&(0,W.jsxs)(N,{children:[(0,W.jsx)(O,{title:`Query Preview`}),(0,W.jsx)(fe,{data:o})]}),s&&(0,W.jsxs)(N,{children:[(0,W.jsx)(O,{title:`Generated Playlist (.nsp)`}),(0,W.jsx)(m,{multiline:!0,rows:15,value:s,fullWidth:!0,slotProps:{input:{readOnly:!0,sx:{fontFamily:`monospace`,fontSize:`0.875rem`}}}}),(0,W.jsx)(D,{onClick:()=>{if(s){let e=new Blob([s],{type:`text/plain`}),t=URL.createObjectURL(e),r=document.createElement(`a`);r.href=t,r.download=`${n}.nsp`,r.click(),URL.revokeObjectURL(t)}},variant:`contained`,sx:{mt:1.25},children:`Download .nsp File`})]})]})}function be(){let{showError:e}=B(),[t,n]=(0,U.useState)(null),[r,i]=(0,U.useState)(null),[a,o]=(0,U.useState)(!1),[s,c]=(0,U.useState)(null),[l,u]=(0,U.useState)(()=>{let e=X(`all`);return e.rules=[Y()],e}),[d,f]=(0,U.useState)(`My Playlist`),[p,m]=(0,U.useState)(``),[h,g]=(0,U.useState)(void 0),[_,v]=(0,U.useState)(``),[y,b]=(0,U.useState)(null),[x,S]=(0,U.useState)(null),[C,w]=(0,U.useState)(!1),[T,E]=(0,U.useState)(null);return{configPreview:t,configText:r,configLoading:a,configError:s,playlistRootGroup:l,playlistName:d,playlistComment:p,playlistLimit:h,playlistSort:_,playlistPreview:y,playlistContent:x,playlistLoading:C,playlistError:T,loadConfigPreview:async()=>{try{o(!0),c(null),n((await re()).tags)}catch(e){c(e instanceof Error?e.message:`Failed to load preview`)}finally{o(!1)}},generateConfig:async()=>{try{o(!0),c(null),i((await F()).config)}catch(e){c(e instanceof Error?e.message:`Failed to generate config`)}finally{o(!1)}},previewPlaylist:async()=>{let t=Z(l);if(!t.trim()){e(`Add at least one complete rule`);return}try{w(!0),E(null),b(await te(t,10))}catch(e){E(e instanceof Error?e.message:`Failed to preview playlist`)}finally{w(!1)}},generatePlaylist:async()=>{let t=Z(l);if(!t.trim()){e(`Add at least one complete rule`);return}if(!d.trim()){e(`Playlist name is required`);return}try{w(!0),E(null),S((await ae({query:t,playlist_name:d,comment:p,limit:h,sort:_||void 0})).content)}catch(e){E(e instanceof Error?e.message:`Failed to generate playlist`)}finally{w(!1)}},setPlaylistRootGroup:u,setPlaylistName:f,setPlaylistComment:m,setPlaylistLimit:g,setPlaylistSort:v}}function xe(){let{configPreview:t,configText:n,configLoading:r,configError:i,playlistRootGroup:l,playlistName:u,playlistComment:d,playlistLimit:f,playlistSort:p,playlistPreview:m,playlistContent:h,playlistLoading:g,playlistError:_,loadConfigPreview:v,generateConfig:y,previewPlaylist:b,generatePlaylist:x,setPlaylistRootGroup:S,setPlaylistName:C,setPlaylistComment:w,setPlaylistLimit:T,setPlaylistSort:E}=be();return(0,W.jsx)(ie,{title:`Navidrome`,children:(0,W.jsxs)(e,{spacing:2,children:[(0,W.jsxs)(s,{defaultExpanded:!0,disableGutters:!0,children:[(0,W.jsx)(c,{expandIcon:(0,W.jsx)(a,{}),children:(0,W.jsx)(R,{variant:`h6`,sx:{fontWeight:600},children:`Generate Config`})}),(0,W.jsx)(o,{children:(0,W.jsx)(oe,{preview:t,configText:n,loading:r,error:i,onLoadPreview:v,onGenerateConfig:y})})]}),(0,W.jsxs)(s,{disableGutters:!0,children:[(0,W.jsx)(c,{expandIcon:(0,W.jsx)(a,{}),children:(0,W.jsx)(R,{variant:`h6`,sx:{fontWeight:600},children:`Playlist Maker`})}),(0,W.jsx)(o,{children:(0,W.jsx)(ye,{rootGroup:l,name:u,comment:d,limit:f,sort:p,preview:m,content:h,loading:g,error:_,onGroupChange:S,onNameChange:C,onCommentChange:w,onLimitChange:T,onSortChange:E,onPreview:b,onGenerate:x})})]})]})})}export{xe as NavidromePage};