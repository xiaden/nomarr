import{t as e}from"./Stack-CEc3FyMT.js";import{i as t,o as n,r,t as i}from"./Select-CkHGpnQQ.js";import{t as a}from"./TextField-B4HCs_hP.js";import{a as o,i as s,n as c,r as l,t as u}from"./TableRow-BQwF3WwQ.js";import{A as d,E as f,Et as p,Gn as m,M as h,Mn as g,Nt as _,O as v,T as y,Un as b,Z as x,bt as S,ct as C,it as w,j as T,k as E,kt as D,lt as O,wt as k,xt as A}from"./index-DnLmJuEf.js";import{t as j}from"./useConfirmDialog-CPi_yaSZ.js";import{t as M}from"./ServerFilePicker-BNdLFsf7.js";import{t as N}from"./useNotification-BjHeKjQP.js";var P=m(b(),1),F=m(g(),1);function I(){let{confirm:t}=j(),[n,r]=(0,P.useState)(``),[i,d]=(0,P.useState)(null),[f,m]=(0,P.useState)(!1),[g,_]=(0,P.useState)(null),[v,y]=(0,P.useState)(!1),[b,x]=(0,P.useState)(!1),[w,E]=(0,P.useState)(null),D=async e=>{if(e.preventDefault(),n.trim())try{m(!0),_(null),E(null),d(await h(n))}catch(e){_(e instanceof Error?e.message:`Failed to load tags`),d(null),console.error(`[Inspect] Load error:`,e)}finally{m(!1)}},N=async()=>{if(n.trim()&&await t({title:`Remove All Tags?`,message:`Remove all tags from ${n}?\n\nThis cannot be undone!`,severity:`warning`}))try{x(!0),_(null),E(null);let e=await T(n);E(`Removed ${e.removed} tag(s) from ${e.path}`),d(await h(n))}catch(e){_(e instanceof Error?e.message:`Failed to remove tags`),console.error(`[Inspect] Remove error:`,e)}finally{x(!1)}},I=e=>Array.isArray(e)?e.join(`, `):String(e);return(0,F.jsxs)(O,{children:[(0,F.jsx)(C,{title:`Inspect Tags`}),(0,F.jsx)(k,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Debug tool to view and remove tags from individual audio files.`}),(0,F.jsx)(`form`,{onSubmit:D,children:(0,F.jsxs)(e,{spacing:2,children:[(0,F.jsxs)(A,{sx:{display:`flex`,gap:1.25,alignItems:`center`},children:[(0,F.jsx)(a,{label:`File Path`,value:n,onChange:e=>r(e.target.value),placeholder:`/music/artist/album/track.flac`,fullWidth:!0,size:`small`,disabled:f||b}),(0,F.jsx)(S,{type:`button`,variant:`outlined`,onClick:()=>y(!0),disabled:f||b,sx:{whiteSpace:`nowrap`,minWidth:`fit-content`},children:`Browse Files`}),(0,F.jsx)(S,{type:`submit`,variant:`contained`,disabled:!n.trim()||f||b,sx:{whiteSpace:`nowrap`,minWidth:`fit-content`},children:f?`Loading...`:`Show Tags`})]}),g&&(0,F.jsx)(p,{severity:`error`,children:g}),w&&(0,F.jsx)(p,{severity:`success`,children:w}),v&&(0,F.jsx)(A,{sx:{mt:2},children:(0,F.jsx)(M,{value:n,onChange:e=>{r(e),y(!1)},mode:`file`,label:`Select Audio File`})}),i&&(0,F.jsxs)(e,{spacing:2,children:[(0,F.jsxs)(A,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,py:1,px:2,backgroundColor:`action.hover`,borderRadius:1},children:[(0,F.jsxs)(k,{variant:`body2`,children:[(0,F.jsx)(`strong`,{children:`File:`}),` `,i.path]}),(0,F.jsxs)(k,{variant:`body2`,children:[(0,F.jsx)(`strong`,{children:`Tags:`}),` `,i.count]})]}),i.count>0&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(o,{size:`small`,children:[(0,F.jsx)(c,{children:(0,F.jsxs)(u,{children:[(0,F.jsx)(l,{children:(0,F.jsx)(`strong`,{children:`Key`})}),(0,F.jsx)(l,{children:(0,F.jsx)(`strong`,{children:`Value`})})]})}),(0,F.jsx)(s,{children:Object.entries(i.tags).map(([e,t])=>(0,F.jsxs)(u,{children:[(0,F.jsx)(l,{sx:{fontFamily:`monospace`},children:e}),(0,F.jsx)(l,{sx:{wordBreak:`break-all`},children:I(t)})]},e))})]}),(0,F.jsx)(A,{sx:{display:`flex`,justifyContent:`flex-end`},children:(0,F.jsx)(S,{onClick:N,variant:`outlined`,color:`error`,disabled:b,sx:{textTransform:`none`},children:b?`Removing...`:`Remove All Tags`})})]}),i.count===0&&(0,F.jsx)(p,{severity:`info`,children:`No tags found in this file.`})]})]})})]})}function L({onRestart:e,actionLoading:t}){return(0,F.jsxs)(O,{children:[(0,F.jsx)(C,{title:`System Controls`}),(0,F.jsx)(w,{label:`Restart Server`,description:`Stops and restarts the API server. Config changes will take effect. Page will reload automatically after restart.`,onClick:e,disabled:t,variant:`contained`,color:`error`})]})}var R=[`discogs_effnet`,`discogs_musicnn`];function z(){let[d,m]=(0,P.useState)(null),[h,g]=(0,P.useState)(!1),[v,b]=(0,P.useState)(null),[w,T]=(0,P.useState)(R[0]),[E,j]=(0,P.useState)(``),[M,N]=(0,P.useState)(!1),[I,L]=(0,P.useState)(null),[z,B]=(0,P.useState)(null),V=(0,P.useCallback)(async()=>{g(!0),b(null);try{m((await y()).stats)}catch(e){e instanceof x?b(`API Error (${e.status}): ${e.message}`):e instanceof Error?b(e.message):b(`Unknown error`)}finally{g(!1)}},[]);(0,P.useEffect)(()=>{V()},[V]);let H=(0,P.useCallback)(async()=>{N(!0),B(null),L(null);try{L((await f(w,E?parseInt(E,10):null)).message),V()}catch(e){e instanceof x?B(`API Error (${e.status}): ${e.message}`):e instanceof Error?B(e.message):B(`Unknown error`)}finally{N(!1)}},[w,E,V]);return(0,F.jsxs)(O,{children:[(0,F.jsx)(C,{title:`Vector Store`}),(0,F.jsxs)(e,{spacing:3,children:[(0,F.jsxs)(A,{children:[(0,F.jsxs)(A,{sx:{display:`flex`,alignItems:`center`,justifyContent:`space-between`,mb:1},children:[(0,F.jsx)(k,{variant:`subtitle2`,children:`Hot/Cold Stats`}),(0,F.jsx)(S,{size:`small`,onClick:()=>void V(),disabled:h,children:h?(0,F.jsx)(D,{size:16}):`Refresh`})]}),v&&(0,F.jsx)(p,{severity:`error`,sx:{mb:1},children:v}),d&&(0,F.jsx)(_,{variant:`outlined`,children:(0,F.jsxs)(o,{size:`small`,children:[(0,F.jsx)(c,{children:(0,F.jsxs)(u,{children:[(0,F.jsx)(l,{children:`Backbone`}),(0,F.jsx)(l,{align:`right`,children:`Hot`}),(0,F.jsx)(l,{align:`right`,children:`Cold`})]})}),(0,F.jsx)(s,{children:d.map(e=>(0,F.jsxs)(u,{children:[(0,F.jsx)(l,{children:e.backbone_id}),(0,F.jsx)(l,{align:`right`,children:e.hot_count}),(0,F.jsx)(l,{align:`right`,children:e.cold_count})]},e.backbone_id))})]})})]}),(0,F.jsxs)(A,{children:[(0,F.jsx)(k,{variant:`subtitle2`,gutterBottom:!0,children:`Promote Vectors`}),(0,F.jsxs)(e,{spacing:1.5,children:[(0,F.jsxs)(n,{fullWidth:!0,size:`small`,children:[(0,F.jsx)(t,{children:`Backbone`}),(0,F.jsx)(i,{value:w,label:`Backbone`,onChange:e=>T(e.target.value),children:R.map(e=>(0,F.jsx)(r,{value:e,children:e},e))})]}),(0,F.jsx)(a,{label:`HNSW nlists (optional)`,placeholder:`Auto-calculated if empty`,value:E,onChange:e=>j(e.target.value),size:`small`,fullWidth:!0,type:`number`,inputProps:{min:1},helperText:`Number of HNSW graph lists. Leave empty for auto.`}),(0,F.jsx)(S,{variant:`contained`,onClick:()=>void H(),disabled:M,children:M?(0,F.jsx)(D,{size:24}):`Promote & Rebuild`}),z&&(0,F.jsx)(p,{severity:`error`,children:z}),I&&(0,F.jsx)(p,{severity:`success`,children:I})]})]})]})]})}function B({onPause:t,onResume:n,actionLoading:r}){return(0,F.jsxs)(O,{children:[(0,F.jsx)(C,{title:`Worker Controls`}),(0,F.jsxs)(e,{spacing:1.25,children:[(0,F.jsx)(w,{label:`Pause Worker`,description:`Stops the worker from processing queue jobs. Jobs remain in the queue.`,onClick:t,disabled:r}),(0,F.jsx)(w,{label:`Resume Worker`,description:`Starts the worker to process queue jobs.`,onClick:n,disabled:r})]})]})}function V(){let{showSuccess:e,showError:t}=N(),{confirm:n,isOpen:r,options:i,handleConfirm:a,handleCancel:o}=j(),[s,c]=(0,P.useState)(!1);return{actionLoading:s,handlePauseWorker:async()=>{if(await n({title:`Pause Worker?`,message:`Pause the worker? Processing will stop.`,confirmLabel:`Pause`,severity:`warning`}))try{c(!0),e((await v()).message)}catch(e){t(e instanceof Error?e.message:`Failed to pause worker`)}finally{c(!1)}},handleResumeWorker:async()=>{if(await n({title:`Resume Worker?`,message:`Resume the worker? Processing will start.`,confirmLabel:`Resume`}))try{c(!0),e((await d()).message)}catch(e){t(e instanceof Error?e.message:`Failed to resume worker`)}finally{c(!1)}},handleRestart:async()=>{if(await n({title:`Restart Server?`,message:`Restart the API server? The page will reload in a few seconds.`,confirmLabel:`Restart`,severity:`error`}))try{c(!0),e((await E()).message),setTimeout(()=>{window.location.reload()},3e3)}catch(e){t(e instanceof Error?e.message:`Failed to restart server`),c(!1)}},dialogState:{isOpen:r,options:i,handleConfirm:a,handleCancel:o}}}export{I as a,L as i,B as n,z as r,V as t};