import{t as e}from"./Stack-tmSg0kgc.js";import{D as t,Dt as n,Et as r,_t as i,a,d as o,f as s,g as c,h as l,j as u,k as d,l as f,m as p,o as m,r as h,w as g}from"./index-gBnixkw7.js";import{t as _}from"./useConfirmDialog-DpEQH9gv.js";import{t as v}from"./useNotification-Dcqd_Pxg.js";var y=n(i(),1),b=n(r(),1);async function x(e=!0){return a(`/api/web/calibration/generate`,{save_sidecars:e})}async function S(){return a(`/api/web/calibration/apply`)}async function C(){return h(`/api/web/calibration/status`)}async function w(){return a(`/api/web/calibration/clear`)}function T({onGenerate:t,onApply:n,onClear:r,actionLoading:i}){return(0,y.jsxs)(c,{children:[(0,y.jsx)(l,{title:`Actions`}),(0,y.jsx)(e,{spacing:2,children:[{label:`Generate New Calibration`,description:`Analyze all files in library to generate optimal calibration values. This will scan the entire library and may take some time.`,onClick:t,color:`primary`,variant:`contained`},{label:`Apply Calibration to Library`,description:`Queue all files for reprocessing with current calibration. This will update all tags based on the current calibration values.`,onClick:n,color:`primary`,variant:`contained`},{label:`Clear Calibration Queue`,description:`Remove all pending calibration jobs from the queue. Running jobs will complete.`,onClick:r,color:`error`,variant:`outlined`}].map(e=>(0,y.jsx)(o,{label:e.label,description:e.description,onClick:e.onClick,disabled:i,variant:e.variant,color:e.color},e.label))})]})}function E({status:e}){let n=[{label:`Pending`,value:e.pending},{label:`Running`,value:e.running},{label:`Completed`,value:e.completed},{label:`Errors`,value:e.errors}];return(0,y.jsxs)(c,{children:[(0,y.jsx)(l,{title:`Calibration Queue Status`}),(0,y.jsx)(s,{minColumnWidth:150,children:n.map(e=>(0,y.jsx)(p,{label:e.label,value:e.value,valueVariant:`h5`,centered:!0},e.label))}),(0,y.jsx)(g,{sx:{mt:2},children:(0,y.jsxs)(t,{variant:`body1`,children:[`Worker:`,` `,(0,y.jsx)(t,{component:`span`,sx:{color:e.worker_alive?`success.main`:`error.main`,fontWeight:600},children:e.worker_alive?`Alive`:`Not Running`}),e.worker_alive&&(0,y.jsxs)(y.Fragment,{children:[` â€¢ `,(0,y.jsx)(t,{component:`span`,sx:{color:e.worker_busy?`info.main`:`success.main`,fontWeight:600},children:e.worker_busy?`Busy`:`Idle`})]})]})})]})}function D(){let{showSuccess:e,showError:t}=v(),{confirm:n,isOpen:r,options:i,handleConfirm:a,handleCancel:o}=_(),[s,c]=(0,b.useState)(null),[l,u]=(0,b.useState)(!0),[d,f]=(0,b.useState)(null),[p,m]=(0,b.useState)(!1),h=async()=>{try{u(!0),f(null),c(await C())}catch(e){f(e instanceof Error?e.message:`Failed to load status`),console.error(`[Calibration] Load error:`,e)}finally{u(!1)}};return(0,b.useEffect)(()=>{h()},[]),{status:s,loading:l,error:d,actionLoading:p,handleGenerate:async()=>{if(await n({title:`Generate Calibration?`,message:`This analyzes all library files and may take some time.`,confirmLabel:`Generate`,severity:`warning`}))try{m(!0);let t=await x(!0),n=Object.keys(t.data.calibrations||{}).length,r=t.saved_files?.saved_files||0,i=`Calibration generated! Library: ${t.data.library_size} files, `;i+=`Calibrations: ${n}, Skipped: ${t.data.skipped_tags}`,r>0&&(i+=`, Saved ${r} files`),e(i)}catch(e){t(e instanceof Error?e.message:`Failed to generate calibration`)}finally{m(!1)}},handleApply:async()=>{if(await n({title:`Apply Calibration?`,message:`Apply calibration to entire library? This will queue all files for reprocessing.`,confirmLabel:`Apply`,severity:`warning`}))try{m(!0),e(`Queued ${(await S()).queued} files for recalibration`),await h()}catch(e){t(e instanceof Error?e.message:`Failed to apply calibration`)}finally{m(!1)}},handleClear:async()=>{if(await n({title:`Clear Calibration Queue?`,message:`Clear all calibration queue jobs?`,confirmLabel:`Clear`,severity:`warning`}))try{m(!0),e(`Cleared ${(await w()).cleared} jobs`),await h()}catch(e){t(e instanceof Error?e.message:`Failed to clear calibration queue`)}finally{m(!1)}},dialogState:{isOpen:r,options:i,handleConfirm:a,handleCancel:o}}}function O(){let{status:t,loading:n,error:r,actionLoading:i,handleGenerate:a,handleApply:o,handleClear:s,dialogState:c}=D();return(0,y.jsxs)(f,{title:`Calibration`,children:[n&&(0,y.jsx)(u,{}),r&&(0,y.jsxs)(d,{severity:`error`,children:[`Error: `,r]}),t&&(0,y.jsxs)(e,{spacing:2.5,children:[(0,y.jsx)(E,{status:t}),(0,y.jsx)(T,{onGenerate:a,onApply:o,onClear:s,actionLoading:i})]}),(0,y.jsx)(m,{open:c.isOpen,title:c.options.title,message:c.options.message,confirmLabel:c.options.confirmLabel,cancelLabel:c.options.cancelLabel,severity:c.options.severity,onConfirm:c.handleConfirm,onCancel:c.handleCancel})]})}export{O as CalibrationPage};