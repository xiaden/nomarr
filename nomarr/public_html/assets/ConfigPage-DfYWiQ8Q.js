import{t as e}from"./Stack-BZZGIzac.js";import"./List-I056YqYH.js";import{a as t,i as n,n as r,o as i,r as a,s as o,t as s}from"./TextField-D4xrf02i.js";import{t as c}from"./useControlled-DdhiOglK.js";import{t as l}from"./Popper--fvY9vbl.js";import{n as u,t as d}from"./MenuItem-DZP_AqUh.js";import"./listItemTextClasses-BTwiaMxP.js";import{$ as f,$t as p,At as m,Cn as h,D as ee,G as g,Gt as _,Ht as v,K as y,Lt as b,Mt as x,Pt as S,Q as te,Rt as C,Tn as ne,Tt as w,U as T,Wt as E,Zt as D,_ as O,a as re,at as k,b as A,cn as j,ct as ie,dt as ae,f as M,fn as N,gt as P,h as oe,ht as se,lt as F,mt as ce,o as le,on as I,ot as L,p as ue,pt as de,qt as fe,sn as R,tt as pe,v as me,vt as z,wt as he,x as ge,y as _e,zt as B}from"./index-B8hAqVgx.js";import{t as ve}from"./useConfirmDialog-Lwr4ikey.js";import{t as ye}from"./ServerFilePicker-B8vk50Pi.js";import{t as V}from"./useNotification-DsBc6I1Y.js";function be(e){return R(`PrivateSwitchBase`,e)}I(`PrivateSwitchBase`,[`root`,`checked`,`disabled`,`input`,`edgeStart`,`edgeEnd`]);var H=ne(h()),U=ne(N()),W=e=>{let{classes:t,checked:n,disabled:r,edge:i}=e;return D({root:[`root`,n&&`checked`,r&&`disabled`,i&&`edge${B(i)}`],input:[`input`]},be,t)},G=E(se,{name:`MuiSwitchBase`})({padding:9,borderRadius:`50%`,variants:[{props:{edge:`start`,size:`small`},style:{marginLeft:-3}},{props:({edge:e,ownerState:t})=>e===`start`&&t.size!==`small`,style:{marginLeft:-12}},{props:{edge:`end`,size:`small`},style:{marginRight:-3}},{props:({edge:e,ownerState:t})=>e===`end`&&t.size!==`small`,style:{marginRight:-12}}]}),K=E(`input`,{name:`MuiSwitchBase`,shouldForwardProp:_})({cursor:`inherit`,position:`absolute`,opacity:0,width:`100%`,height:`100%`,top:0,left:0,margin:0,padding:0,zIndex:1}),q=H.forwardRef(function(e,n){let{autoFocus:r,checked:i,checkedIcon:a,defaultChecked:o,disabled:s,disableFocusRipple:l=!1,edge:u=!1,icon:d,id:f,inputProps:p,inputRef:m,name:h,onBlur:ee,onChange:g,onFocus:_,readOnly:v,required:y=!1,tabIndex:b,type:x,value:S,slots:te={},slotProps:C={},...ne}=e,[w,T]=c({controlled:i,default:!!o,name:`SwitchBase`,state:`checked`}),E=t(),D=e=>{_&&_(e),E&&E.onFocus&&E.onFocus(e)},O=e=>{ee&&ee(e),E&&E.onBlur&&E.onBlur(e)},re=e=>{if(e.nativeEvent.defaultPrevented||v)return;let t=e.target.checked;T(t),g&&g(e,t)},k=s;E&&k===void 0&&(k=E.disabled);let A=x===`checkbox`||x===`radio`,j={...e,checked:w,disabled:k,disableFocusRipple:l,edge:u},ie=W(j),ae={slots:te,slotProps:{input:p,...C}},[M,N]=z(`root`,{ref:n,elementType:G,className:ie.root,shouldForwardComponentProp:!0,externalForwardedProps:{...ae,component:`span`,...ne},getSlotProps:e=>({...e,onFocus:t=>{e.onFocus?.(t),D(t)},onBlur:t=>{e.onBlur?.(t),O(t)}}),ownerState:j,additionalProps:{centerRipple:!0,focusRipple:!l,disabled:k,role:void 0,tabIndex:null}}),[P,oe]=z(`input`,{ref:m,elementType:K,className:ie.input,externalForwardedProps:ae,getSlotProps:e=>({...e,onChange:t=>{e.onChange?.(t),re(t)}}),ownerState:j,additionalProps:{autoFocus:r,checked:i,defaultChecked:o,disabled:k,id:A?f:void 0,name:h,readOnly:v,required:y,tabIndex:b,type:x,...x===`checkbox`&&S===void 0?{}:{value:S}}});return(0,U.jsxs)(M,{...N,children:[(0,U.jsx)(P,{...oe}),w?a:d]})}),xe=b((0,U.jsx)(`path`,{d:`M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z`}),`CheckBoxOutlineBlank`),J=b((0,U.jsx)(`path`,{d:`M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z`}),`CheckBox`),Se=b((0,U.jsx)(`path`,{d:`M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z`}),`IndeterminateCheckBox`);function Ce(e){return R(`MuiCheckbox`,e)}var we=I(`MuiCheckbox`,[`root`,`checked`,`disabled`,`indeterminate`,`colorPrimary`,`colorSecondary`,`sizeSmall`,`sizeMedium`]),Te=e=>{let{classes:t,indeterminate:n,color:r,size:i}=e,a=D({root:[`root`,n&&`indeterminate`,`color${B(r)}`,`size${B(i)}`]},Ce,t);return{...t,...a}},Ee=E(q,{shouldForwardProp:e=>_(e)||e===`classes`,name:`MuiCheckbox`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${B(n.size)}`],n.color!==`default`&&t[`color${B(n.color)}`]]}})(C(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:`default`,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(ce()).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(ce()).map(([t])=>({props:{color:t},style:{[`&.${we.checked}, &.${we.indeterminate}`]:{color:(e.vars||e).palette[t].main},[`&.${we.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:`transparent`}}}}]}))),De=(0,U.jsx)(J,{}),Oe=(0,U.jsx)(xe,{}),ke=(0,U.jsx)(Se,{}),Ae=H.forwardRef(function(e,t){let n=v({props:e,name:`MuiCheckbox`}),{checkedIcon:r=De,color:i=`primary`,icon:a=Oe,indeterminate:s=!1,indeterminateIcon:c=ke,inputProps:l,size:u=`medium`,disableRipple:d=!1,className:f,slots:p={},slotProps:m={},...h}=n,ee=s?c:a,g=s?c:r,_={...n,disableRipple:d,color:i,indeterminate:s,size:u},y=Te(_),b=m.input??l,[x,S]=z(`root`,{ref:t,elementType:Ee,className:j(y.root,f),shouldForwardComponentProp:!0,externalForwardedProps:{slots:p,slotProps:m,...h},ownerState:_,additionalProps:{type:`checkbox`,icon:H.cloneElement(ee,{fontSize:ee.props.fontSize??u}),checkedIcon:H.cloneElement(g,{fontSize:g.props.fontSize??u}),disableRipple:d,slots:p,slotProps:{input:o(typeof b==`function`?b(_):b,{"data-indeterminate":s})}}});return(0,U.jsx)(x,{...S,classes:y})});function Y(e){return R(`MuiFormControlLabel`,e)}var X=I(`MuiFormControlLabel`,[`root`,`labelPlacementStart`,`labelPlacementTop`,`labelPlacementBottom`,`disabled`,`label`,`error`,`required`,`asterisk`]),Z=e=>{let{classes:t,disabled:n,labelPlacement:r,error:i,required:a}=e;return D({root:[`root`,n&&`disabled`,`labelPlacement${B(r)}`,i&&`error`,a&&`required`],label:[`label`,n&&`disabled`],asterisk:[`asterisk`,i&&`error`]},Y,t)};const je=E(`label`,{name:`MuiFormControlLabel`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${X.label}`]:t.label},t.root,t[`labelPlacement${B(n.labelPlacement)}`]]}})(C(({theme:e})=>({display:`inline-flex`,alignItems:`center`,cursor:`pointer`,verticalAlign:`middle`,WebkitTapHighlightColor:`transparent`,marginLeft:-11,marginRight:16,[`&.${X.disabled}`]:{cursor:`default`},[`& .${X.label}`]:{[`&.${X.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:`start`},style:{flexDirection:`row-reverse`,marginRight:-11}},{props:{labelPlacement:`top`},style:{flexDirection:`column-reverse`}},{props:{labelPlacement:`bottom`},style:{flexDirection:`column`}},{props:({labelPlacement:e})=>e===`start`||e===`top`||e===`bottom`,style:{marginLeft:16}}]})));var Q=E(`span`,{name:`MuiFormControlLabel`,slot:`Asterisk`})(C(({theme:e})=>({[`&.${X.error}`]:{color:(e.vars||e).palette.error.main}}))),Me=H.forwardRef(function(e,n){let r=v({props:e,name:`MuiFormControlLabel`}),{checked:a,className:o,componentsProps:s={},control:c,disabled:l,disableTypography:u,inputRef:d,label:f,labelPlacement:p=`end`,name:m,onChange:h,required:ee,slots:g={},slotProps:_={},value:y,...b}=r,x=t(),S=l??c.props.disabled??x?.disabled,te=ee??c.props.required,C={disabled:S,required:te};[`checked`,`name`,`onChange`,`value`,`inputRef`].forEach(e=>{c.props[e]===void 0&&r[e]!==void 0&&(C[e]=r[e])});let ne=i({props:r,muiFormControl:x,states:[`error`]}),w={...r,disabled:S,labelPlacement:p,required:te,error:ne.error},T=Z(w),[E,D]=z(`typography`,{elementType:F,externalForwardedProps:{slots:g,slotProps:{...s,..._}},ownerState:w}),O=f;return O!=null&&O.type!==F&&!u&&(O=(0,U.jsx)(E,{component:`span`,...D,className:j(T.label,D?.className),children:O})),(0,U.jsxs)(je,{className:j(T.root,o),ownerState:w,ref:n,...b,children:[H.cloneElement(c,C),te?(0,U.jsxs)(`div`,{children:[O,(0,U.jsxs)(Q,{ownerState:w,"aria-hidden":!0,className:T.asterisk,children:[` `,`*`]})]}):O]})});function Ne(e){return R(`MuiTooltip`,e)}var $=I(`MuiTooltip`,[`popper`,`popperInteractive`,`popperArrow`,`popperClose`,`tooltip`,`tooltipArrow`,`touch`,`tooltipPlacementLeft`,`tooltipPlacementRight`,`tooltipPlacementTop`,`tooltipPlacementBottom`,`arrow`]);function Pe(e){return Math.round(e*1e5)/1e5}var Fe=e=>{let{classes:t,disableInteractive:n,arrow:r,touch:i,placement:a}=e;return D({popper:[`popper`,!n&&`popperInteractive`,r&&`popperArrow`],tooltip:[`tooltip`,r&&`tooltipArrow`,i&&`touch`,`tooltipPlacement${B(a.split(`-`)[0])}`],arrow:[`arrow`]},Ne,t)},Ie=E(l,{name:`MuiTooltip`,slot:`Popper`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.popper,!n.disableInteractive&&t.popperInteractive,n.arrow&&t.popperArrow,!n.open&&t.popperClose]}})(C(({theme:e})=>({zIndex:(e.vars||e).zIndex.tooltip,pointerEvents:`none`,variants:[{props:({ownerState:e})=>!e.disableInteractive,style:{pointerEvents:`auto`}},{props:({open:e})=>!e,style:{pointerEvents:`none`}},{props:({ownerState:e})=>e.arrow,style:{[`&[data-popper-placement*="bottom"] .${$.arrow}`]:{top:0,marginTop:`-0.71em`,"&::before":{transformOrigin:`0 100%`}},[`&[data-popper-placement*="top"] .${$.arrow}`]:{bottom:0,marginBottom:`-0.71em`,"&::before":{transformOrigin:`100% 0`}},[`&[data-popper-placement*="right"] .${$.arrow}`]:{height:`1em`,width:`0.71em`,"&::before":{transformOrigin:`100% 100%`}},[`&[data-popper-placement*="left"] .${$.arrow}`]:{height:`1em`,width:`0.71em`,"&::before":{transformOrigin:`0 0`}}}},{props:({ownerState:e})=>e.arrow&&!e.isRtl,style:{[`&[data-popper-placement*="right"] .${$.arrow}`]:{left:0,marginLeft:`-0.71em`}}},{props:({ownerState:e})=>e.arrow&&!!e.isRtl,style:{[`&[data-popper-placement*="right"] .${$.arrow}`]:{right:0,marginRight:`-0.71em`}}},{props:({ownerState:e})=>e.arrow&&!e.isRtl,style:{[`&[data-popper-placement*="left"] .${$.arrow}`]:{right:0,marginRight:`-0.71em`}}},{props:({ownerState:e})=>e.arrow&&!!e.isRtl,style:{[`&[data-popper-placement*="left"] .${$.arrow}`]:{left:0,marginLeft:`-0.71em`}}}]}))),Le=E(`div`,{name:`MuiTooltip`,slot:`Tooltip`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.tooltip,n.touch&&t.touch,n.arrow&&t.tooltipArrow,t[`tooltipPlacement${B(n.placement.split(`-`)[0])}`]]}})(C(({theme:e})=>({backgroundColor:e.vars?e.vars.palette.Tooltip.bg:e.alpha(e.palette.grey[700],.92),borderRadius:(e.vars||e).shape.borderRadius,color:(e.vars||e).palette.common.white,fontFamily:e.typography.fontFamily,padding:`4px 8px`,fontSize:e.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:`break-word`,fontWeight:e.typography.fontWeightMedium,[`.${$.popper}[data-popper-placement*="left"] &`]:{transformOrigin:`right center`},[`.${$.popper}[data-popper-placement*="right"] &`]:{transformOrigin:`left center`},[`.${$.popper}[data-popper-placement*="top"] &`]:{transformOrigin:`center bottom`,marginBottom:`14px`},[`.${$.popper}[data-popper-placement*="bottom"] &`]:{transformOrigin:`center top`,marginTop:`14px`},variants:[{props:({ownerState:e})=>e.arrow,style:{position:`relative`,margin:0}},{props:({ownerState:e})=>e.touch,style:{padding:`8px 16px`,fontSize:e.typography.pxToRem(14),lineHeight:`${Pe(16/14)}em`,fontWeight:e.typography.fontWeightRegular}},{props:({ownerState:e})=>!e.isRtl,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginRight:`14px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginLeft:`14px`}}},{props:({ownerState:e})=>!e.isRtl&&e.touch,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginRight:`24px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginLeft:`24px`}}},{props:({ownerState:e})=>!!e.isRtl,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginLeft:`14px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginRight:`14px`}}},{props:({ownerState:e})=>!!e.isRtl&&e.touch,style:{[`.${$.popper}[data-popper-placement*="left"] &`]:{marginLeft:`24px`},[`.${$.popper}[data-popper-placement*="right"] &`]:{marginRight:`24px`}}},{props:({ownerState:e})=>e.touch,style:{[`.${$.popper}[data-popper-placement*="top"] &`]:{marginBottom:`24px`}}},{props:({ownerState:e})=>e.touch,style:{[`.${$.popper}[data-popper-placement*="bottom"] &`]:{marginTop:`24px`}}}]}))),Re=E(`span`,{name:`MuiTooltip`,slot:`Arrow`})(C(({theme:e})=>({overflow:`hidden`,position:`absolute`,width:`1em`,height:`0.71em`,boxSizing:`border-box`,color:e.vars?e.vars.palette.Tooltip.bg:e.alpha(e.palette.grey[700],.9),"&::before":{content:`""`,margin:`auto`,display:`block`,width:`100%`,height:`100%`,backgroundColor:`currentColor`,transform:`rotate(45deg)`}}))),ze=!1,Be=new he,Ve={x:0,y:0};function He(e,t){return(n,...r)=>{t&&t(n,...r),e(n,...r)}}var Ue=H.forwardRef(function(e,t){let n=v({props:e,name:`MuiTooltip`}),{arrow:r=!1,children:i,classes:a,components:o={},componentsProps:s={},describeChild:u=!1,disableFocusListener:d=!1,disableHoverListener:f=!1,disableInteractive:h=!1,disableTouchListener:ee=!1,enterDelay:g=100,enterNextDelay:_=0,enterTouchDelay:y=700,followCursor:b=!1,id:te,leaveDelay:C=0,leaveTouchDelay:ne=1500,onClose:T,onOpen:E,open:D,placement:O=`bottom`,PopperComponent:re,PopperProps:k={},slotProps:A={},slots:ae={},title:M,TransitionComponent:N,TransitionProps:oe,...se}=n,F=H.isValidElement(i)?i:(0,U.jsx)(`span`,{children:i}),ce=fe(),le=p(),[I,L]=H.useState(),[ue,de]=H.useState(null),R=H.useRef(!1),me=h||b,he=w(),ge=w(),_e=w(),B=w(),[ve,ye]=c({controlled:D,default:!1,name:`Tooltip`,state:`open`}),V=ve,be=S(te),W=H.useRef(),G=x(()=>{W.current!==void 0&&(document.body.style.WebkitUserSelect=W.current,W.current=void 0),B.clear()});H.useEffect(()=>G,[G]);let K=e=>{Be.clear(),ze=!0,ye(!0),E&&!V&&E(e)},q=x(e=>{Be.start(800+C,()=>{ze=!1}),ye(!1),T&&V&&T(e),he.start(ce.transitions.duration.shortest,()=>{R.current=!1})}),xe=e=>{R.current&&e.type!==`touchstart`||(I&&I.removeAttribute(`title`),ge.clear(),_e.clear(),g||ze&&_?ge.start(ze?_:g,()=>{K(e)}):K(e))},J=e=>{ge.clear(),_e.start(C,()=>{q(e)})},[,Se]=H.useState(!1),Ce=e=>{P(e.target)||(Se(!1),J(e))},we=e=>{I||L(e.currentTarget),P(e.target)&&(Se(!0),xe(e))},Te=e=>{R.current=!0;let t=F.props;t.onTouchStart&&t.onTouchStart(e)},Ee=e=>{Te(e),_e.clear(),he.clear(),G(),W.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect=`none`,B.start(y,()=>{document.body.style.WebkitUserSelect=W.current,xe(e)})},De=e=>{F.props.onTouchEnd&&F.props.onTouchEnd(e),G(),_e.start(ne,()=>{q(e)})};H.useEffect(()=>{if(!V)return;function e(e){e.key===`Escape`&&q(e)}return document.addEventListener(`keydown`,e),()=>{document.removeEventListener(`keydown`,e)}},[q,V]);let Oe=m(ie(F),L,t);!M&&M!==0&&(V=!1);let ke=H.useRef(),Ae=e=>{let t=F.props;t.onMouseMove&&t.onMouseMove(e),Ve={x:e.clientX,y:e.clientY},ke.current&&ke.current.update()},Y={},X=typeof M==`string`;u?(Y.title=!V&&X&&!f?M:null,Y[`aria-describedby`]=V?be:null):(Y[`aria-label`]=X?M:null,Y[`aria-labelledby`]=V&&!X?be:null);let Z={...Y,...se,...F.props,className:j(se.className,F.props.className),onTouchStart:Te,ref:Oe,...b?{onMouseMove:Ae}:{}},je={};ee||(Z.onTouchStart=Ee,Z.onTouchEnd=De),f||(Z.onMouseOver=He(xe,Z.onMouseOver),Z.onMouseLeave=He(J,Z.onMouseLeave),me||(je.onMouseOver=xe,je.onMouseLeave=J)),d||(Z.onFocus=He(we,Z.onFocus),Z.onBlur=He(Ce,Z.onBlur),me||(je.onFocus=we,je.onBlur=Ce));let Q={...n,isRtl:le,arrow:r,disableInteractive:me,placement:O,PopperComponentProp:re,touch:R.current},Me=typeof A.popper==`function`?A.popper(Q):A.popper,Ne=H.useMemo(()=>{let e=[{name:`arrow`,enabled:!!ue,options:{element:ue,padding:4}}];return k.popperOptions?.modifiers&&(e=e.concat(k.popperOptions.modifiers)),Me?.popperOptions?.modifiers&&(e=e.concat(Me.popperOptions.modifiers)),{...k.popperOptions,...Me?.popperOptions,modifiers:e}},[ue,k.popperOptions,Me?.popperOptions]),$=Fe(Q),Pe=typeof A.transition==`function`?A.transition(Q):A.transition,Ue={slots:{popper:o.Popper,transition:o.Transition??N,tooltip:o.Tooltip,arrow:o.Arrow,...ae},slotProps:{arrow:A.arrow??s.arrow,popper:{...k,...Me??s.popper},tooltip:A.tooltip??s.tooltip,transition:{...oe,...Pe??s.transition}}},[We,Ge]=z(`popper`,{elementType:Ie,externalForwardedProps:Ue,ownerState:Q,className:j($.popper,k?.className)}),[Ke,qe]=z(`transition`,{elementType:pe,externalForwardedProps:Ue,ownerState:Q}),[Je,Ye]=z(`tooltip`,{elementType:Le,className:$.tooltip,externalForwardedProps:Ue,ownerState:Q}),[Xe,Ze]=z(`arrow`,{elementType:Re,className:$.arrow,externalForwardedProps:Ue,ownerState:Q,ref:de});return(0,U.jsxs)(H.Fragment,{children:[H.cloneElement(F,Z),(0,U.jsx)(We,{as:re??l,placement:O,anchorEl:b?{getBoundingClientRect:()=>({top:Ve.y,left:Ve.x,right:Ve.x,bottom:Ve.y,width:0,height:0})}:I,popperRef:ke,open:I?V:!1,id:be,transition:!0,...je,...Ge,popperOptions:Ne,children:({TransitionProps:e})=>(0,U.jsx)(Ke,{timeout:ce.transitions.duration.shorter,...e,...qe,children:(0,U.jsxs)(Je,{...Ye,children:[M,r?(0,U.jsx)(Xe,{...Ze}):null]})})})]})});function We(){let{showSuccess:t}=V(),{confirm:i,isOpen:o,options:c,handleConfirm:l,handleCancel:p}=ve(),[m,h]=(0,H.useState)([]),[_,v]=(0,H.useState)(!0),[y,b]=(0,H.useState)(null),[x,S]=(0,H.useState)(!1),[C,ne]=(0,H.useState)(null),[w,E]=(0,H.useState)(null),[D,j]=(0,H.useState)(null),[ie,ae]=(0,H.useState)(``),[N,P]=(0,H.useState)(``),[se,ce]=(0,H.useState)(!0),[le,I]=(0,H.useState)(`off`),[de,fe]=(0,H.useState)(`full`),[R,pe]=(0,H.useState)(!1),[z,he]=(0,H.useState)(null),[B,be]=(0,H.useState)({}),[W,G]=(0,H.useState)(`full`),K=(0,H.useCallback)(async()=>{try{v(!0),b(null),h(await O())}catch(e){b(e instanceof Error?e.message:`Failed to load libraries`),console.error(`[LibraryManagement] Load error:`,e)}finally{v(!1)}},[]),q=(0,H.useCallback)(async()=>{try{let e=await O();h(t=>{if(t.length!==e.length)return e;let n=new Map(e.map(e=>[e.library_id,e])),r=!1;for(let e of t){let t=n.get(e.library_id);if(!t){r=!0;break}if(e.scanStatus!==t.scanStatus||e.scanProgress!==t.scanProgress||e.scanTotal!==t.scanTotal||e.scanError!==t.scanError||e.scannedAt!==t.scannedAt||e.fileCount!==t.fileCount||e.folderCount!==t.folderCount){r=!0;break}}return r?t.map(e=>{let t=n.get(e.library_id);return!t||e.scanStatus===t.scanStatus&&e.scanProgress===t.scanProgress&&e.scanTotal===t.scanTotal&&e.scanError===t.scanError&&e.scannedAt===t.scannedAt&&e.fileCount===t.fileCount&&e.folderCount===t.folderCount?e:t}):t})}catch(e){console.error(`[LibraryManagement] Refresh error:`,e)}},[]),xe=async()=>{try{j((await re()).library_root||null)}catch(e){console.error(`[LibraryManagement] Failed to load config:`,e)}};(0,H.useEffect)(()=>{K(),xe()},[K]),(0,H.useEffect)(()=>{let e=!0,t=null,n=async()=>{try{let n=await ee();if(!e)return;n.is_busy?t||=setInterval(()=>{q()},500):t&&(clearInterval(t),t=null,q())}catch(e){console.error(`[LibraryManagement] Failed to check work status:`,e)}};n();let r=setInterval(n,5e3);return()=>{e=!1,t&&clearInterval(t),clearInterval(r)}},[q]);let J=e=>{if(!D)return!1;let t=D.replace(/\/+$/,``);return!e.replace(/\/+$/,``).startsWith(t)},Se=()=>{ae(``),P(``),ce(!0),I(`off`),fe(`full`),G(`full`),pe(!1),S(!1),ne(null)},Ce=()=>{Se(),S(!0)},we=e=>{ae(e.name),P(e.rootPath),ce(e.isEnabled),I(e.watchMode),fe(e.fileWriteMode),G(e.fileWriteMode),ne(e.library_id),S(!1)},Te=async()=>{if(!N.trim()){b(`Path is required`);return}try{b(null),await M({name:ie.trim()||null,rootPath:N,isEnabled:se,watchMode:le,fileWriteMode:de}),await K(),Se()}catch(e){b(e instanceof Error?e.message:`Failed to create library`)}},Ee=async()=>{if(C===null)return;if(!N.trim()){b(`Path is required`);return}let e=de!==W;try{if(b(null),await A(C,{name:ie.trim()||void 0,rootPath:N,isEnabled:se,watchMode:le,...e?{}:{fileWriteMode:de}}),e){let e=await ge(C,de);e.requires_reconciliation&&e.affected_file_count>0&&await i({title:`Reconcile Tags?`,message:`${e.affected_file_count} files need to be rewritten with the new tag format. Reconcile now?`,severity:`info`})&&await Q(C)}await K(),Se()}catch(e){b(e instanceof Error?e.message:`Failed to update library`)}},De=async(e,n)=>{try{b(null),E(e);let r=await _e(e,n);t(r.message||`Library scan started (${r.stats?.files_queued??0} files)`),await K()}catch(e){b(e instanceof Error?e.message:`Failed to scan library`)}finally{E(null)}},Oe=async(e,t)=>{if(await i({title:`Delete Library?`,message:`Delete library "${t}"?\n\nThis will remove the library entry but will NOT delete files on disk.`,severity:`warning`}))try{b(null),await ue(e),await K()}catch(e){b(e instanceof Error?e.message:`Failed to delete library`)}},ke=async(e,n)=>{try{b(null),await A(e,{watchMode:n}),await K(),t(`File watching mode changed to ${n}`)}catch(e){b(e instanceof Error?e.message:`Failed to change watch mode`)}},Y=e=>{switch(e){case`event`:return`Event`;case`poll`:return`Poll`;default:return`Off`}},X=e=>{switch(e){case`event`:return`success`;case`poll`:return`warning`;default:return`default`}},Z=e=>{switch(e){case`none`:return`None`;case`minimal`:return`Minimal`;case`full`:return`Full`}},je=e=>{switch(e){case`none`:return`default`;case`minimal`:return`secondary`;case`full`:return`primary`}},Q=async e=>{try{b(null),he(e);let n=await me(e);t(`Reconciled ${n.processed} files (${n.remaining} remaining, ${n.failed} failed)`);let r=await oe(e);be(t=>({...t,[e]:{pending:r.pending_count,inProgress:r.in_progress}}))}catch(e){b(e instanceof Error?e.message:`Failed to reconcile tags`)}finally{he(null)}},Ne=async e=>{try{let t=await oe(e);be(n=>({...n,[e]:{pending:t.pending_count,inProgress:t.in_progress}}))}catch{}},$=x||C!==null;return(0,U.jsxs)(e,{spacing:2.5,children:[(0,U.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`center`,children:[(0,U.jsx)(F,{variant:`h5`,children:`Libraries`}),!$&&(0,U.jsx)(k,{variant:`contained`,onClick:Ce,children:`+ Add Library`})]}),y&&(0,U.jsx)(g,{children:y}),$&&(0,U.jsxs)(f,{children:[(0,U.jsx)(te,{title:x?`Create Library`:`Edit Library`}),(0,U.jsxs)(e,{spacing:2,children:[(0,U.jsxs)(L,{children:[(0,U.jsx)(F,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Name (optional)`}),(0,U.jsx)(s,{value:ie,onChange:e=>ae(e.target.value),placeholder:`Auto-generated from path if left empty`,fullWidth:!0})]}),(0,U.jsxs)(L,{children:[(0,U.jsx)(F,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Root Path`}),(0,U.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,U.jsx)(s,{value:N,onChange:e=>P(e.target.value),placeholder:`/music`,fullWidth:!0}),(0,U.jsx)(k,{variant:`outlined`,onClick:()=>pe(!R),sx:{minWidth:120},children:R?`Hide Picker`:`Browse...`})]}),R&&(0,U.jsx)(L,{sx:{mt:1.25,p:2,bgcolor:`background.default`,borderRadius:1,border:1,borderColor:`divider`},children:(0,U.jsx)(ye,{value:N,onChange:e=>{P(e),pe(!1)},mode:`directory`,label:`Select Library Root Directory`})})]}),(0,U.jsx)(Me,{control:(0,U.jsx)(Ae,{checked:se,onChange:e=>ce(e.target.checked)}),label:`Enabled`}),(0,U.jsx)(L,{children:(0,U.jsxs)(n,{fullWidth:!0,children:[(0,U.jsx)(a,{id:`watch-mode-label`,children:`File Watching`}),(0,U.jsxs)(r,{labelId:`watch-mode-label`,value:le,label:`File Watching`,onChange:e=>I(e.target.value),children:[(0,U.jsx)(d,{value:`off`,children:(0,U.jsxs)(e,{children:[(0,U.jsxs)(F,{children:[(0,U.jsx)(`strong`,{children:`Off`}),` - No automatic scanning`]}),(0,U.jsx)(F,{variant:`caption`,color:`text.secondary`,children:`Manual scans only`})]})}),(0,U.jsx)(d,{value:`event`,children:(0,U.jsxs)(e,{children:[(0,U.jsxs)(F,{children:[(0,U.jsx)(`strong`,{children:`Event`}),` - Real-time file watching`]}),(0,U.jsx)(F,{variant:`caption`,color:`text.secondary`,children:`Fast (2-5s response), local filesystems only`})]})}),(0,U.jsx)(d,{value:`poll`,children:(0,U.jsxs)(e,{children:[(0,U.jsxs)(F,{children:[(0,U.jsx)(`strong`,{children:`Poll`}),` - Periodic scanning`]}),(0,U.jsx)(F,{variant:`caption`,color:`text.secondary`,children:`Slower (60s interval), network-mount-safe`})]})})]})]})}),(0,U.jsx)(L,{children:(0,U.jsxs)(n,{fullWidth:!0,children:[(0,U.jsx)(a,{id:`write-mode-label`,children:`Tag Writing Mode`}),(0,U.jsxs)(r,{labelId:`write-mode-label`,value:de,label:`Tag Writing Mode`,onChange:e=>fe(e.target.value),children:[(0,U.jsx)(d,{value:`none`,children:(0,U.jsxs)(e,{children:[(0,U.jsxs)(F,{children:[(0,U.jsx)(`strong`,{children:`None`}),` - Don't write tags to files`]}),(0,U.jsx)(F,{variant:`caption`,color:`text.secondary`,children:`DB is source of truth; clears existing nomarr tags`})]})}),(0,U.jsx)(d,{value:`minimal`,children:(0,U.jsxs)(e,{children:[(0,U.jsxs)(F,{children:[(0,U.jsx)(`strong`,{children:`Minimal`}),` - Mood tags only`]}),(0,U.jsx)(F,{variant:`caption`,color:`text.secondary`,children:`Write mood-strict, mood-regular, mood-loose`})]})}),(0,U.jsx)(d,{value:`full`,children:(0,U.jsxs)(e,{children:[(0,U.jsxs)(F,{children:[(0,U.jsx)(`strong`,{children:`Full`}),` - All tags`]}),(0,U.jsx)(F,{variant:`caption`,color:`text.secondary`,children:`Write all ML-derived tags to audio files`})]})})]})]})}),(0,U.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,U.jsx)(k,{variant:`contained`,onClick:x?Te:Ee,children:x?`Create`:`Update`}),(0,U.jsx)(k,{variant:`outlined`,onClick:Se,children:`Cancel`})]})]})]}),_&&(0,U.jsx)(F,{children:`Loading libraries...`}),!_&&!$&&m.length===0&&(0,U.jsx)(f,{children:(0,U.jsx)(F,{color:`text.secondary`,textAlign:`center`,fontStyle:`italic`,children:`No libraries configured. Click "Add Library" to get started.`})}),!_&&!$&&m.length>0&&(0,U.jsx)(e,{spacing:2,children:m.map(t=>(0,U.jsxs)(f,{children:[(0,U.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`flex-start`,sx:{mb:2},children:[(0,U.jsxs)(L,{children:[(0,U.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1.25,sx:{mb:.5},children:[(0,U.jsx)(F,{variant:`h6`,children:t.name}),J(t.rootPath)&&(0,U.jsx)(u,{label:`Outside library_root`,color:`warning`,size:`small`})]}),(0,U.jsx)(F,{variant:`body2`,color:`text.secondary`,sx:{fontFamily:`monospace`},children:t.rootPath}),(0,U.jsxs)(e,{direction:`row`,spacing:2,sx:{mt:.5},children:[(0,U.jsxs)(F,{variant:`body2`,color:`text.secondary`,children:[(0,U.jsx)(`strong`,{children:t.fileCount.toLocaleString()}),` files`]}),(0,U.jsxs)(F,{variant:`body2`,color:`text.secondary`,children:[(0,U.jsx)(`strong`,{children:t.folderCount.toLocaleString()}),` folders`]})]}),t.scanStatus===`scanning`&&(0,U.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:.5},children:[(0,U.jsx)(u,{label:`Scanning...`,color:`info`,size:`small`,sx:{animation:`pulse 1.5s infinite`}}),t.scanProgress!=null&&t.scanTotal!=null&&t.scanTotal>0&&(0,U.jsxs)(F,{variant:`body2`,color:`info.main`,children:[t.scanProgress.toLocaleString(),` / `,t.scanTotal.toLocaleString(),` files`,` `,`(`,Math.round(t.scanProgress/t.scanTotal*100),`%)`]})]}),t.scanStatus===`error`&&t.scanError&&(0,U.jsxs)(F,{variant:`caption`,color:`error.main`,sx:{mt:.5},children:[`⚠ Scan error: `,t.scanError]}),J(t.rootPath)&&(0,U.jsxs)(F,{variant:`caption`,color:`warning.main`,sx:{mt:.5},children:[`⚠ This library is outside the configured library_root (`,D,`)`]}),(0,U.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:1},children:[(0,U.jsx)(F,{variant:`caption`,color:`text.secondary`,children:`File Watching:`}),(0,U.jsx)(n,{size:`small`,sx:{minWidth:120},children:(0,U.jsxs)(r,{value:t.watchMode,onChange:e=>ke(t.library_id,e.target.value),size:`small`,sx:{fontSize:`0.75rem`},disabled:w===t.library_id,children:[(0,U.jsx)(d,{value:`off`,children:`Off`}),(0,U.jsx)(d,{value:`event`,children:`Event`}),(0,U.jsx)(d,{value:`poll`,children:`Poll`})]})}),(0,U.jsx)(Ue,{title:t.watchMode===`event`?`Real-time file watching (local filesystems)`:t.watchMode===`poll`?`Periodic scanning (network-mount-safe)`:`No automatic file watching`,children:(0,U.jsx)(u,{label:Y(t.watchMode),color:X(t.watchMode),size:`small`})})]}),(0,U.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:.5},children:[(0,U.jsx)(F,{variant:`caption`,color:`text.secondary`,children:`Tag Writing:`}),(0,U.jsx)(Ue,{title:t.fileWriteMode===`full`?`All ML-derived tags written to audio files`:t.fileWriteMode===`minimal`?`Only mood tags written to audio files`:`No tags written to audio files (DB only)`,children:(0,U.jsx)(u,{label:Z(t.fileWriteMode),color:je(t.fileWriteMode),size:`small`})}),B[t.library_id]?.pending>0&&(0,U.jsx)(u,{label:`${B[t.library_id].pending} pending`,color:`warning`,size:`small`})]})]}),(0,U.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,children:[(0,U.jsx)(L,{sx:{width:8,height:8,borderRadius:`50%`,bgcolor:t.isEnabled?`success.main`:`text.disabled`}}),(0,U.jsx)(F,{variant:`body2`,color:`text.secondary`,children:t.isEnabled?`Enabled`:`Disabled`})]})]}),(0,U.jsxs)(e,{direction:`row`,spacing:1.25,flexWrap:`wrap`,children:[(0,U.jsx)(k,{variant:`outlined`,size:`small`,onClick:()=>we(t),disabled:w===t.library_id,children:`Edit`}),(0,U.jsx)(k,{variant:`outlined`,color:`success`,size:`small`,onClick:()=>De(t.library_id,`quick`),disabled:!t.isEnabled||w===t.library_id||t.scanStatus===`scanning`||J(t.rootPath)||!t.scannedAt,title:t.scannedAt?t.scanStatus===`scanning`?`Scan already in progress`:J(t.rootPath)?`Cannot scan: library is outside library_root`:`Scan only new and modified files`:`Run a Full Scan first before using Quick Scan`,children:w===t.library_id||t.scanStatus===`scanning`?`Scanning...`:`Quick Scan`}),(0,U.jsx)(k,{variant:`contained`,color:`success`,size:`small`,onClick:()=>De(t.library_id,`full`),disabled:!t.isEnabled||w===t.library_id||t.scanStatus===`scanning`||J(t.rootPath),title:t.scanStatus===`scanning`?`Scan already in progress`:J(t.rootPath)?`Cannot scan: library is outside library_root`:`Rescan all files in the library`,children:w===t.library_id||t.scanStatus===`scanning`?`Scanning...`:`Full Scan`}),(0,U.jsx)(k,{variant:`outlined`,color:`secondary`,size:`small`,onClick:()=>Q(t.library_id),disabled:!t.isEnabled||z===t.library_id||t.scanStatus===`scanning`,title:z===t.library_id?`Reconciling tags...`:`Write tags from database to audio files`,onMouseEnter:()=>Ne(t.library_id),children:z===t.library_id?`Reconciling...`:`Reconcile Tags`}),(0,U.jsx)(k,{variant:`contained`,color:`error`,size:`small`,onClick:()=>Oe(t.library_id,t.name),disabled:w===t.library_id,children:`Delete`})]})]},t.library_id))}),(0,U.jsx)(T,{open:o,title:c.title,message:c.message,confirmLabel:c.confirmLabel,cancelLabel:c.cancelLabel,severity:c.severity,onConfirm:l,onCancel:p})]})}var Ge={file_write_mode:{label:`Tag Writing Mode`,description:`Controls which tags are written to audio files`,type:`select`,options:[{value:`none`,label:`None - Tags stored in database only`},{value:`minimal`,label:`Minimal - Essential tags only (artist, album, title, genre)`},{value:`full`,label:`Full - All generated tags written to files`}]},overwrite_tags:{label:`Overwrite Existing Tags`,description:`Whether to overwrite existing tags in audio files`,type:`boolean`},library_auto_tag:{label:`Auto-Tag New Files`,description:`Automatically process new files found during library scans`,type:`boolean`},library_ignore_patterns:{label:`Ignore Patterns`,description:`Comma-separated patterns to ignore during scanning (e.g., */Audiobooks/*,*.tmp)`,type:`text`},tagger_worker_count:{label:`Worker Threads`,description:`Number of parallel worker processes for tagging (0 = auto-detect)`,type:`text`},cache_idle_timeout:{label:`Cache Timeout (seconds)`,description:`How long to keep ML models in memory when idle`,type:`text`},calibrate_heads:{label:`Auto-Calibrate Heads`,description:`Automatically calibrate tag thresholds for optimal results`,type:`boolean`},calibration_repo:{label:`Calibration Repository`,description:`Git repository URL for calibration data downloads`,type:`text`}};function Ke({configKey:e,value:t,onChange:n,disabled:i}){let a=t==null?``:String(t),o=Ge[e],c=o?.label||e,l=o?.description,u=o?.type||(typeof t==`boolean`?`boolean`:`text`),f=o?.options||[];return(0,U.jsxs)(L,{sx:{display:`flex`,gap:2,alignItems:`flex-start`,py:1},children:[(0,U.jsxs)(L,{sx:{minWidth:`280px`,flexShrink:0},children:[(0,U.jsx)(F,{variant:`body2`,color:`text.primary`,sx:{fontWeight:500,mb:l?.5:0},children:c}),l&&(0,U.jsx)(F,{variant:`caption`,color:`text.secondary`,sx:{display:`block`},children:l})]}),(0,U.jsx)(L,{sx:{flex:1,maxWidth:`400px`},children:(()=>u===`select`&&f.length>0?(0,U.jsx)(r,{value:a,onChange:t=>n(e,t.target.value),disabled:i,size:`small`,fullWidth:!0,children:f.map(({value:e,label:t})=>(0,U.jsx)(d,{value:e,children:t},e))}):u===`boolean`?(0,U.jsxs)(r,{value:a,onChange:t=>n(e,t.target.value),disabled:i,size:`small`,fullWidth:!0,children:[(0,U.jsx)(d,{value:`true`,children:`true`}),(0,U.jsx)(d,{value:`false`,children:`false`})]}):(0,U.jsx)(s,{type:`text`,value:a,onChange:t=>n(e,t.target.value),disabled:i,size:`small`,fullWidth:!0,placeholder:l}))()})]})}function qe({config:t,hasChanges:n,saveLoading:r,onChange:i,onSaveAll:a}){return(0,U.jsxs)(f,{children:[(0,U.jsx)(te,{title:`Settings`}),(0,U.jsx)(F,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Changes are saved to the database and will take effect on server restart. Use "Restart Server" in Admin page to apply changes.`}),(0,U.jsx)(e,{spacing:1.875,children:Object.entries(t).map(([e,t])=>(0,U.jsx)(Ke,{configKey:e,value:t,onChange:i,disabled:r},e))}),(0,U.jsxs)(L,{sx:{mt:3.75,display:`flex`,gap:1.25,alignItems:`center`},children:[(0,U.jsx)(k,{onClick:a,variant:`contained`,disabled:!n||r,sx:{whiteSpace:`nowrap`},children:r?`Saving...`:`Save All Changes`}),n&&(0,U.jsx)(F,{variant:`body2`,color:`warning.main`,children:`Unsaved changes`})]})]})}function Je(){let{showSuccess:e,showError:t,showInfo:n}=V(),[r,i]=(0,H.useState)({}),[a,o]=(0,H.useState)({}),[s,c]=(0,H.useState)(!0),[l,u]=(0,H.useState)(null),[d,f]=(0,H.useState)(!1),[p,m]=(0,H.useState)(!1),h=async()=>{try{c(!0),u(null);let e=await re();i(e),o(e),m(!1)}catch(e){u(e instanceof Error?e.message:`Failed to load config`),console.error(`[Config] Load error:`,e)}finally{c(!1)}};return(0,H.useEffect)(()=>{h()},[]),(0,H.useEffect)(()=>{m(Object.keys(r).some(e=>r[e]!==a[e]))},[r,a]),{config:r,loading:s,error:l,saveLoading:d,hasChanges:p,handleSaveAll:async()=>{try{f(!0);let t=[];for(let e of Object.keys(r))if(r[e]!==a[e]){let n=r[e];if(n==null||n===``)continue;await le(e,String(n)),t.push(e)}if(t.length===0){n(`No changes to save`);return}e(`Saved ${t.length} config change(s). Use "Restart Server" in Admin page to apply.`),await h()}catch(e){t(e instanceof Error?e.message:`Failed to save config`)}finally{f(!1)}},handleChange:(e,t)=>{i(n=>({...n,[e]:t}))}}}function Ye(){let{config:t,loading:n,error:r,saveLoading:i,hasChanges:a,handleSaveAll:o,handleChange:s}=Je();return(0,U.jsxs)(y,{title:`Configuration`,children:[n&&(0,U.jsx)(de,{}),r&&(0,U.jsxs)(ae,{severity:`error`,children:[`Error: `,r]}),!n&&!r&&(0,U.jsxs)(e,{spacing:2.5,children:[(0,U.jsx)(We,{}),(0,U.jsx)(qe,{config:t,hasChanges:a,saveLoading:i,onChange:s,onSaveAll:o})]})]})}export{Ye as ConfigPage};