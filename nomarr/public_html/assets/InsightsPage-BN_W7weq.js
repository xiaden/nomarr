import{n as e,t}from"./Stack-BzyI_LD-.js";import{At as n,C as r,Ct as i,D as a,Dt as o,E as s,Et as c,Ft as l,M as u,N as d,Nt as f,O as p,Q as m,S as h,T as g,Z as _,_ as v,_t as y,a as b,b as x,c as S,ct as C,et as w,f as T,gt as E,h as D,ht as O,i as k,it as A,j as ee,jt as te,k as j,kt as ne,l as re,m as M,mt as ie,n as ae,nt as oe,o as se,p as N,r as ce,s as le,t as ue,tt as de,v as fe,w as pe,x as me,y as he,yt as ge}from"./ChartsWrapper-CIS4JKUq.js";import"./List-cMzo8xld.js";import{i as _e,n as ve,r as ye,t as P}from"./TextField-Cag0Q1x9.js";import"./useControlled-CHuL9TqL.js";import{a as be,c as xe,i as Se,l as Ce,n as we,o as Te,r as Ee,s as De,t as Oe,u as ke}from"./LineChart-Dq0J1Hfu.js";import"./Popper-CawmvlKu.js";import{n as F,t as Ae}from"./MenuItem-DECCXrzb.js";import"./listItemTextClasses-B4OD7pFK.js";import{a as je,i as Me,n as Ne,r as I,t as L}from"./TableRow-X8_ilPeT.js";import{$ as R,B as Pe,Cn as Fe,G as Ie,H as Le,K as Re,Lt as ze,Nt as Be,Q as z,Qt as Ve,Tn as He,V as Ue,Wt as B,Zt as We,_ as Ge,_t as Ke,at as V,c as qe,dt as Je,fn as Ye,i as Xe,kt as H,l as Ze,lt as U,n as Qe,on as $e,ot as W,pn as G,pt as et,q as tt,qt as nt,r as rt,sn as it,t as at}from"./index-B62EKSZR.js";import{t as ot}from"./useNotification-B1coadyf.js";import{t as st}from"./PieChart-GGunHg7e.js";var K=He(Fe(),1),q=He(Ye()),ct=ze((0,q.jsx)(`path`,{d:`M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z`}),`Close`);function lt(){return T(`bar`)}function ut(e,t){let n=i(e.x,t.x),r=i(e.y,t.y),a=i(e.width,t.width),o=i(e.height,t.height);return e=>({x:n(e),y:r(e),width:a(e),height:o(e)})}function dt(e){let t={x:e.layout===`vertical`?e.x:e.xOrigin,y:e.layout===`vertical`?e.yOrigin:e.y,width:e.layout===`vertical`?e.width:0,height:e.layout===`vertical`?0:e.height};return he({x:e.x,y:e.y,width:e.width,height:e.height},{createInterpolator:ut,applyProps(e,t){e.setAttribute(`x`,t.x.toString()),e.setAttribute(`y`,t.y.toString()),e.setAttribute(`width`,t.width.toString()),e.setAttribute(`height`,t.height.toString())},transformProps:e=>e,initialProps:t,skip:e.skipAnimation,ref:e.ref})}function ft(e,t){let n=i(e.x,t.x),r=i(e.y,t.y),a=i(e.width,t.width),o=i(e.height,t.height);return e=>({x:n(e),y:r(e),width:a(e),height:o(e)})}function pt(e){let{initialX:t,currentX:n,initialY:r,currentY:i}=e.placement===`outside`?ht(e):mt(e),a={x:t,y:r,width:e.width,height:e.height};return he({x:n,y:i,width:e.width,height:e.height},{createInterpolator:ft,transformProps:e=>e,applyProps(e,t){e.setAttribute(`x`,t.x.toString()),e.setAttribute(`y`,t.y.toString()),e.setAttribute(`width`,t.width.toString()),e.setAttribute(`height`,t.height.toString())},initialProps:a,skip:e.skipAnimation,ref:e.ref})}var J=4;function mt(e){return{initialX:e.layout===`vertical`?e.x+e.width/2:e.xOrigin,initialY:e.layout===`vertical`?e.yOrigin:e.y+e.height/2,currentX:e.x+e.width/2,currentY:e.y+e.height/2}}function ht(e){let t=0,n=0,r=0,i=0;return e.layout===`vertical`?(e.y<e.yOrigin?(t=e.yOrigin-J,n=e.y-J):(t=e.yOrigin+J,n=e.y+e.height+J),{initialX:e.x+e.width/2,currentX:e.x+e.width/2,initialY:t,currentY:n}):(e.x<e.xOrigin?(r=e.xOrigin,i=e.x-J):(r=e.xOrigin,i=e.x+e.width+J),{initialX:r,currentX:i,initialY:e.y+e.height/2,currentY:e.y+e.height/2})}function gt({value:e,onChange:t,options:n,placeholder:r=`Type or select...`,disabled:i=!1,...a}){let[o,s]=(0,K.useState)(!1),[c,l]=(0,K.useState)(n),u=(0,K.useRef)(null);(0,K.useEffect)(()=>{l(e?n.filter(t=>t.toLowerCase().includes(e.toLowerCase())):n)},[e,n]),(0,K.useEffect)(()=>{let e=e=>{u.current&&!u.current.contains(e.target)&&s(!1)};return document.addEventListener(`mousedown`,e),()=>document.removeEventListener(`mousedown`,e)},[]);let d=e=>{t(e.target.value),s(!0)},f=e=>{t(e),s(!1)};return(0,q.jsxs)(W,{...a,ref:u,sx:{position:`relative`,...a.sx},children:[(0,q.jsx)(P,{type:`text`,value:e,onChange:d,onFocus:()=>s(!0),placeholder:r,disabled:i,fullWidth:!0,size:`small`,sx:{"& .MuiOutlinedInput-root":{bgcolor:i?`background.paper`:`background.default`}}}),o&&!i&&c.length>0&&(0,q.jsx)(W,{sx:{position:`absolute`,top:`100%`,left:0,right:0,maxHeight:`200px`,overflowY:`auto`,bgcolor:`background.default`,border:1,borderColor:`divider`,borderTop:`none`,borderRadius:`0 0 4px 4px`,boxShadow:2,zIndex:1e3},children:c.map((e,t)=>(0,q.jsx)(W,{onClick:()=>f(e),sx:{p:1.5,cursor:`pointer`,fontSize:`0.875rem`,borderBottom:t<c.length-1?1:`none`,borderColor:`divider`,"&:hover":{bgcolor:`action.hover`}},children:e},t))})]})}function _t({libraryId:e}){let[n,r]=(0,K.useState)([]),[i,a]=(0,K.useState)([]),[o,s]=(0,K.useState)(``),[c,l]=(0,K.useState)(``),[u,d]=(0,K.useState)([]),[f,p]=(0,K.useState)([]),[m,h]=(0,K.useState)(null),[g,_]=(0,K.useState)(!1),[v,y]=(0,K.useState)(null);(0,K.useEffect)(()=>{b()},[]),(0,K.useEffect)(()=>{o?x(o):(a([]),l(``))},[o]);let b=async()=>{try{r((await qe(!0)).tag_keys)}catch(e){console.error(`[TagCoOccurrence] Failed to load tag keys:`,e)}},x=async e=>{try{let t=await Ze(e,!0),n=new Set;for(let e of t.tag_keys)if(e.startsWith(`[`)&&e.endsWith(`]`))try{let t=JSON.parse(e);Array.isArray(t)?t.forEach(e=>n.add(String(e))):n.add(e)}catch{n.add(e)}else n.add(e);a(Array.from(n).sort())}catch(e){console.error(`[TagCoOccurrence] Failed to load tag values:`,e),a([])}},S=(e,t)=>u.some(n=>n.key===e&&n.value===t)||f.some(n=>n.key===e&&n.value===t),C=()=>{o&&c&&!u.some(e=>e.key===o&&e.value===c)&&u.length<16&&d([...u,{key:o,value:c}])},w=()=>{o&&c&&!f.some(e=>e.key===o&&e.value===c)&&f.length<16&&p([...f,{key:o,value:c}])},T=e=>{d(u.filter((t,n)=>n!==e))},E=e=>{p(f.filter((t,n)=>n!==e))},D=async()=>{if(u.length===0||f.length===0){y(`Both X and Y axes must have at least one tag`);return}try{_(!0),y(null),h(await Le({x:u,y:f},e))}catch(e){y(e instanceof Error?e.message:`Failed to build matrix`),console.error(`[TagCoOccurrence] Matrix build error:`,e)}finally{_(!1)}},O=(e,t)=>{if(e===0)return`#1a1a1a`;let n=Math.min(e/t,1);return`rgb(${Math.floor(30+n*44)}, ${Math.floor(30+n*128)}, ${Math.floor(30+n*225)})`},k=m?.matrix?Math.max(...m.matrix.flat(),1):1;return(0,q.jsxs)(R,{children:[(0,q.jsx)(z,{title:`Tag Co-Occurrence Matrix`}),(0,q.jsxs)(t,{spacing:2,sx:{mb:2.5},children:[(0,q.jsxs)(W,{sx:{display:`flex`,gap:1.5,alignItems:`flex-end`},children:[(0,q.jsxs)(W,{sx:{flex:1},children:[(0,q.jsx)(U,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:`Tag Key`}),(0,q.jsx)(gt,{value:o,onChange:s,options:n,placeholder:`Select tag key...`})]}),(0,q.jsxs)(W,{sx:{flex:1},children:[(0,q.jsx)(U,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:`Tag Value`}),(0,q.jsx)(gt,{value:c,onChange:l,options:i,placeholder:`Select tag value...`,disabled:!o})]}),(0,q.jsx)(V,{onClick:C,disabled:!o||!c||u.length>=16||S(o,c),variant:`contained`,size:`small`,children:`Add to X`}),(0,q.jsx)(V,{onClick:w,disabled:!o||!c||f.length>=16||S(o,c),variant:`contained`,color:`secondary`,size:`small`,children:`Add to Y`})]}),(0,q.jsxs)(W,{children:[(0,q.jsxs)(U,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:[`X Axis (`,u.length,`/16)`]}),(0,q.jsxs)(W,{sx:{display:`flex`,flexWrap:`wrap`,gap:1,p:1.5,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minHeight:80},children:[u.length===0&&(0,q.jsx)(U,{variant:`body2`,color:`text.secondary`,children:`No tags added to X axis yet`}),u.map((e,t)=>(0,q.jsx)(F,{label:`${e.key}: ${e.value}`,onDelete:()=>T(t),deleteIcon:(0,q.jsx)(ct,{}),size:`small`},t))]})]}),(0,q.jsxs)(W,{children:[(0,q.jsxs)(U,{variant:`body2`,sx:{mb:.5,fontWeight:500},children:[`Y Axis (`,f.length,`/16)`]}),(0,q.jsxs)(W,{sx:{display:`flex`,flexWrap:`wrap`,gap:1,p:1.5,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minHeight:80},children:[f.length===0&&(0,q.jsx)(U,{variant:`body2`,color:`text.secondary`,children:`No tags added to Y axis yet`}),f.map((e,t)=>(0,q.jsx)(F,{label:`${e.key}: ${e.value}`,onDelete:()=>E(t),deleteIcon:(0,q.jsx)(ct,{}),size:`small`},t))]})]}),(0,q.jsx)(V,{onClick:D,disabled:g||u.length===0||f.length===0,variant:`contained`,fullWidth:!0,children:g?`Building Matrix...`:`Build Matrix`})]}),v&&(0,q.jsx)(U,{color:`error`,sx:{mb:2},children:v}),m&&(0,q.jsx)(W,{sx:{overflowX:`auto`,mt:2.5},children:(0,q.jsxs)(je,{size:`small`,sx:{minWidth:300},children:[(0,q.jsx)(Ne,{children:(0,q.jsxs)(L,{children:[(0,q.jsx)(I,{sx:{bgcolor:`background.default`,borderBottom:2,borderColor:`divider`,fontWeight:600},children:`Y \\ X`}),m.x.map((e,t)=>(0,q.jsxs)(I,{sx:{bgcolor:`background.default`,borderBottom:2,borderColor:`divider`,fontWeight:600},children:[e.key,`:`,(0,q.jsx)(`br`,{}),e.value]},t))]})}),(0,q.jsx)(Me,{children:m.y.map((e,t)=>(0,q.jsxs)(L,{children:[(0,q.jsxs)(I,{sx:{borderColor:`divider`,fontWeight:600},children:[e.key,`: `,e.value]}),m.x.map((e,n)=>(0,q.jsx)(I,{align:`center`,sx:{borderColor:`divider`,bgcolor:O(m.matrix[t][n],k),fontWeight:m.matrix[t][n]>0?600:`normal`},children:m.matrix[t][n]},n))]},t))})]})})]})}var vt=`nomarr:insights:accordion:`;function yt({storageKey:e,title:t,defaultExpanded:n=!0,children:r,secondary:i}){let a=`${vt}${e}`,[o,s]=(0,K.useState)(()=>{try{let e=localStorage.getItem(a);if(e!==null)return e===`true`}catch{}return n}),c=(0,K.useCallback)((e,t)=>{s(t);try{localStorage.setItem(a,String(t))}catch{}},[a]);return(0,K.useEffect)(()=>{let e=e=>{e.key===a&&e.newValue!==null&&s(e.newValue===`true`)};return window.addEventListener(`storage`,e),()=>window.removeEventListener(`storage`,e)},[a]),(0,q.jsxs)(ke,{expanded:o,onChange:c,children:[(0,q.jsxs)(xe,{expandIcon:(0,q.jsx)(De,{}),children:[(0,q.jsx)(U,{variant:`h6`,sx:{flexGrow:1},children:t}),i]}),(0,q.jsx)(Ce,{children:r})]})}function Y({sectionId:e,title:t,defaultExpanded:n=!0,children:r,secondary:i}){return(0,q.jsx)(Ke,{elevation:1,sx:{mb:2},children:(0,q.jsx)(yt,{storageKey:e,title:t,defaultExpanded:n,secondary:i,children:(0,q.jsx)(W,{sx:{px:1},children:r})})})}function bt({libraryId:e}){return(0,q.jsx)(Y,{sectionId:`advanced`,title:`Advanced Analytics`,defaultExpanded:!1,children:(0,q.jsx)(_t,{libraryId:e})})}function xt(e){return it(`MuiBarElement`,e)}const St=$e(`MuiBarElement`,[`root`,`highlighted`,`faded`,`series`]),Ct=e=>{let{classes:t,id:n,isHighlighted:r,isFaded:i}=e;return We({root:[`root`,`series-${n}`,r&&`highlighted`,i&&`faded`]},xt,t)};function wt(e){return it(`MuiBarLabel`,e)}const Tt=$e(`MuiBarLabel`,[`root`,`highlighted`,`faded`,`animate`]),Et=e=>{let{classes:t,seriesId:n,isFaded:r,isHighlighted:i,skipAnimation:a}=e;return We({root:[`root`,`series-${n}`,i&&`highlighted`,r&&`faded`,!a&&`animate`]},wt,t)};function Dt(e){let{barLabel:t,value:n,dataIndex:r,seriesId:i,height:a,width:o}=e;return t===`value`?n?n?.toString():null:t({seriesId:i,dataIndex:r,value:n},{bar:{height:a,width:o}})}var Ot=[`seriesId`,`dataIndex`,`color`,`isFaded`,`isHighlighted`,`classes`,`skipAnimation`,`layout`,`xOrigin`,`yOrigin`,`placement`,`hidden`];const kt=B(`text`,{name:`MuiBarLabel`,slot:`Root`,overridesResolver:(e,t)=>[{[`&.${Tt.faded}`]:t.faded},{[`&.${Tt.highlighted}`]:t.highlighted},t.root]})(({theme:e})=>G({},e?.typography?.body2,{stroke:`none`,fill:(e.vars||e)?.palette?.text?.primary,transitionProperty:`opacity, fill`,transitionDuration:`300ms`,transitionTimingFunction:me,pointerEvents:`none`}));function At(e){let t=l({props:e,name:`MuiBarLabel`}),{isFaded:n,hidden:r}=t,i=H(t,Ot),a=pt(t);return(0,q.jsx)(kt,G({textAnchor:jt(t),dominantBaseline:Mt(t),opacity:r?0:n?.3:1},i,a))}function jt({placement:e,layout:t,xOrigin:n,x:r}){return e===`outside`&&t===`horizontal`?r<n?`end`:`start`:`middle`}function Mt({placement:e,layout:t,yOrigin:n,y:r}){return e===`outside`?t===`horizontal`?`central`:r<n?`auto`:`hanging`:`central`}var Nt=[`seriesId`,`classes`,`color`,`dataIndex`,`barLabel`,`slots`,`slotProps`,`xOrigin`,`yOrigin`,`x`,`y`,`width`,`height`,`value`,`skipAnimation`,`layout`,`barLabelPlacement`,`hidden`],Pt=[`ownerState`];function Ft(t){let{seriesId:n,classes:r,color:i,dataIndex:a,barLabel:o,slots:s,slotProps:c,xOrigin:l,yOrigin:u,x:d,y:f,width:p,height:m,value:g,skipAnimation:_,layout:v,barLabelPlacement:y,hidden:b}=t,x=H(t,Nt),{isFaded:S,isHighlighted:C}=h({seriesId:n,dataIndex:a}),w={seriesId:n,classes:r,color:i,isFaded:S,isHighlighted:C,dataIndex:a,skipAnimation:_,layout:v},T=Et(w),E=s?.barLabel??At,D=e({elementType:E,externalSlotProps:c?.barLabel,additionalProps:G({},x,{xOrigin:l,yOrigin:u,x:d,y:f,width:p,height:m,placement:y,className:T.root}),ownerState:w}),{ownerState:O}=D,k=H(D,Pt);if(!o)return null;let A=Dt({barLabel:o,value:g,dataIndex:a,seriesId:n,height:m,width:p});return A?(0,q.jsx)(E,G({},k,O,{hidden:b,children:A})):null}var It=[`processedSeries`,`className`,`skipAnimation`];function Lt(e){let{processedSeries:t,className:n,skipAnimation:r}=e,i=H(e,It),{seriesId:a,data:o,layout:s,xOrigin:c,yOrigin:l}=t,u=t.barLabel??e.barLabel;return u?(0,q.jsx)(`g`,{className:n,"data-series":a,children:o.map(({x:e,y:n,dataIndex:o,color:d,value:f,width:p,height:m,hidden:h})=>(0,q.jsx)(Ft,G({seriesId:a,dataIndex:o,value:f,color:d,xOrigin:c,yOrigin:l,x:e,y:n,width:p,height:m,skipAnimation:r??!1,layout:s??`vertical`,hidden:h},i,{barLabel:u,barLabelPlacement:t.barLabelPlacement||`center`}),o))},a):null}var Rt=(e,t)=>{let n=`${e}-axis`,r=`${e}Axis`;return t===(e===`x`?`DEFAULT_X_AXIS_KEY`:`DEFAULT_Y_AXIS_KEY`)?`The first \`${r}\``:`The ${n} with id "${t}"`};function zt(e,t,n,r,i,a,o){let s=i[r],c=o[a],l=e?s:c,u=e?c:s,d=e?r:a,f=e?a:r,p=e?`x`:`y`,m=e?`y`:`x`;if(l.scaleType!==`band`)throw Error(`MUI X Charts: ${Rt(p,d)} should be of type "band" to display the bar series of id "${t}".`);if(l.data===void 0)throw Error(`MUI X Charts: ${Rt(p,d)} should have data property.`);if(u.scaleType===`band`||u.scaleType===`point`)throw Error(`MUI X Charts: ${Rt(m,f)} should be a continuous type to display the bar series of id "${t}".`)}function Bt(e,t,n){let r=lt()??{series:{},stackingGroups:[],seriesOrder:[]},i=M().xAxisIds[0],a=D().yAxisIds[0];return Vt(e,v(),r.stackingGroups,r.series,t,n,i,a)}function Vt(e,t,n,r,i,a,o,s){let c={};return{completedData:n.flatMap(({ids:l},u)=>{let f=e.left,p=e.left+e.width,m=e.top,h=e.top+e.height,g=new Map,_=new Map;return l.map(e=>{let l=r[e].xAxisId??o,v=r[e].yAxisId??s,y=r[e].layout,b=i[l],x=a[v],S=r[e].layout===`vertical`,C=(S?x.reverse:b.reverse)??!1;zt(S,e,r[e].stackedData.length,l,i,v,a);let w=S?b:x,T=b.scale,E=x.scale,D=Math.round(T(0)??0),O=Math.round(E(0)??0),k=d(r[e],i[l],a[v]),A=[];for(let i=0;i<w.data.length;i+=1){let a=ee({verticalLayout:S,xAxisConfig:b,yAxisConfig:x,series:r[e],dataIndex:i,numberOfGroups:n.length,groupIndex:u});if(a==null)continue;let o=r[e].stack,s=G({seriesId:e,dataIndex:i,hidden:r[e].hidden},a,{color:k(i),value:r[e].data[i],maskId:`${t}_${o||e}_${u}_${i}`});if(s.x>p||s.x+s.width<f||s.y>h||s.y+s.height<m)continue;let l=g.get(i),d=_.get(i),v=(C?-1:1)*Math.sign(s.value??0);v>0?(d&&delete d.borderRadiusSide,s.borderRadiusSide=S?`top`:`right`,_.set(i,s)):v<0&&(l&&delete l.borderRadiusSide,s.borderRadiusSide=S?`bottom`:`left`,g.set(i,s)),c[s.maskId]||(c[s.maskId]={id:s.maskId,width:0,height:0,hasNegative:!1,hasPositive:!1,layout:y,xOrigin:D,yOrigin:O,x:0,y:0});let w=c[s.maskId];w.width=y===`vertical`?s.width:w.width+s.width,w.height=y===`vertical`?w.height+s.height:s.height,w.x=Math.min(w.x===0?1/0:w.x,s.x),w.y=Math.min(w.y===0?1/0:w.y,s.y);let T=s.value??0;w.hasNegative=w.hasNegative||(C?T>0:T<0),w.hasPositive=w.hasPositive||(C?T<0:T>0),A.push(s)}return{seriesId:e,barLabel:r[e].barLabel,barLabelPlacement:r[e].barLabelPlacement,data:A,layout:y,xOrigin:D,yOrigin:O}})}),masksData:Object.values(c)}}function Ht(e){return it(`MuiBar`,e)}$e(`MuiBar`,[`root`,`series`,`seriesLabels`]);const Ut=e=>We({root:[`root`],series:[`series`],seriesLabels:[`seriesLabels`]},Ht,e);var Wt=[`ownerState`,`skipAnimation`,`id`,`dataIndex`,`xOrigin`,`yOrigin`];function Gt(e){let{ownerState:t}=e,n=H(e,Wt),r=dt(e);return(0,q.jsx)(`rect`,G({},n,{filter:t.isHighlighted?`brightness(120%)`:void 0,opacity:t.isFaded?.3:1,"data-highlighted":t.isHighlighted||void 0,"data-faded":t.isFaded||void 0},r))}function Kt(e){return a().use(A,e)}var qt=[`id`,`dataIndex`,`classes`,`color`,`slots`,`slotProps`,`style`,`onClick`,`skipAnimation`,`layout`,`x`,`xOrigin`,`y`,`yOrigin`,`width`,`height`,`hidden`];function Jt(t){let{id:n,dataIndex:r,classes:i,color:a,slots:o,slotProps:s,style:c,onClick:l,skipAnimation:u,layout:d,x:f,xOrigin:m,y:g,yOrigin:_,width:v,height:y,hidden:b}=t,x=H(t,qt),S=K.useMemo(()=>({type:`bar`,seriesId:n,dataIndex:r}),[n,r]),C=p(S),{isFaded:w,isHighlighted:T}=h(S),E={id:n,dataIndex:r,classes:i,color:a,isFaded:w,isHighlighted:T,isFocused:Kt(K.useMemo(()=>({type:`bar`,seriesId:n,dataIndex:r}),[n,r]))},D=Ct(E),O=o?.bar??Gt;return(0,q.jsx)(O,G({},e({elementType:O,externalSlotProps:s?.bar,externalForwardedProps:x,additionalProps:G({},C,{id:n,dataIndex:r,color:a,x:f,xOrigin:m,y:g,yOrigin:_,width:v,height:y,style:c,onClick:l,cursor:l?`pointer`:`unset`,stroke:`none`,fill:a,skipAnimation:u,layout:d,hidden:b}),className:D.root,ownerState:E})))}function Yt(e,t){let n=i(e.x,t.x),r=i(e.y,t.y),a=i(e.width,t.width),o=i(e.height,t.height),s=i(e.borderRadius,t.borderRadius);return e=>({x:n(e),y:r(e),width:a(e),height:o(e),borderRadius:s(e)})}function Xt(e){let t={x:e.layout===`vertical`?e.x:e.xOrigin,y:e.layout===`vertical`?e.yOrigin:e.y,width:e.layout===`vertical`?e.width:0,height:e.layout===`vertical`?0:e.height,borderRadius:e.borderRadius};return he({x:e.x,y:e.y,width:e.width,height:e.height,borderRadius:e.borderRadius},{createInterpolator:Yt,transformProps:t=>({d:Qt(e.hasNegative,e.hasPositive,e.layout,t.x,t.y,t.width,t.height,e.xOrigin,e.yOrigin,t.borderRadius)}),applyProps(e,{d:t}){t&&e.setAttribute(`d`,t)},initialProps:t,skip:e.skipAnimation,ref:e.ref})}function Zt(e){let{maskId:t,x:n,y:r,width:i,height:a,skipAnimation:o}=e,{ref:s,d:c}=Xt({layout:e.layout??`vertical`,hasNegative:e.hasNegative,hasPositive:e.hasPositive,xOrigin:e.xOrigin,yOrigin:e.yOrigin,x:n,y:r,width:i,height:a,borderRadius:e.borderRadius??0,skipAnimation:o});return!e.borderRadius||e.borderRadius<=0?null:(0,q.jsx)(`clipPath`,{id:t,children:(0,q.jsx)(`path`,{ref:s,d:c})})}function Qt(e,t,n,r,i,a,o,s,c,l){if(n===`vertical`){if(t&&e){let e=Math.min(l,a/2,o/2);return`M${r},${i+o/2} v${-(o/2-e)} a${e},${e} 0 0 1 ${e},${-e} h${a-e*2} a${e},${e} 0 0 1 ${e},${e} v${o-2*e} a${e},${e} 0 0 1 ${-e},${e} h${-(a-e*2)} a${e},${e} 0 0 1 ${-e},${-e} v${-(o/2-e)}`}let n=Math.min(l,a/2);if(t)return`M${r},${Math.max(c,i+n)} v${Math.min(0,-(c-i-n))} a${n},${n} 0 0 1 ${n},${-n} h${a-n*2} a${n},${n} 0 0 1 ${n},${n} v${Math.max(0,c-i-n)} Z`;if(e)return`M${r},${Math.min(c,i+o-n)} v${Math.max(0,o-n)} a${n},${n} 0 0 0 ${n},${n} h${a-n*2} a${n},${n} 0 0 0 ${n},${-n} v${-Math.max(0,o-n)} Z`}if(n===`horizontal`){if(t&&e){let e=Math.min(l,a/2,o/2);return`M${r+a/2},${i} h${a/2-e} a${e},${e} 0 0 1 ${e},${e} v${o-e*2} a${e},${e} 0 0 1 ${-e},${e} h${-(a-2*e)} a${e},${e} 0 0 1 ${-e},${-e} v${-(o-e*2)} a${e},${e} 0 0 1 ${e},${-e} h${a/2-e}`}let n=Math.min(l,o/2);if(t)return`M${Math.min(s,r-n)},${i} h${a} a${n},${n} 0 0 1 ${n},${n} v${o-n*2} a${n},${n} 0 0 1 ${-n},${n} h${-a} Z`;if(e)return`M${Math.max(s,r+a+n)},${i} h${-a} a${n},${n} 0 0 0 ${-n},${n} v${o-n*2} a${n},${n} 0 0 0 ${n},${n} h${a} Z`}}var $t=[`completedData`,`masksData`,`borderRadius`,`onItemClick`,`skipAnimation`];function en(e){let{completedData:t,masksData:n,borderRadius:r,onItemClick:i,skipAnimation:a}=e,o=H(e,$t),s=Ut(),c=!r||r<=0;return(0,q.jsxs)(K.Fragment,{children:[!c&&n.map(({id:e,x:t,y:n,xOrigin:i,yOrigin:o,width:s,height:c,hasPositive:l,hasNegative:u,layout:d})=>(0,q.jsx)(Zt,{maskId:e,borderRadius:r,hasNegative:u,hasPositive:l,layout:d,x:t,y:n,xOrigin:i,yOrigin:o,width:s,height:c,skipAnimation:a??!1},e)),t.map(({seriesId:e,layout:t,xOrigin:n,yOrigin:r,data:l})=>(0,q.jsx)(`g`,{"data-series":e,className:s.series,children:l.map(({dataIndex:s,color:l,maskId:u,x:d,y:f,width:p,height:m})=>{let h=(0,q.jsx)(Jt,G({id:e,dataIndex:s,color:l,skipAnimation:a??!1,layout:t??`vertical`,x:d,xOrigin:n,y:f,yOrigin:r,width:p,height:m},o,{onClick:i&&(t=>{i(t,{type:`bar`,seriesId:e,dataIndex:s})})}),s);return c?h:(0,q.jsx)(`g`,{clipPath:`url(#${u})`,children:h},s)})},e))]})}function tn(e,t){return e.bandwidth()===0?Math.floor((t-Math.min(...e.range())+e.step()/2)/e.step()):Math.floor((t-Math.min(...e.range()))/e.step())}const nn=f(E,y,c,function({axis:e,axisIds:t},{axis:n,axisIds:r},i,a){let{series:o,stackingGroups:s=[]}=i?.bar??{},c=t[0],l=r[0],d;for(let t=0;t<s.length;t+=1){let r=s[t].ids;for(let i of r){let r=(o??{})[i],f=r.xAxisId??c,p=r.yAxisId??l,m=e[f],h=n[p],g=r.layout===`horizontal`?h:m,_=r.layout===`horizontal`?m:h,v=g.scale,y=r.layout===`horizontal`?a.y:a.x;if(!ge(v))continue;let b=tn(v,y),{barWidth:x,offset:S}=u(v.bandwidth(),s.length,g.barGapRatio),C=t*(x+S),w=g.data?.[b];if(w==null)continue;let T=v(w);if(T==null)continue;let E=T+C,D=E+x;if(y>=Math.min(E,D)&&y<=Math.max(E,D)){let e=r.layout===`horizontal`?a.x:a.y,t=r.visibleStackedData[b],n=_.scale(t[0]),o=_.scale(t[1]);if(n==null||o==null)continue;e>=Math.min(n,o)&&e<=Math.max(n,o)&&(d={seriesId:i,dataIndex:b})}}}if(d)return{type:`bar`,seriesId:d.seriesId,dataIndex:d.dataIndex}});function rn(e){let{instance:t}=j(),n=N(),r=a();K.useEffect(()=>{let i=n.current;if(!i||!e)return;let a=null,o=function(n){let o=n;a&&Math.abs(n.clientX-a.clientX)<=1&&Math.abs(n.clientY-a.clientY)<=1&&(o={clientX:a.clientX,clientY:a.clientY}),a=null;let s=O(i,o);if(!t.isPointInside(s.x,s.y))return;let c=nn(r.state,s);c&&e(n,{type:`bar`,seriesId:c.seriesId,dataIndex:c.dataIndex})},s=function(e){a=e};return i.addEventListener(`click`,o),i.addEventListener(`pointerup`,s),()=>{i.removeEventListener(`click`,o),i.removeEventListener(`pointerup`,s)}},[t,e,r,n])}function an(e,t,n){let r=e.get(t);return r?r.push(n):(r=[n],e.set(t,r)),r}var on=1e3;function sn(e,t,n,r,i,a,o,s){let c=Math.min(i,n/2,r/2),l=Math.min(a,n/2,r/2),u=Math.min(o,n/2,r/2),d=Math.min(s,n/2,r/2);return`M${e+c},${t}
   h${n-c-l}
   a${l},${l} 0 0 1 ${l},${l}
   v${r-l-u}
   a${u},${u} 0 0 1 -${u},${u}
   h-${n-u-d}
   a${d},${d} 0 0 1 -${d},-${d}
   v-${r-d-c}
   a${c},${c} 0 0 1 ${c},-${c}
   Z`}function cn(e,t){return sn(e.x,e.y,e.width,e.height,e.borderRadiusSide===`left`||e.borderRadiusSide===`top`?t:0,e.borderRadiusSide===`right`||e.borderRadiusSide===`top`?t:0,e.borderRadiusSide===`right`||e.borderRadiusSide===`bottom`?t:0,e.borderRadiusSide===`left`||e.borderRadiusSide===`bottom`?t:0)}function ln(e,t){let n=new Map,r=new Map;for(let i=0;i<e.data.length;i+=1){let a=e.data[i],o=cn(a,t),s=an(r,a.color,o);s.length>=on&&(an(n,a.color,s.join(``)),r.delete(a.color))}for(let[e,t]of r.entries())t.length>0&&an(n,e,t.join(``));return n}var un=[`skipAnimation`,`layout`,`xOrigin`,`yOrigin`],dn=[`children`,`layout`,`xOrigin`,`yOrigin`],fn=B(`g`)({'&[data-faded="true"]':{opacity:.3},"& path":{pointerEvents:`none`}});function pn(e){let{skipAnimation:t,layout:n,xOrigin:r,yOrigin:i}=e,a=H(e,un);return t?(0,q.jsx)(fn,G({},a)):(0,q.jsx)(mn,G({},a,{layout:n,xOrigin:r,yOrigin:i}))}var X=B(`rect`)({"@keyframes scaleInX":{from:{transform:`scaleX(0)`},to:{transform:`scaleX(1)`}},"@keyframes scaleInY":{from:{transform:`scaleY(0)`},to:{transform:`scaleY(1)`}},animationDuration:`300ms`,animationFillMode:`forwards`,'&[data-orientation="horizontal"]':{animationName:`scaleInX`},'&[data-orientation="vertical"]':{animationName:`scaleInY`}});function mn(e){let{children:t,layout:n,xOrigin:r,yOrigin:i}=e,o=H(e,dn),s=a().use(ne),c=Ve(),l=[];return n===`horizontal`?(l.push((0,q.jsx)(X,{"data-orientation":`horizontal`,x:s.left,width:r-s.left,y:s.top,height:s.height,style:{transformOrigin:`${r}px ${s.top+s.height/2}px`}},`left`)),l.push((0,q.jsx)(X,{"data-orientation":`horizontal`,x:r,width:s.left+s.width-r,y:s.top,height:s.height,style:{transformOrigin:`${r}px ${s.top+s.height/2}px`}},`right`))):(l.push((0,q.jsx)(X,{"data-orientation":`vertical`,x:s.left,width:s.width,y:s.top,height:i-s.top,style:{transformOrigin:`${s.left+s.width/2}px ${i}px`}},`top`)),l.push((0,q.jsx)(X,{"data-orientation":`vertical`,x:s.left,width:s.width,y:i,height:s.top+s.height-i,style:{transformOrigin:`${s.left+s.width/2}px ${i}px`}},`bottom`))),(0,q.jsxs)(K.Fragment,{children:[(0,q.jsx)(`clipPath`,{id:c,children:l}),(0,q.jsx)(fn,G({clipPath:`url(#${c})`},o,{children:t}))]})}function hn(e,t,n){let{instance:r}=j(),i=N(),o=a(),s=K.useRef(!1),c=K.useRef(void 0),l=Be(()=>t?.()),u=Be(()=>n?.());K.useEffect(()=>{let t=i.current;if(!t)return;function n(){s.current=!0}function a(){let e=c.current;e&&(c.current=void 0,r.removeTooltipItem(e),r.clearHighlight(),u())}function d(){s.current=!1,a()}let f=function(n){let i=O(t,n);if(!r.isPointInside(i.x,i.y)){a();return}let s=e(o.state,i);s?(r.setLastUpdateSource(`pointer`),r.setTooltipItem(s),r.setHighlight(s),l(),c.current=s):a()};return t.addEventListener(`pointerleave`,d),t.addEventListener(`pointermove`,f),t.addEventListener(`pointerenter`,n),()=>{t.removeEventListener(`pointerenter`,n),t.removeEventListener(`pointermove`,f),t.removeEventListener(`pointerleave`,d),s.current&&d()}},[e,r,l,u,o,i])}function gn({completedData:e,borderRadius:t=0,onItemClick:n,skipAnimation:r=!1}){let i=K.useRef(null),a=N();return hn(nn,n?()=>{let e=a.current;e&&(i.current??(i.current=e.style.cursor,e.style.cursor=`pointer`))}:void 0,n?()=>{let e=a.current;e&&i.current!=null&&(e.style.cursor=i.current,i.current=null)}:void 0),rn(n),(0,q.jsx)(K.Fragment,{children:e.map(e=>(0,q.jsx)(vn,{series:e,borderRadius:t,skipAnimation:r},e.seriesId))})}var _n=K.memo(bn);function vn({series:e,borderRadius:t,skipAnimation:n}){let i=Ut(),{store:a}=j(),o=a.use(pe,e.seriesId),s=a.use(r,e.seriesId);return(0,q.jsxs)(K.Fragment,{children:[(0,q.jsx)(pn,{className:i.series,"data-series":e.seriesId,layout:e.layout,xOrigin:e.xOrigin,yOrigin:e.yOrigin,skipAnimation:n,"data-faded":s||void 0,"data-highlighted":o||void 0,children:(0,q.jsx)(yn,{processedSeries:e,borderRadius:t})}),(0,q.jsx)(_n,{processedSeries:e,borderRadius:t})]})}function yn({processedSeries:e,borderRadius:t}){let n=ln(e,t),r=[],i=0;for(let[e,t]of n.entries())for(let n of t)r.push((0,q.jsx)(`path`,{fill:e,d:n},i)),i+=1;return(0,q.jsx)(K.Fragment,{children:r})}function bn({processedSeries:e,borderRadius:t}){let{store:n}=j(),r=n.use(g,e.seriesId),i=n.use(s,e.seriesId),a=r==null?null:e.data.find(e=>e.dataIndex===r)||null,o=i==null?null:e.data.find(e=>e.dataIndex===i)||null,c=[];return a!=null&&c.push((0,q.jsx)(`path`,{fill:a.color,filter:`brightness(120%)`,"data-highlighted":!0,d:cn(a,t)},`highlighted-${e.seriesId}`)),o!=null&&c.push((0,q.jsx)(`path`,{fill:o.color,d:cn(o,t)},`unfaded-${o.seriesId}`)),(0,q.jsx)(K.Fragment,{children:c})}var xn=[`skipAnimation`,`onItemClick`,`borderRadius`,`barLabel`,`renderer`],Sn=B(`g`,{name:`MuiBarPlot`,slot:`Root`})({[`& .${St.root}`]:{transitionProperty:`opacity, fill`,transitionDuration:`300ms`,transitionTimingFunction:me}});function Cn(e){let{skipAnimation:t,onItemClick:n,borderRadius:r,barLabel:i,renderer:a}=e,o=H(e,xn),s=S(Te()||t),c=S(t),{xAxis:l}=M(),{yAxis:u}=D(),{completedData:d,masksData:f}=Bt(fe(),l,u),p=Ut(),m=a===`svg-batch`?gn:en;return(0,q.jsxs)(Sn,{className:p.root,children:[(0,q.jsx)(m,G({completedData:d,masksData:f,skipAnimation:a===`svg-batch`?c:s,onItemClick:n,borderRadius:r},o)),d.map(e=>(0,q.jsx)(Lt,G({className:p.seriesLabels,processedSeries:e,skipAnimation:s,barLabel:i},o),e.seriesId))]})}const wn=[m,oe,de,ie,C,_,o,w];var Tn=`xAxis.yAxis.series.width.height.margin.colors.dataset.sx.axisHighlight.grid.children.slots.slotProps.skipAnimation.loading.layout.onItemClick.highlightedItem.onHighlightChange.borderRadius.barLabel.className.hideLegend.showToolbar.brushConfig.renderer`.split(`.`);const En=e=>{let{xAxis:t,yAxis:r,series:i,width:a,height:o,margin:s,colors:c,dataset:l,sx:u,axisHighlight:d,grid:f,children:p,slots:m,slotProps:h,skipAnimation:g,loading:_,layout:v,onItemClick:y,highlightedItem:b,onHighlightChange:x,borderRadius:S,barLabel:C,className:w,brushConfig:T,renderer:E}=e,D=H(e,Tn),O=`${Ve()}-clip-path`,k=v===`horizontal`||v===void 0&&i.some(e=>e.layout===`horizontal`),A=K.useMemo(()=>[{id:n,scaleType:`band`,data:Array.from({length:Math.max(...i.map(e=>(e.data??l??[]).length))},(e,t)=>t)}],[l,i]),ee=K.useMemo(()=>[{id:te,scaleType:`band`,data:Array.from({length:Math.max(...i.map(e=>(e.data??l??[]).length))},(e,t)=>t)}],[l,i]),j=K.useMemo(()=>i.map(e=>G({type:`bar`},e,{layout:k?`horizontal`:`vertical`})),[k,i]),ne=k?void 0:A,re=K.useMemo(()=>t?k?t:t.map(e=>G({scaleType:`band`},e)):ne,[ne,k,t]),M=k?ee:void 0,ie=G({},D,{series:j,width:a,height:o,margin:s,colors:c,dataset:l,xAxis:re,yAxis:K.useMemo(()=>r?k?r.map(e=>G({scaleType:`band`},e)):r:M,[M,k,r]),highlightedItem:b,onHighlightChange:x,disableAxisListener:h?.tooltip?.trigger!==`axis`&&d?.x===`none`&&d?.y===`none`,className:w,skipAnimation:g,brushConfig:T,plugins:wn}),ae={onItemClick:y,slots:m,slotProps:h,borderRadius:S,renderer:E,barLabel:C},oe={vertical:f?.vertical,horizontal:f?.horizontal},se={clipPath:`url(#${O})`},N={id:O},ce={slots:m,slotProps:h,loading:_},le={slots:m,slotProps:h},ue=G({},k?{y:`band`}:{x:`band`},d),de={slots:m,slotProps:h};return{chartsWrapperProps:{sx:u,legendPosition:e.slotProps?.legend?.position,legendDirection:e.slotProps?.legend?.direction,hideLegend:e.hideLegend??!1},chartContainerProps:ie,barPlotProps:ae,gridProps:oe,clipPathProps:N,clipPathGroupProps:se,overlayProps:ce,chartsAxisProps:le,axisHighlightProps:ue,legendProps:de,children:p}};function Dn(e){let t=nt(),n=re(),r=lt(),{xAxis:i,xAxisIds:a}=M(),{yAxis:o,yAxisIds:s}=D();if(n===null||n.type!==`bar`||!r)return null;let c=r.series[n.seriesId];if(c.data[n.dataIndex]==null)return null;let l=c.xAxisId??a[0],u=c.yAxisId??s[0],d=i[l],f=o[u],p=r.series[n.seriesId].layout===`vertical`,m=r.stackingGroups.findIndex(e=>e.ids.includes(n.seriesId)),h=ee({verticalLayout:p,xAxisConfig:d,yAxisConfig:f,series:c,dataIndex:n.dataIndex,numberOfGroups:r.stackingGroups.length,groupIndex:m});if(h===null)return null;let{x:g,y:_,height:v,width:y}=h;return(0,q.jsx)(`rect`,G({fill:`none`,stroke:(t.vars??t).palette.text.primary,strokeWidth:2,x:g-3,y:_-3,width:y+6,height:v+6,rx:3,ry:3},e))}var On=K.forwardRef(function(e,t){let n=l({props:e,name:`MuiBarChart`}),{chartsWrapperProps:r,chartContainerProps:i,barPlotProps:a,gridProps:o,clipPathProps:s,clipPathGroupProps:c,overlayProps:u,chartsAxisProps:d,axisHighlightProps:f,legendProps:p,children:m}=En(n),{chartDataProviderProps:h,chartsSurfaceProps:g}=k(i,t),_=n.slots?.tooltip??le,v=n.slots?.toolbar;return(0,q.jsx)(ce,G({},h,{children:(0,q.jsxs)(ue,G({},r,{children:[n.showToolbar&&v?(0,q.jsx)(v,G({},n.slotProps?.toolbar)):null,!n.hideLegend&&(0,q.jsx)(se,G({},p)),(0,q.jsxs)(ae,G({},g,{children:[(0,q.jsx)(we,G({},o)),(0,q.jsxs)(`g`,G({},c,{children:[(0,q.jsx)(Cn,G({},a)),(0,q.jsx)(b,G({},u)),(0,q.jsx)(Se,G({},f)),(0,q.jsx)(Dn,{})]})),(0,q.jsx)(be,G({},d)),(0,q.jsx)(Ee,G({},s)),m]})),!n.loading&&(0,q.jsx)(_,G({},n.slotProps?.tooltip))]}))}))});function Z({subsectionId:e,parentId:t,title:n,defaultExpanded:r=!0,children:i,secondary:a}){return(0,q.jsx)(W,{sx:{mb:1},children:(0,q.jsx)(yt,{storageKey:`${t}:${e}`,title:n,defaultExpanded:r,secondary:a,children:i})})}function kn({distribution:e,parentId:t}){let{top_artists:n,others_count:r,total_artists:i}=e;if(n.length===0)return(0,q.jsx)(Z,{subsectionId:`artists`,parentId:t,title:`Artists`,children:(0,q.jsx)(U,{color:`text.secondary`,children:`No artist data available`})});let a=n.map(e=>e.artist),o=n.map(e=>e.count);return(0,q.jsxs)(Z,{subsectionId:`artists`,parentId:t,title:`Artists`,secondary:(0,q.jsxs)(U,{variant:`body2`,color:`text.secondary`,children:[i,` artists`]}),children:[(0,q.jsx)(On,{height:300,xAxis:[{scaleType:`band`,data:a,tickLabelStyle:{angle:-45,textAnchor:`end`,fontSize:11}}],series:[{data:o}],margin:{left:50,right:20,top:20,bottom:80}}),r>0&&(0,q.jsxs)(U,{variant:`body2`,color:`text.secondary`,sx:{fontStyle:`italic`,mt:1},children:[`+ `,r,` tracks from `,i-n.length,` `,`other artists`]})]})}var Q=[`#2196f3`,`#4caf50`,`#ff9800`,`#e91e63`,`#9c27b0`,`#00bcd4`,`#ff5722`,`#795548`,`#607d8b`,`#3f51b5`,`#8bc34a`,`#ffc107`,`#673ab7`,`#009688`,`#f44336`,`#03a9f4`,`#cddc39`,`#ffeb3b`,`#9e9e9e`,`#ff4081`];function An({distribution:e,parentId:n}){let[r,i]=(0,K.useState)(new Set),{pieData:a,visibleCount:o,totalCount:s}=(0,K.useMemo)(()=>{let t=e.filter(e=>!r.has(e.genre));return{pieData:t.map((e,t)=>({id:e.genre,value:e.count,label:e.genre,color:Q[t%Q.length]})),visibleCount:t.length,totalCount:e.length}},[e,r]),c=e=>{i(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})};return e.length===0?(0,q.jsx)(Z,{subsectionId:`genres`,parentId:n,title:`Genres`,children:(0,q.jsx)(U,{color:`text.secondary`,children:`No genre data available`})}):(0,q.jsxs)(Z,{subsectionId:`genres`,parentId:n,title:`Genres`,secondary:(0,q.jsxs)(U,{variant:`body2`,color:`text.secondary`,children:[o,` of `,s,` genres shown`]}),children:[a.length>0?(0,q.jsx)(W,{sx:{height:350,mb:2},children:(0,q.jsx)(st,{series:[{data:a,innerRadius:40,outerRadius:120,paddingAngle:1,cornerRadius:4,highlightScope:{highlight:`item`,fade:`global`}}],height:350,hideLegend:!0})}):(0,q.jsx)(U,{color:`text.secondary`,sx:{mb:2},children:`All genres hidden. Click chips below to show.`}),(0,q.jsx)(W,{sx:{mb:1},children:(0,q.jsxs)(t,{direction:`row`,spacing:1,sx:{mb:1},children:[(0,q.jsx)(F,{label:`Show All`,size:`small`,variant:`outlined`,onClick:()=>i(new Set),disabled:r.size===0}),(0,q.jsx)(F,{label:`Hide All`,size:`small`,variant:`outlined`,onClick:()=>i(new Set(e.map(e=>e.genre))),disabled:r.size===e.length})]})}),(0,q.jsx)(t,{direction:`row`,flexWrap:`wrap`,gap:.5,children:e.map((e,t)=>{let n=r.has(e.genre),i=Q[t%Q.length];return(0,q.jsx)(F,{label:`${e.genre} (${e.count})`,size:`small`,onClick:()=>c(e.genre),sx:{bgcolor:n?`transparent`:i,color:n?`text.secondary`:`#fff`,border:n?1:0,borderColor:`divider`,textDecoration:n?`line-through`:`none`,opacity:n?.6:1,"&:hover":{bgcolor:n?`action.hover`:i,opacity:1}}},e.genre)})})]})}function jn(e){let t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4);return t>0?`${t}h ${n}m`:`${n}m`}function Mn(e){return e>=0xe8d4a51000?`${(e/0xe8d4a51000).toFixed(1)} TB`:e>=1e9?`${(e/1e9).toFixed(1)} GB`:e>=1e6?`${(e/1e6).toFixed(1)} MB`:`${(e/1e3).toFixed(1)} KB`}function $({label:e,value:t}){return(0,q.jsxs)(W,{sx:{textAlign:`center`,py:1,flex:`1 1 25%`,minWidth:100},children:[(0,q.jsx)(U,{variant:`h5`,color:`primary`,children:t}),(0,q.jsx)(U,{variant:`body2`,color:`text.secondary`,children:e})]})}function Nn({stats:e,parentId:t}){return(0,q.jsx)(Z,{subsectionId:`stats`,parentId:t,title:`Library Statistics`,children:(0,q.jsxs)(W,{sx:{display:`flex`,flexWrap:`wrap`,gap:2},children:[(0,q.jsx)($,{label:`Tracks`,value:e.file_count.toLocaleString()}),(0,q.jsx)($,{label:`Total Duration`,value:jn(e.total_duration_ms)}),(0,q.jsx)($,{label:`Total Size`,value:Mn(e.total_file_size_bytes)}),(0,q.jsx)($,{label:`Avg Track`,value:jn(e.avg_track_length_ms)})]})})}function Pn({distribution:e,parentId:t}){let n=e.filter(e=>String(e.year)!==`1`).sort((e,t)=>Number(e.year)-Number(t.year));if(n.length===0)return(0,q.jsx)(Z,{subsectionId:`years`,parentId:t,title:`Years`,children:(0,q.jsx)(U,{color:`text.secondary`,children:`No year data available`})});let r=n.map(e=>String(e.year)),i=n.map(e=>e.count);return(0,q.jsx)(Z,{subsectionId:`years`,parentId:t,title:`Years`,secondary:(0,q.jsxs)(U,{variant:`body2`,color:`text.secondary`,children:[n.length,` years`]}),children:(0,q.jsx)(Oe,{height:250,xAxis:[{scaleType:`point`,data:r}],series:[{data:i,curve:`catmullRom`,showMark:!1}],margin:{left:50,right:20,top:20,bottom:30}})})}function Fn({libraryId:e}){let[t,n]=(0,K.useState)(null),[r,i]=(0,K.useState)(!0),[a,o]=(0,K.useState)(null);return(0,K.useEffect)(()=>{(async()=>{try{i(!0),o(null),n(await Pe(e))}catch(e){o(e instanceof Error?e.message:`Failed to load collection overview`),console.error(`[CollectionOverview] Load error:`,e)}finally{i(!1)}})()},[e]),r?(0,q.jsx)(Y,{sectionId:`collection-overview`,title:`Collection Overview`,children:(0,q.jsx)(et,{size:24})}):a||!t?(0,q.jsx)(Y,{sectionId:`collection-overview`,title:`Collection Overview`,children:(0,q.jsx)(Je,{severity:`error`,children:a||`Failed to load collection overview`})}):(0,q.jsxs)(Y,{sectionId:`collection-overview`,title:`Collection Overview`,secondary:(0,q.jsxs)(U,{variant:`body2`,color:`text.secondary`,children:[t.stats.file_count.toLocaleString(),` tracks`]}),children:[(0,q.jsx)(Nn,{stats:t.stats,parentId:`collection-overview`}),(0,q.jsx)(Pn,{distribution:t.year_distribution,parentId:`collection-overview`}),(0,q.jsx)(An,{distribution:t.genre_distribution,parentId:`collection-overview`}),(0,q.jsx)(kn,{distribution:t.artist_distribution,parentId:`collection-overview`})]})}function In({value:e,onChange:t}){let[n,r]=(0,K.useState)([]),[i,a]=(0,K.useState)(!0);return(0,K.useEffect)(()=>{(async()=>{try{r(await Ge(!0))}catch(e){console.error(`[LibraryFilter] Failed to load libraries:`,e)}finally{a(!1)}})()},[]),(0,q.jsxs)(_e,{size:`small`,sx:{minWidth:200},children:[(0,q.jsx)(ye,{id:`library-filter-label`,children:`Library`}),(0,q.jsxs)(ve,{labelId:`library-filter-label`,id:`library-filter`,value:e??``,label:`Library`,onChange:e=>{let n=e.target.value;t(n===``?void 0:n)},disabled:i,children:[(0,q.jsx)(Ae,{value:``,children:`All Libraries`}),n.map(e=>(0,q.jsx)(Ae,{value:e.library_id,children:e.name},e.library_id))]})]})}function Ln({vibes:e,parentId:t}){return e.length===0?(0,q.jsx)(Z,{subsectionId:`vibes`,parentId:t,title:`Dominant Vibes`,children:(0,q.jsx)(U,{color:`text.secondary`,children:`No mood data available`})}):(0,q.jsx)(Z,{subsectionId:`vibes`,parentId:t,title:`Dominant Vibes`,children:(0,q.jsx)(W,{sx:{display:`flex`,flexWrap:`wrap`,gap:2},children:e.map((e,t)=>(0,q.jsxs)(W,{sx:{textAlign:`center`,flex:`1 1 100px`,p:1,borderRadius:1,bgcolor:t===0?`primary.main`:`action.hover`,color:t===0?`primary.contrastText`:`text.primary`},children:[(0,q.jsxs)(U,{variant:`h6`,children:[e.percentage.toFixed(0),`%`]}),(0,q.jsx)(U,{variant:`body2`,sx:{textTransform:`capitalize`},children:e.mood})]},e.mood))})})}function Rn({pairs:e,parentId:t,tierSelector:n}){return e.length===0?(0,q.jsx)(Z,{subsectionId:`combos`,parentId:t,title:`Mood Combos`,secondary:(0,q.jsx)(W,{sx:{display:`flex`,alignItems:`center`,gap:1},children:n}),children:(0,q.jsx)(U,{color:`text.secondary`,children:`No mood combinations found`})}):(0,q.jsx)(Z,{subsectionId:`combos`,parentId:t,title:`Mood Combos`,defaultExpanded:!1,secondary:(0,q.jsxs)(W,{sx:{display:`flex`,alignItems:`center`,gap:1},children:[(0,q.jsx)(U,{variant:`body2`,color:`text.secondary`,children:`Top pairs`}),n]}),children:(0,q.jsx)(W,{sx:{display:`flex`,flexWrap:`wrap`,gap:1},children:e.map((e,t)=>(0,q.jsx)(F,{label:(0,q.jsxs)(W,{sx:{display:`flex`,alignItems:`center`,gap:.5},children:[(0,q.jsx)(U,{variant:`body2`,component:`span`,sx:{textTransform:`capitalize`},children:e.mood1}),(0,q.jsx)(U,{variant:`body2`,component:`span`,color:`text.secondary`,children:`+`}),(0,q.jsx)(U,{variant:`body2`,component:`span`,sx:{textTransform:`capitalize`},children:e.mood2}),(0,q.jsxs)(U,{variant:`body2`,component:`span`,color:`text.secondary`,sx:{ml:.5},children:[`(`,e.count,`)`]})]}),variant:t<3?`filled`:`outlined`,color:t<3?`primary`:`default`,size:`small`},`${e.mood1}-${e.mood2}`))})})}var zn={strict:`Strict`,regular:`Regular`,loose:`Loose`},Bn=[`strict`,`regular`,`loose`];function Vn({coverage:e,balance:t,parentId:n}){let r=Bn.filter(n=>n in e.tiers||n in t);return(0,q.jsx)(Z,{subsectionId:`coverage`,parentId:n,title:`Mood Coverage`,secondary:(0,q.jsxs)(U,{variant:`body2`,color:`text.secondary`,children:[e.total_files.toLocaleString(),` tracks`]}),children:(0,q.jsx)(W,{sx:{display:`flex`,gap:2,flexWrap:`wrap`,justifyContent:`center`},children:r.map(n=>{let r=e.tiers[n],i=(t[n]||[]).map((e,t)=>({id:t,value:e.count,label:e.mood}));return(0,q.jsxs)(W,{sx:{textAlign:`center`,minWidth:200},children:[(0,q.jsx)(U,{variant:`subtitle2`,children:zn[n]||n}),r&&(0,q.jsxs)(U,{variant:`caption`,color:`text.secondary`,children:[r.tagged.toLocaleString(),` tagged (`,r.percentage.toFixed(1),`%)`]}),i.length>0?(0,q.jsx)(st,{series:[{data:i,innerRadius:25,outerRadius:80,paddingAngle:1,cornerRadius:3}],height:200,width:250,hideLegend:!0}):(0,q.jsx)(U,{variant:`body2`,color:`text.secondary`,sx:{mt:2},children:`No data`})]},n)})})})}var Hn=[{value:`strict`,label:`Strict`},{value:`regular`,label:`Regular`},{value:`loose`,label:`Loose`}];function Un({libraryId:e}){let[t,n]=(0,K.useState)(null),[r,i]=(0,K.useState)(!0),[a,o]=(0,K.useState)(null),[s,c]=(0,K.useState)(`strict`);return(0,K.useEffect)(()=>{(async()=>{try{i(!0),o(null),n(await Ue(e,s))}catch(e){o(e instanceof Error?e.message:`Failed to load mood analysis`),console.error(`[MoodAnalysis] Load error:`,e)}finally{i(!1)}})()},[e,s]),r?(0,q.jsx)(Y,{sectionId:`mood-analysis`,title:`Mood Analysis`,children:(0,q.jsx)(et,{size:24})}):a||!t?(0,q.jsx)(Y,{sectionId:`mood-analysis`,title:`Mood Analysis`,children:(0,q.jsx)(Je,{severity:`error`,children:a||`Failed to load mood analysis`})}):(0,q.jsxs)(Y,{sectionId:`mood-analysis`,title:`Mood Analysis`,secondary:(0,q.jsxs)(U,{variant:`body2`,color:`text.secondary`,children:[(t.coverage.tiers.strict?.percentage??0).toFixed(0),`% strict coverage`]}),children:[(0,q.jsx)(Vn,{coverage:t.coverage,balance:t.balance,parentId:`mood-analysis`}),(0,q.jsx)(Ln,{vibes:t.dominant_vibes,parentId:`mood-analysis`}),(0,q.jsx)(Rn,{pairs:t.top_pairs,parentId:`mood-analysis`,tierSelector:(0,q.jsxs)(_e,{size:`small`,sx:{minWidth:120},onClick:e=>e.stopPropagation(),children:[(0,q.jsx)(ye,{id:`mood-tier-label`,children:`Tier`}),(0,q.jsx)(ve,{labelId:`mood-tier-label`,id:`mood-tier-select`,value:s,label:`Tier`,onChange:e=>{c(e.target.value)},children:Hn.map(e=>(0,q.jsx)(Ae,{value:e.value,children:e.label},e.value))})]})})]})}function Wn(){let[e,n]=(0,K.useState)(void 0);return(0,q.jsxs)(t,{spacing:0,sx:{mt:2},children:[(0,q.jsx)(W,{sx:{mb:2},children:(0,q.jsx)(In,{value:e,onChange:n})}),(0,q.jsx)(Fn,{libraryId:e}),(0,q.jsx)(Un,{libraryId:e}),(0,q.jsx)(bt,{libraryId:e})]})}function Gn({preview:e,configText:n,loading:r,error:i,onLoadPreview:a,onGenerateConfig:o}){let{showSuccess:s}=ot();return(0,q.jsxs)(t,{spacing:2.5,children:[(0,q.jsxs)(R,{children:[(0,q.jsx)(z,{title:`Navidrome TOML Configuration`}),(0,q.jsxs)(t,{spacing:1.25,children:[(0,q.jsx)(V,{onClick:a,disabled:r,variant:`contained`,fullWidth:!0,children:r?`Loading...`:`Load Tag Preview`}),(0,q.jsx)(V,{onClick:o,disabled:r,variant:`contained`,fullWidth:!0,children:r?`Generating...`:`Generate Config`})]}),i&&(0,q.jsxs)(Ie,{children:[`Error: `,i]})]}),e&&(0,q.jsxs)(R,{children:[(0,q.jsx)(z,{title:`Tag Preview`}),(0,q.jsx)(W,{sx:{overflowX:`auto`},children:(0,q.jsxs)(je,{children:[(0,q.jsx)(Ne,{children:(0,q.jsxs)(L,{children:[(0,q.jsx)(I,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Tag`}),(0,q.jsx)(I,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Type`}),(0,q.jsx)(I,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Multivalue`}),(0,q.jsx)(I,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Count`}),(0,q.jsx)(I,{sx:{bgcolor:`background.default`,borderBottom:2},children:`Summary`})]})}),(0,q.jsx)(Me,{children:e.map(e=>(0,q.jsxs)(L,{children:[(0,q.jsx)(I,{sx:{borderColor:`divider`},children:e.tag_key}),(0,q.jsx)(I,{sx:{borderColor:`divider`},children:e.type}),(0,q.jsx)(I,{sx:{borderColor:`divider`},children:e.is_multivalue?`Yes`:`No`}),(0,q.jsx)(I,{sx:{borderColor:`divider`},children:e.total_count}),(0,q.jsx)(I,{sx:{borderColor:`divider`},children:e.summary})]},e.tag_key))})]})})]}),n&&(0,q.jsxs)(R,{children:[(0,q.jsx)(z,{title:`Generated Config`}),(0,q.jsx)(P,{multiline:!0,rows:20,value:n,fullWidth:!0,InputProps:{readOnly:!0,sx:{fontFamily:`monospace`,fontSize:`0.875rem`}}}),(0,q.jsx)(V,{onClick:()=>{n&&(navigator.clipboard.writeText(n),s(`Copied to clipboard!`))},variant:`contained`,sx:{mt:1.25},children:`Copy to Clipboard`})]})]})}function Kn({query:e,name:n,comment:r,limit:i,sort:a,preview:o,content:s,loading:c,error:l,onQueryChange:u,onNameChange:d,onCommentChange:f,onLimitChange:p,onSortChange:m,onPreview:h,onGenerate:g}){return(0,q.jsxs)(t,{spacing:2.5,children:[(0,q.jsxs)(R,{children:[(0,q.jsx)(z,{title:`Smart Playlist Generator`}),(0,q.jsx)(W,{component:`form`,onSubmit:h,children:(0,q.jsxs)(t,{spacing:2,children:[(0,q.jsxs)(W,{children:[(0,q.jsx)(U,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Query *`}),(0,q.jsx)(P,{value:e,onChange:e=>u(e.target.value),placeholder:`e.g., tag:nom_happy > 0.8`,multiline:!0,rows:3,disabled:c,required:!0,fullWidth:!0,InputProps:{sx:{fontFamily:`monospace`,fontSize:`0.875rem`}}})]}),(0,q.jsxs)(W,{children:[(0,q.jsx)(U,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Playlist Name *`}),(0,q.jsx)(P,{value:n,onChange:e=>d(e.target.value),disabled:c,required:!0,fullWidth:!0})]}),(0,q.jsxs)(W,{children:[(0,q.jsx)(U,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Comment`}),(0,q.jsx)(P,{value:r,onChange:e=>f(e.target.value),disabled:c,fullWidth:!0})]}),(0,q.jsxs)(W,{sx:{display:`grid`,gridTemplateColumns:`1fr 1fr`,gap:1.25},children:[(0,q.jsxs)(W,{children:[(0,q.jsx)(U,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Limit`}),(0,q.jsx)(P,{type:`number`,value:i??``,onChange:e=>p(e.target.value?parseInt(e.target.value):void 0),disabled:c,placeholder:`Optional`,fullWidth:!0})]}),(0,q.jsxs)(W,{children:[(0,q.jsx)(U,{variant:`body2`,color:`text.secondary`,sx:{mb:.5,fontWeight:600},children:`Sort`}),(0,q.jsx)(P,{value:a,onChange:e=>m(e.target.value),disabled:c,placeholder:`Optional`,fullWidth:!0})]})]}),(0,q.jsxs)(t,{direction:`row`,spacing:1.25,children:[(0,q.jsx)(V,{type:`submit`,variant:`contained`,disabled:c,fullWidth:!0,children:c?`Loading...`:`Preview Query`}),(0,q.jsx)(V,{type:`button`,onClick:g,variant:`contained`,disabled:c,fullWidth:!0,children:c?`Generating...`:`Generate .nsp`})]})]})}),l&&(0,q.jsxs)(Ie,{children:[`Error: `,l]})]}),o&&(0,q.jsxs)(R,{children:[(0,q.jsx)(z,{title:`Query Preview`}),(0,q.jsx)(W,{component:`pre`,sx:{p:2,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,overflow:`auto`,fontSize:`0.875rem`,fontFamily:`monospace`},children:JSON.stringify(o,null,2)})]}),s&&(0,q.jsxs)(R,{children:[(0,q.jsx)(z,{title:`Generated Playlist (.nsp)`}),(0,q.jsx)(P,{multiline:!0,rows:15,value:s,fullWidth:!0,InputProps:{readOnly:!0,sx:{fontFamily:`monospace`,fontSize:`0.875rem`}}}),(0,q.jsx)(V,{onClick:()=>{if(s){let e=new Blob([s],{type:`text/plain`}),t=URL.createObjectURL(e),r=document.createElement(`a`);r.href=t,r.download=`${n}.nsp`,r.click(),URL.revokeObjectURL(t)}},variant:`contained`,sx:{mt:1.25},children:`Download .nsp File`})]})]})}function qn(){let{showError:e}=ot(),[t,n]=(0,K.useState)(null),[r,i]=(0,K.useState)(null),[a,o]=(0,K.useState)(!1),[s,c]=(0,K.useState)(null),[l,u]=(0,K.useState)(``),[d,f]=(0,K.useState)(`My Playlist`),[p,m]=(0,K.useState)(``),[h,g]=(0,K.useState)(void 0),[_,v]=(0,K.useState)(``),[y,b]=(0,K.useState)(null),[x,S]=(0,K.useState)(null),[C,w]=(0,K.useState)(!1),[T,E]=(0,K.useState)(null);return{configPreview:t,configText:r,configLoading:a,configError:s,playlistQuery:l,playlistName:d,playlistComment:p,playlistLimit:h,playlistSort:_,playlistPreview:y,playlistContent:x,playlistLoading:C,playlistError:T,loadConfigPreview:async()=>{try{o(!0),c(null),n((await rt()).tags)}catch(e){c(e instanceof Error?e.message:`Failed to load preview`)}finally{o(!1)}},generateConfig:async()=>{try{o(!0),c(null),i((await Qe()).config)}catch(e){c(e instanceof Error?e.message:`Failed to generate config`)}finally{o(!1)}},previewPlaylist:async e=>{if(e.preventDefault(),l.trim())try{w(!0),E(null),b(await Xe(l,10))}catch(e){E(e instanceof Error?e.message:`Failed to preview playlist`)}finally{w(!1)}},generatePlaylist:async()=>{if(!l.trim()){e(`Query is required`);return}if(!d.trim()){e(`Playlist name is required`);return}try{w(!0),E(null),S((await at({query:l,playlist_name:d,comment:p,limit:h,sort:_||void 0})).content)}catch(e){E(e instanceof Error?e.message:`Failed to generate playlist`)}finally{w(!1)}},setPlaylistQuery:u,setPlaylistName:f,setPlaylistComment:m,setPlaylistLimit:g,setPlaylistSort:v}}function Jn(){let[e,t]=(0,K.useState)(`config`),{configPreview:n,configText:r,configLoading:i,configError:a,playlistQuery:o,playlistName:s,playlistComment:c,playlistLimit:l,playlistSort:u,playlistPreview:d,playlistContent:f,playlistLoading:p,playlistError:m,loadConfigPreview:h,generateConfig:g,previewPlaylist:_,generatePlaylist:v,setPlaylistQuery:y,setPlaylistName:b,setPlaylistComment:x,setPlaylistLimit:S,setPlaylistSort:C}=qn();return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(tt,{tabs:[{id:`config`,label:`Config Generator`},{id:`playlist`,label:`Playlist Generator`}],activeTab:e,onTabChange:e=>t(e)}),e===`config`&&(0,q.jsx)(Gn,{preview:n,configText:r,loading:i,error:a,onLoadPreview:h,onGenerateConfig:g}),e===`playlist`&&(0,q.jsx)(Kn,{query:o,name:s,comment:c,limit:l,sort:u,preview:d,content:f,loading:p,error:m,onQueryChange:y,onNameChange:b,onCommentChange:x,onLimitChange:S,onSortChange:C,onPreview:_,onGenerate:v})]})}function Yn(){let[e,t]=(0,K.useState)(`analytics`);return(0,q.jsxs)(Re,{title:`Insights`,children:[(0,q.jsx)(tt,{tabs:[{id:`analytics`,label:`Analytics`},{id:`navidrome`,label:`Navidrome Integration`}],activeTab:e,onTabChange:e=>t(e)}),e===`analytics`&&(0,q.jsx)(Wn,{}),e===`navidrome`&&(0,q.jsx)(Jn,{})]})}export{Yn as InsightsPage};