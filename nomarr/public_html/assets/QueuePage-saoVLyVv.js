import{Z as e,dt as t,n,pt as r,t as i}from"./index-D4HyKH-U.js";var a=r(e(),1);function o({statusFilter:e,onFilterChange:t,loading:n,actionLoading:r,summary:i,onRefresh:o,onClearCompleted:u,onClearErrors:d,onClearAll:f}){return(0,a.jsxs)(`div`,{style:{display:`flex`,gap:`10px`,marginBottom:`20px`,flexWrap:`wrap`},children:[(0,a.jsx)(`div`,{style:{display:`flex`,gap:`5px`},children:[`all`,`pending`,`running`,`done`,`error`].map(r=>(0,a.jsx)(`button`,{onClick:()=>t(r),style:{...s,...e===r?c:{}},disabled:n,children:r.charAt(0).toUpperCase()+r.slice(1)},r))}),(0,a.jsxs)(`div`,{style:{marginLeft:`auto`,display:`flex`,gap:`5px`},children:[(0,a.jsx)(`button`,{onClick:o,style:s,disabled:n||r,children:`Refresh`}),(0,a.jsx)(`button`,{onClick:u,style:s,disabled:n||r||i.completed===0,children:`Clear Completed`}),(0,a.jsx)(`button`,{onClick:d,style:s,disabled:n||r||i.errors===0,children:`Clear Errors`}),(0,a.jsx)(`button`,{onClick:f,style:{...s,...l},disabled:n||r,children:`Clear All`})]})]})}var s={padding:`8px 16px`,backgroundColor:`#2a2a2a`,border:`1px solid #444`,borderRadius:`4px`,color:`#fff`,cursor:`pointer`,fontSize:`14px`,transition:`all 0.2s`},c={backgroundColor:`#4a9eff`,borderColor:`#4a9eff`},l={backgroundColor:`#d32f2f`,borderColor:`#d32f2f`};function u({jobs:e,total:t,currentPage:n,totalPages:r,onRemoveJob:i,onNextPage:o,onPrevPage:s,statusFilter:c}){let l=e=>e?new Date(e*1e3).toLocaleString():`-`,u=(e,t=60)=>{if(e.length<=t)return e;let n=e.substring(0,30),r=e.substring(e.length-27);return n+`...`+r},_=e=>{let t={padding:`4px 8px`,borderRadius:`4px`,fontSize:`12px`,fontWeight:`bold`,color:`#fff`},n=`#555`;return e===`running`?n=`#ff9800`:e===`done`?n=`#4caf50`:e===`error`&&(n=`#f44336`),{...t,backgroundColor:n}};return e.length===0&&t===0?(0,a.jsxs)(`div`,{style:{textAlign:`center`,padding:`60px 20px`,backgroundColor:`#1a1a1a`,borderRadius:`8px`,border:`1px solid #333`},children:[(0,a.jsx)(`p`,{style:{fontSize:`18px`,color:`#888`,marginBottom:`10px`},children:`No jobs in queue`}),(0,a.jsx)(`p`,{style:{fontSize:`14px`,color:`#666`},children:c===`all`?`Queue is empty`:`No ${c} jobs found`})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(`div`,{style:{overflowX:`auto`},children:(0,a.jsxs)(`table`,{style:d,children:[(0,a.jsx)(`thead`,{children:(0,a.jsxs)(`tr`,{children:[(0,a.jsx)(`th`,{style:f,children:`ID`}),(0,a.jsx)(`th`,{style:f,children:`File Path`}),(0,a.jsx)(`th`,{style:f,children:`Status`}),(0,a.jsx)(`th`,{style:f,children:`Created`}),(0,a.jsx)(`th`,{style:f,children:`Started`}),(0,a.jsx)(`th`,{style:f,children:`Error`}),(0,a.jsx)(`th`,{style:f,children:`Actions`})]})}),(0,a.jsx)(`tbody`,{children:e.length===0?(0,a.jsx)(`tr`,{children:(0,a.jsx)(`td`,{colSpan:7,style:{textAlign:`center`,padding:`40px`},children:`No jobs found`})}):e.map(e=>(0,a.jsxs)(`tr`,{style:m,children:[(0,a.jsx)(`td`,{style:p,children:e.id}),(0,a.jsx)(`td`,{style:p,title:e.path,children:u(e.path)}),(0,a.jsx)(`td`,{style:p,children:(0,a.jsx)(`span`,{style:_(e.status),children:e.status})}),(0,a.jsx)(`td`,{style:p,children:l(e.created_at)}),(0,a.jsx)(`td`,{style:p,children:l(e.started_at)}),(0,a.jsx)(`td`,{style:{...p,fontSize:`12px`,color:`var(--accent-red)`},children:e.error_message||`-`}),(0,a.jsx)(`td`,{style:p,children:(0,a.jsx)(`button`,{onClick:()=>i(e.id),style:h,disabled:e.status===`running`,children:`Remove`})})]},e.id))})]})}),r>1&&(0,a.jsxs)(`div`,{style:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,marginTop:`20px`,padding:`15px`,backgroundColor:`#1a1a1a`,borderRadius:`6px`,border:`1px solid #333`},children:[(0,a.jsx)(`button`,{onClick:s,disabled:n===1,style:g,children:`Previous`}),(0,a.jsxs)(`span`,{children:[`Page `,n,` of `,r,` (`,t,` total jobs)`]}),(0,a.jsx)(`button`,{onClick:o,disabled:n===r,style:g,children:`Next`})]})]})}var d={width:`100%`,borderCollapse:`collapse`,backgroundColor:`#1a1a1a`,borderRadius:`8px`,overflow:`hidden`},f={padding:`12px`,textAlign:`left`,borderBottom:`2px solid #333`,fontWeight:`bold`,fontSize:`14px`},p={padding:`12px`,borderBottom:`1px solid #2a2a2a`,fontSize:`14px`},m={transition:`background-color 0.15s`},h={padding:`4px 12px`,backgroundColor:`#d32f2f`,border:`none`,borderRadius:`4px`,color:`#fff`,cursor:`pointer`,fontSize:`12px`},g={padding:`8px 16px`,backgroundColor:`#4a9eff`,border:`none`,borderRadius:`4px`,color:`#fff`,cursor:`pointer`,fontSize:`14px`};function _({summary:e,connected:t}){return(0,a.jsxs)(`div`,{children:[(0,a.jsx)(`div`,{style:{marginBottom:`20px`},children:(0,a.jsxs)(`span`,{children:[`SSE:`,` `,(0,a.jsx)(`span`,{style:{color:t?`var(--accent-green)`:`var(--accent-red)`},children:t?`Connected`:`Disconnected`})]})}),(0,a.jsxs)(`div`,{style:{display:`flex`,gap:`15px`,marginBottom:`20px`,flexWrap:`wrap`},children:[(0,a.jsxs)(`div`,{style:v,children:[(0,a.jsx)(`span`,{style:{fontSize:`24px`,fontWeight:`bold`},children:e.pending}),(0,a.jsx)(`span`,{style:{fontSize:`12px`,opacity:.8},children:`Pending`})]}),(0,a.jsxs)(`div`,{style:v,children:[(0,a.jsx)(`span`,{style:{fontSize:`24px`,fontWeight:`bold`},children:e.running}),(0,a.jsx)(`span`,{style:{fontSize:`12px`,opacity:.8},children:`Running`})]}),(0,a.jsxs)(`div`,{style:v,children:[(0,a.jsx)(`span`,{style:{fontSize:`24px`,fontWeight:`bold`},children:e.completed}),(0,a.jsx)(`span`,{style:{fontSize:`12px`,opacity:.8},children:`Completed`})]}),(0,a.jsxs)(`div`,{style:v,children:[(0,a.jsx)(`span`,{style:{fontSize:`24px`,fontWeight:`bold`},children:e.errors}),(0,a.jsx)(`span`,{style:{fontSize:`12px`,opacity:.8},children:`Errors`})]})]})]})}var v={display:`flex`,flexDirection:`column`,alignItems:`center`,padding:`15px 25px`,backgroundColor:`#1a1a1a`,borderRadius:`8px`,border:`1px solid #333`,minWidth:`100px`},y=r(t(),1);function b(){let[e,t]=(0,y.useState)([]),[r,a]=(0,y.useState)({pending:0,running:0,completed:0,errors:0}),[o,s]=(0,y.useState)(0),[c,l]=(0,y.useState)(!0),[u,d]=(0,y.useState)(null),[f,p]=(0,y.useState)(!1),[m,h]=(0,y.useState)(`all`),[g]=(0,y.useState)(50),[_,v]=(0,y.useState)(0),b=Math.floor(_/g)+1,x=Math.ceil(o/g),S=async()=>{try{l(!0),d(null);let e={limit:g,offset:_};m!==`all`&&(e.status=m);let r=await n.queue.listJobs(e);t(r.jobs),s(r.total),a(await n.queue.getStatus())}catch(e){d(e instanceof Error?e.message:`Failed to load queue`),console.error(`[Queue] Load error:`,e)}finally{l(!1)}};(0,y.useEffect)(()=>{S()},[m,_]);let{connected:C}=i({onMessage:e=>{try{let t=JSON.parse(e.data);t.topic===`queue:status`&&t.state&&(a({pending:t.state.pending||0,running:t.state.running||0,completed:t.state.completed||0,errors:t.state.errors||0}),console.log(`[Queue] SSE: Updated summary from event`,t.state)),t.topic===`queue:jobs`&&!c&&(console.log(`[Queue] SSE: Job update, reloading job list`),S())}catch(e){console.warn(`[Queue] Failed to parse SSE message:`,e)}}});return{jobs:e,summary:r,total:o,loading:c,error:u,actionLoading:f,connected:C,statusFilter:m,currentPage:b,totalPages:x,loadQueue:S,removeJob:async e=>{if(confirm(`Remove job ${e}?`))try{p(!0),await n.queue.removeJobs({job_id:e}),await S()}catch(e){alert(e instanceof Error?e.message:`Failed to remove job`)}finally{p(!1)}},clearCompleted:async()=>{if(confirm(`Clear all completed jobs?`))try{p(!0);let e=await n.queue.clearCompleted();alert(`Removed ${e.removed} completed job(s)`),await S()}catch(e){alert(e instanceof Error?e.message:`Failed to clear completed`)}finally{p(!1)}},clearErrors:async()=>{if(confirm(`Clear all error jobs?`))try{p(!0);let e=await n.queue.clearErrors();alert(`Removed ${e.removed} error job(s)`),await S()}catch(e){alert(e instanceof Error?e.message:`Failed to clear errors`)}finally{p(!1)}},clearAll:async()=>{if(confirm(`Clear ALL jobs (except running)?`))try{p(!0);let e=await n.queue.clearAll();alert(`Removed ${e.removed} job(s)`),await S()}catch(e){alert(e instanceof Error?e.message:`Failed to clear all`)}finally{p(!1)}},handleFilterChange:e=>{h(e),v(0)},nextPage:()=>{b<x&&v(_+g)},prevPage:()=>{b>1&&v(Math.max(0,_-g))}}}function x(){let{jobs:e,summary:t,total:n,loading:r,error:i,actionLoading:s,connected:c,statusFilter:l,currentPage:d,totalPages:f,loadQueue:p,removeJob:m,clearCompleted:h,clearErrors:g,clearAll:v,handleFilterChange:y,nextPage:x,prevPage:S}=b();return(0,a.jsxs)(`div`,{style:{padding:`20px`},children:[(0,a.jsx)(`h1`,{style:{marginBottom:`10px`},children:`Queue Management`}),(0,a.jsx)(_,{summary:t,connected:c}),(0,a.jsx)(o,{statusFilter:l,onFilterChange:y,loading:r,actionLoading:s,summary:t,onRefresh:p,onClearCompleted:h,onClearErrors:g,onClearAll:v}),r&&(0,a.jsx)(`div`,{style:{textAlign:`center`,padding:`40px`},children:(0,a.jsx)(`p`,{children:`Loading queue...`})}),i&&(0,a.jsxs)(`div`,{style:{padding:`20px`,backgroundColor:`var(--accent-red)`,borderRadius:`6px`,marginBottom:`20px`},children:[(0,a.jsx)(`strong`,{children:`Error:`}),` `,i]}),!r&&!i&&(0,a.jsx)(u,{jobs:e,total:n,currentPage:d,totalPages:f,onRemoveJob:m,onNextPage:x,onPrevPage:S,statusFilter:l})]})}export{x as QueuePage};