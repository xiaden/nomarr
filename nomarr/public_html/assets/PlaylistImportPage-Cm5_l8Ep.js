import{t as e}from"./Stack-T04yclWk.js";import"./listItemTextClasses-CouBwO02.js";import{a as t,i as n,n as r,r as i,t as a}from"./TextField-B8Rfe9MI.js";import"./useControlled-eA17I6yq.js";import{t as o}from"./Chip-DM4jfjFG.js";import{a as s,i as c,n as l,r as u,t as d}from"./TableRow-BwM4JDFI.js";import{t as f}from"./TableContainer-DDyNrnBW.js";import{Fn as p,J as m,Ln as h,Ot as g,Q as _,Yt as v,gt as y,ht as b,q as x,wn as S,wt as C,xt as w,y as T,yt as E}from"./index-D1CJpQaN.js";import{t as D}from"./MusicNote-Dcxhg619.js";var O=h(S()),k=v((0,O.jsx)(`path`,{d:`M19 2h-4.18C14.4.84 13.3 0 12 0S9.6.84 9.18 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m7 18H5V4h2v3h10V4h2z`}),`ContentPaste`),A=v((0,O.jsx)(`path`,{d:`M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z`}),`Download`),j=h(p(),1);function M(e){switch(e){case`exact_isrc`:return`isrc`;case`exact_metadata`:return`exact`;case`fuzzy`:return`fuzzy_high`;case`ambiguous`:return`fuzzy_low`;case`not_found`:return`none`}}async function N(e){return m(`/api/web/playlist-import/convert`,e)}async function P(){return x(`/api/web/playlist-import/spotify-status`)}var F={isrc:`success`,exact:`success`,fuzzy_high:`info`,fuzzy_low:`warning`,none:`error`};function I(){let[p,m]=(0,j.useState)(``),[h,v]=(0,j.useState)(``),[x,S]=(0,j.useState)([]),[I,L]=(0,j.useState)(null),[R,z]=(0,j.useState)(!1),[B,V]=(0,j.useState)(null),[H,U]=(0,j.useState)(null);(0,j.useEffect)(()=>{T().then(e=>{S(e),e.length>0&&v(e[0].library_id)}).catch(()=>S([])),P().then(e=>U(e.configured)).catch(()=>U(!1))},[]);let W=(0,j.useCallback)(async()=>{if(!(!p.trim()||!h)){z(!0),V(null),L(null);try{L(await N({playlist_url:p.trim(),library_id:h}))}catch(e){V(e instanceof Error?e.message:`Failed to convert playlist`)}finally{z(!1)}}},[p,h]),G=(0,j.useCallback)(()=>{if(!I)return;let e=new Blob([I.m3u_content],{type:`audio/x-mpegurl`}),t=URL.createObjectURL(e),n=document.createElement(`a`);n.href=t,n.download=`${I.playlist_metadata.name}.m3u`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)},[I]),K=p.includes(`spotify`)&&H===!1;return(0,O.jsx)(_,{title:`Playlist Import`,children:(0,O.jsxs)(e,{spacing:3,children:[(0,O.jsx)(w,{severity:`info`,icon:(0,O.jsx)(D,{}),children:`Paste a Spotify or Deezer playlist URL to convert it to an M3U playlist by matching tracks against your local library.`}),H===!1&&(0,O.jsxs)(w,{severity:`warning`,children:[`Spotify credentials not configured. Add `,(0,O.jsx)(`code`,{children:`spotify_client_id`}),` and`,` `,(0,O.jsx)(`code`,{children:`spotify_client_secret`}),` to your config to enable Spotify playlists.`]}),(0,O.jsx)(g,{sx:{p:3},children:(0,O.jsxs)(e,{spacing:2,children:[(0,O.jsx)(a,{label:`Playlist URL`,placeholder:`https://open.spotify.com/playlist/... or https://deezer.com/playlist/...`,value:p,onChange:e=>m(e.target.value),fullWidth:!0,InputProps:{startAdornment:(0,O.jsx)(k,{sx:{mr:1,color:`text.secondary`}})}}),(0,O.jsxs)(t,{fullWidth:!0,children:[(0,O.jsx)(n,{children:`Library`}),(0,O.jsx)(r,{value:h,label:`Library`,onChange:e=>v(e.target.value),children:x.map(e=>(0,O.jsx)(i,{value:e.library_id,children:e.name},e.library_id))})]}),(0,O.jsx)(b,{variant:`contained`,onClick:W,disabled:!p.trim()||!h||R||K,startIcon:R?(0,O.jsx)(C,{size:20}):(0,O.jsx)(D,{}),children:R?`Converting...`:`Convert Playlist`})]})}),B&&(0,O.jsx)(w,{severity:`error`,children:B}),I&&(0,O.jsx)(g,{sx:{p:3},children:(0,O.jsxs)(e,{spacing:2,children:[(0,O.jsxs)(y,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`},children:[(0,O.jsxs)(y,{children:[(0,O.jsx)(E,{variant:`h6`,children:I.playlist_metadata.name}),(0,O.jsxs)(E,{variant:`body2`,color:`text.secondary`,children:[I.total_tracks,` tracks from `,I.playlist_metadata.source_platform]})]}),(0,O.jsx)(b,{variant:`outlined`,startIcon:(0,O.jsx)(A,{}),onClick:G,children:`Download M3U`})]}),(0,O.jsxs)(y,{sx:{display:`flex`,gap:2,flexWrap:`wrap`},children:[(0,O.jsx)(o,{label:`${I.exact_matches} exact`,color:`success`,variant:`outlined`}),I.fuzzy_matches>0&&(0,O.jsx)(o,{label:`${I.fuzzy_matches} fuzzy`,color:`info`,variant:`outlined`}),I.ambiguous_count>0&&(0,O.jsx)(o,{label:`${I.ambiguous_count} ambiguous`,color:`warning`,variant:`outlined`}),I.not_found_count>0&&(0,O.jsx)(o,{label:`${I.not_found_count} not found`,color:`error`,variant:`outlined`}),(0,O.jsx)(o,{label:`${Math.round(I.match_rate*100)}% matched`,variant:`outlined`})]}),I.ambiguous_matches.length>0&&(0,O.jsxs)(y,{children:[(0,O.jsx)(E,{variant:`subtitle2`,color:`text.secondary`,sx:{mb:1},children:`Ambiguous matches (need review)`}),(0,O.jsx)(f,{sx:{maxHeight:300},children:(0,O.jsxs)(s,{size:`small`,stickyHeader:!0,children:[(0,O.jsx)(l,{children:(0,O.jsxs)(d,{children:[(0,O.jsx)(u,{children:`Track`}),(0,O.jsx)(u,{children:`Artist`}),(0,O.jsx)(u,{children:`Matched To`}),(0,O.jsx)(u,{align:`right`,children:`Confidence`})]})}),(0,O.jsx)(c,{children:I.ambiguous_matches.map((e,t)=>(0,O.jsxs)(d,{children:[(0,O.jsx)(u,{children:e.input_track.title}),(0,O.jsx)(u,{children:e.input_track.artist}),(0,O.jsx)(u,{sx:{maxWidth:300,overflow:`hidden`,textOverflow:`ellipsis`},children:e.matched_path?.split(`/`).pop()||`-`}),(0,O.jsx)(u,{align:`right`,children:(0,O.jsx)(o,{label:`${Math.round(e.confidence*100)}%`,color:F[M(e.status)],size:`small`})})]},t))})]})})]}),I.unmatched_tracks.length>0&&(0,O.jsxs)(y,{children:[(0,O.jsx)(E,{variant:`subtitle2`,color:`text.secondary`,sx:{mb:1},children:`Not found in library`}),(0,O.jsx)(f,{sx:{maxHeight:300},children:(0,O.jsxs)(s,{size:`small`,stickyHeader:!0,children:[(0,O.jsx)(l,{children:(0,O.jsxs)(d,{children:[(0,O.jsx)(u,{children:`Track`}),(0,O.jsx)(u,{children:`Artist`}),(0,O.jsx)(u,{children:`Album`})]})}),(0,O.jsx)(c,{children:I.unmatched_tracks.map((e,t)=>(0,O.jsxs)(d,{children:[(0,O.jsx)(u,{children:e.title}),(0,O.jsx)(u,{children:e.artist}),(0,O.jsx)(u,{children:e.album||`-`})]},t))})]})})]})]})})]})})}export{I as PlaylistImportPage};