import{t as e}from"./Stack-Cpw-s-cd.js";import{c as t,i as n,n as r,t as i}from"./TextField-Ccb8pGpE.js";import"./useSlotProps-C8NYhqjn.js";import{n as a}from"./listItemTextClasses-D34phFJT.js";import{K as o,O as s,Q as c,R as l,St as u,Y as d,Z as f,b as p,ct as m,ft as h,lt as g,m as _,n as v,p as y,st as b,tt as x,w as S,x as C,xt as w}from"./index-C7-f9Jfd.js";import{t as T}from"./useNotification-516BVKEL.js";var E=b(`MuiDivider`,[`root`,`absolute`,`fullWidth`,`inset`,`middle`,`flexItem`,`light`,`vertical`,`withChildren`,`withChildrenVertical`,`textAlignRight`,`textAlignLeft`,`wrapper`,`wrapperVertical`]),D=b(`MuiListItemIcon`,[`root`,`alignItemsFlexStart`]);function O(e){return m(`MuiMenuItem`,e)}var k=b(`MuiMenuItem`,[`root`,`focusVisible`,`dense`,`disabled`,`divider`,`gutters`,`selected`]),A=u(w()),j=u(h());const M=(e,t)=>{let{ownerState:n}=e;return[t.root,n.dense&&t.dense,n.divider&&t.divider,!n.disableGutters&&t.gutters]};var N=e=>{let{disabled:t,dense:n,divider:r,disableGutters:i,selected:a,classes:o}=e,s=x({root:[`root`,n&&`dense`,t&&`disabled`,!i&&`gutters`,r&&`divider`,a&&`selected`]},O,o);return{...o,...s}},P=f(s,{shouldForwardProp:e=>c(e)||e===`classes`,name:`MuiMenuItem`,slot:`Root`,overridesResolver:M})(o(({theme:e})=>({...e.typography.body1,display:`flex`,justifyContent:`flex-start`,alignItems:`center`,position:`relative`,textDecoration:`none`,minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:`border-box`,whiteSpace:`nowrap`,"&:hover":{textDecoration:`none`,backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:`transparent`}},[`&.${k.selected}`]:{backgroundColor:e.alpha((e.vars||e).palette.primary.main,(e.vars||e).palette.action.selectedOpacity),[`&.${k.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.primary.main,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)}},[`&.${k.selected}:hover`]:{backgroundColor:e.alpha((e.vars||e).palette.primary.main,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:e.alpha((e.vars||e).palette.primary.main,(e.vars||e).palette.action.selectedOpacity)}},[`&.${k.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${k.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`& + .${E.root}`]:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},[`& + .${E.inset}`]:{marginLeft:52},[`& .${a.root}`]:{marginTop:0,marginBottom:0},[`& .${a.inset}`]:{paddingLeft:36},[`& .${D.root}`]:{minWidth:36},variants:[{props:({ownerState:e})=>!e.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:e})=>e.divider,style:{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:`padding-box`}},{props:({ownerState:e})=>!e.dense,style:{[e.breakpoints.up(`sm`)]:{minHeight:`auto`}}},{props:({ownerState:e})=>e.dense,style:{minHeight:32,paddingTop:4,paddingBottom:4,...e.typography.body2,[`& .${D.root} svg`]:{fontSize:`1.25rem`}}}]}))),F=A.forwardRef(function(e,r){let i=d({props:e,name:`MuiMenuItem`}),{autoFocus:a=!1,component:o=`li`,dense:s=!1,divider:c=!1,disableGutters:u=!1,focusVisibleClassName:f,role:p=`menuitem`,tabIndex:m,className:h,..._}=i,v=A.useContext(n),y=A.useMemo(()=>({dense:s||v.dense||!1,disableGutters:u}),[v.dense,s,u]),b=A.useRef(null);t(()=>{a&&b.current&&b.current.focus()},[a]);let x={...i,dense:y.dense,divider:c,disableGutters:u},S=N(i),C=l(b,r),w;return i.disabled||(w=m===void 0?-1:m),(0,j.jsx)(n.Provider,{value:y,children:(0,j.jsx)(P,{ref:C,role:p,tabIndex:w,component:o,focusVisibleClassName:g(S.focusVisible,f),className:g(S.root,h),..._,ownerState:x,classes:S})})});function I({configKey:e,value:t,onChange:n,disabled:a}){let o=t==null?``:String(t);return(0,j.jsxs)(C,{sx:{display:`grid`,gap:1},children:[(0,j.jsx)(S,{variant:`body2`,color:`text.secondary`,sx:{fontWeight:`bold`},children:e}),(0,j.jsx)(C,{sx:{display:`flex`,gap:1.25,alignItems:`center`},children:typeof t==`boolean`?(0,j.jsxs)(r,{value:o,onChange:t=>n(e,t.target.value),disabled:a,size:`small`,fullWidth:!0,children:[(0,j.jsx)(F,{value:`true`,children:`true`}),(0,j.jsx)(F,{value:`false`,children:`false`})]}):(0,j.jsx)(i,{type:`text`,value:o,onChange:t=>n(e,t.target.value),disabled:a,size:`small`,fullWidth:!0})})]})}function L({config:t,hasChanges:n,saveLoading:r,onChange:i,onSaveAll:a}){return(0,j.jsxs)(_,{children:[(0,j.jsx)(y,{title:`Settings`}),(0,j.jsx)(S,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Changes are saved to the database and will take effect on server restart. Use "Restart Server" in Admin page to apply changes.`}),(0,j.jsx)(e,{spacing:1.875,children:Object.entries(t).map(([e,t])=>(0,j.jsx)(I,{configKey:e,value:t,onChange:i,disabled:r},e))}),(0,j.jsxs)(C,{sx:{mt:3.75,display:`flex`,gap:1.25,alignItems:`center`},children:[(0,j.jsx)(p,{onClick:a,variant:`contained`,disabled:!n||r,sx:{whiteSpace:`nowrap`},children:r?`Saving...`:`Save All Changes`}),n&&(0,j.jsx)(S,{variant:`body2`,color:`warning.main`,children:`Unsaved changes`})]})]})}function R(){let{showSuccess:e,showError:t,showInfo:n}=T(),[r,i]=(0,A.useState)({}),[a,o]=(0,A.useState)({}),[s,c]=(0,A.useState)(!0),[l,u]=(0,A.useState)(null),[d,f]=(0,A.useState)(!1),[p,m]=(0,A.useState)(!1),h=async()=>{try{c(!0),u(null);let e=await v.config.get();i(e),o(e),m(!1)}catch(e){u(e instanceof Error?e.message:`Failed to load config`),console.error(`[Config] Load error:`,e)}finally{c(!1)}};return(0,A.useEffect)(()=>{h()},[]),(0,A.useEffect)(()=>{m(Object.keys(r).some(e=>r[e]!==a[e]))},[r,a]),{config:r,loading:s,error:l,saveLoading:d,hasChanges:p,handleSaveAll:async()=>{try{f(!0);let t=[];for(let e of Object.keys(r))if(r[e]!==a[e]){let n=r[e];if(n==null||n===``)continue;await v.config.update(e,String(n)),t.push(e)}if(t.length===0){n(`No changes to save`);return}e(`Saved ${t.length} config change(s). Use "Restart Server" in Admin page to apply.`),await h()}catch(e){t(e instanceof Error?e.message:`Failed to save config`)}finally{f(!1)}},handleChange:(e,t)=>{i(n=>({...n,[e]:t}))}}}function z(){let{config:e,loading:t,error:n,saveLoading:r,hasChanges:i,handleSaveAll:a,handleChange:o}=R();return(0,j.jsxs)(`div`,{style:{padding:`20px`},children:[(0,j.jsx)(`h1`,{style:{marginBottom:`20px`},children:`Configuration`}),t&&(0,j.jsx)(`p`,{children:`Loading configuration...`}),n&&(0,j.jsxs)(`p`,{style:{color:`var(--accent-red)`},children:[`Error: `,n]}),!t&&!n&&(0,j.jsx)(`div`,{style:{display:`grid`,gap:`20px`},children:(0,j.jsx)(L,{config:e,hasChanges:i,saveLoading:r,onChange:o,onSaveAll:a})})]})}export{z as ConfigPage};