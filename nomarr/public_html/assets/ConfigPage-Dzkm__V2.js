import{t as e}from"./Stack-DVingYwP.js";import{a as t,c as n,l as r,n as i,o as a,s as o,t as s}from"./TextField-Bnql_IZQ.js";import{n as c}from"./useSlotProps-biQbmenV.js";import{t as l}from"./Tooltip-DKum3e4f.js";import{t as u}from"./Chip-CnPx7Y89.js";import{t as d}from"./MenuItem-CmuMy-KC.js";import{t as f}from"./ServerFilePicker-BlNPCaHO.js";import{a as p,c as m,i as h,n as g,o as _,s as v,t as ee}from"./library-BsG9YwLA.js";import{C as y,D as b,Dt as x,Et as S,I as C,M as w,N as T,Q as E,X as D,Z as O,_t as k,a as A,c as j,et as M,ft as N,g as P,h as F,j as I,k as L,l as te,mt as R,nt as z,o as ne,ot as re,pt as B,r as V,rt as H,w as U}from"./index-W9oPedVS.js";import{t as ie}from"./useConfirmDialog-BDJ08get.js";import{t as ae}from"./useNotification-CG8b52NB.js";function W(e){return B(`PrivateSwitchBase`,e)}N(`PrivateSwitchBase`,[`root`,`checked`,`disabled`,`input`,`edgeStart`,`edgeEnd`]);var G=x(S()),K=x(k()),q=e=>{let{classes:t,checked:n,disabled:r,edge:i}=e;return re({root:[`root`,n&&`checked`,r&&`disabled`,i&&`edge${E(i)}`],input:[`input`]},W,t)},J=z(T,{name:`MuiSwitchBase`})({padding:9,borderRadius:`50%`,variants:[{props:{edge:`start`,size:`small`},style:{marginLeft:-3}},{props:({edge:e,ownerState:t})=>e===`start`&&t.size!==`small`,style:{marginLeft:-12}},{props:{edge:`end`,size:`small`},style:{marginRight:-3}},{props:({edge:e,ownerState:t})=>e===`end`&&t.size!==`small`,style:{marginRight:-12}}]}),oe=z(`input`,{name:`MuiSwitchBase`,shouldForwardProp:H})({cursor:`inherit`,position:`absolute`,opacity:0,width:`100%`,height:`100%`,top:0,left:0,margin:0,padding:0,zIndex:1}),se=G.forwardRef(function(e,t){let{autoFocus:n,checked:r,checkedIcon:i,defaultChecked:a,disabled:s,disableFocusRipple:l=!1,edge:u=!1,icon:d,id:f,inputProps:p,inputRef:m,name:h,onBlur:g,onChange:_,onFocus:v,readOnly:ee,required:y=!1,tabIndex:b,type:x,value:S,slots:w={},slotProps:T={},...E}=e,[D,O]=c({controlled:r,default:!!a,name:`SwitchBase`,state:`checked`}),k=o(),A=e=>{v&&v(e),k&&k.onFocus&&k.onFocus(e)},j=e=>{g&&g(e),k&&k.onBlur&&k.onBlur(e)},M=e=>{if(e.nativeEvent.defaultPrevented)return;let t=e.target.checked;O(t),_&&_(e,t)},N=s;k&&N===void 0&&(N=k.disabled);let P=x===`checkbox`||x===`radio`,F={...e,checked:D,disabled:N,disableFocusRipple:l,edge:u},I=q(F),L={slots:w,slotProps:{input:p,...T}},[te,R]=C(`root`,{ref:t,elementType:J,className:I.root,shouldForwardComponentProp:!0,externalForwardedProps:{...L,component:`span`,...E},getSlotProps:e=>({...e,onFocus:t=>{e.onFocus?.(t),A(t)},onBlur:t=>{e.onBlur?.(t),j(t)}}),ownerState:F,additionalProps:{centerRipple:!0,focusRipple:!l,disabled:N,role:void 0,tabIndex:null}}),[z,ne]=C(`input`,{ref:m,elementType:oe,className:I.input,externalForwardedProps:L,getSlotProps:e=>({...e,onChange:t=>{e.onChange?.(t),M(t)}}),ownerState:F,additionalProps:{autoFocus:n,checked:r,defaultChecked:a,disabled:N,id:P?f:void 0,name:h,readOnly:ee,required:y,tabIndex:b,type:x,...x===`checkbox`&&S===void 0?{}:{value:S}}});return(0,K.jsxs)(te,{...R,children:[(0,K.jsx)(z,{...ne}),D?i:d]})}),ce=D((0,K.jsx)(`path`,{d:`M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z`}),`CheckBoxOutlineBlank`),le=D((0,K.jsx)(`path`,{d:`M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z`}),`CheckBox`),ue=D((0,K.jsx)(`path`,{d:`M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z`}),`IndeterminateCheckBox`);function de(e){return B(`MuiCheckbox`,e)}var Y=N(`MuiCheckbox`,[`root`,`checked`,`disabled`,`indeterminate`,`colorPrimary`,`colorSecondary`,`sizeSmall`,`sizeMedium`]),fe=e=>{let{classes:t,indeterminate:n,color:r,size:i}=e,a=re({root:[`root`,n&&`indeterminate`,`color${E(r)}`,`size${E(i)}`]},de,t);return{...t,...a}},pe=z(se,{shouldForwardProp:e=>H(e)||e===`classes`,name:`MuiCheckbox`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${E(n.size)}`],n.color!==`default`&&t[`color${E(n.color)}`]]}})(O(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:`default`,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(w()).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(w()).map(([t])=>({props:{color:t},style:{[`&.${Y.checked}, &.${Y.indeterminate}`]:{color:(e.vars||e).palette[t].main},[`&.${Y.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:`transparent`}}}}]}))),X=(0,K.jsx)(le,{}),Z=(0,K.jsx)(ce,{}),me=(0,K.jsx)(ue,{}),he=G.forwardRef(function(e,t){let n=M({props:e,name:`MuiCheckbox`}),{checkedIcon:i=X,color:a=`primary`,icon:o=Z,indeterminate:s=!1,indeterminateIcon:c=me,inputProps:l,size:u=`medium`,disableRipple:d=!1,className:f,slots:p={},slotProps:m={},...h}=n,g=s?c:o,_=s?c:i,v={...n,disableRipple:d,color:a,indeterminate:s,size:u},ee=fe(v),y=m.input??l,[b,x]=C(`root`,{ref:t,elementType:pe,className:R(ee.root,f),shouldForwardComponentProp:!0,externalForwardedProps:{slots:p,slotProps:m,...h},ownerState:v,additionalProps:{type:`checkbox`,icon:G.cloneElement(g,{fontSize:g.props.fontSize??u}),checkedIcon:G.cloneElement(_,{fontSize:_.props.fontSize??u}),disableRipple:d,slots:p,slotProps:{input:r(typeof y==`function`?y(v):y,{"data-indeterminate":s})}}});return(0,K.jsx)(b,{...x,classes:ee})});function Q(e){return B(`MuiFormControlLabel`,e)}var $=N(`MuiFormControlLabel`,[`root`,`labelPlacementStart`,`labelPlacementTop`,`labelPlacementBottom`,`disabled`,`label`,`error`,`required`,`asterisk`]),ge=e=>{let{classes:t,disabled:n,labelPlacement:r,error:i,required:a}=e;return re({root:[`root`,n&&`disabled`,`labelPlacement${E(r)}`,i&&`error`,a&&`required`],label:[`label`,n&&`disabled`],asterisk:[`asterisk`,i&&`error`]},Q,t)};const _e=z(`label`,{name:`MuiFormControlLabel`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${$.label}`]:t.label},t.root,t[`labelPlacement${E(n.labelPlacement)}`]]}})(O(({theme:e})=>({display:`inline-flex`,alignItems:`center`,cursor:`pointer`,verticalAlign:`middle`,WebkitTapHighlightColor:`transparent`,marginLeft:-11,marginRight:16,[`&.${$.disabled}`]:{cursor:`default`},[`& .${$.label}`]:{[`&.${$.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:`start`},style:{flexDirection:`row-reverse`,marginRight:-11}},{props:{labelPlacement:`top`},style:{flexDirection:`column-reverse`}},{props:{labelPlacement:`bottom`},style:{flexDirection:`column`}},{props:({labelPlacement:e})=>e===`start`||e===`top`||e===`bottom`,style:{marginLeft:16}}]})));var ve=z(`span`,{name:`MuiFormControlLabel`,slot:`Asterisk`})(O(({theme:e})=>({[`&.${$.error}`]:{color:(e.vars||e).palette.error.main}}))),ye=G.forwardRef(function(e,t){let r=M({props:e,name:`MuiFormControlLabel`}),{checked:i,className:a,componentsProps:s={},control:c,disabled:l,disableTypography:u,inputRef:d,label:f,labelPlacement:p=`end`,name:m,onChange:h,required:g,slots:_={},slotProps:v={},value:ee,...y}=r,x=o(),S=l??c.props.disabled??x?.disabled,w=g??c.props.required,T={disabled:S,required:w};[`checked`,`name`,`onChange`,`value`,`inputRef`].forEach(e=>{c.props[e]===void 0&&r[e]!==void 0&&(T[e]=r[e])});let E=n({props:r,muiFormControl:x,states:[`error`]}),D={...r,disabled:S,labelPlacement:p,required:w,error:E.error},O=ge(D),[k,A]=C(`typography`,{elementType:b,externalForwardedProps:{slots:_,slotProps:{...s,...v}},ownerState:D}),j=f;return j!=null&&j.type!==b&&!u&&(j=(0,K.jsx)(k,{component:`span`,...A,className:R(O.label,A?.className),children:j})),(0,K.jsxs)(_e,{className:R(O.root,a),ownerState:D,ref:t,...y,children:[G.cloneElement(c,T),w?(0,K.jsxs)(`div`,{children:[j,(0,K.jsxs)(ve,{ownerState:D,"aria-hidden":!0,className:O.asterisk,children:[` `,`*`]})]}):j]})});async function be(){return V(`/api/web/config`)}async function xe(e,t){return A(`/api/web/config`,{key:e,value:t})}function Se(){let{showSuccess:n}=ae(),{confirm:r,isOpen:o,options:c,handleConfirm:x,handleCancel:S}=ie(),[C,w]=(0,G.useState)([]),[T,E]=(0,G.useState)(!0),[D,O]=(0,G.useState)(null),[k,A]=(0,G.useState)(!1),[M,N]=(0,G.useState)(null),[I,L]=(0,G.useState)(null),[te,R]=(0,G.useState)(null),[z,re]=(0,G.useState)(null),[B,V]=(0,G.useState)(``),[H,W]=(0,G.useState)(``),[q,J]=(0,G.useState)(!0),[oe,se]=(0,G.useState)(!1),[ce,le]=(0,G.useState)(`off`),[ue,de]=(0,G.useState)(!1),[Y,fe]=(0,G.useState)(null),[pe,X]=(0,G.useState)(!1),Z=async()=>{try{E(!0),O(null),w(await h())}catch(e){O(e instanceof Error?e.message:`Failed to load libraries`),console.error(`[LibraryManagement] Load error:`,e)}finally{E(!1)}},me=async()=>{try{re((await be()).library_root||null)}catch(e){console.error(`[LibraryManagement] Failed to load config:`,e)}};(0,G.useEffect)(()=>{Z(),me()},[]);let Q=e=>{if(!z)return!1;let t=z.replace(/\/+$/,``);return!e.replace(/\/+$/,``).startsWith(t)},$=()=>{V(``),W(``),J(!0),se(!1),le(`off`),de(!1),fe(null),X(!1),A(!1),N(null)},ge=()=>{$(),A(!0)},_e=e=>{V(e.name),W(e.rootPath),J(e.isEnabled),se(e.isDefault),le(e.watchMode),N(e.id),A(!1),fe(null),X(!1)},ve=async()=>{if(!H.trim()){O(`Path is required for preview`);return}if(M===null){O(`Create the library first to preview file count`);return}try{O(null),X(!0),fe((await p(M,{recursive:!0})).file_count)}catch(e){O(e instanceof Error?e.message:`Failed to preview library`)}finally{X(!1)}},xe=async()=>{if(!H.trim()){O(`Path is required`);return}try{O(null),await ee({name:B.trim()||null,rootPath:H,isEnabled:q,isDefault:oe,watchMode:ce}),await Z(),$()}catch(e){O(e instanceof Error?e.message:`Failed to create library`)}},Se=async()=>{if(M!==null){if(!H.trim()){O(`Path is required`);return}try{O(null),await m(M,{name:B.trim()||void 0,rootPath:H,isEnabled:q,isDefault:oe,watchMode:ce}),await Z(),$()}catch(e){O(e instanceof Error?e.message:`Failed to update library`)}}},Ce=async e=>{try{O(null),await v(e),await Z()}catch(e){O(e instanceof Error?e.message:`Failed to set default library`)}},we=async e=>{try{if(O(null),L(e),R(`preparing`),!await r({title:`Start Library Scan?`,message:`Found ${(await p(e,{recursive:!0})).file_count.toLocaleString()} audio files. Start scan?`}))return;R(`queueing`);let t=await _(e);n(`Scan ${t.status}: ${t.message||`Library scan queued`}`),await Z()}catch(e){O(e instanceof Error?e.message:`Failed to scan library`)}finally{L(null),R(null)}},Te=async(e,t,n)=>{if(n){O(`Cannot delete the default library. Set another library as default first.`);return}if(await r({title:`Delete Library?`,message:`Delete library "${t}"?\n\nThis will remove the library entry but will NOT delete files on disk.`,severity:`warning`}))try{O(null),await g(e),await Z()}catch(e){O(e instanceof Error?e.message:`Failed to delete library`)}},Ee=async(e,t)=>{try{O(null),await m(e,{watchMode:t}),await Z(),n(`File watching mode changed to ${t}`)}catch(e){O(e instanceof Error?e.message:`Failed to change watch mode`)}},De=e=>{switch(e){case`event`:return`Event`;case`poll`:return`Poll`;default:return`Off`}},Oe=e=>{switch(e){case`event`:return`success`;case`poll`:return`warning`;default:return`default`}},ke=k||M!==null;return(0,K.jsxs)(e,{spacing:2.5,children:[(0,K.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`center`,children:[(0,K.jsx)(b,{variant:`h5`,children:`Libraries`}),!ke&&(0,K.jsx)(y,{variant:`contained`,onClick:ge,children:`+ Add Library`})]}),D&&(0,K.jsx)(j,{children:D}),ke&&(0,K.jsxs)(P,{children:[(0,K.jsx)(F,{title:k?`Create Library`:`Edit Library`}),(0,K.jsxs)(e,{spacing:2,children:[(0,K.jsxs)(U,{children:[(0,K.jsx)(b,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Name (optional)`}),(0,K.jsx)(s,{value:B,onChange:e=>V(e.target.value),placeholder:`Auto-generated from path if left empty`,fullWidth:!0})]}),(0,K.jsxs)(U,{children:[(0,K.jsx)(b,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Root Path`}),(0,K.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,K.jsx)(s,{value:H,onChange:e=>W(e.target.value),placeholder:`/music`,fullWidth:!0}),(0,K.jsx)(y,{variant:`outlined`,onClick:()=>de(!ue),sx:{minWidth:120},children:ue?`Hide Picker`:`Browse...`})]}),ue&&(0,K.jsx)(U,{sx:{mt:1.25,p:2,bgcolor:`background.default`,borderRadius:1,border:1,borderColor:`divider`},children:(0,K.jsx)(f,{value:H,onChange:e=>{W(e),de(!1)},mode:`directory`,label:`Select Library Root Directory`})})]}),(0,K.jsx)(ye,{control:(0,K.jsx)(he,{checked:q,onChange:e=>J(e.target.checked)}),label:`Enabled`}),(0,K.jsx)(ye,{control:(0,K.jsx)(he,{checked:oe,onChange:e=>se(e.target.checked)}),label:`Default Library`}),(0,K.jsx)(U,{children:(0,K.jsxs)(a,{fullWidth:!0,children:[(0,K.jsx)(t,{id:`watch-mode-label`,children:`File Watching`}),(0,K.jsxs)(i,{labelId:`watch-mode-label`,value:ce,label:`File Watching`,onChange:e=>le(e.target.value),children:[(0,K.jsx)(d,{value:`off`,children:(0,K.jsxs)(e,{children:[(0,K.jsxs)(b,{children:[(0,K.jsx)(`strong`,{children:`Off`}),` - No automatic scanning`]}),(0,K.jsx)(b,{variant:`caption`,color:`text.secondary`,children:`Manual scans only`})]})}),(0,K.jsx)(d,{value:`event`,children:(0,K.jsxs)(e,{children:[(0,K.jsxs)(b,{children:[(0,K.jsx)(`strong`,{children:`Event`}),` - Real-time file watching`]}),(0,K.jsx)(b,{variant:`caption`,color:`text.secondary`,children:`Fast (2-5s response), local filesystems only`})]})}),(0,K.jsx)(d,{value:`poll`,children:(0,K.jsxs)(e,{children:[(0,K.jsxs)(b,{children:[(0,K.jsx)(`strong`,{children:`Poll`}),` - Periodic scanning`]}),(0,K.jsx)(b,{variant:`caption`,color:`text.secondary`,children:`Slower (60s interval), network-mount-safe`})]})})]})]})}),M!==null&&(0,K.jsxs)(U,{children:[(0,K.jsx)(y,{variant:`outlined`,onClick:ve,disabled:!H.trim()||pe,children:pe?`Checking...`:`Preview File Count`}),Y!==null&&(0,K.jsx)(U,{sx:{mt:1,p:1.5,bgcolor:`background.paper`,borderRadius:1,border:1,borderColor:`divider`},children:(0,K.jsxs)(b,{children:[(0,K.jsx)(`strong`,{children:Y.toLocaleString()}),` audio files found`]})})]}),(0,K.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,K.jsx)(y,{variant:`contained`,onClick:k?xe:Se,children:k?`Create`:`Update`}),(0,K.jsx)(y,{variant:`outlined`,onClick:$,children:`Cancel`})]})]})]}),T&&(0,K.jsx)(b,{children:`Loading libraries...`}),!T&&!ke&&C.length===0&&(0,K.jsx)(P,{children:(0,K.jsx)(b,{color:`text.secondary`,textAlign:`center`,fontStyle:`italic`,children:`No libraries configured. Click "Add Library" to get started.`})}),!T&&!ke&&C.length>0&&(0,K.jsx)(e,{spacing:2,children:C.map(t=>(0,K.jsxs)(P,{children:[(0,K.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`flex-start`,sx:{mb:2},children:[(0,K.jsxs)(U,{children:[(0,K.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1.25,sx:{mb:.5},children:[(0,K.jsx)(b,{variant:`h6`,children:t.name}),t.isDefault&&(0,K.jsx)(u,{label:`Default`,color:`primary`,size:`small`}),Q(t.rootPath)&&(0,K.jsx)(u,{label:`Outside library_root`,color:`warning`,size:`small`})]}),(0,K.jsx)(b,{variant:`body2`,color:`text.secondary`,sx:{fontFamily:`monospace`},children:t.rootPath}),Q(t.rootPath)&&(0,K.jsxs)(b,{variant:`caption`,color:`warning.main`,sx:{mt:.5},children:[`⚠ This library is outside the configured library_root (`,z,`)`]}),(0,K.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:1},children:[(0,K.jsx)(b,{variant:`caption`,color:`text.secondary`,children:`File Watching:`}),(0,K.jsx)(a,{size:`small`,sx:{minWidth:120},children:(0,K.jsxs)(i,{value:t.watchMode,onChange:e=>Ee(t.id,e.target.value),size:`small`,sx:{fontSize:`0.75rem`},disabled:I===t.id,children:[(0,K.jsx)(d,{value:`off`,children:`Off`}),(0,K.jsx)(d,{value:`event`,children:`Event`}),(0,K.jsx)(d,{value:`poll`,children:`Poll`})]})}),(0,K.jsx)(l,{title:t.watchMode===`event`?`Real-time file watching (local filesystems)`:t.watchMode===`poll`?`Periodic scanning (network-mount-safe)`:`No automatic file watching`,children:(0,K.jsx)(u,{label:De(t.watchMode),color:Oe(t.watchMode),size:`small`})})]})]}),(0,K.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,children:[(0,K.jsx)(U,{sx:{width:8,height:8,borderRadius:`50%`,bgcolor:t.isEnabled?`success.main`:`text.disabled`}}),(0,K.jsx)(b,{variant:`body2`,color:`text.secondary`,children:t.isEnabled?`Enabled`:`Disabled`})]})]}),(0,K.jsxs)(e,{direction:`row`,spacing:1.25,flexWrap:`wrap`,children:[(0,K.jsx)(y,{variant:`outlined`,size:`small`,onClick:()=>_e(t),disabled:I===t.id,children:`Edit`}),!t.isDefault&&(0,K.jsx)(y,{variant:`outlined`,size:`small`,onClick:()=>Ce(t.id),disabled:I===t.id,children:`Set Default`}),(0,K.jsx)(y,{variant:`contained`,color:`success`,size:`small`,onClick:()=>we(t.id),disabled:!t.isEnabled||I===t.id||Q(t.rootPath),title:Q(t.rootPath)?`Cannot scan: library is outside library_root`:void 0,children:I===t.id?te===`preparing`?`Preparing...`:`Queueing...`:`Scan`}),(0,K.jsx)(y,{variant:`contained`,color:`error`,size:`small`,onClick:()=>Te(t.id,t.name,t.isDefault),disabled:I===t.id,children:`Delete`})]})]},t.id))}),(0,K.jsx)(ne,{open:o,title:c.title,message:c.message,confirmLabel:c.confirmLabel,cancelLabel:c.cancelLabel,severity:c.severity,onConfirm:x,onCancel:S})]})}var Ce={library_root:`Library Root Directory`,scan_recursive:`Scan Subdirectories`,scan_ignore_patterns:`Ignore Patterns`,tagging_enabled:`Auto-Tagging Enabled`,tagging_version_tag_key:`Version Tag Key`,processing_batch_size:`Processing Batch Size`,processing_max_workers:`Max Worker Threads`,gpu_enabled:`GPU Acceleration`,gpu_device_id:`GPU Device ID`,cache_size_mb:`Cache Size (MB)`,log_level:`Log Level`};function we({configKey:e,value:t,onChange:n,disabled:r}){let a=t==null?``:String(t),o=typeof t==`boolean`;return(0,K.jsxs)(U,{sx:{display:`flex`,gap:2,alignItems:`center`},children:[(0,K.jsx)(b,{variant:`body2`,color:`text.primary`,sx:{fontWeight:500,minWidth:`240px`,flexShrink:0},children:Ce[e]||e}),(0,K.jsx)(U,{sx:{flex:1,maxWidth:`400px`},children:o?(0,K.jsxs)(i,{value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0,children:[(0,K.jsx)(d,{value:`true`,children:`true`}),(0,K.jsx)(d,{value:`false`,children:`false`})]}):(0,K.jsx)(s,{type:`text`,value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0})})]})}function Te({config:t,hasChanges:n,saveLoading:r,onChange:i,onSaveAll:a}){return(0,K.jsxs)(P,{children:[(0,K.jsx)(F,{title:`Settings`}),(0,K.jsx)(b,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Changes are saved to the database and will take effect on server restart. Use "Restart Server" in Admin page to apply changes.`}),(0,K.jsx)(e,{spacing:1.875,children:Object.entries(t).map(([e,t])=>(0,K.jsx)(we,{configKey:e,value:t,onChange:i,disabled:r},e))}),(0,K.jsxs)(U,{sx:{mt:3.75,display:`flex`,gap:1.25,alignItems:`center`},children:[(0,K.jsx)(y,{onClick:a,variant:`contained`,disabled:!n||r,sx:{whiteSpace:`nowrap`},children:r?`Saving...`:`Save All Changes`}),n&&(0,K.jsx)(b,{variant:`body2`,color:`warning.main`,children:`Unsaved changes`})]})]})}function Ee(){let{showSuccess:e,showError:t,showInfo:n}=ae(),[r,i]=(0,G.useState)({}),[a,o]=(0,G.useState)({}),[s,c]=(0,G.useState)(!0),[l,u]=(0,G.useState)(null),[d,f]=(0,G.useState)(!1),[p,m]=(0,G.useState)(!1),h=async()=>{try{c(!0),u(null);let e=await be();i(e),o(e),m(!1)}catch(e){u(e instanceof Error?e.message:`Failed to load config`),console.error(`[Config] Load error:`,e)}finally{c(!1)}};return(0,G.useEffect)(()=>{h()},[]),(0,G.useEffect)(()=>{m(Object.keys(r).some(e=>r[e]!==a[e]))},[r,a]),{config:r,loading:s,error:l,saveLoading:d,hasChanges:p,handleSaveAll:async()=>{try{f(!0);let t=[];for(let e of Object.keys(r))if(r[e]!==a[e]){let n=r[e];if(n==null||n===``)continue;await xe(e,String(n)),t.push(e)}if(t.length===0){n(`No changes to save`);return}e(`Saved ${t.length} config change(s). Use "Restart Server" in Admin page to apply.`),await h()}catch(e){t(e instanceof Error?e.message:`Failed to save config`)}finally{f(!1)}},handleChange:(e,t)=>{i(n=>({...n,[e]:t}))}}}function De(){let{config:t,loading:n,error:r,saveLoading:i,hasChanges:a,handleSaveAll:o,handleChange:s}=Ee();return(0,K.jsxs)(te,{title:`Configuration`,children:[n&&(0,K.jsx)(I,{}),r&&(0,K.jsxs)(L,{severity:`error`,children:[`Error: `,r]}),!n&&!r&&(0,K.jsxs)(e,{spacing:2.5,children:[(0,K.jsx)(Se,{}),(0,K.jsx)(Te,{config:t,hasChanges:a,saveLoading:i,onChange:s,onSaveAll:o})]})]})}export{De as ConfigPage};