import{t as e}from"./Stack-CHbb6P4R.js";import"./useSlotProps--BZhkIc6.js";import{t}from"./Tooltip-DKP7nFlS.js";import{t as n}from"./Chip-C03yJejV.js";import{a as r,i,n as a,o,r as s,t as c}from"./queue-BHeNTDra.js";import{A as l,C as u,D as d,Dt as f,Et as p,M as m,N as h,Q as g,X as _,Z as v,_t as y,c as b,et as x,ft as S,g as C,l as w,mt as T,nt as E,o as D,ot as O,pt as k,t as A,ut as j,w as M}from"./index-uH8yfxIe.js";import{t as N}from"./useConfirmDialog-D_yV7nVf.js";import{t as P}from"./useNotification-DrfMeyUT.js";var F=f(p());function I(e){return F.Children.toArray(e).filter(e=>F.isValidElement(e))}function L(e){return k(`MuiToggleButton`,e)}var R=S(`MuiToggleButton`,[`root`,`disabled`,`selected`,`standard`,`primary`,`secondary`,`sizeSmall`,`sizeMedium`,`sizeLarge`,`fullWidth`]),z=F.createContext({}),B=F.createContext(void 0);function V(e,t){return t===void 0||e===void 0?!1:Array.isArray(t)?t.includes(e):e===t}var H=f(y()),U=e=>{let{classes:t,fullWidth:n,selected:r,disabled:i,size:a,color:o}=e;return O({root:[`root`,r&&`selected`,i&&`disabled`,n&&`fullWidth`,`size${g(a)}`,o]},L,t)},W=E(h,{name:`MuiToggleButton`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t[`size${g(n.size)}`]]}})(v(({theme:e})=>({...e.typography.button,borderRadius:(e.vars||e).shape.borderRadius,padding:11,border:`1px solid ${(e.vars||e).palette.divider}`,color:(e.vars||e).palette.action.active,[`&.${R.disabled}`]:{color:(e.vars||e).palette.action.disabled,border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`},"&:hover":{textDecoration:`none`,backgroundColor:e.alpha((e.vars||e).palette.text.primary,(e.vars||e).palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:`transparent`}},variants:[{props:{color:`standard`},style:{[`&.${R.selected}`]:{color:(e.vars||e).palette.text.primary,backgroundColor:e.alpha((e.vars||e).palette.text.primary,(e.vars||e).palette.action.selectedOpacity),"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.text.primary,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:e.alpha((e.vars||e).palette.text.primary,(e.vars||e).palette.action.selectedOpacity)}}}}},...Object.entries(e.palette).filter(m()).map(([t])=>({props:{color:t},style:{[`&.${R.selected}`]:{color:(e.vars||e).palette[t].main,backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.selectedOpacity),"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.selectedOpacity)}}}}})),{props:{fullWidth:!0},style:{width:`100%`}},{props:{size:`small`},style:{padding:7,fontSize:e.typography.pxToRem(13)}},{props:{size:`large`},style:{padding:15,fontSize:e.typography.pxToRem(15)}}]}))),G=F.forwardRef(function(e,t){let{value:n,...r}=F.useContext(z),i=F.useContext(B),a=x({props:j({...r,selected:V(e.value,n)},e),name:`MuiToggleButton`}),{children:o,className:s,color:c=`standard`,disabled:l=!1,disableFocusRipple:u=!1,fullWidth:d=!1,onChange:f,onClick:p,selected:m,size:h=`medium`,value:g,..._}=a,v={...a,color:c,disabled:l,disableFocusRipple:u,fullWidth:d,size:h},y=U(v),b=e=>{p&&(p(e,g),e.defaultPrevented)||f&&f(e,g)},S=i||``;return(0,H.jsx)(W,{className:T(r.className,y.root,s,S),disabled:l,focusRipple:!u,ref:t,onClick:b,onChange:f,value:g,ownerState:v,"aria-pressed":m,..._,children:o})});function K(e){return k(`MuiToggleButtonGroup`,e)}var q=S(`MuiToggleButtonGroup`,[`root`,`selected`,`horizontal`,`vertical`,`disabled`,`grouped`,`groupedHorizontal`,`groupedVertical`,`fullWidth`,`firstButton`,`lastButton`,`middleButton`]),J=e=>{let{classes:t,orientation:n,fullWidth:r,disabled:i}=e;return O({root:[`root`,n,r&&`fullWidth`],grouped:[`grouped`,`grouped${g(n)}`,i&&`disabled`],firstButton:[`firstButton`],lastButton:[`lastButton`],middleButton:[`middleButton`]},K,t)},Y=E(`div`,{name:`MuiToggleButtonGroup`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${q.grouped}`]:t.grouped},{[`& .${q.grouped}`]:t[`grouped${g(n.orientation)}`]},{[`& .${q.firstButton}`]:t.firstButton},{[`& .${q.lastButton}`]:t.lastButton},{[`& .${q.middleButton}`]:t.middleButton},t.root,n.orientation===`vertical`&&t.vertical,n.fullWidth&&t.fullWidth]}})(v(({theme:e})=>({display:`inline-flex`,borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{orientation:`vertical`},style:{flexDirection:`column`,[`& .${q.grouped}`]:{[`&.${q.selected} + .${q.grouped}.${q.selected}`]:{borderTop:0,marginTop:0}},[`& .${q.firstButton},& .${q.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${q.lastButton},& .${q.middleButton}`]:{marginTop:-1,borderTop:`1px solid transparent`,borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${q.lastButton}.${R.disabled},& .${q.middleButton}.${R.disabled}`]:{borderTop:`1px solid transparent`}}},{props:{fullWidth:!0},style:{width:`100%`}},{props:{orientation:`horizontal`},style:{[`& .${q.grouped}`]:{[`&.${q.selected} + .${q.grouped}.${q.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${q.firstButton},& .${q.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${q.lastButton},& .${q.middleButton}`]:{marginLeft:-1,borderLeft:`1px solid transparent`,borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${q.lastButton}.${R.disabled},& .${q.middleButton}.${R.disabled}`]:{borderLeft:`1px solid transparent`}}}]}))),X=F.forwardRef(function(e,t){let n=x({props:e,name:`MuiToggleButtonGroup`}),{children:r,className:i,color:a=`standard`,disabled:o=!1,exclusive:s=!1,fullWidth:c=!1,onChange:l,orientation:u=`horizontal`,size:d=`medium`,value:f,...p}=n,m={...n,disabled:o,fullWidth:c,orientation:u,size:d},h=J(m),g=F.useCallback((e,t)=>{if(!l)return;let n=f&&f.indexOf(t),r;f&&n>=0?(r=f.slice(),r.splice(n,1)):r=f?f.concat(t):[t],l(e,r)},[l,f]),_=F.useCallback((e,t)=>{l&&l(e,f===t?null:t)},[l,f]),v=F.useMemo(()=>({className:h.grouped,onChange:s?_:g,value:f,size:d,fullWidth:c,color:a,disabled:o}),[h.grouped,s,_,g,f,d,c,a,o]),y=I(r),b=y.length,S=e=>{let t=e===0,n=e===b-1;return t&&n?``:t?h.firstButton:n?h.lastButton:h.middleButton};return(0,H.jsx)(Y,{role:`group`,className:T(h.root,i),ref:t,ownerState:m,...p,children:(0,H.jsx)(z.Provider,{value:v,children:y.map((e,t)=>(0,H.jsx)(B.Provider,{value:S(t),children:e},t))})})}),Z=_((0,H.jsx)(`path`,{d:`M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z`}),`Delete`),Q=_((0,H.jsx)(`path`,{d:`M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z`}),`Refresh`);function $({statusFilter:t,onFilterChange:n,loading:r,actionLoading:i,summary:a,onRefresh:o,onClearCompleted:s,onClearErrors:c,onClearAll:l}){return(0,H.jsx)(C,{children:(0,H.jsxs)(e,{direction:`row`,spacing:2,alignItems:`center`,justifyContent:`space-between`,flexWrap:`wrap`,gap:2,children:[(0,H.jsx)(X,{value:t,exclusive:!0,onChange:(e,t)=>t&&n(t),size:`small`,disabled:r,children:[`all`,`pending`,`running`,`done`,`error`].map(e=>(0,H.jsx)(G,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),(0,H.jsxs)(e,{direction:`row`,spacing:1,children:[(0,H.jsx)(u,{onClick:o,disabled:r||i,variant:`outlined`,size:`small`,startIcon:(0,H.jsx)(Q,{}),children:`Refresh`}),(0,H.jsx)(u,{onClick:s,disabled:r||i||a.completed===0,variant:`outlined`,size:`small`,children:`Clear Completed`}),(0,H.jsx)(u,{onClick:c,disabled:r||i||a.errors===0,variant:`outlined`,size:`small`,children:`Clear Errors`}),(0,H.jsx)(u,{onClick:l,disabled:r||i,variant:`outlined`,color:`error`,size:`small`,children:`Clear All`})]})]})})}function ee({jobs:r,total:i,currentPage:a,totalPages:o,onRemoveJob:s,onNextPage:c,onPrevPage:f,statusFilter:p}){let m=e=>e?new Date(e*1e3).toLocaleString():`-`,h=(e,t=80)=>{if(e.length<=t)return e;let n=e.substring(0,40),r=e.substring(e.length-37);return n+`...`+r},g=e=>e===`running`?`warning`:e===`done`?`success`:e===`error`?`error`:`default`;return r.length===0&&i===0?(0,H.jsx)(C,{children:(0,H.jsx)(d,{color:`text.secondary`,textAlign:`center`,py:8,children:p===`all`?`Queue is empty`:`No ${p} jobs found`})}):(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(e,{spacing:1,children:r.map(r=>(0,H.jsxs)(M,{sx:{bgcolor:`background.paper`,border:1,borderColor:`divider`,borderRadius:1,p:2,display:`flex`,justifyContent:`space-between`,alignItems:`flex-start`},children:[(0,H.jsxs)(M,{sx:{flex:1,minWidth:0},children:[(0,H.jsxs)(e,{direction:`row`,spacing:1,alignItems:`center`,sx:{mb:1},children:[(0,H.jsxs)(d,{variant:`caption`,color:`text.disabled`,sx:{fontFamily:`monospace`},children:[`#`,r.id]}),(0,H.jsx)(n,{label:r.status,size:`small`,color:g(r.status),sx:{height:20,fontSize:`0.7rem`}})]}),(0,H.jsx)(t,{title:r.path,placement:`top`,children:(0,H.jsx)(d,{variant:`body2`,sx:{fontFamily:`monospace`,fontSize:`0.85rem`,mb:.5,wordBreak:`break-all`},children:h(r.path)})}),(0,H.jsxs)(e,{direction:`row`,spacing:2,sx:{mt:1},children:[(0,H.jsxs)(d,{variant:`caption`,color:`text.secondary`,children:[`Created: `,m(r.created_at)]}),r.started_at&&(0,H.jsxs)(d,{variant:`caption`,color:`text.secondary`,children:[`Started: `,m(r.started_at)]})]}),r.error_message&&(0,H.jsx)(d,{variant:`caption`,color:`error`,sx:{display:`block`,mt:1,p:1,bgcolor:`error.dark`,borderRadius:.5},children:r.error_message})]}),(0,H.jsx)(l,{onClick:()=>s(r.id),disabled:r.status===`running`,color:`error`,size:`small`,sx:{ml:2},children:(0,H.jsx)(Z,{fontSize:`small`})})]},r.id))}),o>1&&(0,H.jsx)(M,{sx:{mt:3},children:(0,H.jsxs)(e,{direction:`row`,spacing:2,alignItems:`center`,justifyContent:`center`,children:[(0,H.jsx)(u,{variant:`outlined`,onClick:f,disabled:a===1,children:`Previous`}),(0,H.jsxs)(d,{color:`text.secondary`,children:[`Page `,a,` of `,o,` (`,i.toLocaleString(),` total)`]}),(0,H.jsx)(u,{variant:`outlined`,onClick:c,disabled:a===o,children:`Next`})]})})]})}function te({summary:t,connected:r}){return(0,H.jsxs)(C,{children:[(0,H.jsxs)(e,{direction:`row`,spacing:1,alignItems:`center`,sx:{mb:2},children:[(0,H.jsx)(d,{variant:`body2`,color:`text.secondary`,children:`SSE Status:`}),(0,H.jsx)(n,{label:r?`Connected`:`Disconnected`,size:`small`,color:r?`success`:`error`,sx:{height:20,fontSize:`0.7rem`}})]}),(0,H.jsxs)(e,{direction:`row`,spacing:2,flexWrap:`wrap`,children:[(0,H.jsxs)(M,{sx:{display:`flex`,flexDirection:`column`,alignItems:`center`,p:2,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minWidth:100},children:[(0,H.jsx)(d,{variant:`h4`,fontWeight:`bold`,children:t.pending}),(0,H.jsx)(d,{variant:`caption`,color:`text.secondary`,children:`Pending`})]}),(0,H.jsxs)(M,{sx:{display:`flex`,flexDirection:`column`,alignItems:`center`,p:2,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minWidth:100},children:[(0,H.jsx)(d,{variant:`h4`,fontWeight:`bold`,children:t.running}),(0,H.jsx)(d,{variant:`caption`,color:`text.secondary`,children:`Running`})]}),(0,H.jsxs)(M,{sx:{display:`flex`,flexDirection:`column`,alignItems:`center`,p:2,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minWidth:100},children:[(0,H.jsx)(d,{variant:`h4`,fontWeight:`bold`,children:t.completed}),(0,H.jsx)(d,{variant:`caption`,color:`text.secondary`,children:`Completed`})]}),(0,H.jsxs)(M,{sx:{display:`flex`,flexDirection:`column`,alignItems:`center`,p:2,bgcolor:`background.default`,border:1,borderColor:`divider`,borderRadius:1,minWidth:100},children:[(0,H.jsx)(d,{variant:`h4`,fontWeight:`bold`,children:t.errors}),(0,H.jsx)(d,{variant:`caption`,color:`text.secondary`,children:`Errors`})]})]})]})}function ne(){let{showSuccess:e,showError:t}=P(),{confirm:n,isOpen:l,options:u,handleConfirm:d,handleCancel:f}=N(),[p,m]=(0,F.useState)([]),[h,g]=(0,F.useState)({pending:0,running:0,completed:0,errors:0}),[_,v]=(0,F.useState)(0),[y,b]=(0,F.useState)(!0),[x,S]=(0,F.useState)(null),[C,w]=(0,F.useState)(!1),[T,E]=(0,F.useState)(`all`),[D]=(0,F.useState)(50),[O,k]=(0,F.useState)(0),j=Math.floor(O/D)+1,M=Math.ceil(_/D),I=async()=>{try{b(!0),S(null);let e={limit:D,offset:O};T!==`all`&&(e.status=T);let t=await r(e);m(t.jobs),v(t.total),g(await i())}catch(e){S(e instanceof Error?e.message:`Failed to load queue`),console.error(`[Queue] Load error:`,e)}finally{b(!1)}};(0,F.useEffect)(()=>{I()},[T,O]);let{connected:L}=A({onMessage:e=>{try{let t=JSON.parse(e.data);t.topic===`queue:status`&&t.state&&(g({pending:t.state.pending||0,running:t.state.running||0,completed:t.state.completed||0,errors:t.state.errors||0}),console.log(`[Queue] SSE: Updated summary from event`,t.state)),t.topic===`queue:jobs`&&!y&&(console.log(`[Queue] SSE: Job update, reloading job list`),I())}catch(e){console.warn(`[Queue] Failed to parse SSE message:`,e)}}});return{jobs:p,summary:h,total:_,loading:y,error:x,actionLoading:C,connected:L,statusFilter:T,currentPage:j,totalPages:M,loadQueue:I,removeJob:async e=>{if(await n({title:`Remove Job`,message:`Remove job ${e}?`,severity:`warning`}))try{w(!0),await o({job_id:e}),await I()}catch(e){t(e instanceof Error?e.message:`Failed to remove job`)}finally{w(!1)}},clearCompleted:async()=>{if(await n({title:`Clear Completed Jobs`,message:`Clear all completed jobs?`,severity:`warning`}))try{w(!0),e(`Removed ${(await a()).removed} completed job(s)`),await I()}catch(e){t(e instanceof Error?e.message:`Failed to clear completed`)}finally{w(!1)}},clearErrors:async()=>{if(await n({title:`Clear Error Jobs`,message:`Clear all error jobs?`,severity:`error`}))try{w(!0),e(`Removed ${(await s()).removed} error job(s)`),await I()}catch(e){t(e instanceof Error?e.message:`Failed to clear errors`)}finally{w(!1)}},clearAll:async()=>{if(await n({title:`Clear All Jobs`,message:`Clear ALL jobs (except running)?`,severity:`error`}))try{w(!0),e(`Removed ${(await c()).removed} job(s)`),await I()}catch(e){t(e instanceof Error?e.message:`Failed to clear all`)}finally{w(!1)}},handleFilterChange:e=>{E(e),k(0)},nextPage:()=>{j<M&&k(O+D)},prevPage:()=>{j>1&&k(Math.max(0,O-D))},dialogState:{isOpen:l,options:u,handleConfirm:d,handleCancel:f}}}function re(){let{jobs:e,summary:t,total:n,loading:r,error:i,actionLoading:a,connected:o,statusFilter:s,currentPage:c,totalPages:l,loadQueue:u,removeJob:f,clearCompleted:p,clearErrors:m,clearAll:h,handleFilterChange:g,nextPage:_,prevPage:v,dialogState:y}=ne();return(0,H.jsxs)(w,{title:`Tagger Status`,children:[(0,H.jsx)(te,{summary:t,connected:o}),(0,H.jsx)($,{statusFilter:s,onFilterChange:g,loading:r,actionLoading:a,summary:t,onRefresh:u,onClearCompleted:p,onClearErrors:m,onClearAll:h}),r&&(0,H.jsx)(d,{textAlign:`center`,py:5,color:`text.secondary`,children:`Loading tagger status...`}),i&&(0,H.jsx)(b,{children:i}),!r&&!i&&(0,H.jsx)(ee,{jobs:e,total:n,currentPage:c,totalPages:l,onRemoveJob:f,onNextPage:_,onPrevPage:v,statusFilter:s}),(0,H.jsx)(D,{open:y.isOpen,title:y.options.title,message:y.options.message,confirmLabel:y.options.confirmLabel,cancelLabel:y.options.cancelLabel,severity:y.options.severity,onConfirm:y.handleConfirm,onCancel:y.handleCancel})]})}export{re as TaggerStatusPage};