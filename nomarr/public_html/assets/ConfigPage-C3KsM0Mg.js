import{t as e}from"./Stack-B65G-2W0.js";import{a as t,c as n,l as r,n as i,o as a,s as o,t as s}from"./TextField-BzikLwEx.js";import{n as c}from"./useSlotProps-CB3aTem6.js";import{t as l}from"./Tooltip-jSayCkWx.js";import{t as u}from"./Chip-BlysArp3.js";import{t as d}from"./MenuItem-B6TTKVgQ.js";import{At as f,Ft as p,Gt as m,H as h,J as g,Kt as _,Mt as v,Ot as y,Pt as b,Rt as x,V as S,Wt as C,Y as w,Yt as T,a as E,an as D,at as O,d as k,dt as A,g as j,h as ee,in as M,kt as N,lt as P,m as te,mt as F,nt as I,o as L,p as ne,st as R,tt as z,u as re,ut as B,z as ie}from"./index-C-W2loPz.js";import{t as ae}from"./useConfirmDialog-DCMdHl76.js";import{t as oe}from"./ServerFilePicker-BYgOwVv8.js";import{t as se}from"./useNotification-DVBm8Skm.js";function ce(e){return m(`PrivateSwitchBase`,e)}C(`PrivateSwitchBase`,[`root`,`checked`,`disabled`,`input`,`edgeStart`,`edgeEnd`]);var V=D(M()),H=D(T()),U=e=>{let{classes:t,checked:n,disabled:r,edge:i}=e;return x({root:[`root`,n&&`checked`,r&&`disabled`,i&&`edge${f(i)}`],input:[`input`]},ce,t)},W=b(A,{name:`MuiSwitchBase`})({padding:9,borderRadius:`50%`,variants:[{props:{edge:`start`,size:`small`},style:{marginLeft:-3}},{props:({edge:e,ownerState:t})=>e===`start`&&t.size!==`small`,style:{marginLeft:-12}},{props:{edge:`end`,size:`small`},style:{marginRight:-3}},{props:({edge:e,ownerState:t})=>e===`end`&&t.size!==`small`,style:{marginRight:-12}}]}),G=b(`input`,{name:`MuiSwitchBase`,shouldForwardProp:p})({cursor:`inherit`,position:`absolute`,opacity:0,width:`100%`,height:`100%`,top:0,left:0,margin:0,padding:0,zIndex:1}),K=V.forwardRef(function(e,t){let{autoFocus:n,checked:r,checkedIcon:i,defaultChecked:a,disabled:s,disableFocusRipple:l=!1,edge:u=!1,icon:d,id:f,inputProps:p,inputRef:m,name:h,onBlur:g,onChange:_,onFocus:v,readOnly:y,required:b=!1,tabIndex:x,type:S,value:C,slots:w={},slotProps:T={},...E}=e,[D,O]=c({controlled:r,default:!!a,name:`SwitchBase`,state:`checked`}),k=o(),A=e=>{v&&v(e),k&&k.onFocus&&k.onFocus(e)},j=e=>{g&&g(e),k&&k.onBlur&&k.onBlur(e)},ee=e=>{if(e.nativeEvent.defaultPrevented)return;let t=e.target.checked;O(t),_&&_(e,t)},M=s;k&&M===void 0&&(M=k.disabled);let N=S===`checkbox`||S===`radio`,P={...e,checked:D,disabled:M,disableFocusRipple:l,edge:u},te=U(P),I={slots:w,slotProps:{input:p,...T}},[L,ne]=F(`root`,{ref:t,elementType:W,className:te.root,shouldForwardComponentProp:!0,externalForwardedProps:{...I,component:`span`,...E},getSlotProps:e=>({...e,onFocus:t=>{e.onFocus?.(t),A(t)},onBlur:t=>{e.onBlur?.(t),j(t)}}),ownerState:P,additionalProps:{centerRipple:!0,focusRipple:!l,disabled:M,role:void 0,tabIndex:null}}),[R,z]=F(`input`,{ref:m,elementType:G,className:te.input,externalForwardedProps:I,getSlotProps:e=>({...e,onChange:t=>{e.onChange?.(t),ee(t)}}),ownerState:P,additionalProps:{autoFocus:n,checked:r,defaultChecked:a,disabled:M,id:N?f:void 0,name:h,readOnly:y,required:b,tabIndex:x,type:S,...S===`checkbox`&&C===void 0?{}:{value:C}}});return(0,H.jsxs)(L,{...ne,children:[(0,H.jsx)(R,{...z}),D?i:d]})}),q=y((0,H.jsx)(`path`,{d:`M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z`}),`CheckBoxOutlineBlank`),J=y((0,H.jsx)(`path`,{d:`M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z`}),`CheckBox`),le=y((0,H.jsx)(`path`,{d:`M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z`}),`IndeterminateCheckBox`);function Y(e){return m(`MuiCheckbox`,e)}var ue=C(`MuiCheckbox`,[`root`,`checked`,`disabled`,`indeterminate`,`colorPrimary`,`colorSecondary`,`sizeSmall`,`sizeMedium`]),X=e=>{let{classes:t,indeterminate:n,color:r,size:i}=e,a=x({root:[`root`,n&&`indeterminate`,`color${f(r)}`,`size${f(i)}`]},Y,t);return{...t,...a}},Z=b(K,{shouldForwardProp:e=>p(e)||e===`classes`,name:`MuiCheckbox`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${f(n.size)}`],n.color!==`default`&&t[`color${f(n.color)}`]]}})(N(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:`default`,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(B()).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(B()).map(([t])=>({props:{color:t},style:{[`&.${ue.checked}, &.${ue.indeterminate}`]:{color:(e.vars||e).palette[t].main},[`&.${ue.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:`transparent`}}}}]}))),de=(0,H.jsx)(J,{}),fe=(0,H.jsx)(q,{}),pe=(0,H.jsx)(le,{}),me=V.forwardRef(function(e,t){let n=v({props:e,name:`MuiCheckbox`}),{checkedIcon:i=de,color:a=`primary`,icon:o=fe,indeterminate:s=!1,indeterminateIcon:c=pe,inputProps:l,size:u=`medium`,disableRipple:d=!1,className:f,slots:p={},slotProps:m={},...h}=n,g=s?c:o,y=s?c:i,b={...n,disableRipple:d,color:a,indeterminate:s,size:u},x=X(b),S=m.input??l,[C,w]=F(`root`,{ref:t,elementType:Z,className:_(x.root,f),shouldForwardComponentProp:!0,externalForwardedProps:{slots:p,slotProps:m,...h},ownerState:b,additionalProps:{type:`checkbox`,icon:V.cloneElement(g,{fontSize:g.props.fontSize??u}),checkedIcon:V.cloneElement(y,{fontSize:y.props.fontSize??u}),disableRipple:d,slots:p,slotProps:{input:r(typeof S==`function`?S(b):S,{"data-indeterminate":s})}}});return(0,H.jsx)(C,{...w,classes:x})});function he(e){return m(`MuiFormControlLabel`,e)}var Q=C(`MuiFormControlLabel`,[`root`,`labelPlacementStart`,`labelPlacementTop`,`labelPlacementBottom`,`disabled`,`label`,`error`,`required`,`asterisk`]),ge=e=>{let{classes:t,disabled:n,labelPlacement:r,error:i,required:a}=e;return x({root:[`root`,n&&`disabled`,`labelPlacement${f(r)}`,i&&`error`,a&&`required`],label:[`label`,n&&`disabled`],asterisk:[`asterisk`,i&&`error`]},he,t)};const _e=b(`label`,{name:`MuiFormControlLabel`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${Q.label}`]:t.label},t.root,t[`labelPlacement${f(n.labelPlacement)}`]]}})(N(({theme:e})=>({display:`inline-flex`,alignItems:`center`,cursor:`pointer`,verticalAlign:`middle`,WebkitTapHighlightColor:`transparent`,marginLeft:-11,marginRight:16,[`&.${Q.disabled}`]:{cursor:`default`},[`& .${Q.label}`]:{[`&.${Q.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:`start`},style:{flexDirection:`row-reverse`,marginRight:-11}},{props:{labelPlacement:`top`},style:{flexDirection:`column-reverse`}},{props:{labelPlacement:`bottom`},style:{flexDirection:`column`}},{props:({labelPlacement:e})=>e===`start`||e===`top`||e===`bottom`,style:{marginLeft:16}}]})));var ve=b(`span`,{name:`MuiFormControlLabel`,slot:`Asterisk`})(N(({theme:e})=>({[`&.${Q.error}`]:{color:(e.vars||e).palette.error.main}}))),ye=V.forwardRef(function(e,t){let r=v({props:e,name:`MuiFormControlLabel`}),{checked:i,className:a,componentsProps:s={},control:c,disabled:l,disableTypography:u,inputRef:d,label:f,labelPlacement:p=`end`,name:m,onChange:h,required:g,slots:y={},slotProps:b={},value:x,...S}=r,C=o(),w=l??c.props.disabled??C?.disabled,T=g??c.props.required,E={disabled:w,required:T};[`checked`,`name`,`onChange`,`value`,`inputRef`].forEach(e=>{c.props[e]===void 0&&r[e]!==void 0&&(E[e]=r[e])});let D=n({props:r,muiFormControl:C,states:[`error`]}),k={...r,disabled:w,labelPlacement:p,required:T,error:D.error},A=ge(k),[j,ee]=F(`typography`,{elementType:O,externalForwardedProps:{slots:y,slotProps:{...s,...b}},ownerState:k}),M=f;return M!=null&&M.type!==O&&!u&&(M=(0,H.jsx)(j,{component:`span`,...ee,className:_(A.label,ee?.className),children:M})),(0,H.jsxs)(_e,{className:_(A.root,a),ownerState:k,ref:t,...S,children:[V.cloneElement(c,E),T?(0,H.jsxs)(`div`,{children:[M,(0,H.jsxs)(ve,{ownerState:k,"aria-hidden":!0,className:A.asterisk,children:[` `,`*`]})]}):M]})});function be(){let{showSuccess:n}=se(),{confirm:r,isOpen:o,options:c,handleConfirm:f,handleCancel:p}=ae(),[m,h]=(0,V.useState)([]),[_,v]=(0,V.useState)(!0),[y,b]=(0,V.useState)(null),[x,C]=(0,V.useState)(!1),[T,D]=(0,V.useState)(null),[A,M]=(0,V.useState)(null),[N,P]=(0,V.useState)(null),[F,L]=(0,V.useState)(``),[R,B]=(0,V.useState)(``),[ce,U]=(0,V.useState)(!0),[W,G]=(0,V.useState)(!1),[K,q]=(0,V.useState)(`off`),[J,le]=(0,V.useState)(!1),Y=async()=>{try{v(!0),b(null),h(await ne())}catch(e){b(e instanceof Error?e.message:`Failed to load libraries`),console.error(`[LibraryManagement] Load error:`,e)}finally{v(!1)}},ue=async()=>{try{P((await E()).library_root||null)}catch(e){console.error(`[LibraryManagement] Failed to load config:`,e)}};(0,V.useEffect)(()=>{Y(),ue()},[]),(0,V.useEffect)(()=>{if(!m.some(e=>e.scanStatus===`scanning`))return;let e=setInterval(()=>{Y()},1e3);return()=>clearInterval(e)},[m]);let X=e=>{if(!N)return!1;let t=N.replace(/\/+$/,``);return!e.replace(/\/+$/,``).startsWith(t)},Z=()=>{L(``),B(``),U(!0),G(!1),q(`off`),le(!1),C(!1),D(null)},de=()=>{Z(),C(!0)},fe=e=>{L(e.name),B(e.rootPath),U(e.isEnabled),G(e.isDefault),q(e.watchMode),D(e.id),C(!1)},pe=async()=>{if(!R.trim()){b(`Path is required`);return}try{b(null),await re({name:F.trim()||null,rootPath:R,isEnabled:ce,isDefault:W,watchMode:K}),await Y(),Z()}catch(e){b(e instanceof Error?e.message:`Failed to create library`)}},he=async()=>{if(T!==null){if(!R.trim()){b(`Path is required`);return}try{b(null),await j(T,{name:F.trim()||void 0,rootPath:R,isEnabled:ce,isDefault:W,watchMode:K}),await Y(),Z()}catch(e){b(e instanceof Error?e.message:`Failed to update library`)}}},Q=async e=>{try{b(null),await ee(e),await Y()}catch(e){b(e instanceof Error?e.message:`Failed to set default library`)}},ge=async(e,t)=>{try{b(null),M(e);let r=await te(e,t);n(r.message||`Library scan started (${r.stats?.files_queued??0} files)`),await Y()}catch(e){b(e instanceof Error?e.message:`Failed to scan library`)}finally{M(null)}},_e=async(e,t,n)=>{if(n){b(`Cannot delete the default library. Set another library as default first.`);return}if(await r({title:`Delete Library?`,message:`Delete library "${t}"?\n\nThis will remove the library entry but will NOT delete files on disk.`,severity:`warning`}))try{b(null),await k(e),await Y()}catch(e){b(e instanceof Error?e.message:`Failed to delete library`)}},ve=async(e,t)=>{try{b(null),await j(e,{watchMode:t}),await Y(),n(`File watching mode changed to ${t}`)}catch(e){b(e instanceof Error?e.message:`Failed to change watch mode`)}},be=e=>{switch(e){case`event`:return`Event`;case`poll`:return`Poll`;default:return`Off`}},xe=e=>{switch(e){case`event`:return`success`;case`poll`:return`warning`;default:return`default`}},$=x||T!==null;return(0,H.jsxs)(e,{spacing:2.5,children:[(0,H.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`center`,children:[(0,H.jsx)(O,{variant:`h5`,children:`Libraries`}),!$&&(0,H.jsx)(z,{variant:`contained`,onClick:de,children:`+ Add Library`})]}),y&&(0,H.jsx)(S,{children:y}),$&&(0,H.jsxs)(w,{children:[(0,H.jsx)(g,{title:x?`Create Library`:`Edit Library`}),(0,H.jsxs)(e,{spacing:2,children:[(0,H.jsxs)(I,{children:[(0,H.jsx)(O,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Name (optional)`}),(0,H.jsx)(s,{value:F,onChange:e=>L(e.target.value),placeholder:`Auto-generated from path if left empty`,fullWidth:!0})]}),(0,H.jsxs)(I,{children:[(0,H.jsx)(O,{variant:`body2`,color:`text.secondary`,sx:{mb:.5},children:`Root Path`}),(0,H.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,H.jsx)(s,{value:R,onChange:e=>B(e.target.value),placeholder:`/music`,fullWidth:!0}),(0,H.jsx)(z,{variant:`outlined`,onClick:()=>le(!J),sx:{minWidth:120},children:J?`Hide Picker`:`Browse...`})]}),J&&(0,H.jsx)(I,{sx:{mt:1.25,p:2,bgcolor:`background.default`,borderRadius:1,border:1,borderColor:`divider`},children:(0,H.jsx)(oe,{value:R,onChange:e=>{B(e),le(!1)},mode:`directory`,label:`Select Library Root Directory`})})]}),(0,H.jsx)(ye,{control:(0,H.jsx)(me,{checked:ce,onChange:e=>U(e.target.checked)}),label:`Enabled`}),(0,H.jsx)(ye,{control:(0,H.jsx)(me,{checked:W,onChange:e=>G(e.target.checked)}),label:`Default Library`}),(0,H.jsx)(I,{children:(0,H.jsxs)(a,{fullWidth:!0,children:[(0,H.jsx)(t,{id:`watch-mode-label`,children:`File Watching`}),(0,H.jsxs)(i,{labelId:`watch-mode-label`,value:K,label:`File Watching`,onChange:e=>q(e.target.value),children:[(0,H.jsx)(d,{value:`off`,children:(0,H.jsxs)(e,{children:[(0,H.jsxs)(O,{children:[(0,H.jsx)(`strong`,{children:`Off`}),` - No automatic scanning`]}),(0,H.jsx)(O,{variant:`caption`,color:`text.secondary`,children:`Manual scans only`})]})}),(0,H.jsx)(d,{value:`event`,children:(0,H.jsxs)(e,{children:[(0,H.jsxs)(O,{children:[(0,H.jsx)(`strong`,{children:`Event`}),` - Real-time file watching`]}),(0,H.jsx)(O,{variant:`caption`,color:`text.secondary`,children:`Fast (2-5s response), local filesystems only`})]})}),(0,H.jsx)(d,{value:`poll`,children:(0,H.jsxs)(e,{children:[(0,H.jsxs)(O,{children:[(0,H.jsx)(`strong`,{children:`Poll`}),` - Periodic scanning`]}),(0,H.jsx)(O,{variant:`caption`,color:`text.secondary`,children:`Slower (60s interval), network-mount-safe`})]})})]})]})}),(0,H.jsxs)(e,{direction:`row`,spacing:1.25,children:[(0,H.jsx)(z,{variant:`contained`,onClick:x?pe:he,children:x?`Create`:`Update`}),(0,H.jsx)(z,{variant:`outlined`,onClick:Z,children:`Cancel`})]})]})]}),_&&(0,H.jsx)(O,{children:`Loading libraries...`}),!_&&!$&&m.length===0&&(0,H.jsx)(w,{children:(0,H.jsx)(O,{color:`text.secondary`,textAlign:`center`,fontStyle:`italic`,children:`No libraries configured. Click "Add Library" to get started.`})}),!_&&!$&&m.length>0&&(0,H.jsx)(e,{spacing:2,children:m.map(t=>(0,H.jsxs)(w,{children:[(0,H.jsxs)(e,{direction:`row`,justifyContent:`space-between`,alignItems:`flex-start`,sx:{mb:2},children:[(0,H.jsxs)(I,{children:[(0,H.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1.25,sx:{mb:.5},children:[(0,H.jsx)(O,{variant:`h6`,children:t.name}),t.isDefault&&(0,H.jsx)(u,{label:`Default`,color:`primary`,size:`small`}),X(t.rootPath)&&(0,H.jsx)(u,{label:`Outside library_root`,color:`warning`,size:`small`})]}),(0,H.jsx)(O,{variant:`body2`,color:`text.secondary`,sx:{fontFamily:`monospace`},children:t.rootPath}),(0,H.jsxs)(e,{direction:`row`,spacing:2,sx:{mt:.5},children:[(0,H.jsxs)(O,{variant:`body2`,color:`text.secondary`,children:[(0,H.jsx)(`strong`,{children:t.fileCount.toLocaleString()}),` files`]}),(0,H.jsxs)(O,{variant:`body2`,color:`text.secondary`,children:[(0,H.jsx)(`strong`,{children:t.folderCount.toLocaleString()}),` folders`]})]}),t.scanStatus===`scanning`&&(0,H.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:.5},children:[(0,H.jsx)(u,{label:`Scanning...`,color:`info`,size:`small`,sx:{animation:`pulse 1.5s infinite`}}),t.scanProgress!=null&&t.scanTotal!=null&&t.scanTotal>0&&(0,H.jsxs)(O,{variant:`body2`,color:`info.main`,children:[t.scanProgress.toLocaleString(),` / `,t.scanTotal.toLocaleString(),` files`,` `,`(`,Math.round(t.scanProgress/t.scanTotal*100),`%)`]})]}),t.scanStatus===`error`&&t.scanError&&(0,H.jsxs)(O,{variant:`caption`,color:`error.main`,sx:{mt:.5},children:[`⚠ Scan error: `,t.scanError]}),X(t.rootPath)&&(0,H.jsxs)(O,{variant:`caption`,color:`warning.main`,sx:{mt:.5},children:[`⚠ This library is outside the configured library_root (`,N,`)`]}),(0,H.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,sx:{mt:1},children:[(0,H.jsx)(O,{variant:`caption`,color:`text.secondary`,children:`File Watching:`}),(0,H.jsx)(a,{size:`small`,sx:{minWidth:120},children:(0,H.jsxs)(i,{value:t.watchMode,onChange:e=>ve(t.id,e.target.value),size:`small`,sx:{fontSize:`0.75rem`},disabled:A===t.id,children:[(0,H.jsx)(d,{value:`off`,children:`Off`}),(0,H.jsx)(d,{value:`event`,children:`Event`}),(0,H.jsx)(d,{value:`poll`,children:`Poll`})]})}),(0,H.jsx)(l,{title:t.watchMode===`event`?`Real-time file watching (local filesystems)`:t.watchMode===`poll`?`Periodic scanning (network-mount-safe)`:`No automatic file watching`,children:(0,H.jsx)(u,{label:be(t.watchMode),color:xe(t.watchMode),size:`small`})})]})]}),(0,H.jsxs)(e,{direction:`row`,alignItems:`center`,spacing:1,children:[(0,H.jsx)(I,{sx:{width:8,height:8,borderRadius:`50%`,bgcolor:t.isEnabled?`success.main`:`text.disabled`}}),(0,H.jsx)(O,{variant:`body2`,color:`text.secondary`,children:t.isEnabled?`Enabled`:`Disabled`})]})]}),(0,H.jsxs)(e,{direction:`row`,spacing:1.25,flexWrap:`wrap`,children:[(0,H.jsx)(z,{variant:`outlined`,size:`small`,onClick:()=>fe(t),disabled:A===t.id,children:`Edit`}),!t.isDefault&&(0,H.jsx)(z,{variant:`outlined`,size:`small`,onClick:()=>Q(t.id),disabled:A===t.id,children:`Set Default`}),(0,H.jsx)(z,{variant:`outlined`,color:`success`,size:`small`,onClick:()=>ge(t.id,`quick`),disabled:!t.isEnabled||A===t.id||t.scanStatus===`scanning`||X(t.rootPath)||!t.scannedAt,title:t.scannedAt?t.scanStatus===`scanning`?`Scan already in progress`:X(t.rootPath)?`Cannot scan: library is outside library_root`:`Scan only new and modified files`:`Run a Full Scan first before using Quick Scan`,children:A===t.id||t.scanStatus===`scanning`?`Scanning...`:`Quick Scan`}),(0,H.jsx)(z,{variant:`contained`,color:`success`,size:`small`,onClick:()=>ge(t.id,`full`),disabled:!t.isEnabled||A===t.id||t.scanStatus===`scanning`||X(t.rootPath),title:t.scanStatus===`scanning`?`Scan already in progress`:X(t.rootPath)?`Cannot scan: library is outside library_root`:`Rescan all files in the library`,children:A===t.id||t.scanStatus===`scanning`?`Scanning...`:`Full Scan`}),(0,H.jsx)(z,{variant:`contained`,color:`error`,size:`small`,onClick:()=>_e(t.id,t.name,t.isDefault),disabled:A===t.id,children:`Delete`})]})]},t.id))}),(0,H.jsx)(ie,{open:o,title:c.title,message:c.message,confirmLabel:c.confirmLabel,cancelLabel:c.cancelLabel,severity:c.severity,onConfirm:f,onCancel:p})]})}var xe={file_write_mode:{label:`Tag Writing Mode`,description:`Controls which tags are written to audio files`,type:`select`,options:[{value:`none`,label:`None - Tags stored in database only`},{value:`minimal`,label:`Minimal - Essential tags only (artist, album, title, genre)`},{value:`full`,label:`Full - All generated tags written to files`}]},overwrite_tags:{label:`Overwrite Existing Tags`,description:`Whether to overwrite existing tags in audio files`,type:`boolean`},library_auto_tag:{label:`Auto-Tag New Files`,description:`Automatically process new files found during library scans`,type:`boolean`},library_ignore_patterns:{label:`Ignore Patterns`,description:`Comma-separated patterns to ignore during scanning (e.g., */Audiobooks/*,*.tmp)`,type:`text`},tagger_worker_count:{label:`Worker Threads`,description:`Number of parallel worker processes for tagging (0 = auto-detect)`,type:`text`},cache_idle_timeout:{label:`Cache Timeout (seconds)`,description:`How long to keep ML models in memory when idle`,type:`text`},calibrate_heads:{label:`Auto-Calibrate Heads`,description:`Automatically calibrate tag thresholds for optimal results`,type:`boolean`},calibration_repo:{label:`Calibration Repository`,description:`Git repository URL for calibration data downloads`,type:`text`}};function $({configKey:e,value:t,onChange:n,disabled:r}){let a=t==null?``:String(t),o=xe[e],c=o?.label||e,l=o?.description,u=o?.type||(typeof t==`boolean`?`boolean`:`text`),f=o?.options||[];return(0,H.jsxs)(I,{sx:{display:`flex`,gap:2,alignItems:`flex-start`,py:1},children:[(0,H.jsxs)(I,{sx:{minWidth:`280px`,flexShrink:0},children:[(0,H.jsx)(O,{variant:`body2`,color:`text.primary`,sx:{fontWeight:500,mb:l?.5:0},children:c}),l&&(0,H.jsx)(O,{variant:`caption`,color:`text.secondary`,sx:{display:`block`},children:l})]}),(0,H.jsx)(I,{sx:{flex:1,maxWidth:`400px`},children:(()=>u===`select`&&f.length>0?(0,H.jsx)(i,{value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0,children:f.map(({value:e,label:t})=>(0,H.jsx)(d,{value:e,children:t},e))}):u===`boolean`?(0,H.jsxs)(i,{value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0,children:[(0,H.jsx)(d,{value:`true`,children:`true`}),(0,H.jsx)(d,{value:`false`,children:`false`})]}):(0,H.jsx)(s,{type:`text`,value:a,onChange:t=>n(e,t.target.value),disabled:r,size:`small`,fullWidth:!0,placeholder:l}))()})]})}function Se({config:t,hasChanges:n,saveLoading:r,onChange:i,onSaveAll:a}){return(0,H.jsxs)(w,{children:[(0,H.jsx)(g,{title:`Settings`}),(0,H.jsx)(O,{variant:`body2`,color:`text.secondary`,sx:{mb:2.5},children:`Changes are saved to the database and will take effect on server restart. Use "Restart Server" in Admin page to apply changes.`}),(0,H.jsx)(e,{spacing:1.875,children:Object.entries(t).map(([e,t])=>(0,H.jsx)($,{configKey:e,value:t,onChange:i,disabled:r},e))}),(0,H.jsxs)(I,{sx:{mt:3.75,display:`flex`,gap:1.25,alignItems:`center`},children:[(0,H.jsx)(z,{onClick:a,variant:`contained`,disabled:!n||r,sx:{whiteSpace:`nowrap`},children:r?`Saving...`:`Save All Changes`}),n&&(0,H.jsx)(O,{variant:`body2`,color:`warning.main`,children:`Unsaved changes`})]})]})}function Ce(){let{showSuccess:e,showError:t,showInfo:n}=se(),[r,i]=(0,V.useState)({}),[a,o]=(0,V.useState)({}),[s,c]=(0,V.useState)(!0),[l,u]=(0,V.useState)(null),[d,f]=(0,V.useState)(!1),[p,m]=(0,V.useState)(!1),h=async()=>{try{c(!0),u(null);let e=await E();i(e),o(e),m(!1)}catch(e){u(e instanceof Error?e.message:`Failed to load config`),console.error(`[Config] Load error:`,e)}finally{c(!1)}};return(0,V.useEffect)(()=>{h()},[]),(0,V.useEffect)(()=>{m(Object.keys(r).some(e=>r[e]!==a[e]))},[r,a]),{config:r,loading:s,error:l,saveLoading:d,hasChanges:p,handleSaveAll:async()=>{try{f(!0);let t=[];for(let e of Object.keys(r))if(r[e]!==a[e]){let n=r[e];if(n==null||n===``)continue;await L(e,String(n)),t.push(e)}if(t.length===0){n(`No changes to save`);return}e(`Saved ${t.length} config change(s). Use "Restart Server" in Admin page to apply.`),await h()}catch(e){t(e instanceof Error?e.message:`Failed to save config`)}finally{f(!1)}},handleChange:(e,t)=>{i(n=>({...n,[e]:t}))}}}function we(){let{config:t,loading:n,error:r,saveLoading:i,hasChanges:a,handleSaveAll:o,handleChange:s}=Ce();return(0,H.jsxs)(h,{title:`Configuration`,children:[n&&(0,H.jsx)(P,{}),r&&(0,H.jsxs)(R,{severity:`error`,children:[`Error: `,r]}),!n&&!r&&(0,H.jsxs)(e,{spacing:2.5,children:[(0,H.jsx)(be,{}),(0,H.jsx)(Se,{config:t,hasChanges:a,saveLoading:i,onChange:s,onSaveAll:o})]})]})}export{we as ConfigPage};